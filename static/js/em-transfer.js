!function(){var e=function(){},t=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},a=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},n=function(n){var s=n.dataType||"text",i=n.success||e,r=n.error||e,o=t()||a();o.onreadystatechange=function(){if(4===o.readyState){var e=o.status||0;if(200===e){if("text"===s)return void i(o.responseText,o);if("json"===s){try{var t=JSON.parse(o.responseText);i(t,o)}catch(a){}return}return void i(o.response||o.responseText,o)}if("json"==s){try{var t=Utils.parseJSON(o.responseText);r(t,o,"服务器返回错误信息")}catch(a){r(o.responseText,o,"服务器返回错误信息")}return}return void r(o.responseText,o,"服务器返回错误信息")}0===o.readyState&&r(o.responseText,o,"服务器异常")};var m=n.type||"GET",d=n.data||{},u="";if("get"===m.toLowerCase()){for(var c in d)d.hasOwnProperty(c)&&(u+=c+"="+d[c]+"&");u=u?u.slice(0,-1):u,n.url+=(n.url.indexOf("?")>0?"&":"?")+(u?u+"&":u)+"_v="+(new Date).getTime(),d=null}else d._v=(new Date).getTime(),d=JSON.stringify(d);return o.open(m,n.url),o.setRequestHeader("Content-Type","application/json"),o.send(d),o};window.easemobim=window.easemobim||{},window.easemobim.emajax=n}(),window.easemobim=window.easemobim||{},window.easemobIM=window.easemobIM||{},easemobIM.Transfer=easemobim.Transfer=function(){"use strict";var e=function(e,t){if(JSON&&JSON.parse){var a=e.data;a=JSON.parse(a),"function"==typeof t&&t(a)}},t=function(e){return this instanceof t?(this.iframe=document.getElementById(e),void(this.origin=location.protocol+"//"+location.host)):new t(e)};return t.prototype.send=function(e){return e.origin=this.origin,e=JSON.stringify(e),this.iframe?this.iframe.contentWindow.postMessage(e,"*"):window.parent.postMessage(e,"*"),this},t.prototype.listen=function(t){var a=this;return window.addEventListener?window.addEventListener("message",function(n){e.call(a,n,t)},!1):window.attachEvent&&window.attachEvent("onmessage",function(n){e.call(a,n,t)}),this},t}(),function(){var e=new easemobim.Transfer,t=function(t){return{url:t.url,data:t.excludeData?null:t.msg.data,type:t.type||"GET",success:function(a){try{a=JSON.parse(a)}catch(n){}e.send({call:t.msg.api,timespan:t.msg.timespan,status:0,data:a})},error:function(a){try{a=JSON.parse(a)}catch(n){}e.send({call:t.msg.api,status:1,data:a})}}};e.listen(function(a){if(a&&a.user&&a.tenantId)try{easemobim.isMobile&&easemobim.utils.set("emconfig"+a.tenantId+a.ukey,JSON.stringify(a))}catch(n){}else switch(e.targetOrigin=a.origin,a.api){case"getRelevanceList":easemobim.emajax(t({url:"/v1/webimplugin/targetChannels",msg:a}));break;case"getDutyStatus":easemobim.emajax(t({url:"/v1/webimplugin/showMessage",msg:a}));break;case"createVisitor":easemobim.emajax(t({url:"/v1/webimplugin/visitors?tenantId="+a.data.tenantId,msg:a,type:"POST"}));break;case"getSession":easemobim.emajax(t({url:"/v1/webimplugin/visitors/"+a.data.id+"/schedule-data?techChannelInfo="+a.data.orgName+"%23"+a.data.appName+"%23"+a.data.imServiceNumber+"&tenantId="+a.data.tenantId,msg:a,excludeData:!0}));break;case"getExSession":easemobim.emajax(t({url:"/v1/webimplugin/visitors/"+a.data.id+"/schedule-data-ex?techChannelInfo="+a.data.orgName+"%23"+a.data.appName+"%23"+a.data.imServiceNumber+"&tenantId="+a.data.tenantId,msg:a,excludeData:!0}));break;case"getPassword":easemobim.emajax(t({url:"/v1/webimplugin/visitors/password?tenantId="+a.data.tenantId,msg:a}));break;case"getGroup":easemobim.emajax(t({url:"/v1/webimplugin/visitors/"+a.data.id+"/ChatGroupId?techChannelInfo="+a.data.orgName+"%23"+a.data.appName+"%23"+a.data.imServiceNumber+"&tenantId="+a.data.tenantId,msg:a,excludeData:!0}));break;case"getHistory":easemobim.emajax(t({url:"/v1/webimplugin/visitors/msgHistory",msg:a}));break;case"getSlogan":easemobim.emajax(t({url:"/v1/webimplugin/notice/options",msg:a}));break;case"getTheme":easemobim.emajax(t({url:"/v1/webimplugin/theme/options",msg:a}));break;case"getSystemGreeting":easemobim.emajax(t({url:"/v1/webimplugin/welcome",msg:a}));break;case"getRobertGreeting":easemobim.emajax(t({url:"/v1/Tenants/"+a.data.tenantId+"/robots/visitor/greetings",msg:a}));break;case"sendVisitorInfo":easemobim.emajax(t({url:"/v1/webimplugin/tenants/"+a.data.tenantId+"/visitors/"+a.data.visitorId+"/attributes?tenantId="+a.data.tenantId,msg:a,type:"POST"}))}})}();