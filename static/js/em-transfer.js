!function(){var e=function(){},a=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},t=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},s=function(s){var n,i=s.dataType||"text",r=s.success||e,m=s.error||e,o=a()||t(),d=s.type||"GET",u=s.data||{},c="",g=s.headers||{},l=s.isFileUpload;if(o.onreadystatechange=function(){var e;if(4===o.readyState){var a=o.status||0;if(200===a){if("text"===i)return void r(o.responseText,o);if("json"===i){try{e=JSON.parse(o.responseText),r(e,o)}catch(t){}return}return void r(o.response||o.responseText,o)}if("json"==i){try{e=JSON.parse(o.responseText),m(e,o,"服务器返回错误信息")}catch(t){m(o.responseText,o,"服务器返回错误信息")}return}return void m(o.responseText,o,"服务器返回错误信息")}0===o.readyState&&m(o.responseText,o,"服务器异常")},"get"===d.toLowerCase()){for(var p in u)u.hasOwnProperty(p)&&(c+=p+"="+u[p]+"&");c=c?c.slice(0,-1):c,s.url+=(s.url.indexOf("?")>0?"&":"?")+(c?c+"&":c)+"_v="+(new Date).getTime(),u=null}else{if(l){var b=new FormData;return b.append("file",u.file),o.open("POST",s.url),o.setRequestHeader("Authorization",u.auth),o.send(b),o}u._v=(new Date).getTime(),u=JSON.stringify(u)}if(o.open(d,s.url),o.setRequestHeader){g["Content-Type"]=g["Content-Type"]||"application/json";for(n in g)g.hasOwnProperty(n)&&o.setRequestHeader(n,g[n])}return o.send(u),o};window.easemobim=window.easemobim||{},window.easemobim.emajax=s}(),window.easemobim=window.easemobim||{},window.easemobIM=window.easemobIM||{},easemobIM.Transfer=easemobim.Transfer=function(){"use strict";var e=function(){var e=!0;try{window.postMessage({toString:function(){e=!1}},"*")}catch(a){}return e}(),a=function(e,a,t){var s,n,i,r=!1,m=e.data;if("object"==typeof m)s=m;else if("string"==typeof m){try{s=JSON.parse(m)}catch(o){}if("object"!=typeof s)return}if(t&&t.length)for(n=0,i=t.length;i>n;n++)s.key===t[n]&&(r=!0,"function"==typeof a&&a(s));else"function"==typeof a&&a(s);if(!r&&t)for(n=0,i=t.length;i>n;n++)if("data"===t[n]){"function"==typeof a&&a(s);break}},t=function(e,a,s){return this instanceof t?(this.key=a,this.iframe=document.getElementById(e),this.origin=location.protocol+"//"+location.host,void(this.useObject=s)):new t(e)};return t.prototype.send=function(a,t){return a.origin=this.origin,a.key=this.key,t&&(a.to=t),e&&(this.useObject||a.useObject)||(a=JSON.stringify(a)),this.iframe?this.iframe.contentWindow.postMessage(a,"*"):window.parent.postMessage(a,"*"),this},t.prototype.listen=function(e,t){var s=this;return window.addEventListener?window.addEventListener("message",function(n){a.call(s,n,e,t)},!1):window.attachEvent&&window.attachEvent("onmessage",function(n){a.call(s,n,e,t)}),this},t}(),function(){var e=new easemobim.Transfer(null,"api"),a=function(a){var t=null,s=a.msg.useObject;return a.msg.data&&a.msg.data.headers&&(t=a.msg.data.headers,delete a.msg.data.headers),{url:a.url,headers:t,data:a.excludeData?null:a.msg.data,type:a.type||"GET",isFileUpload:a.isFileUpload,success:function(t){try{t=JSON.parse(t)}catch(n){}e.send({call:a.msg.api,timespan:a.msg.timespan,status:0,data:t,useObject:s})},error:function(t){try{t=JSON.parse(t)}catch(n){}e.send({call:a.msg.api,timespan:a.msg.timespan,status:1,data:t,useObject:s})}}};e.listen(function(t){switch(e.targetOrigin=t.origin,t.api){case"getRelevanceList":easemobim.emajax(a({url:"/v1/webimplugin/targetChannels",msg:t}));break;case"getDutyStatus":easemobim.emajax(a({url:"/v1/webimplugin/showMessage",msg:t}));break;case"getWechatVisitor":easemobim.emajax(a({url:"/v1/webimplugin/visitors/wechat/"+t.data.openid+"?tenantId="+t.data.tenantId,msg:t,type:"POST"}));break;case"createVisitor":easemobim.emajax(a({url:"/v1/webimplugin/visitors?tenantId="+t.data.tenantId,msg:t,type:"POST"}));break;case"getSession":easemobim.emajax(a({url:"/v1/webimplugin/visitors/"+t.data.id+"/schedule-data?techChannelInfo="+t.data.orgName+"%23"+t.data.appName+"%23"+t.data.imServiceNumber+"&tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"getExSession":easemobim.emajax(a({url:"/v1/webimplugin/visitors/"+t.data.id+"/schedule-data-ex?techChannelInfo="+t.data.orgName+"%23"+t.data.appName+"%23"+t.data.imServiceNumber+"&tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"getPassword":easemobim.emajax(a({url:"/v1/webimplugin/visitors/password",msg:t}));break;case"getGroup":easemobim.emajax(a({url:"/v1/webimplugin/visitors/"+t.data.id+"/ChatGroupId?techChannelInfo="+t.data.orgName+"%23"+t.data.appName+"%23"+t.data.imServiceNumber+"&tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"getGroupNew":easemobim.emajax(a({url:"/v1/webimplugin/tenant/"+t.data.tenantId+"/visitors/"+t.data.id+"/ChatGroupId?techChannelInfo="+t.data.orgName+"%23"+t.data.appName+"%23"+t.data.imServiceNumber+"&tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"getHistory":easemobim.emajax(a({url:"/v1/webimplugin/visitors/msgHistory",msg:t}));break;case"getSlogan":easemobim.emajax(a({url:"/v1/webimplugin/notice/options",msg:t}));break;case"getTheme":easemobim.emajax(a({url:"/v1/webimplugin/theme/options",msg:t}));break;case"getSystemGreeting":easemobim.emajax(a({url:"/v1/webimplugin/welcome",msg:t}));break;case"getRobertGreeting":easemobim.emajax(a({url:"/v1/Tenants/"+t.data.tenantId+"/robots/visitor/greetings/"+t.data.originType+"?tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"sendVisitorInfo":easemobim.emajax(a({url:"/v1/webimplugin/tenants/"+t.data.tenantId+"/visitors/"+t.data.visitorId+"/attributes?tenantId="+t.data.tenantId,msg:t,type:"POST"}));break;case"getProject":easemobim.emajax(a({url:"/tenants/"+t.data.tenantId+"/projects",msg:t}));break;case"createTicket":easemobim.emajax(a({url:"/tenants/"+t.data.tenantId+"/projects/"+t.data.projectId+"/tickets?tenantId="+t.data.tenantId+"&easemob-target-username="+t.data["easemob-target-username"]+"&easemob-appkey="+t.data["easemob-appkey"]+"&easemob-username="+t.data["easemob-username"],msg:t,type:"POST"}));break;case"receiveMsgChannel":easemobim.emajax(a({url:"/v1/imgateway/messages",msg:t}));break;case"sendMsgChannel":easemobim.emajax(a({url:"/v1/imgateway/messages?tenantId="+t.data.tenantId,msg:t,type:"POST"}));break;case"getAgentStatus":easemobim.emajax(a({url:"/v1/tenants/"+t.data.tenantId+"/agents/"+t.data.agentUserId+"/agentstate",msg:t}));break;case"getNickNameOption":easemobim.emajax(a({url:"/v1/webimplugin/agentnicename/options?tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"reportEvent":easemobim.emajax(a({url:"/v1/event_collector/events",msg:t,type:"POST"}));break;case"deleteEvent":easemobim.emajax(a({url:"/v1/event_collector/event/"+encodeURIComponent(t.data.userId),msg:t,type:"DELETE",excludeData:!0}));break;case"mediaStreamUpdateStatus":var s=t.data.streamId;delete t.data.streamId,easemobim.emajax(a({url:"/v1/rtcmedia/media_streams/"+s,msg:t,type:"PUT"}));break;case"graylist":easemobim.emajax(a({url:"/management/graylist",msg:t,excludeData:!0}));break;case"getCurrentServiceSession":easemobim.emajax(a({url:"/v1/webimplugin/tenant/"+t.data.tenantId+"/visitors/"+t.data.id+"/CurrentServiceSession?techChannelInfo="+t.data.orgName+"%23"+t.data.appName+"%23"+t.data.imServiceNumber+"&tenantId="+t.data.tenantId,msg:t,excludeData:!0}));break;case"messagePredict":var n=t.data.tenantId,i=t.data.agentId;delete t.data.tenantId,delete t.data.agentId,easemobim.emajax(a({url:"/v1/webimplugin/agents/"+i+"/messagePredict?tenantId="+n,msg:t,type:"POST"}));break;case"getSessionQueueId":var r=t.data.visitorUsername;easemobim.emajax(a({url:"/v1/visitors/"+r+"/waitings/sessions",msg:t,type:"GET"}));break;case"getWaitListNumber":easemobim.emajax(a({url:"/v1/visitors/waitings/data",msg:t,type:"GET"}));break;case"getDutyStatus_2":easemobim.emajax(a({url:"/v1/webimplugin/tenants/show-message",msg:t}));break;case"getRobertGreeting_2":easemobim.emajax(a({url:"/v1/webimplugin/tenants/robots/welcome",msg:t}));break;case"getAgentInputState":easemobim.emajax(a({url:"/v1/webimplugin/sessions/"+t.data.serviceSessionId+"/agent-input-state?tenantId="+t.data.tenantId+"&orgName="+t.data.orgName+"&appName="+t.data.appName+"&userName="+t.data.username+"&token="+t.data.token,msg:t,excludeData:!0}));break;case"closeServiceSession":var m=t.data.serviceSessionId;delete t.data.serviceSessionId,easemobim.emajax(a({url:"/webimplugin/tenants/"+t.data.tenantId+"/visitors/"+t.data.userName+"/servicesessions/"+m+"/stop?tenantId="+t.data.tenantId,msg:t,type:"POST"}));break;case"uploadImgMsgChannel":easemobim.emajax(a({url:"/v1/Tenant/"+t.data.tenantId+"/"+t.data.orgName+"/"+t.data.appName+"/"+t.data.userName+"/MediaFiles",msg:t,isFileUpload:!0,type:"POST"}))}},["data"])}();