window.easemobim=window.easemobim||{},window.easemobim.emajax=function(){var e=function(){},t=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},a=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}};return function(s){function n(){var e,t=c.status||0;if(4===c.readyState){if(200===t){if("text"===i)return void o(c.responseText,c);if("json"===i){try{e=JSON.parse(c.responseText),o(e,c)}catch(a){}return}return void o(c.response||c.responseText,c)}if("json"==i){try{e=JSON.parse(c.responseText),u(e,c,"服务器返回错误信息")}catch(a){u(c.responseText,c,"服务器返回错误信息")}return}return void u(c.responseText,c,"服务器返回错误信息")}0===c.readyState&&u(c.responseText,c,"服务器异常")}var r,i=s.dataType||"text",o=s.success||e,u=s.error||e,m=s.useXDomainRequestInIE,c=t()||a(),l=s.type||"GET",p=s.data||{},g="",d=s.headers||{},b=s.isFileUpload;if(m&&window.XDomainRequest)return c=new XDomainRequest,c.onload=function(){var e={};try{e=JSON.parse(c.responseText)}catch(t){}o(e,c)},c.ontimeout=function(){u(c.responseText,c,"XDomainRequest timeout.")},c.onerror=function(){u(c.responseText,c,"XDomainRequest error.")},c.open("POST",s.url),c.send(JSON.stringify(p)),c;if(c.onreadystatechange=n,"get"===l.toLowerCase()){for(var v in p)p.hasOwnProperty(v)&&(g+=v+"="+p[v]+"&");g=g?g.slice(0,-1):g,s.url+=(s.url.indexOf("?")>0?"&":"?")+(g?g+"&":g)+"_v="+(new Date).getTime()}else{if(b){var f=new FormData;return f.append("file",p.file),c.open("POST",s.url),c.setRequestHeader("Authorization",p.auth),c.send(f),c}p=JSON.stringify(p)}if(c.open(l,s.url),c.setRequestHeader){d["Content-Type"]=d["Content-Type"]||"application/json";for(r in d)d.hasOwnProperty(r)&&c.setRequestHeader(r,d[r])}return c.send(p),c}}(),window.easemobim=window.easemobim||{},window.easemobIM=window.easemobIM||{},easemobIM.Transfer=easemobim.Transfer=function(){"use strict";var e=function(){var e=!0;try{window.postMessage({toString:function(){e=!1}},"*")}catch(t){}return e}(),t=function(e,t,a){var s,n,r,i=!1,o=e.data;if("object"==typeof o)s=o;else if("string"==typeof o){try{s=JSON.parse(o)}catch(u){}if("object"!=typeof s)return}if(a&&a.length)for(n=0,r=a.length;r>n;n++)s.key===a[n]&&(i=!0,"function"==typeof t&&t(s));else"function"==typeof t&&t(s);if(!i&&a)for(n=0,r=a.length;r>n;n++)if("data"===a[n]){"function"==typeof t&&t(s);break}},a=function(e,t,s){return this instanceof a?(this.key=t,this.iframe=document.getElementById(e),this.origin=location.protocol+"//"+location.host,void(this.useObject=s)):new a(e)};return a.prototype.send=function(t,a){return t.origin=this.origin,t.key=this.key,this.to?t.to=this.to:a&&(t.to=a),e&&(this.useObject||t.useObject)||(t=JSON.stringify(t)),this.iframe?this.iframe.contentWindow.postMessage(t,"*"):window.parent.postMessage(t,"*"),this},a.prototype.listen=function(e,a){var s=this;return window.addEventListener?window.addEventListener("message",function(n){t.call(s,n,e,a)},!1):window.attachEvent&&window.attachEvent("onmessage",function(n){t.call(s,n,e,a)}),this},a}(),function(e,t){function a(e){var t=null,a=e.msg,n=a.data,r=a.useObject,i=a.api,o=a.timespan;n&&n.headers&&(t=n.headers,delete n.headers),easemobim.emajax({url:e.url,headers:t,data:e.excludeData?null:n,type:e.type,isFileUpload:e.isFileUpload,success:function(e){try{e=JSON.parse(e)}catch(t){}s.send({call:i,timespan:o,status:0,data:e,useObject:r})},error:function(e){try{e=JSON.parse(e)}catch(t){}s.send({call:i,timespan:o,status:1,data:e,useObject:r})}})}var s=new easemobim.Transfer(null,"api");s.listen(function(e){var t,n=e.api,r=e.data||{},i=r.tenantId,o=r.orgName+"%23"+r.appName+"%23"+r.imServiceNumber;switch(s.targetOrigin=e.origin,n){case"getRelevanceList":a({url:"/v1/webimplugin/targetChannels",type:"GET",msg:e});break;case"getDutyStatus":a({url:"/v1/webimplugin/showMessage",type:"GET",msg:e});break;case"getWechatVisitor":a({url:"/v1/webimplugin/visitors/wechat/"+r.openid+"?tenantId="+i,msg:e,type:"POST"});break;case"createVisitor":a({url:"/v1/webimplugin/visitors?tenantId="+i,msg:e,type:"POST"});break;case"getSession":a({url:"/v1/webimplugin/visitors/"+r.id+"/schedule-data?techChannelInfo="+o+"&tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"getExSession":a({url:"/v1/webimplugin/visitors/"+r.id+"/schedule-data-ex?techChannelInfo="+o+"&tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"getPassword":a({url:"/v1/webimplugin/visitors/password",type:"GET",msg:e});break;case"getGroup":a({url:"/v1/webimplugin/visitors/"+r.id+"/ChatGroupId?techChannelInfo="+o+"&tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"getGroupNew":a({url:"/v1/webimplugin/tenant/"+i+"/visitors/"+r.id+"/ChatGroupId?techChannelInfo="+o+"&tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"getHistory":a({url:"/v1/webimplugin/visitors/msgHistory",type:"GET",msg:e});break;case"getSlogan":a({url:"/v1/webimplugin/notice/options",type:"GET",msg:e});break;case"getTheme":a({url:"/v1/webimplugin/theme/options",type:"GET",msg:e});break;case"getSystemGreeting":a({url:"/v1/webimplugin/welcome",type:"GET",msg:e});break;case"getRobertGreeting":a({url:"/v1/Tenants/"+i+"/robots/visitor/greetings/"+r.originType+"?tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"sendVisitorInfo":a({url:"/v1/webimplugin/tenants/"+i+"/visitors/"+r.visitorId+"/attributes?tenantId="+i,msg:e,type:"POST"});break;case"getProject":a({url:"/tenants/"+i+"/projects",type:"GET",msg:e});break;case"createTicket":a({url:"/tenants/"+i+"/projects/"+r.projectId+"/tickets?tenantId="+i+"&easemob-target-username="+r["easemob-target-username"]+"&easemob-appkey="+r["easemob-appkey"]+"&easemob-username="+r["easemob-username"],msg:e,type:"POST"});break;case"receiveMsgChannel":a({url:"/v1/imgateway/messages",type:"GET",msg:e});break;case"sendMsgChannel":a({url:"/v1/imgateway/messages?tenantId="+i,msg:e,type:"POST"});break;case"getAgentStatus":if(!r.token)return void console.error("token does not exist.");a({url:"/v1/tenants/"+i+"/agents/"+r.agentUserId+"/agentstate",type:"GET",msg:e});break;case"getNickNameOption":a({url:"/v1/webimplugin/agentnicename/options?tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"reportEvent":a({url:"/v1/event_collector/events",msg:e,type:"POST"});break;case"deleteEvent":a({url:"/v1/event_collector/event/"+encodeURIComponent(r.userId),msg:e,type:"DELETE",excludeData:!0});break;case"mediaStreamUpdateStatus":t="/v1/rtcmedia/media_streams/"+r.streamId,delete r.streamId,a({url:t,msg:e,type:"PUT"});break;case"graylist":a({url:"/management/graylist",msg:e,type:"GET",excludeData:!0});break;case"getCurrentServiceSession":a({url:"/v1/webimplugin/tenant/"+i+"/visitors/"+r.id+"/CurrentServiceSession?techChannelInfo="+o+"&tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"messagePredict":t="/v1/webimplugin/agents/"+r.agentId+"/messagePredict?tenantId="+r.tenantId,delete r.tenantId,delete r.agentId,a({url:t,msg:e,type:"POST"});break;case"getSessionQueueId":a({url:"/v1/visitors/"+r.visitorUsername+"/waitings/sessions",msg:e,type:"GET"});break;case"getWaitListNumber":a({url:"/v1/visitors/waitings/data",msg:e,type:"GET"});break;case"getDutyStatus_2":a({url:"/v1/webimplugin/tenants/show-message",type:"GET",msg:e});break;case"getRobertGreeting_2":a({url:"/v1/webimplugin/tenants/robots/welcome",type:"GET",msg:e});break;case"getSkillgroupMenu":a({url:"/v1/webimplugin/tenants/"+i+"/skillgroup-menu",type:"GET",msg:e,excludeData:!0});break;case"getAgentInputState":a({url:"/v1/webimplugin/sessions/"+r.serviceSessionId+"/agent-input-state?tenantId="+i+"&orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.username+"&token="+r.token,msg:e,type:"GET",excludeData:!0});break;case"closeServiceSession":t="/webimplugin/tenants/"+i+"/visitors/"+r.userName+"/servicesessions/"+r.serviceSessionId+"/stop?tenantId="+i,delete r.serviceSessionId,a({url:t,msg:e,type:"POST"});break;case"uploadImgMsgChannel":a({url:"/v1/Tenant/"+i+"/"+r.orgName+"/"+r.appName+"/"+r.userName+"/MediaFiles",msg:e,isFileUpload:!0,type:"POST"});break;case"getVisitorInfo":a({url:"/v1/webimplugin/tenants/"+i+"/visitors?orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.userName+"&token="+r.token+"&techChannelInfo="+o,msg:e,type:"GET",excludeData:!0});break;case"getOfficalAccounts":a({url:"/v1/webimplugin/tenants/"+i+"/visitors/"+r.visitorId+"/official-accounts?page=0&size=100&orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.userName+"&token="+r.token,msg:e,type:"GET",excludeData:!0});break;case"getOfficalAccountMessage":a({url:"/v1/webimplugin/tenants/"+i+"/visitors/"+r.visitorId+"/official-accounts/"+r.officialAccountId+"/messages?size="+r.size+(r.startId?"&startId="+r.startId:"")+"&direction="+r.direction+"&orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.userName+"&token="+r.token,msg:e,type:"GET",excludeData:!0});break;case"getConfig":a({url:"/v1/webimplugin/settings/visitors/configs/"+r.configId,msg:e,type:"GET",excludeData:!0});break;case"getRobertIsOpen":a({url:"/v1/webimplugin/tenants/robot-ready",type:"GET",msg:e});break;case"getExSession_2":a({url:"/v1/webimplugin/visitors/"+r.username+"/schedule-data-ex2?techChannelInfo="+o+"&channelType="+r.channelType+"&originType="+r.originType+"&channelId="+r.channelId+"&queueName="+r.queueName+"&agentUsername="+r.agentUsername+"&tenantId="+i,msg:e,type:"GET",excludeData:!0});break;case"getLastSession":a({url:"/v1/webimplugin/tenants/"+i+"/visitors/"+r.visitorId+"/official-accounts/"+r.officialAccountId+"/latest-session?orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.userName+"&token="+r.token+"&techChannelInfo="+o,msg:e,type:"GET",excludeData:!0});break;case"reportVisitorAttributes":t="/v1/webimplugin/tenants/"+i+"/sessions/"+r.sessionId+"/attributes?orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.userName+"&token="+r.token+"&techChannelInfo="+o,delete r.tenantId,delete r.sessionId,delete r.orgName,delete r.appName,delete r.userName,delete r.token,delete r.imServiceNumber,a({url:t,msg:e,type:"POST"});break;case"messagePredict_2":t="/v1/webimplugin/servicesessions/"+r.sessionId+"/messagePredict?orgName="+r.orgName+"&appName="+r.appName+"&userName="+r.userName+"&token="+r.token+"&techChannelInfo="+o,delete r.sessionId,delete r.orgName,delete r.appName,delete r.userName,delete r.token,delete r.imServiceNumber,a({url:t,msg:e,type:"POST"});break;default:console.error("unexpect api name: "+n)}},["data"])}(easemobim.emajax,easemobim.Transfer);