!function(){var e=function(){},t=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},a=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},s=function(s){var n,r=s.dataType||"text",i=s.success||e,o=s.error||e,u=t()||a(),c=s.type||"GET",m=s.data||{},g="",p=s.headers||{},l=s.isFileUpload;if(u.onreadystatechange=function(){var e;if(4===u.readyState){var t=u.status||0;if(200===t){if("text"===r)return void i(u.responseText,u);if("json"===r){try{e=JSON.parse(u.responseText),i(e,u)}catch(a){}return}return void i(u.response||u.responseText,u)}if("json"==r){try{e=JSON.parse(u.responseText),o(e,u,"服务器返回错误信息")}catch(a){o(u.responseText,u,"服务器返回错误信息")}return}return void o(u.responseText,u,"服务器返回错误信息")}0===u.readyState&&o(u.responseText,u,"服务器异常")},"get"===c.toLowerCase()){for(var d in m)m.hasOwnProperty(d)&&(g+=d+"="+m[d]+"&");g=g?g.slice(0,-1):g,s.url+=(s.url.indexOf("?")>0?"&":"?")+(g?g+"&":g)+"_v="+(new Date).getTime(),m=null}else{if(l){var b=new FormData;return b.append("file",m.file),u.open("POST",s.url),u.setRequestHeader("Authorization",m.auth),u.send(b),u}m._v=(new Date).getTime(),m=JSON.stringify(m)}if(u.open(c,s.url),u.setRequestHeader){p["Content-Type"]=p["Content-Type"]||"application/json";for(n in p)p.hasOwnProperty(n)&&u.setRequestHeader(n,p[n])}return u.send(m),u};window.easemobim=window.easemobim||{},window.easemobim.emajax=s}(),window.easemobim=window.easemobim||{},window.easemobIM=window.easemobIM||{},easemobIM.Transfer=easemobim.Transfer=function(){"use strict";var e=function(){var e=!0;try{window.postMessage({toString:function(){e=!1}},"*")}catch(t){}return e}(),t=function(e,t,a){var s,n,r,i=!1,o=e.data;if("object"==typeof o)s=o;else if("string"==typeof o){try{s=JSON.parse(o)}catch(u){}if("object"!=typeof s)return}if(a&&a.length)for(n=0,r=a.length;r>n;n++)s.key===a[n]&&(i=!0,"function"==typeof t&&t(s));else"function"==typeof t&&t(s);if(!i&&a)for(n=0,r=a.length;r>n;n++)if("data"===a[n]){"function"==typeof t&&t(s);break}},a=function(e,t,s){return this instanceof a?(this.key=t,this.iframe=document.getElementById(e),this.origin=location.protocol+"//"+location.host,void(this.useObject=s)):new a(e)};return a.prototype.send=function(t,a){return t.origin=this.origin,t.key=this.key,a&&(t.to=a),e&&(this.useObject||t.useObject)||(t=JSON.stringify(t)),this.iframe?this.iframe.contentWindow.postMessage(t,"*"):window.parent.postMessage(t,"*"),this},a.prototype.listen=function(e,a){var s=this;return window.addEventListener?window.addEventListener("message",function(n){t.call(s,n,e,a)},!1):window.attachEvent&&window.attachEvent("onmessage",function(n){t.call(s,n,e,a)}),this},a}(),function(e,t){function a(e){var t=null,a=e.msg,n=a.data,r=a.useObject,i=a.api,o=a.timespan;n&&n.headers&&(t=n.headers,delete n.headers),easemobim.emajax({url:e.url,headers:t,data:e.excludeData?null:n,type:e.type,isFileUpload:e.isFileUpload,success:function(e){try{e=JSON.parse(e)}catch(t){}s.send({call:i,timespan:o,status:0,data:e,useObject:r})},error:function(e){try{e=JSON.parse(e)}catch(t){}s.send({call:i,timespan:o,status:1,data:e,useObject:r})}})}var s=new easemobim.Transfer(null,"api");s.listen(function(e){var t=e.api,n=e.data||{},r=n.tenantId,i=n.orgName+"%23"+n.appName+"%23"+n.imServiceNumber;switch(s.targetOrigin=e.origin,t){case"getRelevanceList":a({url:"/v1/webimplugin/targetChannels",type:"GET",msg:e});break;case"getDutyStatus":a({url:"/v1/webimplugin/showMessage",type:"GET",msg:e});break;case"getWechatVisitor":a({url:"/v1/webimplugin/visitors/wechat/"+n.openid+"?tenantId="+r,msg:e,type:"POST"});break;case"createVisitor":a({url:"/v1/webimplugin/visitors?tenantId="+r,msg:e,type:"POST"});break;case"getSession":a({url:"/v1/webimplugin/visitors/"+n.id+"/schedule-data?techChannelInfo="+i+"&tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"getExSession":a({url:"/v1/webimplugin/visitors/"+n.id+"/schedule-data-ex?techChannelInfo="+i+"&tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"getPassword":a({url:"/v1/webimplugin/visitors/password",type:"GET",msg:e});break;case"getGroup":a({url:"/v1/webimplugin/visitors/"+n.id+"/ChatGroupId?techChannelInfo="+i+"&tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"getGroupNew":a({url:"/v1/webimplugin/tenant/"+r+"/visitors/"+n.id+"/ChatGroupId?techChannelInfo="+i+"&tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"getHistory":a({url:"/v1/webimplugin/visitors/msgHistory",type:"GET",msg:e});break;case"getSlogan":a({url:"/v1/webimplugin/notice/options",type:"GET",msg:e});break;case"getTheme":a({url:"/v1/webimplugin/theme/options",type:"GET",msg:e});break;case"getSystemGreeting":a({url:"/v1/webimplugin/welcome",type:"GET",msg:e});break;case"getRobertGreeting":a({url:"/v1/Tenants/"+r+"/robots/visitor/greetings/"+n.originType+"?tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"sendVisitorInfo":a({url:"/v1/webimplugin/tenants/"+r+"/visitors/"+n.visitorId+"/attributes?tenantId="+r,msg:e,type:"POST"});break;case"getProject":a({url:"/tenants/"+r+"/projects",type:"GET",msg:e});break;case"getConfig":a({url:"/v1/webimplugin/settings/visitors/tenants/28026/configs/69b927d5-535d-48b2-b913-ce9b63f09655",msg:e,type:"GET",excludeData:!0});break;case"createTicket":a({url:"/tenants/"+r+"/projects/"+n.projectId+"/tickets?tenantId="+r+"&easemob-target-username="+n["easemob-target-username"]+"&easemob-appkey="+n["easemob-appkey"]+"&easemob-username="+n["easemob-username"],msg:e,type:"POST"});break;case"receiveMsgChannel":a({url:"/v1/imgateway/messages",type:"GET",msg:e});break;case"sendMsgChannel":a({url:"/v1/imgateway/messages?tenantId="+r,msg:e,type:"POST"});break;case"getAgentStatus":if(!n.token)return void console.error("token does not exist.");a({url:"/v1/tenants/"+r+"/agents/"+n.agentUserId+"/agentstate",type:"GET",msg:e});break;case"getNickNameOption":a({url:"/v1/webimplugin/agentnicename/options?tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"reportEvent":a({url:"/v1/event_collector/events",msg:e,type:"POST"});break;case"deleteEvent":a({url:"/v1/event_collector/event/"+encodeURIComponent(n.userId),msg:e,type:"DELETE",excludeData:!0});break;case"mediaStreamUpdateStatus":var o=n.streamId;delete n.streamId,a({url:"/v1/rtcmedia/media_streams/"+o,msg:e,type:"PUT"});break;case"graylist":a({url:"/management/graylist",msg:e,type:"GET",excludeData:!0});break;case"getCurrentServiceSession":a({url:"/v1/webimplugin/tenant/"+r+"/visitors/"+n.id+"/CurrentServiceSession?techChannelInfo="+i+"&tenantId="+r,msg:e,type:"GET",excludeData:!0});break;case"messagePredict":var u=n.tenantId,c=n.agentId;delete n.tenantId,delete n.agentId,a({url:"/v1/webimplugin/agents/"+c+"/messagePredict?tenantId="+u,msg:e,type:"POST"});break;case"getSessionQueueId":var m=n.visitorUsername;a({url:"/v1/visitors/"+m+"/waitings/sessions",msg:e,type:"GET"});break;case"getWaitListNumber":a({url:"/v1/visitors/waitings/data",msg:e,type:"GET"});break;case"getDutyStatus_2":a({url:"/v1/webimplugin/tenants/show-message",type:"GET",msg:e});break;case"getRobertGreeting_2":a({url:"/v1/webimplugin/tenants/robots/welcome",type:"GET",msg:e});break;case"getAgentInputState":a({url:"/v1/webimplugin/sessions/"+n.serviceSessionId+"/agent-input-state?tenantId="+r+"&orgName="+n.orgName+"&appName="+n.appName+"&userName="+n.username+"&token="+n.token,msg:e,type:"GET",excludeData:!0});break;case"closeServiceSession":var g=n.serviceSessionId;delete n.serviceSessionId,a({url:"/webimplugin/tenants/"+r+"/visitors/"+n.userName+"/servicesessions/"+g+"/stop?tenantId="+r,msg:e,type:"POST"});break;case"uploadImgMsgChannel":a({url:"/v1/Tenant/"+r+"/"+n.orgName+"/"+n.appName+"/"+n.userName+"/MediaFiles",msg:e,isFileUpload:!0,type:"POST"});break;case"getVisitorInfo":a({url:"/v1/webimplugin/tenants/"+r+"/visitors?orgName="+n.orgName+"&appName="+n.appName+"&userName="+n.userName+"&token="+n.token+"&techChannelInfo="+i,msg:e,type:"GET",excludeData:!0});break;case"getOfficalAccounts":a({url:"/v1/webimplugin/tenants/"+r+"/visitors/"+n.visitorId+"/official-accounts?page=0&size=100&orgName="+n.orgName+"&appName="+n.appName+"&userName="+n.userName+"&token="+n.token,msg:e,type:"GET",excludeData:!0});break;case"getOfficalAccountMessage":a({url:"/v1/webimplugin/tenants/"+r+"/visitors/"+n.visitorId+"/official-accounts/"+n.officialAccountId+"/messages?size="+n.size+(n.startId?"&startId="+n.startId:"")+"&direction="+n.direction+"&orgName="+n.orgName+"&appName="+n.appName+"&userName="+n.userName+"&token="+n.token,msg:e,type:"GET",excludeData:!0});break;default:console.error("unexpect api name: "+t)}},["data"])}(easemobim.emajax,easemobim.Transfer);