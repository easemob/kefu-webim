!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(module,exports,__webpack_require__){!function(e,t){module.exports=t()}(window,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=0)}([function(e,t,n){"use strict";var r=window.emedia=window.emedia||{},i=r.util=n(1),o=n(75);if(r.config=function(e){e=i.extend({},e);for(var t in e)r.config[t]=e[t],"logLevel"===t&&(r.LOG_LEVEL=e[t]);r.config.loglastConfrCount&&!r._logContext&&(r._logContext=new Array(r.config.loglastConfrCount),r._logContextIndex=-1)},r.config({autoSub:!0,onlyEnter:!1,reconnect:13,reconnectDelay:3e3,getCopyIntervalMillis:3e4,checkConnectIntervalMillis:1e3,iceRebuildCount:3,iceRebuildIntervalMillis:500,enterTimeout:2e4,useRTCCfgIfServerReturn:!1,forceUseRTCCfgIfServerReturnWhenP2P:!0,allowRepeatAudioMixerPublish:!1,logVolumeWhenInstantGE:.5,getMediaMeterIntervalMillis:400,_useRequestAnimationFrame:!1,meterWithTrackAudioLevel:!1,judgeTalkingByInstantGE:.05,_printSoundData:!1,trackBufferSize:20,allowSendWhenLessThan:4,disableTrack:!1,ctrlCheckIntervalMillis:1e4,ctrlTimeoutMillis:3e4,_printDebugStats:!1,statsSeconds:10,remainLastStatsCount:120,loglastConfrCount:2,loglastStoreArray:!0,consoleLogger:!0,printStatsWhenPCClose:!0,rebuildPeerConnectionWhenNetworkChanaged:!0,useDeployMore:!1,useDTX:!0,uploadStats:!0,liveCfgs:[],rtcStatsTypeMath:function(e,t){switch(e.type){case"remote-candidate":case"local-candidate":case"track":case"stream":case"inbound-rtp":case"outbound-rtp":case"transport":return!0}return!1}}),i.logger.count(),function(){var e=n(76).default;if(r.browser=e.__browser,r.browserVersion=e.__browserVersion,void 0===r.browser)throw"Not discern browser. may require adapter error. eg. it.default"}(),i.logger.info("Current browser",r.browser,r.browserVersion),r.AudioContext=window.AudioContext||window.webkitAudioContext,r.config.getMediaMeterIntervalMillis){try{"function"==typeof r.AudioContext?(r.__audioContext=new r.AudioContext,r.__usingWebAudio=!0):r.__usingWebAudio=!1}catch(s){r.__usingWebAudio=!1}r.__usingWebAudio&&"suspended"===r.__audioContext.state&&o(function(){var e=function t(){"suspended"===r.__audioContext.state&&r.__audioContext.resume(),i.logger.warn("AudioContext state suspended ->",r.__audioContext.state),setTimeout(function(){"running"===r.__audioContext.state&&(document.body.removeEventListener("touchend",t,!1),document.body.removeEventListener("click",t,!1))},0)};document.body.addEventListener("touchend",e,!1),document.body.addEventListener("click",e,!1)}),r.__usingWebAudio||console.warn("'new AudioContext()' failed. can not know who talking."),r.__audioContext&&"suspended"===r.__audioContext.state&&console.warn("audioContext.state is suspended. can not know who talking. You can resume() emedia.__audioContext, but only in response to a tap.")}if(window.requestAnimationFrame&&r.config._useRequestAnimationFrame?r.requestAnimationFrame=function(e){window.requestAnimationFrame(e)}:r.requestAnimationFrame=function(e,t){return setTimeout(e,t||r.config.getMediaMeterIntervalMillis)},window.cancelAnimationFrame&&r.config._useRequestAnimationFrame?r.cancelAnimationFrame=function(e){window.cancelAnimationFrame(e)}:r.cancelAnimationFrame=function(e){clearTimeout(e)},r.isWifi=function(){try{var e=!0,t=window.navigator.userAgent,n=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;if(/MicroMessenger/.test(t)){if(t.indexOf("WIFI")>=0)return!0;e=!1}else if(n){var r=n.type;"wifi"!==r&&"2"!==r&&"unknown"!==r&&(e=!1)}return e}catch(i){return!1}},r.stopAudioTracks=function(e){e&&e.getAudioTracks().forEach(function(t){t.stop(),i.logger.info("Media stream stop audio track. stream =",e.id,"track =",t.id,t.kind)})},r.stopAndRemoveAudioTracks=function(e){var t=[];e&&e.getAudioTracks().forEach(function(n){n.stop(),t.push(n),i.logger.info("Media stream stop and remove audio tracks. stream =",e.id,"track =",n.id,n.kind)}),i.forEach(t,function(t,n){e.removeTrack(n)})},r.stopTracks=function(e){try{var t=function(){e.getTracks().forEach(function(t){t.stop(),i.logger.info("Media stream stop track. stream =",e.id," track =",t.id,t.kind)}),e._bindAttendee&&(i.removeAttribute(e._bindAttendee._openedRtcMediaStreams,e.id),e._bindAttendee=null),i.logger.info("stream tracks stoped. it ",e.id)};if(!e||e.active===!1)return void i.logger.debug("stream tracks had been stoped. it ",e&&e.id);t()}catch(n){i.logger.error(n)}},r.enableVideoTracks=function(e,t){e&&e.getVideoTracks().forEach(function(n){return"function"==typeof n.enable?(n.enable(),i.logger.info("Media stream enable video track. stream =",e.id,"track =",n.kind,n.enabled,n.id),void(n.enabled===t||n.enable(t))):(n.enabled===t||(n.enabled=t),void i.logger.info("Media stream enable video track. stream =",e.id,"track =",n.kind,n.enabled,n.id))})},r.enableAudioTracks=function(e,t){e&&e.getAudioTracks().forEach(function(n){return"function"==typeof n.enable?(n.enable(),i.logger.info("Media stream enable audio track. stream =",e.id,"track =",n.kind,n.enabled,n.id),void(n.enabled===t||n.enable(t))):(n.enabled===t||(n.enabled=t),void i.logger.info("Media stream enable audio track. stream =",e.id,"track =",n.kind,n.enabled,n.id))})},r.hasEnabledTracks=function(e){if(!e||"function"!=typeof e.getAudioTracks)return!1;if(!e.active)return!1;var t=e.getAudioTracks();if(0===t.length)return!1;for(var n in t)if("function"==typeof t[n].enable&&t[n].enable(),t[n].enabled)return!0;return!1},r.genReportName=function(){var e=r._lastSetupDate||new Date;return(r._lastSetupTktId||r._lastSetupConfr)+"_"+r._lastSetupMemName+"_"+e.getTime()+".log"},r.getReportUploadUrl=function(e,t,n){var r=new XMLHttpRequest;r.open(e,t,!0),r.addEventListener("load",function(e){n&&n(e)},!1),r.send(null)},r.uploadReport=function(e,t,n,o,s,a){function c(n){console.info("log begin upload. result = ",n.currentTarget.status,e," > ",t),200===n.currentTarget.status?o&&o(n):s&&s(n)}var u=r.genReport();if(!u)return void(s&&s("not logs"));"function"==typeof n&&(a=s,s=o,o=n,n=void 0);var d=new Blob([u],{type:"text/plain"}),f=new FormData;f.append(e,d,e),n&&"function"==typeof f.set&&i.forEach(n,function(e,t){f.set(e,t)});var l=new XMLHttpRequest;l.open("POST",t,!0),l.setRequestHeader("X-File-Name",e),a&&a(l),l.addEventListener("load",c,!1),l.send(f),console.info("log begin upload. ",e," > ",t)},r.genReport=function(){if(r._logContext&&r._logContext instanceof Array&&!("undefined"==typeof r._logContextIndex||r._logContextIndex<0)){var e=0,t=r._logContextIndex;r._logContextIndex>=r._logContext.length&&(e=r._logContextIndex-r._logContext.length+1);for(var n="",i=e;i<=t;i++){var o=i%r._logContext.length,s=r._logContext[o];n+=s.join("\r\n")+"\r\n"}return r._logContext.loadlogs&&r._logContext.loadlogs instanceof Array&&(n+="-------------------------------------------------------------\r\n",n+=r._logContext.loadlogs.join("\r\n")+"\r\n"),n}},r.fileReport=function(e,t){var n=r.genReport();if(n){t&&(n="遇到的异常描述如下：\r\n "+t+" \r\n "+n);var i=encodeURIComponent(n),o=document.createElement("a");o.style.display="none",o.download=e||"emedia-"+(new Date).toJSON()+".log",o.href="data:text/plain;charset=utf-8,"+i,document.body.appendChild(o),o.click(),o.parentNode.removeChild(o)}},navigator.mediaDevices){var a=navigator.mediaDevices.getSupportedConstraints();i.logger.info("Supported constraints",a)}r.config({globalConstraints:{}});var c=n(129),u=n(138);r.Webrtc=n(143),r.Service=c,r.P2P=n(153),r.XService=c,r.XServiceWithP2P=r.P2P(c),r.mgr=n(154).outer,r.ctrl=n(361),r.CompositeCanvas=n(367),r.pannel||(r.pannel={}),r.pannel.DefaultMouseTrack=n(150),r.pannel.MouseTrack=n(151),r.pannel.KeyboardTrack=n(368);var d=r.PCStats=n(149);if(r.helper=r.helper||{},r.helper.PCStats=d,r.helper.pcstats=d.echo,r.helper.intervalPcstats=d.intervalEcho,r.helper.inboundAudio=d.inboundAudio,r.helper.inboundVideo=d.inboundVideo,r.helper.outboundAudio=d.outboundAudio,r.helper.outboundVideo=d.outboundVideo,r.event=u,r.LOG_LEVEL=0,r.isFirefox="firefox"===r.browser,r.isChrome="chrome"===r.browser,r.isSafari="safari"===r.browser,r.isEdge="edge"===r.browser,r.isElectron=/Electron/.test(navigator.userAgent),r.isElectron)try{n(369)}catch(s){i.logger.error(s)}r.youInSomeBrowsers=function(){if(r.isSafari){var e=new RegExp("(Version)/([0-9.]+)","i"),t=navigator.userAgent.match(e);if(null!=t){var n=unescape(t[2]);return n=parseInt(n),n<13}}return!1},r.replaceIpAndPortOfCandidate=function(e,t,n){var r="string"==typeof e?e:e.candidate;return r=r.replace(/(candidate:\d+\s+\d+\s+udp\s+\d+\s+)([\d\.]+)\s+(\d+)(\s+.*)/g,function(e,r,i,o,s){return r+t+" "+n+s}),e.candidate?(e=i.extend(!0,{},e),e.candidate=r):e=r,e},r.replaceIpAndPort=function(e,t){if("function"!=typeof t)return e;var n="string"==typeof e?e:e.candidate;return n=n.replace(/(candidate:\d+\s+\d+\s+udp\s+\d+\s+)([\d\.]+)\s+(\d+)(\s+.*)/g,function(e,n,r,i,o){var s=t(r,i);return"string"==typeof s?(s=s.replace(":"," "),n+s+o):n+r+" "+i+o}),e.candidate?(e=i.extend(!0,{},e),e.candidate=n):e=n,e},r.replaceURL=function(e,t){return"function"!=typeof t?e:e.replace(/([^:\/?&#=]+):\/\/([^\/:?#]+)(:\d+)?(\/[^?#]*)?(\?[^\/#]*)?(#[^\/?]*)?/g,function(n,r,i,o,s,a,c){o&&(o=o.substring(1));var u=t(n,r,i,o,s,a,c);if(!u)return e;if("string"==typeof u)return u;var d=u.protocol||r,f=u.host||i,l=u.port||o,p=u.path||s,h=u.query||a,v=u.fragment||c;return d+"://"+f+(l?":"+l:"")+(p?p:"")+(h?h:"")+(v?v:"")})},r.requireTrustBeforeJoin=function(){return!1},r.isWebRTC=window.RTCPeerConnection&&/^https\:$/.test(window.location.protocol),(r.isChrome||r.isSafari)&&(r.supportPRAnswer=!0),r.supportPRAnswer=!1,r.config({baseAcptOps:[102,104,105,106,107,300,302,303,304,301,204,206,400,401,1001,100221,100222,100223,100224,100201,100202,100203]}),r.config({clientType:"WEB",version:"3.4.1",userAgent:navigator.userAgent,isHttpDNS:!0,acptOps:[100230,100205,1003,1004]}),e.exports=r},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function Util(){}var _typeof2=__webpack_require__(2),_typeof3=_interopRequireDefault(_typeof2),_getPrototypeOf=__webpack_require__(69),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_stringify=__webpack_require__(73),_stringify2=_interopRequireDefault(_stringify);!function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var r,i=e,o=[];if(n=n||i.length,t)for(r=0;r<t;r++)o[r]=i[0|Math.random()*n];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(s=0|16*Math.random(),o[r]=i[19==r?3&s|8:s])}return o.join("")},Math.uuidFast=function(){for(var t,n=e,r=new Array(36),i=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),t=15&i,i>>=4,r[o]=n[19==o?3&t|8:t]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}}(),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});var Logger=function(e){function t(e,t){try{i(e,t)}catch(n){if(console){if(console.error)return void console.error(n);if(console.log)return void console.log(n)}throw n}}function n(){if(!(emedia._logContextIndex<0)&&emedia._logContext&&emedia._logContext instanceof Array){var e=emedia._logContextIndex%emedia._logContext.length,t=emedia._logContext[e];t&&t instanceof Array||(t=emedia._logContext[e]=[]);var n=[];n.push(emedia._logContextIndex);var r=new Date;"function"==typeof r.toLocaleString?n.push(r.toLocaleString()):r.toJSON?n.push(r.toJSON()):r.toISOString?n.push(r.toISOString()):n.push(r+"");for(var i=0;i<arguments.length;i++){var o=arguments[i];"string"!=typeof o&&o?"string"!=typeof o.message?"function"!=typeof o.message?"string"!=typeof o.stack?o.event&&"function"==typeof o.event.toString?n.push(o.event.toString()):o.event&&"function"==typeof o.event.toString?n.push(o.event.toString()):"string"!=typeof o.candidate?"string"!=typeof o.sdp?isPlainObject(o)?n.push((0,_stringify2.default)(o)):n.push(String(o)):n.push(o.sdp):n.push(o.candidate):n.push(o.stack):n.push(o.message()):n.push(o.message):n.push(o)}var s;if(emedia.config.loglastStoreArray&&t.push(s=n.join(" ")),"function"==typeof emedia.config.onSdkLog)try{s||(s=n.join(" ")),emedia.config.onSdkLog(s)}catch(a){console.error(a)}}}function r(){try{n.apply(null,arguments)}catch(e){console.warn(e)}}function i(t,n){if(!(emedia&&emedia.LOG_LEVEL&&t<emedia.LOG_LEVEL)){var r=[];r.push(t),e&&r.push(e);for(var i=0;i<n.length;i++)r.push(n[i]&&n[i]._toString?n[i]._toString.call(n[i]):n[i]);o._log.apply(o,r)}}var o=this,s={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5},a=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];this._log=function(){var e=arguments[0];if(e=arguments[0]=a[e],emedia._logContext&&r.apply(null,arguments),emedia.config.consoleLogger===!0)return emedia&&emedia.isElectron?void console.log.apply(console,arguments):void(console&&e&&(console[e.toLowerCase()]||console.warn).apply(console,arguments))},this.log=function(){this._log&&t(s.INFO,arguments)},this.trace=function(){this._log&&t(s.TRACE,arguments)},this.debug=function(){this._log&&t(s.DEBUG,arguments)},this.info=function(){this._log&&t(s.INFO,arguments)},this.warn=function(){this._log&&t(s.WARN,arguments)},this.error=function(){this._log&&t(s.ERROR,arguments)},this.fatal=function(){this._log&&t(s.FATAL,arguments)}};Logger.prototype.count=function(){if(emedia._logContext){emedia._logContextIndex++;var e=emedia._logContextIndex%emedia._logContext.length;0===e&&0!==emedia._logContextIndex&&(emedia._logContext.loadlogs=emedia._logContext[e]),emedia._logContext[e]=[]}},Util.prototype.logger=new Logger,Util.prototype.tagLogger=function(e){return new Logger(e)},Util.prototype.parseJSON=function(e){return JSON.parse(e)};var stringifyJSON=Util.prototype.stringifyJSON=function(e){return(0,_stringify2.default)(e)},class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),isPlainObject=Util.prototype.isPlainObject=function(e){var t,n,r;return!(!e||"[object Object]"!==(r=toString.call(e))||"<JSAPI-Auto Javascript Object>"===e.toString()||"[object IFBComJavascriptObject]"===e.toString())&&(!(t=(0,_getPrototypeOf2.default)(e))||(n=hasOwn.call(t,"constructor")&&t.constructor,"function"==typeof n&&fnToString.call(n)===ObjectFunctionString))};Util.prototype.isArray=Array.isArray,Util.prototype.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},Util.prototype.type=function(e){return null==e?e+"":"object"===("undefined"==typeof e?"undefined":(0,_typeof3.default)(e))||"function"==typeof e?class2type[toString.call(e)]||"object":"undefined"==typeof e?"undefined":(0,_typeof3.default)(e)},Util.prototype.extend=function(){var e,t,n,r,i,o,s=this,a=arguments[0]||{},c=1,u=arguments.length,d=!1;for("boolean"==typeof a&&(d=a,a=arguments[c]||{},c++),"object"===("undefined"==typeof a?"undefined":(0,_typeof3.default)(a))||s.isFunction(a)||(a={}),c===u&&(a=this,c--);c<u;c++)if(null!=(e=arguments[c]))for(t in e)n=a[t],r=e[t],a!==r&&(d&&r&&(s.isPlainObject(r)||(i=s.isArray(r)))?(i?(i=!1,o=n&&s.isArray(n)?n:[]):o=n&&s.isPlainObject(n)?n:{},a[t]=s.extend(d,o,r)):void 0!==r&&(a[t]=r));return a},Util.prototype.removeAttribute=function(e,t){if(null!==e&&void 0!==e){var n=e[t];return delete e[t],n}},Util.prototype.prototypeExtend_000=Util.prototype.classExtend=function(){function e(){for(var e=0;e<arguments.length;e++){var t=arguments[e]||{};n.extend(!0,this,t)}this.__init__&&this.__init__.apply(this,arguments)}for(var t,n=this,r=0;r<arguments.length;r++){var i=arguments[r]||{};"function"==typeof i?t?(i.constructor=t,i.__proto__=t.prototype):t=i:n.extend(!0,e.prototype,i)}return t&&(e.prototype.__proto__=t.prototype),t&&(e.prototype.constructor=t),e.extend||(e.extend=function(t){return n.prototypeExtend(e,t)}),e},Util.prototype.prototypeExtend=Util.prototype.classExtend=function(){function e(){for(var e=0;e<arguments.length;e++){var n=arguments[e]||{};t.extend(!0,this,n)}this.__init__&&this.__init__.apply(this,arguments)}for(var t=this,n=0;n<arguments.length;n++){var r=arguments[n]||{};"function"==typeof r&&(r=r.prototype),t.extend(!0,e.prototype,r)}return e.extend||(e.extend=function(n){return t.prototypeExtend(e,n)}),e},Util.prototype.hasLocalStorage=function(e){return null!=localStorage.getItem(e)&&"{}"!=localStorage.getItem(e)},Util.prototype.toggleClass=function(e,t){return e.hasClass(t)?void e.removeClass(t):void e.addClass(t)},Util.prototype.setCookie=function(e,t,n){var r=new Date;r.setTime(r.getTime()+60*n*60*1e3),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},Util.prototype.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},Util.prototype.parseURL=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},Util.prototype.forEach=function(e,t){if(e&&!(this.isArray(e)&&0===e.length||void 0!==e.length&&0===e.length))if(e.length)for(var n=0;n<e.length;n++)t(n,e[n]);else if(e&&!this.isEmptyObject(e)){e=e||{};var r=this.extend(!1,{},e);for(var i in r)t(i,e[i])}},Util.prototype.isInt=function(e){return Number(e)===e&&e%1===0},Util.prototype.isFloat=function(e){return Number(e)===e&&e%1!==0},Util.prototype.list=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return e},Util.prototype.addEvent=function(e,t,n){if(e.attachEvent)return e.attachEvent("on"+t,n);if(e.addEventListener)return e.addEventListener(t,n,!1);throw"Handler could not be attached"},Util.prototype.removeEvent=function(e,t,n){if(e.detachEvent)return e.detachEvent("on"+t,n);if(e.removeEventListener)return e.removeEventListener(t,n,!1);throw"Handler could not be removed"},Util.prototype.stopEvent=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1},Util.prototype.getDomPageRect=function(e){var t=e.getBoundingClientRect();return{x:t.left+(window.pageXOffset||window.document.documentElement.scrollLeft),y:t.top+(window.pageYOffset||window.document.documentElement.scrollTop),width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}},Util.prototype.getEventElementXY=function(e,t,n){e=e||window.event;var r,i,o=e.changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e;void 0!=o.pageX&&void 0!=o.pageY?(r=o.pageX,i=o.pageY):void 0!=o.clientX&&void 0!=o.clientY&&(r=o.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=o.clientY+document.body.scrollTop+document.documentElement.scrollTop);var s=this.getDomPageRect(t),a=r-s.x,c=i-s.y;return(0===n||void 0==n)&&(n=1),{x:Math.round(Math.max(Math.min(a,s.width-1),0)/n),y:Math.round(Math.max(Math.min(c,s.height-1),0)/n),width:Math.round(s.width/n),height:Math.round(s.height/n),realX:a,realY:c}},Util.prototype.layoutEngine=function(){var e={presto:!!window.opera,trident:!!window.ActiveXObject&&(window.XMLHttpRequest?document.querySelectorAll?6:5:4),webkit:function(){try{return!navigator.taintEnabled&&(i.Features.xpath?i.Features.query?525:420:419)}catch(e){return!1}}(),gecko:!(!document.getBoxObjectFor&&null==window.mozInnerScreenX)&&(document.getElementsByClassName?19:18)};return e.webkit&&(e.webkit=function(e){var t=(navigator.userAgent.match(/WebKit\/([0-9\.]*) /)||["",e])[1];return parseFloat(t,10)}(e)),e}(),Util.prototype.targetDOM="object"===("undefined"==typeof HTMLElement?"undefined":(0,_typeof3.default)(HTMLElement))?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"===("undefined"==typeof e?"undefined":(0,_typeof3.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},Util.prototype.cloneCSS=function(e,t){var n=window.getComputedStyle&&window.getComputedStyle(e,null)||e.currentStyle;for(var r in n){var i=n[r];/^[a-z]/i.test(r)&&[null,"",void 0].indexOf(i)<0&&(t.style[r]=i)}},Util.prototype.canYield=function(){try{return eval("!!Function('yield true;')().next()")}catch(e){return!1}}(),module.exports=new Util},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(3),o=r(i),s=n(54),a=r(s),c="function"==typeof a.default&&"symbol"==typeof o.default?function(e){return typeof e}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":typeof e};t.default="function"==typeof a.default&&"symbol"===c(o.default)?function(e){return"undefined"==typeof e?"undefined":c(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":"undefined"==typeof e?"undefined":c(e)}},function(e,t,n){e.exports={default:n(4),__esModule:!0}},function(e,t,n){n(5),n(49),e.exports=n(53).f("iterator")},function(e,t,n){"use strict";var r=n(6)(!0);n(9)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(7),i=n(8);e.exports=function(e){return function(t,n){var o,s,a=String(i(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(o=a.charCodeAt(c),o<55296||o>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):o:e?a.slice(c,c+2):(o-55296<<10)+(s-56320)+65536)}}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";var r=n(10),i=n(11),o=n(27),s=n(16),a=n(28),c=n(29),u=n(45),d=n(47),f=n(46)("iterator"),l=!([].keys&&"next"in[].keys()),p="@@iterator",h="keys",v="values",m=function(){return this};e.exports=function(e,t,n,b,_,g,y){c(n,t,b);var S,w,x,C=function(e){if(!l&&e in R)return R[e];switch(e){case h:return function(){return new n(this,e)};case v:return function(){return new n(this,e)}}return function(){return new n(this,e)}},I=t+" Iterator",T=_==v,E=!1,R=e.prototype,k=R[f]||R[p]||_&&R[_],M=k||C(_),O=_?T?C("entries"):M:void 0,A="Array"==t?R.entries||k:k;if(A&&(x=d(A.call(new e)),x!==Object.prototype&&x.next&&(u(x,I,!0),r||"function"==typeof x[f]||s(x,f,m))),T&&k&&k.name!==v&&(E=!0,M=function(){return k.call(this)}),r&&!y||!l&&!E&&R[f]||s(R,f,M),a[t]=M,a[I]=m,_)if(S={values:T?M:C(v),keys:g?M:C(h),entries:O},y)for(w in S)w in R||o(R,w,S[w]);else i(i.P+i.F*(l||E),t,S);return S}},function(e,t){e.exports=!0},function(e,t,n){var r=n(12),i=n(13),o=n(14),s=n(16),a=n(26),c="prototype",u=function(e,t,n){var d,f,l,p=e&u.F,h=e&u.G,v=e&u.S,m=e&u.P,b=e&u.B,_=e&u.W,g=h?i:i[t]||(i[t]={}),y=g[c],S=h?r:v?r[t]:(r[t]||{})[c];h&&(n=t);for(d in n)f=!p&&S&&void 0!==S[d],f&&a(g,d)||(l=f?S[d]:n[d],g[d]=h&&"function"!=typeof S[d]?n[d]:b&&f?o(l,r):_&&S[d]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[c]=e[c],t}(l):m&&"function"==typeof l?o(Function.call,l):l,m&&((g.virtual||(g.virtual={}))[d]=l,e&u.R&&y&&!y[d]&&s(y,d,l)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.6.10"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(15);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(17),i=n(25);e.exports=n(21)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(18),i=n(20),o=n(24),s=Object.defineProperty;t.f=n(21)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(19);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(21)&&!n(22)(function(){return 7!=Object.defineProperty(n(23)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){e.exports=!n(22)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,n){var r=n(19),i=n(12).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(19);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){e.exports=n(16)},function(e,t){e.exports={}},function(e,t,n){"use strict";var r=n(30),i=n(25),o=n(45),s={};n(16)(s,n(46)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(18),i=n(31),o=n(43),s=n(40)("IE_PROTO"),a=function(){},c="prototype",u=function(){var e,t=n(23)("iframe"),r=o.length,i="<",s=">";for(t.style.display="none",n(44).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(i+"script"+s+"document.F=Object"+i+"/script"+s),e.close(),u=e.F;r--;)delete u[c][o[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(a[c]=r(e),n=new a,a[c]=null,n[s]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(17),i=n(18),o=n(32);e.exports=n(21)?Object.defineProperties:function(e,t){i(e);for(var n,s=o(t),a=s.length,c=0;a>c;)r.f(e,n=s[c++],t[n]);return e}},function(e,t,n){var r=n(33),i=n(43);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(26),i=n(34),o=n(37)(!1),s=n(40)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),c=0,u=[];for(n in a)n!=s&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~o(u,n)||u.push(n));return u}},function(e,t,n){var r=n(35),i=n(8);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(36);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(34),i=n(38),o=n(39);e.exports=function(e){return function(t,n,s){var a,c=r(t),u=i(c.length),d=o(s,u);if(e&&n!=n){for(;u>d;)if(a=c[d++],a!=a)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}}},function(e,t,n){var r=n(7),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(7),i=Math.max,o=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(41)("keys"),i=n(42);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(13),i=n(12),o="__core-js_shared__",s=i[o]||(i[o]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(10)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(12).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(17).f,i=n(26),o=n(46)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(41)("wks"),i=n(42),o=n(12).Symbol,s="function"==typeof o,a=e.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:i)("Symbol."+e))};a.store=r},function(e,t,n){var r=n(26),i=n(48),o=n(40)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,n){var r=n(8);e.exports=function(e){return Object(r(e))}},function(e,t,n){n(50);for(var r=n(12),i=n(16),o=n(28),s=n(46)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],d=r[u],f=d&&d.prototype;f&&!f[s]&&i(f,s,u),o[u]=o.Array}},function(e,t,n){"use strict";var r=n(51),i=n(52),o=n(28),s=n(34);e.exports=n(9)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){t.f=n(46)},function(e,t,n){e.exports={default:n(55),__esModule:!0}},function(e,t,n){n(56),n(66),n(67),n(68),e.exports=n(13).Symbol},function(e,t,n){"use strict";var r=n(12),i=n(26),o=n(21),s=n(11),a=n(27),c=n(57).KEY,u=n(22),d=n(41),f=n(45),l=n(42),p=n(46),h=n(53),v=n(58),m=n(59),b=n(62),_=n(18),g=n(19),y=n(48),S=n(34),w=n(24),x=n(25),C=n(30),I=n(63),T=n(65),E=n(60),R=n(17),k=n(32),M=T.f,O=R.f,A=I.f,P=r.Symbol,j=r.JSON,N=j&&j.stringify,D="prototype",L=p("_hidden"),V=p("toPrimitive"),F={}.propertyIsEnumerable,U=d("symbol-registry"),W=d("symbols"),B=d("op-symbols"),q=Object[D],G="function"==typeof P&&!!E.f,z=r.QObject,H=!z||!z[D]||!z[D].findChild,Y=o&&u(function(){return 7!=C(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=M(q,t);r&&delete q[t],O(e,t,n),r&&e!==q&&O(q,t,r)}:O,K=function(e){var t=W[e]=C(P[D]);return t._k=e,t},X=G&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},J=function(e,t,n){return e===q&&J(B,t,n),_(e),t=w(t,!0),_(n),i(W,t)?(n.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),
n=C(n,{enumerable:x(0,!1)})):(i(e,L)||O(e,L,x(1,{})),e[L][t]=!0),Y(e,t,n)):O(e,t,n)},$=function(e,t){_(e);for(var n,r=m(t=S(t)),i=0,o=r.length;o>i;)J(e,n=r[i++],t[n]);return e},Z=function(e,t){return void 0===t?C(e):$(C(e),t)},Q=function(e){var t=F.call(this,e=w(e,!0));return!(this===q&&i(W,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(W,e)||i(this,L)&&this[L][e])||t)},ee=function(e,t){if(e=S(e),t=w(t,!0),e!==q||!i(W,t)||i(B,t)){var n=M(e,t);return!n||!i(W,t)||i(e,L)&&e[L][t]||(n.enumerable=!0),n}},te=function(e){for(var t,n=A(S(e)),r=[],o=0;n.length>o;)i(W,t=n[o++])||t==L||t==c||r.push(t);return r},ne=function(e){for(var t,n=e===q,r=A(n?B:S(e)),o=[],s=0;r.length>s;)!i(W,t=r[s++])||n&&!i(q,t)||o.push(W[t]);return o};G||(P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=l(arguments.length>0?arguments[0]:void 0),t=function(n){this===q&&t.call(B,n),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),Y(this,e,x(1,n))};return o&&H&&Y(q,e,{configurable:!0,set:t}),K(e)},a(P[D],"toString",function(){return this._k}),T.f=ee,R.f=J,n(64).f=I.f=te,n(61).f=Q,E.f=ne,o&&!n(10)&&a(q,"propertyIsEnumerable",Q,!0),h.f=function(e){return K(p(e))}),s(s.G+s.W+s.F*!G,{Symbol:P});for(var re="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;re.length>ie;)p(re[ie++]);for(var oe=k(p.store),se=0;oe.length>se;)v(oe[se++]);s(s.S+s.F*!G,"Symbol",{for:function(e){return i(U,e+="")?U[e]:U[e]=P(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),s(s.S+s.F*!G,"Object",{create:Z,defineProperty:J,defineProperties:$,getOwnPropertyDescriptor:ee,getOwnPropertyNames:te,getOwnPropertySymbols:ne});var ae=u(function(){E.f(1)});s(s.S+s.F*ae,"Object",{getOwnPropertySymbols:function(e){return E.f(y(e))}}),j&&s(s.S+s.F*(!G||u(function(){var e=P();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(g(t)||void 0!==e)&&!X(e))return b(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!X(t))return t}),r[1]=t,N.apply(j,r)}}),P[D][V]||n(16)(P[D],V,P[D].valueOf),f(P,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){var r=n(42)("meta"),i=n(19),o=n(26),s=n(17).f,a=0,c=Object.isExtensible||function(){return!0},u=!n(22)(function(){return c(Object.preventExtensions({}))}),d=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[r].i},l=function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[r].w},p=function(e){return u&&h.NEED&&c(e)&&!o(e,r)&&d(e),e},h=e.exports={KEY:r,NEED:!1,fastKey:f,getWeak:l,onFreeze:p}},function(e,t,n){var r=n(12),i=n(13),o=n(10),s=n(53),a=n(17).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},function(e,t,n){var r=n(32),i=n(60),o=n(61);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,a=n(e),c=o.f,u=0;a.length>u;)c.call(e,s=a[u++])&&t.push(s);return t}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(36);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(34),i=n(64).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return i(e)}catch(t){return s.slice()}};e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?a(e):i(r(e))}},function(e,t,n){var r=n(33),i=n(43).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(61),i=n(25),o=n(34),s=n(24),a=n(26),c=n(20),u=Object.getOwnPropertyDescriptor;t.f=n(21)?u:function(e,t){if(e=o(e),t=s(t,!0),c)try{return u(e,t)}catch(n){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t){},function(e,t,n){n(58)("asyncIterator")},function(e,t,n){n(58)("observable")},function(e,t,n){e.exports={default:n(70),__esModule:!0}},function(e,t,n){n(71),e.exports=n(13).Object.getPrototypeOf},function(e,t,n){var r=n(48),i=n(47);n(72)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(11),i=n(13),o=n(22);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",s)}},function(e,t,n){e.exports={default:n(74),__esModule:!0}},function(e,t,n){var r=n(13),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,n){var r;!function(i,o){r=function(){return o(i)}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))}(this,function(){var t=function(){function e(e){return null==e?String(e):K[X.call(e)]||"object"}function t(t){return"function"==e(t)}function n(e){return null!=e&&e==e.window}function r(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function i(t){return"object"==e(t)}function o(e){return i(e)&&!n(e)&&Object.getPrototypeOf(e)==Object.prototype}function s(e){var t=!!e&&"length"in e&&e.length,r=C.type(e);return"function"!=r&&!n(e)&&("array"==r||0===t||"number"==typeof t&&t>0&&t-1 in e)}function a(e){return M.call(e,function(e){return null!=e})}function c(e){return e.length>0?C.fn.concat.apply([],e):e}function u(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function d(e){return e in j?j[e]:j[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function f(e,t){return"number"!=typeof t||N[u(e)]?t:t+"px"}function l(e){var t,n;return P[e]||(t=A.createElement(e),A.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),P[e]=n),P[e]}function p(e){return"children"in e?O.call(e.children):C.map(e.childNodes,function(e){if(1==e.nodeType)return e})}function h(e,t){var n,r=e?e.length:0;for(n=0;n<r;n++)this[n]=e[n];this.length=r,this.selector=t||""}function v(e,t,n){for(x in t)n&&(o(t[x])||Q(t[x]))?(o(t[x])&&!o(e[x])&&(e[x]={}),Q(t[x])&&!Q(e[x])&&(e[x]=[]),v(e[x],t[x],n)):t[x]!==w&&(e[x]=t[x])}function m(e,t){return null==t?C(e):C(e).filter(t)}function b(e,n,r,i){return t(n)?n.call(e,r,i):n}function _(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function g(e,t){var n=e.className||"",r=n&&n.baseVal!==w;return t===w?r?n.baseVal:n:void(r?n.baseVal=t:e.className=t)}function y(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?C.parseJSON(e):e):e}catch(t){return e}}function S(e,t){t(e);for(var n=0,r=e.childNodes.length;n<r;n++)S(e.childNodes[n],t)}var w,x,C,I,T,E,R=[],k=R.concat,M=R.filter,O=R.slice,A=window.document,P={},j={},N={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},D=/^\s*<(\w+|!)[^>]*>/,L=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,V=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,F=/^(?:body|html)$/i,U=/([A-Z])/g,W=["val","css","html","text","data","width","height","offset"],B=["after","prepend","before","append"],q=A.createElement("table"),G=A.createElement("tr"),z={tr:A.createElement("tbody"),tbody:q,thead:q,tfoot:q,td:G,th:G,"*":A.createElement("div")},H=/complete|loaded|interactive/,Y=/^[\w-]*$/,K={},X=K.toString,J={},$=A.createElement("div"),Z={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Q=Array.isArray||function(e){return e instanceof Array};return J.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,o=!i;return o&&(i=$).appendChild(e),r=~J.qsa(i,t).indexOf(e),o&&$.removeChild(e),r},T=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},E=function(e){return M.call(e,function(t,n){return e.indexOf(t)==n})},J.fragment=function(e,t,n){var r,i,s;return L.test(e)&&(r=C(A.createElement(RegExp.$1))),r||(e.replace&&(e=e.replace(V,"<$1></$2>")),t===w&&(t=D.test(e)&&RegExp.$1),t in z||(t="*"),s=z[t],s.innerHTML=""+e,r=C.each(O.call(s.childNodes),function(){s.removeChild(this)})),o(n)&&(i=C(r),C.each(n,function(e,t){W.indexOf(e)>-1?i[e](t):i.attr(e,t)})),r},J.Z=function(e,t){return new h(e,t)},J.isZ=function(e){return e instanceof J.Z},J.init=function(e,n){var r;if(!e)return J.Z();if("string"==typeof e)if(e=e.trim(),"<"==e[0]&&D.test(e))r=J.fragment(e,RegExp.$1,n),e=null;else{if(n!==w)return C(n).find(e);r=J.qsa(A,e)}else{if(t(e))return C(A).ready(e);if(J.isZ(e))return e;if(Q(e))r=a(e);else if(i(e))r=[e],e=null;else if(D.test(e))r=J.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==w)return C(n).find(e);r=J.qsa(A,e)}}return J.Z(r,e)},C=function(e,t){return J.init(e,t)},C.extend=function(e){var t,n=O.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){v(e,n,t)}),e},J.qsa=function(e,t){var n,r="#"==t[0],i=!r&&"."==t[0],o=r||i?t.slice(1):t,s=Y.test(o);return e.getElementById&&s&&r?(n=e.getElementById(o))?[n]:[]:1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType?[]:O.call(s&&!r&&e.getElementsByClassName?i?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))},C.contains=A.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},C.type=e,C.isFunction=t,C.isWindow=n,C.isArray=Q,C.isPlainObject=o,C.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},C.isNumeric=function(e){var t=Number(e),n=typeof e;return null!=e&&"boolean"!=n&&("string"!=n||e.length)&&!isNaN(t)&&isFinite(t)||!1},C.inArray=function(e,t,n){return R.indexOf.call(t,e,n)},C.camelCase=T,C.trim=function(e){return null==e?"":String.prototype.trim.call(e)},C.uuid=0,C.support={},C.expr={},C.noop=function(){},C.map=function(e,t){var n,r,i,o=[];if(s(e))for(r=0;r<e.length;r++)n=t(e[r],r),null!=n&&o.push(n);else for(i in e)n=t(e[i],i),null!=n&&o.push(n);return c(o)},C.each=function(e,t){var n,r;if(s(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},C.grep=function(e,t){return M.call(e,t)},window.JSON&&(C.parseJSON=JSON.parse),C.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){K["[object "+t+"]"]=t.toLowerCase()}),C.fn={constructor:J.Z,length:0,forEach:R.forEach,reduce:R.reduce,push:R.push,sort:R.sort,splice:R.splice,indexOf:R.indexOf,concat:function(){var e,t,n=[];for(e=0;e<arguments.length;e++)t=arguments[e],n[e]=J.isZ(t)?t.toArray():t;return k.apply(J.isZ(this)?this.toArray():this,n)},map:function(e){return C(C.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return C(O.apply(this,arguments))},ready:function(e){return H.test(A.readyState)&&A.body?e(C):A.addEventListener("DOMContentLoaded",function(){e(C)},!1),this},get:function(e){return e===w?O.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return R.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return t(e)?this.not(this.not(e)):C(M.call(this,function(t){return J.matches(t,e)}))},add:function(e,t){return C(E(this.concat(C(e,t))))},is:function(e){return this.length>0&&J.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==w)this.each(function(t){e.call(this,t)||n.push(this)});else{var r="string"==typeof e?this.filter(e):s(e)&&t(e.item)?O.call(e):C(e);this.forEach(function(e){r.indexOf(e)<0&&n.push(e)})}return C(n)},has:function(e){return this.filter(function(){return i(e)?C.contains(this,e):C(this).find(e).size()})},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!i(e)?e:C(e)},last:function(){var e=this[this.length-1];return e&&!i(e)?e:C(e)},find:function(e){var t,n=this;return t=e?"object"==typeof e?C(e).filter(function(){var e=this;return R.some.call(n,function(t){return C.contains(t,e)})}):1==this.length?C(J.qsa(this[0],e)):this.map(function(){return J.qsa(this,e)}):C()},closest:function(e,t){var n=[],i="object"==typeof e&&C(e);return this.each(function(o,s){for(;s&&!(i?i.indexOf(s)>=0:J.matches(s,e));)s=s!==t&&!r(s)&&s.parentNode;s&&n.indexOf(s)<0&&n.push(s)}),C(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=C.map(n,function(e){if((e=e.parentNode)&&!r(e)&&t.indexOf(e)<0)return t.push(e),e});return m(t,e)},parent:function(e){return m(E(this.pluck("parentNode")),e)},children:function(e){return m(this.map(function(){return p(this)}),e)},contents:function(){return this.map(function(){return this.contentDocument||O.call(this.childNodes)})},siblings:function(e){return m(this.map(function(e,t){return M.call(p(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return C.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=l(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var r=C(e).get(0),i=r.parentNode||this.length>1;return this.each(function(t){C(this).wrapAll(n?e.call(this,t):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){C(this[0]).before(e=C(e));for(var t;(t=e.children()).length;)e=t.first();C(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var r=C(this),i=r.contents(),o=n?e.call(this,t):e;i.length?i.wrapAll(o):r.append(o)})},unwrap:function(){return this.parent().each(function(){C(this).replaceWith(C(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=C(this);(e===w?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return C(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return C(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;C(this).empty().append(b(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=b(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(i(e))for(x in e)_(this,x,e[x]);else _(this,e,b(this,t,n,this.getAttribute(e)))}):0 in this&&1==this[0].nodeType&&null!=(n=this[0].getAttribute(e))?n:w},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){_(this,e)},this)})},prop:function(e,t){return e=Z[e]||e,1 in arguments?this.each(function(n){this[e]=b(this,t,n,this[e])}):this[0]&&this[0][e]},removeProp:function(e){return e=Z[e]||e,this.each(function(){delete this[e]})},data:function(e,t){var n="data-"+e.replace(U,"-$1").toLowerCase(),r=1 in arguments?this.attr(n,t):this.attr(n);return null!==r?y(r):w},val:function(e){return 0 in arguments?(null==e&&(e=""),this.each(function(t){this.value=b(this,e,t,this.value)})):this[0]&&(this[0].multiple?C(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=C(this),r=b(this,e,t,n.offset()),i=n.offsetParent().offset(),o={top:r.top-i.top,left:r.left-i.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;if(A.documentElement!==this[0]&&!C.contains(A.documentElement,this[0]))return{top:0,left:0};var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var r=this[0];if("string"==typeof t){if(!r)return;return r.style[T(t)]||getComputedStyle(r,"").getPropertyValue(t)}if(Q(t)){if(!r)return;var i={},o=getComputedStyle(r,"");return C.each(t,function(e,t){i[t]=r.style[T(t)]||o.getPropertyValue(t)}),i}}var s="";if("string"==e(t))n||0===n?s=u(t)+":"+f(t,n):this.each(function(){this.style.removeProperty(u(t))});else for(x in t)t[x]||0===t[x]?s+=u(x)+":"+f(x,t[x])+";":this.each(function(){this.style.removeProperty(u(x))});return this.each(function(){this.style.cssText+=";"+s})},index:function(e){return e?this.indexOf(C(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&R.some.call(this,function(e){return this.test(g(e))},d(e))},addClass:function(e){return e?this.each(function(t){if("className"in this){I=[];var n=g(this),r=b(this,e,t,n);r.split(/\s+/g).forEach(function(e){C(this).hasClass(e)||I.push(e)},this),I.length&&g(this,n+(n?" ":"")+I.join(" "))}}):this},removeClass:function(e){return this.each(function(t){if("className"in this){if(e===w)return g(this,"");I=g(this),b(this,e,t,I).split(/\s+/g).forEach(function(e){I=I.replace(d(e)," ")}),g(this,I.trim())}})},toggleClass:function(e,t){return e?this.each(function(n){var r=C(this),i=b(this,e,n,g(this));i.split(/\s+/g).forEach(function(e){(t===w?!r.hasClass(e):t)?r.addClass(e):r.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===w?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===w?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),r=F.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(C(e).css("margin-top"))||0,n.left-=parseFloat(C(e).css("margin-left"))||0,r.top+=parseFloat(C(t[0]).css("border-top-width"))||0,r.left+=parseFloat(C(t[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||A.body;e&&!F.test(e.nodeName)&&"static"==C(e).css("position");)e=e.offsetParent;return e})}},C.fn.detach=C.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});C.fn[e]=function(i){var o,s=this[0];return i===w?n(s)?s["inner"+t]:r(s)?s.documentElement["scroll"+t]:(o=this.offset())&&o[e]:this.each(function(t){s=C(this),s.css(e,b(this,i,t,s[e]()))})}}),B.forEach(function(t,n){var r=n%2;C.fn[t]=function(){var t,i,o=C.map(arguments,function(n){var r=[];return t=e(n),"array"==t?(n.forEach(function(e){return e.nodeType!==w?r.push(e):C.zepto.isZ(e)?r=r.concat(e.get()):void(r=r.concat(J.fragment(e)))}),r):"object"==t||null==n?n:J.fragment(n)}),s=this.length>1;return o.length<1?this:this.each(function(e,t){i=r?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var a=C.contains(A.documentElement,i);o.forEach(function(e){if(s)e=e.cloneNode(!0);else if(!i)return C(e).remove();i.insertBefore(e,t),a&&S(e,function(e){if(!(null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src)){var t=e.ownerDocument?e.ownerDocument.defaultView:window;t.eval.call(t,e.innerHTML)}})})})},C.fn[r?t+"To":"insert"+(n?"Before":"After")]=function(e){return C(e)[t](this),this}}),J.Z.prototype=h.prototype=C.fn,J.uniq=E,J.deserializeValue=y,C.zepto=J,C}();return window.Zepto=t,void 0===window.$&&(window.$=t),e.exports=t,function(e){function t(e){return e._zid||(e._zid=l++)}function n(e,n,o,s){if(n=r(n),n.ns)var a=i(n.ns);return(m[t(e)]||[]).filter(function(e){return e&&(!n.e||e.e==n.e)&&(!n.ns||a.test(e.ns))&&(!o||t(e.fn)===t(o))&&(!s||e.sel==s)})}function r(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function i(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function o(e,t){return e.del&&!_&&e.e in g||!!t}function s(e){return y[e]||_&&g[e]||e}function a(n,i,a,c,d,l,p){var h=t(n),v=m[h]||(m[h]=[]);i.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(a);var i=r(t);i.fn=a,i.sel=d,i.e in y&&(a=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return i.fn.apply(this,arguments)}),i.del=l;var h=l||a;i.proxy=function(e){if(e=u(e),!e.isImmediatePropagationStopped()){e.data=c;var t=h.apply(n,e._args==f?[e]:[e].concat(e._args));return t===!1&&(e.preventDefault(),e.stopPropagation()),t}},i.i=v.length,v.push(i),"addEventListener"in n&&n.addEventListener(s(i.e),i.proxy,o(i,p))})}function c(e,r,i,a,c){var u=t(e);(r||"").split(/\s/).forEach(function(t){n(e,t,i,a).forEach(function(t){delete m[u][t.i],"removeEventListener"in e&&e.removeEventListener(s(t.e),t.proxy,o(t,c))})})}function u(t,n){return!n&&t.isDefaultPrevented||(n||(n=t),e.each(C,function(e,r){var i=n[e];t[e]=function(){return this[r]=S,i&&i.apply(n,arguments)},t[r]=w}),t.timeStamp||(t.timeStamp=Date.now()),(n.defaultPrevented!==f?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=S)),t}function d(e){var t,n={originalEvent:e};for(t in e)x.test(t)||e[t]===f||(n[t]=e[t]);return u(n,e)}var f,l=1,p=Array.prototype.slice,h=e.isFunction,v=function(e){return"string"==typeof e},m={},b={},_="onfocusin"in window,g={focus:"focusin",blur:"focusout"},y={mouseenter:"mouseover",mouseleave:"mouseout"};b.click=b.mousedown=b.mouseup=b.mousemove="MouseEvents",e.event={add:a,remove:c},e.proxy=function(n,r){var i=2 in arguments&&p.call(arguments,2);if(h(n)){var o=function(){return n.apply(r,i?i.concat(p.call(arguments)):arguments)};return o._zid=t(n),o}if(v(r))return i?(i.unshift(n[r],n),e.proxy.apply(null,i)):e.proxy(n[r],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var S=function(){return!0},w=function(){return!1},x=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,C={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r,i,o){var s,u,l=this;return t&&!v(t)?(e.each(t,function(e,t){l.on(e,n,r,t,o)}),l):(v(n)||h(i)||i===!1||(i=r,r=n,n=f),i!==f&&r!==!1||(i=r,r=f),i===!1&&(i=w),l.each(function(f,l){o&&(s=function(e){return c(l,e.type,i),i.apply(this,arguments)}),n&&(u=function(t){var r,o=e(t.target).closest(n,l).get(0);if(o&&o!==l)return r=e.extend(d(t),{currentTarget:o,liveFired:l}),(s||i).apply(o,[r].concat(p.call(arguments,1)))}),a(l,t,i,r,n,u||s)}))},e.fn.off=function(t,n,r){var i=this;return t&&!v(t)?(e.each(t,function(e,t){i.off(e,n,t)}),i):(v(n)||h(r)||r===!1||(r=n,n=f),r===!1&&(r=w),i.each(function(){c(this,t,r,n)}))},e.fn.trigger=function(t,n){return t=v(t)||e.isPlainObject(t)?e.Event(t):u(t),t._args=n,this.each(function(){t.type in g&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,r){var i,o;return this.each(function(s,a){i=d(v(t)?e.Event(t):t),i._args=r,i.target=a,e.each(n(a,t.type||t),function(e,t){if(o=t.proxy(i),i.isImmediatePropagationStopped())return!1})}),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){v(e)||(t=e,e=t.type);var n=document.createEvent(b[e]||"Events"),r=!0;if(t)for(var i in t)"bubbles"==i?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),u(n)}}(t),function(e){function t(t,n,r){var i=e.Event(n);return e(t).trigger(i,r),!i.isDefaultPrevented()}function n(e,n,r,i){if(e.global)return t(n||g,r,i)}function r(t){t.global&&0===e.active++&&n(t,null,"ajaxStart")}function i(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var r=t.context;return t.beforeSend.call(r,e,t)!==!1&&n(t,r,"ajaxBeforeSend",[e,t])!==!1&&void n(t,r,"ajaxSend",[e,t])}function s(e,t,r,i){var o=r.context,s="success";r.success.call(o,e,s,t),i&&i.resolveWith(o,[e,s,t]),n(r,o,"ajaxSuccess",[t,r,e]),c(s,t,r)}function a(e,t,r,i,o){var s=i.context;i.error.call(s,r,t,e),o&&o.rejectWith(s,[r,t,e]),n(i,s,"ajaxError",[r,i,e||t]),c(t,r,i)}function c(e,t,r){var o=r.context;r.complete.call(o,t,e),n(r,o,"ajaxComplete",[t,r]),i(r)}function u(e,t,n){if(n.dataFilter==d)return e;var r=n.context;return n.dataFilter.call(r,e,t)}function d(){}function f(e){return e&&(e=e.split(";",2)[0]),e&&(e==C?"html":e==x?"json":S.test(e)?"script":w.test(e)&&"xml")||"text"}function l(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function p(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()&&"jsonp"!=t.dataType||(t.url=l(t.url,t.data),t.data=void 0)}function h(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}function v(t,n,r,i){var o,s=e.isArray(n),a=e.isPlainObject(n);e.each(n,function(n,c){o=e.type(c),i&&(n=r?i:i+"["+(a||"object"==o||"array"==o?n:"")+"]"),!i&&s?t.add(c.name,c.value):"array"==o||!r&&"object"==o?v(t,c,r,n):t.add(n,c)})}var m,b,_=+new Date,g=window.document,y=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,S=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,x="application/json",C="text/html",I=/^\s*$/,T=g.createElement("a");T.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var r,i,c=t.jsonpCallback,u=(e.isFunction(c)?c():c)||"Zepto"+_++,d=g.createElement("script"),f=window[u],l=function(t){e(d).triggerHandler("error",t||"abort")},p={abort:l};return n&&n.promise(p),e(d).on("load error",function(o,c){clearTimeout(i),e(d).off().remove(),"error"!=o.type&&r?s(r[0],p,t,n):a(null,c||"error",p,t,n),window[u]=f,r&&e.isFunction(f)&&f(r[0]),f=r=void 0}),o(p,t)===!1?(l("abort"),p):(window[u]=function(){r=arguments},d.src=t.url.replace(/\?(.+)=\?/,"?$1="+u),g.head.appendChild(d),t.timeout>0&&(i=setTimeout(function(){l("timeout")},t.timeout)),p)},e.ajaxSettings={type:"GET",beforeSend:d,success:d,error:d,complete:d,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:x,xml:"application/xml, text/xml",html:C,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:d},e.ajax=function(t){var n,i,c=e.extend({},t||{}),h=e.Deferred&&e.Deferred();for(m in e.ajaxSettings)void 0===c[m]&&(c[m]=e.ajaxSettings[m]);r(c),c.crossDomain||(n=g.createElement("a"),n.href=c.url,n.href=n.href,c.crossDomain=T.protocol+"//"+T.host!=n.protocol+"//"+n.host),c.url||(c.url=window.location.toString()),(i=c.url.indexOf("#"))>-1&&(c.url=c.url.slice(0,i)),p(c);var v=c.dataType,_=/\?.+=\?/.test(c.url);if(_&&(v="jsonp"),c.cache!==!1&&(t&&t.cache===!0||"script"!=v&&"jsonp"!=v)||(c.url=l(c.url,"_="+Date.now())),"jsonp"==v)return _||(c.url=l(c.url,c.jsonp?c.jsonp+"=?":c.jsonp===!1?"":"callback=?")),e.ajaxJSONP(c,h);var y,S=c.accepts[v],w={},x=function(e,t){w[e.toLowerCase()]=[e,t]},C=/^([\w-]+:)\/\//.test(c.url)?RegExp.$1:window.location.protocol,E=c.xhr(),R=E.setRequestHeader;if(h&&h.promise(E),c.crossDomain||x("X-Requested-With","XMLHttpRequest"),x("Accept",S||"*/*"),(S=c.mimeType||S)&&(S.indexOf(",")>-1&&(S=S.split(",",2)[0]),E.overrideMimeType&&E.overrideMimeType(S)),(c.contentType||c.contentType!==!1&&c.data&&"GET"!=c.type.toUpperCase())&&x("Content-Type",c.contentType||"application/x-www-form-urlencoded"),c.headers)for(b in c.headers)x(b,c.headers[b]);if(E.setRequestHeader=x,E.onreadystatechange=function(){if(4==E.readyState){E.onreadystatechange=d,clearTimeout(y);var t,n=!1;if(E.status>=200&&E.status<300||304==E.status||0==E.status&&"file:"==C){if(v=v||f(c.mimeType||E.getResponseHeader("content-type")),"arraybuffer"==E.responseType||"blob"==E.responseType)t=E.response;else{t=E.responseText;try{t=u(t,v,c),"script"==v?(0,eval)(t):"xml"==v?t=E.responseXML:"json"==v&&(t=I.test(t)?null:e.parseJSON(t))}catch(r){n=r}if(n)return a(n,"parsererror",E,c,h)}s(t,E,c,h)}else a(E.statusText||null,E.status?"error":"abort",E,c,h)}},o(E,c)===!1)return E.abort(),a(null,"abort",E,c,h),E;var k=!("async"in c)||c.async;if(E.open(c.type,c.url,k,c.username,c.password),c.xhrFields)for(b in c.xhrFields)E[b]=c.xhrFields[b];for(b in w)R.apply(E,w[b]);return c.timeout>0&&(y=setTimeout(function(){E.onreadystatechange=d,E.abort(),a(null,"timeout",E,c,h)},c.timeout)),E.send(c.data?c.data:null),E},e.get=function(){return e.ajax(h.apply(null,arguments))},e.post=function(){var t=h.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=h.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,r){if(!this.length)return this;var i,o=this,s=t.split(/\s/),a=h(t,n,r),c=a.success;return s.length>1&&(a.url=s[0],i=s[1]),a.success=function(t){o.html(i?e("<div>").html(t.replace(y,"")).find(i):t),c&&c.apply(o,arguments)},e.ajax(a),this};var E=encodeURIComponent;e.param=function(t,n){var r=[];return r.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(E(t)+"="+E(n))},v(r,t,n),r.join("&").replace(/%20/g,"+")}}(t),function(e){e.fn.serializeArray=function(){var t,n,r=[],i=function(e){return e.forEach?e.forEach(i):void r.push({name:t,value:e})};return this[0]&&e.each(this[0].elements,function(r,o){n=o.type,t=o.name,t&&"fieldset"!=o.nodeName.toLowerCase()&&!o.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||o.checked)&&i(e(o).val())}),r},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(0 in arguments)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(t),function(){try{getComputedStyle(void 0)}catch(e){var t=getComputedStyle;window.getComputedStyle=function(e,n){try{return t(e,n)}catch(r){return null}}}}(),t})},function(e,t,n){"use strict";function r(){emedia.util.logger.warn("webrtc-adapter must load once. if more, safari may initC sdp error(too many audio video, easemob server dont work)")}function i(){if(document.documentMode){var e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],t="IE",r=parseInt(e[1],10);r||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],r=parseInt(e[1]||"0",10)),emedia.util.logger.error("adapter.ie not required"),s.__browser=t,s.__browserVersion=r}else s=n(77),emedia.util.logger.info("webrtc-adapter load first"),o();emedia.singleWebrtcAdapter=s}function o(){function e(e,t){e.srcObject=t,emedia.isSafari&&(e.pause(),e.play());var n=emedia.util.logger||window.console||console;if(n){if(t&&n.info("stream attach videoTag.",t.id,t._located,">>",e.id,e.muted,e.volume,e),t||n.info("stream(null) attach videoTag.",e.id,e.muted,e.volume,e),!e.hxSetOnvolumechange){
var r=e.onvolumechange;e.onvolumechange=function(){n.debug("stream attach detail: video tag volume chanage",e.volume,t?t.id:t),r&&r.apply(e,arguments)},e.hxSetOnvolumechange=!0}if(!e.hxSetOnstalled){var i=e.onstalled;e.onstalled=function(){n.debug("stream attach detail: video tag onstalled",t?t.id:t),i&&i.apply(e,arguments)},e.hxSetOnstalled=!0}if(!e.hxSetOnabort){var o=e.onabort;e.onabort=function(){n.debug("stream attach detail: video tag onabort",t?t.id:t),o&&o.apply(e,arguments)},e.hxSetOnabort=!0}if(!e.hxSetOncanplay){var s=e.oncanplay;e.oncanplay=function(){t&&t.getTracks().forEach(function(e){"function"==typeof e.getSettings&&n.debug("stream attach detail",t.id," track setting =",e.enabled,e.id,e.kind,e.label,e.getSettings())}),n.debug("stream attach detail: video tag",e.videoWidth,"x",e.videoHeight,t?t.id:t),s&&s.apply(e,arguments)},e.hxSetOncanplay=!0}}}function t(t,n,r,i){function o(){r=!!(void 0===r?n._located:r),t.muted=!1,r!==t.muted&&(t.muted=!0)}if(i||(i=window.__attachMediaStream)||(i=e.bind(this)),t)return n?t.srcObject&&t.srcObject._located&&n._located&&t.srcObject.id===n.id?t.srcObject:(o(),i(t,n),t):void i(t,n)}window.attachMediaStream&&window.attachMediaStream._wrapped!==!0&&(window.__attachMediaStream=window.attachMediaStream),window.attachMediaStream=t,window.attachMediaStream._wrapped=!0,console&&"function"==typeof console.info&&console.info("Wrap the attachMediaStream ",s.__browser,s.__browserVersion)}Object.defineProperty(t,"__esModule",{value:!0});var s=emedia.singleWebrtcAdapter;r(),s?emedia.util.logger.error("webrtc-adapter repeated load, safari may dont work"):i(),s.__browser=s.__browser||s.browserDetails.browser,s.__browserVersion=s.__browserVersion||s.browserDetails.version,emedia.util.logger.info("Current browser",s.__browser,s.__browserVersion),"Not a supported browser."===s.__browser&&emedia.util.logger.error("Not a supported browser"),t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,o,s,a,a,c=n(78),u=r(c),d=n(73),f=r(d),l=n(82),p=r(l),h=n(85),v=r(h),m=n(107),b=r(m),_=n(110),g=r(_),y=n(126),S=r(y),w=n(3),x=r(w),C=n(54),I=r(C),T=n(2),E=r(T);!function(n){if("object"===(0,E.default)(t)&&"undefined"!=typeof e)e.exports=n();else{o=[],i=n,s="function"==typeof i?i.apply(t,o):i,!(void 0!==s&&(e.exports=s))}}(function(){return function(){function e(t,n,r){function i(s,c){if(!n[s]){if(!t[s]){var u="function"==typeof a&&a;if(!c&&u)return a(s,!0);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return i(n||e)},f,f.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof a&&a,s=0;s<r.length;s++)i(r[s]);return i}return e}()({1:[function(e,t,n){console.warn("webrtc adapter version: 7.6.1");var r=e("./adapter_factory.js"),i=(0,r.adapterFactory)({window:window});t.exports=i},{"./adapter_factory.js":2}],2:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=s.log,i=s.detectBrowser(t),o={browserDetails:i,commonShim:m,extractVersion:s.extractVersion,disableLog:s.disableLog,disableWarnings:s.disableWarnings};switch(i.browser){case"chrome":if(!c||!c.shimPeerConnection||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),o;if(null===i.version)return r("Chrome shim can not determine version, not shimming."),o;r("adapter.js shimming chrome."),o.browserShim=c,c.shimGetUserMedia(t),c.shimMediaStream(t),c.shimPeerConnection(t),c.shimOnTrack(t),c.shimAddTrackRemoveTrack(t),c.shimGetSendersWithDtmf(t),c.shimGetStats(t),c.shimSenderReceiverGetStats(t),c.fixNegotiationNeeded(t),m.shimRTCIceCandidate(t),m.shimConnectionState(t),m.shimMaxMessageSize(t),m.shimSendThrowTypeError(t),m.removeAllowExtmapMixed(t);break;case"firefox":if(!l||!l.shimPeerConnection||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),o;r("adapter.js shimming firefox."),o.browserShim=l,l.shimGetUserMedia(t),l.shimPeerConnection(t),l.shimOnTrack(t),l.shimRemoveStream(t),l.shimSenderGetStats(t),l.shimReceiverGetStats(t),l.shimRTCDataChannel(t),l.shimAddTransceiver(t),l.shimCreateOffer(t),l.shimCreateAnswer(t),m.shimRTCIceCandidate(t),m.shimConnectionState(t),m.shimMaxMessageSize(t),m.shimSendThrowTypeError(t);break;case"edge":if(!d||!d.shimPeerConnection||!n.shimEdge)return r("MS edge shim is not included in this adapter release."),o;r("adapter.js shimming edge."),o.browserShim=d,d.shimGetUserMedia(t),d.shimGetDisplayMedia(t),d.shimPeerConnection(t),d.shimReplaceTrack(t),m.shimMaxMessageSize(t),m.shimSendThrowTypeError(t);break;case"safari":if(!h||!n.shimSafari)return r("Safari shim is not included in this adapter release."),o;r("adapter.js shimming safari."),o.browserShim=h,h.shimRTCIceServerUrls(t),h.shimCreateOfferLegacy(t),h.shimCallbacksAPI(t),h.shimLocalStreamsAPI(t),h.shimRemoteStreamsAPI(t),h.shimTrackEventTransceiver(t),h.shimGetUserMedia(t),h.shimAudioContext(t),m.shimRTCIceCandidate(t),m.shimMaxMessageSize(t),m.shimSendThrowTypeError(t),m.removeAllowExtmapMixed(t);break;default:r("Unsupported browser!")}return o}Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=i;var o=e("./utils"),s=r(o),a=e("./chrome/chrome_shim"),c=r(a),u=e("./edge/edge_shim"),d=r(u),f=e("./firefox/firefox_shim"),l=r(f),p=e("./safari/safari_shim"),h=r(p),v=e("./common_shim"),m=r(v)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t,n){return t in e?(0,S.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function s(e){if("object"!==("undefined"==typeof e?"undefined":m(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)C.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function a(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);t!==-1&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function c(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],o=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var s=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new g.default((0,b.default)(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i(a(s(e)))};return t.apply(this,[c,r])}return new v.default(function(n,r){t.apply(e,[function(e){n(a(s(e)))},r])}).then(i,o)}}}function u(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return C.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),C.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return C.filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],n=void 0,r=void 0,o=void 0;return this.getSenders().forEach(function(e){e.track===t&&(n?o=!0:n=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(r?o=!0:r=e),e.track===t}),o||n&&r?v.default.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():v.default.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function d(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},(0,b.default)(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?this._shimmedLocalStreams[n.id].indexOf(r)===-1&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});if(n)throw new DOMException("Track already exists.","InvalidAccessError")});var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter(function(e){return r.indexOf(e)===-1});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&(0,b.default)(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);r!==-1&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}}function f(e){function t(e,t){var n=t.sdp;return(0,b.default)(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return(0,b.default)(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}if(e.RTCPeerConnection){var r=C.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return d(e);var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t=n.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}s.apply(this,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var s=this._streams[n.id];if(s)s.addTrack(t),v.default.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);this._streams[n.id]=a,this._reverseStreams[a.id]=n,this.addStream(a)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n],o=i({},n,function(){var e=this,n=arguments,i=arguments.length&&"function"==typeof arguments[0];return i?r.apply(this,[function(r){var i=t(e,r);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(n){return t(e,n)})});e.RTCPeerConnection.prototype[n]=o[n]});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=n(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};var u=(0,p.default)(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=u.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var n=e._pc===this;if(!n)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;(0,b.default)(this._streams).forEach(function(n){var i=t._streams[n].getTracks().find(function(t){return e.track===t});i&&(r=t._streams[n])}),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function l(e){var t=C.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],r=i({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=r[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?v.default.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),v.default.resolve())}}}function h(e){var t=C.detectBrowser(e);C.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var m="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)},_=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return _.shimGetUserMedia}});var y=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return y.shimGetDisplayMedia}}),n.shimMediaStream=o,n.shimOnTrack=s,n.shimGetSendersWithDtmf=a,n.shimGetStats=c,n.shimSenderReceiverGetStats=u,n.shimAddTrackRemoveTrackWithNative=d,n.shimAddTrackRemoveTrack=f,n.shimPeerConnection=l,n.fixNegotiationNeeded=h;var w=e("../utils.js"),C=r(w)},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){function r(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices)return"function"!=typeof t?void console.error("shimGetDisplayMedia: getSourceId argument is not a function"):void(e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})})}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=r},{}],5:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){var t=e&&e.navigator;if(t.mediaDevices){var n=a.detectBrowser(e),r=function(e){if("object"!==("undefined"==typeof e?"undefined":o(e))||e.mandatory||e.optional)return e;var t={};return(0,b.default)(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===o(e[n])?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var s={};"number"==typeof r.ideal?(s[i("min",n)]=r.ideal,t.optional.push(s),s={},s[i("max",n)]=r.ideal,t.optional.push(s)):(s[i("",n)]=r.ideal,t.optional.push(s))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if(e=JSON.parse((0,f.default)(e)),e&&"object"===o(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse((0,f.default)(e)),s(e.audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"===o(e.video)){var a=e.video.facingMode;a=a&&("object"===("undefined"==typeof a?"undefined":o(a))?a:{ideal:a});var u=n.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||u)){delete e.video.facingMode;var d=void 0;if("environment"===a.exact||"environment"===a.ideal?d=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return d.some(function(t){return e.label.toLowerCase().includes(t)})});return!n&&t.length&&d.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=a.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),c("chrome: "+(0,f.default)(e)),i(e)})}e.video=r(e.video)}return c("chrome: "+(0,f.default)(e)),i(e)},s=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},u=function(e,n,r){i(e,function(e){t.webkitGetUserMedia(e,n,function(e){r&&r(s(e))})})};if(t.getUserMedia=u.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return v.default.reject(s(e))})})}}}}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)};n.shimGetUserMedia=i;var s=e("../utils.js"),a=r(s),c=a.log},{"../utils.js":15}],6:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===("undefined"==typeof e?"undefined":l(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse((0,f.default)(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=h.default.parseCandidate(e.candidate),i=(0,u.default)(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,m.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function s(e){if(e.RTCPeerConnection){var t=m.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=h.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=h.default.parseMLine(e);return t&&"application"===t.kind&&t.protocol.indexOf("SCTP")!==-1})},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!==n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?e===-1?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=h.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&n!==-1&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),a=e.sdpSemantics;"plan-b"===a&&Object.defineProperty(this,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var c=r(arguments[0]),u=i(c),d=o(arguments[0],c),f=void 0;f=0===u&&0===d?Number.POSITIVE_INFINITY:0===u||0===d?Math.max(u,d):Math.min(u,d);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return f}}),this._sctp=l}return s.apply(this,arguments)}}}function a(e){function t(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return t(e,this),e},m.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}}function c(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}}function d(e){if(e.RTCPeerConnection){var t=m.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&e.sdp.indexOf("\na=extmap-allow-mixed")!==-1&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),n.apply(this,arguments)}}}}Object.defineProperty(n,"__esModule",{value:!0});var l="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)};n.shimRTCIceCandidate=o,n.shimMaxMessageSize=s,n.shimSendThrowTypeError=a,n.shimConnectionState=c,n.removeAllowExtmapMixed=d;var p=e("sdp"),h=i(p),v=e("./utils"),m=r(v)},{"./utils":15,sdp:17}],7:[function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){var t=d.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=(0,p.default)(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=(0,h.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,f.filterIceServers)(e.iceServers,t.version),d.log("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype}function s(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack);
}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var a=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return a.shimGetUserMedia}});var c=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return c.shimGetDisplayMedia}}),n.shimPeerConnection=o,n.shimReplaceTrack=s;var u=e("../utils"),d=i(u),f=e("./filtericeservers"),l=e("rtcpeerconnection-shim"),h=r(l)},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){var n=!1;return e=JSON.parse((0,f.default)(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&s.deprecated("RTCIceServer.url","RTCIceServer.urls");var r="string"==typeof t;return r&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n}),delete e.url,e.urls=r?t[0]:t,!!t.length}})}Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=i;var o=e("../utils"),s=r(o)},{"../utils":15}],9:[function(e,t,n){function r(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=r},{}],10:[function(e,t,n){function r(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return v.default.reject(n(e))})}}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=r},{}],11:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t,n){return t in e?(0,S.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){"object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function s(e){var t=w.detectBrowser(e);if("object"===("undefined"==typeof e?"undefined":m(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],r=i({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=r[t]}),t.version<68){var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?v.default.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),v.default.resolve())}}var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],i=e[1],s=e[2];return o.apply(this,[n||null]).then(function(e){if(t.version<53&&!i)try{e.forEach(function(e){e.type=r[e.type]||e.type})}catch(n){if("TypeError"!==n.name)throw n;e.forEach(function(t,n){e.set(n,(0,u.default)({},t,{type:r[t.type]||t.type}))})}return e}).then(i,s)}}}function a(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):v.default.resolve(new g.default)}}}function c(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n}),w.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function d(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;w.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)})})}function f(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function l(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach(function(e){if("rid"in e){var t=/^[a-z0-9]{0,16}$/i;if(!t.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var r=t.apply(this,arguments);if(n){var i=r.sender,o=i.getParameters();"encodings"in o||(o.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).catch(function(){})))}return r})}}function p(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?v.default.all(this.setParametersPromises).then(function(){return t.apply(e,n)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}}function h(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?v.default.all(this.setParametersPromises).then(function(){return t.apply(e,n)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var m="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)},b=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return b.shimGetUserMedia}});var _=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _.shimGetDisplayMedia}}),n.shimOnTrack=o,n.shimPeerConnection=s,n.shimSenderGetStats=a,n.shimReceiverGetStats=c,n.shimRemoveStream=d,n.shimRTCDataChannel=f,n.shimAddTransceiver=l,n.shimCreateOffer=p,n.shimCreateAnswer=h;var y=e("../utils"),w=r(y)},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,n){function r(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,v.default.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=r},{}],13:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){var t=a.detectBrowser(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){a.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===("undefined"==typeof e?"undefined":o(e))&&"object"===o(e.audio)&&(e=JSON.parse((0,f.default)(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},r&&r.prototype.getSettings){var c=r.prototype.getSettings;r.prototype.getSettings=function(){var e=c.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var u=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===("undefined"==typeof e?"undefined":o(e))&&(e=JSON.parse((0,f.default)(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)};n.shimGetUserMedia=i;var s=e("../utils"),a=r(s)},{"../utils":15}],14:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(r){return t.call(n,r,e)}),e.getVideoTracks().forEach(function(r){return t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i&&i.forEach(function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(n!==-1){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach(function(e){r.includes(e.track)&&t.removeTrack(e)})}})}}function o(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}}function s(e){if("object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),v.default.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),v.default.resolve()):i};var a=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),v.default.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),v.default.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),v.default.resolve()):r},t.addIceCandidate=a}}function a(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(c(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function c(e){return e&&void 0!==e.video?(0,u.default)({},e,{video:_.compactObject(e.video)}):e}function d(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(_.deprecated("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse((0,f.default)(o)),o.urls=o.url,delete o.url,r.push(o)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function l(e){"object"===("undefined"==typeof e?"undefined":m(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function p(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!=typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});e.offerToReceiveAudio===!1&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveAudio!==!0||n||this.addTransceiver("audio"),"undefined"!=typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});e.offerToReceiveVideo===!1&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):e.offerToReceiveVideo!==!0||r||this.addTransceiver("video")}return t.apply(this,arguments)}}function h(e){"object"!==("undefined"==typeof e?"undefined":m(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}Object.defineProperty(n,"__esModule",{value:!0});var m="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)};n.shimLocalStreamsAPI=i,n.shimRemoteStreamsAPI=o,n.shimCallbacksAPI=s,n.shimGetUserMedia=a,n.shimConstraints=c,n.shimRTCIceServerUrls=d,n.shimTrackEventTransceiver=l,n.shimCreateOfferLegacy=p,n.shimAudioContext=h;var b=e("../utils"),_=r(b)},{"../utils":15}],15:[function(e,t,n){function r(e,t,n){return t in e?(0,S.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function o(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},(0,S.default)(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function s(e){return"boolean"!=typeof e?new Error("Argument type: "+("undefined"==typeof e?"undefined":m(e))+". Please use a boolean."):(_=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function a(e){return"boolean"!=typeof e?new Error("Argument type: "+("undefined"==typeof e?"undefined":m(e))+". Please use a boolean."):(y=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function c(){if("object"===("undefined"==typeof window?"undefined":m(window))){if(_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function d(e,t){y&&console.warn(e+" is deprecated, please use "+t+" instead.")}function f(e){var t=e.navigator,n={browser:null,version:null};if("undefined"==typeof e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=i(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=i(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=i(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=i(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function l(e){return"[object Object]"===Object.prototype.toString.call(e)}function p(e){return l(e)?(0,b.default)(e).reduce(function(t,n){var i=l(e[n]),o=i?p(e[n]):e[n],s=i&&!(0,b.default)(o).length;return void 0===o||s?t:(0,u.default)(t,r({},n,o))},{}):e}function h(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),(0,b.default)(t).forEach(function(r){r.endsWith("Id")?h(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(function(t){h(e,e.get(t),n)})}))}function v(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new g.default;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(n){n.type===r&&n.trackId===t.id&&h(e,n,i)})}),i}Object.defineProperty(n,"__esModule",{value:!0});var m="function"==typeof I.default&&"symbol"===(0,E.default)(x.default)?function(e){return"undefined"==typeof e?"undefined":(0,E.default)(e)}:function(e){return e&&"function"==typeof I.default&&e.constructor===I.default&&e!==I.default.prototype?"symbol":"undefined"==typeof e?"undefined":(0,E.default)(e)};n.extractVersion=i,n.wrapPeerConnectionEvent=o,n.disableLog=s,n.disableWarnings=a,n.log=c,n.deprecated=d,n.detectBrowser=f,n.compactObject=p,n.walkStats=h,n.filterStats=v;var _=!0,y=!0},{}],16:[function(e,t,n){function r(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function i(e,t,n,r,i){var o=l.writeRtpDescription(e.kind,t);if(o+=l.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var a="msid:"+(r?r.id:"-")+" "+s+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),o}function o(e,t){var n=!1;return e=JSON.parse((0,f.default)(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){var r=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;return r?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&e.indexOf("?transport=udp")===-1}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}function s(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),s=r(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(r.name.toLowerCase()===s.name.toLowerCase()&&r.clockRate===s.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&s.parameters.apt&&!i(r,s,e.codecs,t.codecs))continue;s=JSON.parse((0,f.default)(s)),s.numChannels=Math.min(r.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}function c(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function d(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var l=e("sdp");t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function p(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function h(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var m=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse((0,f.default)(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=o(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(m.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(m.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),m.prototype.onicecandidate=null,m.prototype.onaddstream=null,m.prototype.ontrack=null,m.prototype.onremovestream=null,m.prototype.onsignalingstatechange=null,m.prototype.oniceconnectionstatechange=null,m.prototype.onconnectionstatechange=null,m.prototype.onicegatheringstatechange=null,m.prototype.onnegotiationneeded=null,m.prototype.ondatachannel=null,m.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},m.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},m.prototype.getConfiguration=function(){return this._config},m.prototype.getLocalStreams=function(){return this.localStreams},m.prototype.getRemoteStreams=function(){return this.remoteStreams},m.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},m.prototype.addTrack=function(t,n){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r=this.transceivers.find(function(e){return e.track===t});if(r)throw d("InvalidAccessError","Track already exists.");for(var i,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(i=this.transceivers[o]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(n)===-1&&this.localStreams.push(n),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},m.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},m.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw d("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null;var i=this.transceivers.map(function(e){return e.stream});i.indexOf(r)===-1&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},m.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},m.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},m.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},m.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===(0,b.default)(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},m.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,a=!s||0===(0,b.default)(s).length;if(a)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),s.component=1,s.ufrag=i.getLocalParameters().usernameFragment;var c=l.writeCandidate(s);o.candidate=(0,u.default)(o.candidate,l.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=l.getMediaSections(r._localDescription.sdp);a?d[o.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n":d[o.candidate.sdpMLineIndex]+="a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=l.getDescription(r._localDescription.sdp)+d.join("");var f=r.transceivers.every(function(e){
return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),a||r._dispatchEvent("icecandidate",o),f&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},m.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},m.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},m.prototype._transceive=function(e,n,r){var i=s(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:l.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},m.prototype.setLocalDescription=function(e){var t=this;if(["offer","answer"].indexOf(e.type)===-1)return v.default.reject(d("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,t.signalingState)||t._isClosed)return v.default.reject(d("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));var n,r;if("offer"===e.type)n=l.splitSections(e.sdp),r=n.shift(),n.forEach(function(e,n){var r=l.parseRtpParameters(e);t.transceivers[n].localCapabilities=r}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){n=l.splitSections(t._remoteDescription.sdp),r=n.shift();var i=l.matchPrefix(r,"a=ice-lite").length>0;n.forEach(function(e,n){var o=t.transceivers[n],a=o.iceGatherer,c=o.iceTransport,u=o.dtlsTransport,d=o.localCapabilities,f=o.remoteCapabilities,p=l.isRejected(e)&&0===l.matchPrefix(e,"a=bundle-only").length;if(!p&&!o.rejected){var h=l.getIceParameters(e,r),v=l.getDtlsParameters(e,r);i&&(v.role="server"),t.usingBundle&&0!==n||(t._gather(o.mid,n),"new"===c.state&&c.start(a,h,i?"controlling":"controlled"),"new"===u.state&&u.start(v));var m=s(d,f);t._transceive(o,m.codecs.length>0,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),v.default.resolve()},m.prototype.setRemoteDescription=function(r){var i=this;if(["offer","answer"].indexOf(r.type)===-1)return v.default.reject(d("TypeError",'Unsupported type "'+r.type+'"'));if(!a("setRemoteDescription",r.type,i.signalingState)||i._isClosed)return v.default.reject(d("InvalidStateError","Can not set remote "+r.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var u=[],f=l.splitSections(r.sdp),m=f.shift(),_=l.matchPrefix(m,"a=ice-lite").length>0,g=l.matchPrefix(m,"a=group:BUNDLE ").length>0;i.usingBundle=g;var y=l.matchPrefix(m,"a=ice-options:")[0];return y?i.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0:i.canTrickleIceCandidates=!1,f.forEach(function(a,d){var f=l.splitLines(a),h=l.getKind(a),v=l.isRejected(a)&&0===l.matchPrefix(a,"a=bundle-only").length,b=f[0].substr(2).split(" ")[2],y=l.getDirection(a,m),S=l.parseMsid(a),w=l.getMid(a)||l.generateIdentifier();if(v||"application"===h&&("DTLS/SCTP"===b||"UDP/DTLS/SCTP"===b))return void(i.transceivers[d]={mid:w,kind:h,protocol:b,rejected:!0});!v&&i.transceivers[d]&&i.transceivers[d].rejected&&(i.transceivers[d]=i._createTransceiver(h,!0));var x,C,I,T,E,R,k,M,O,A,P,j=l.parseRtpParameters(a);v||(A=l.getIceParameters(a,m),P=l.getDtlsParameters(a,m),P.role="client"),k=l.parseRtpEncodingParameters(a);var N=l.parseRtcpParameters(a),D=l.matchPrefix(a,"a=end-of-candidates",m).length>0,L=l.matchPrefix(a,"a=candidate:").map(function(e){return l.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!v&&g&&d>0&&i.transceivers[d]&&(i._disposeIceAndDtlsTransports(d),i.transceivers[d].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[d].iceTransport=i.transceivers[0].iceTransport,i.transceivers[d].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[d].rtpSender&&i.transceivers[d].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[d].rtpReceiver&&i.transceivers[d].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==r.type||v){if("answer"===r.type&&!v){x=i.transceivers[d],C=x.iceGatherer,I=x.iceTransport,T=x.dtlsTransport,E=x.rtpReceiver,R=x.sendEncodingParameters,M=x.localCapabilities,i.transceivers[d].recvEncodingParameters=k,i.transceivers[d].remoteCapabilities=j,i.transceivers[d].rtcpParameters=N,L.length&&"new"===I.state&&(!_&&!D||g&&0!==d?L.forEach(function(e){c(x.iceTransport,e)}):I.setRemoteCandidates(L)),g&&0!==d||("new"===I.state&&I.start(C,A,"controlling"),"new"===T.state&&T.start(P));var V=s(x.localCapabilities,x.remoteCapabilities),F=V.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!F&&x.sendEncodingParameters[0].rtx&&delete x.sendEncodingParameters[0].rtx,i._transceive(x,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!E||"sendrecv"!==y&&"sendonly"!==y?delete x.rtpReceiver:(O=E.track,S?(o[S.stream]||(o[S.stream]=new e.MediaStream),n(O,o[S.stream]),u.push([O,E,o[S.stream]])):(o.default||(o.default=new e.MediaStream),n(O,o.default),u.push([O,E,o.default])))}}else{x=i.transceivers[d]||i._createTransceiver(h),x.mid=w,x.iceGatherer||(x.iceGatherer=i._createIceGatherer(d,g)),L.length&&"new"===x.iceTransport.state&&(!D||g&&0!==d?L.forEach(function(e){c(x.iceTransport,e)}):x.iceTransport.setRemoteCandidates(L)),M=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(M.codecs=M.codecs.filter(function(e){return"rtx"!==e.name})),R=x.sendEncodingParameters||[{ssrc:1001*(2*d+2)}];var U=!1;if("sendrecv"===y||"sendonly"===y){if(U=!x.rtpReceiver,E=x.rtpReceiver||new e.RTCRtpReceiver(x.dtlsTransport,h),U){var W;O=E.track,S&&"-"===S.stream||(S?(o[S.stream]||(o[S.stream]=new e.MediaStream,Object.defineProperty(o[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(O,"id",{get:function(){return S.track}}),W=o[S.stream]):(o.default||(o.default=new e.MediaStream),W=o.default)),W&&(n(O,W),x.associatedRemoteMediaStreams.push(W)),u.push([O,E,W])}}else x.rtpReceiver&&x.rtpReceiver.track&&(x.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===x.rtpReceiver.track.id});t&&p(t,e)}),x.associatedRemoteMediaStreams=[]);x.localCapabilities=M,x.remoteCapabilities=j,x.rtpReceiver=E,x.rtcpParameters=N,x.sendEncodingParameters=R,x.recvEncodingParameters=k,i._transceive(i.transceivers[d],!1,U)}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===r.type?"active":"passive"),i._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),(0,b.default)(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(i.remoteStreams.indexOf(n)===-1){i.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){i._dispatchEvent("addstream",r)})}u.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&h(i,t,r,[n])})}}),u.forEach(function(e){e[2]||h(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),v.default.resolve()},m.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},m.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},m.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},m.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},m.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},m.prototype.createOffer=function(){var n=this;if(n._isClosed)return v.default.reject(d("InvalidStateError","Can not call createOffer after close"));var r=n.transceivers.filter(function(e){return"audio"===e.kind}).length,o=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(r=s.offerToReceiveAudio===!0?1:s.offerToReceiveAudio===!1?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=s.offerToReceiveVideo===!0?1:s.offerToReceiveVideo===!1?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?(r--,r<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});r>0||o>0;)r>0&&(n._createTransceiver("audio"),r--),o>0&&(n._createTransceiver("video"),o--);var a=l.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,i){var o=r.track,s=r.kind,a=r.mid||l.generateIdentifier();r.mid=a,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(i,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(s);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){var t=r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[];t.forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=r.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,s)),r.localCapabilities=c,r.sendEncodingParameters=u}),"max-compat"!==n._config.bundlePolicy&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){a+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,a+="a="+l.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:a});return v.default.resolve(c)},m.prototype.createAnswer=function(){var n=this;if(n._isClosed)return v.default.reject(d("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return v.default.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=l.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var o=l.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,a){if(!(a+1>o)){if(e.rejected)return"application"===e.kind?r+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var u=s(e.localCapabilities,e.remoteCapabilities),d=u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!d&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var a=new e.RTCSessionDescription({type:"answer",sdp:r});return v.default.resolve(a)},m.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?v.default.reject(new TypeError("sdpMLineIndex or sdpMid required")):new v.default(function(r,i){if(!n._remoteDescription)return i(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<n.transceivers.length;s++)if(n.transceivers[s].mid===e.sdpMid){o=s;break}var a=n.transceivers[o];if(!a)return i(d("OperationError","Can not add ICE candidate"));if(a.rejected)return r();var u=(0,b.default)(e.candidate).length>0?l.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return r();if(u.component&&1!==u.component)return r();if((0===o||o>0&&a.iceTransport!==n.transceivers[0].iceTransport)&&!c(a.iceTransport,u))return i(d("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),t=l.getMediaSections(n._remoteDescription.sdp),t[o]+="a="+(u.type?f:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=l.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var p=0;p<n.transceivers.length&&(n.transceivers[p].rejected||(n.transceivers[p].iceTransport.addRemoteCandidate({}),t=l.getMediaSections(n._remoteDescription.sdp),t[p]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=l.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));p++);r()})},m.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw d("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),v.default.all(r).then(function(e){var t=new g.default;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};var _=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];_.forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new g.default;return(0,b.default)(e).forEach(function(n){e[n].type=r(e[n]),t.set(n,e[n])}),t})}}});var y=["createOffer","createAnswer"];return y.forEach(function(e){var t=m.prototype[e];m.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),y=["setLocalDescription","setRemoteDescription","addIceCandidate"],y.forEach(function(e){var t=m.prototype[e];m.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=m.prototype[e];m.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),m}},{sdp:17}],17:[function(e,t,n){var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&(0,b.default)(e.parameters).length){var r=[];(0,b.default)(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){var n=r.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:n.map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===(0,E.default)(e.keyParams)?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){var n=r.matchPrefix(e+t,"a=crypto:");return n.map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var s=i[o],a=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var c=r.parseRtpMap(a),u=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=u.length?r.parseFmtp(u[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&(r=JSON.parse((0,f.default)(r)),r.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var d=r.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};var s=r.matchPrefix(e,"a=sctpmap:");if(s.length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i,o=void 0!==t?t:2;i=e?e:r.generateSessionId();var s=n||"thisisadapterortc";return"v=0\r\no="+s+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){var t=r.splitLines(e),n=t[0].split(" ");return n[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"===("undefined"==typeof t?"undefined":(0,E.default)(t))&&(t.exports=r)},{}]},{},[1])(1)})},function(e,t,n){e.exports={default:n(79),__esModule:!0}},function(e,t,n){n(80),e.exports=n(13).Object.assign},function(e,t,n){var r=n(11);r(r.S+r.F,"Object",{assign:n(81)})},function(e,t,n){"use strict";var r=n(21),i=n(32),o=n(60),s=n(61),a=n(48),c=n(35),u=Object.assign;e.exports=!u||n(22)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=a(e),u=arguments.length,d=1,f=o.f,l=s.f;u>d;)for(var p,h=c(arguments[d++]),v=f?i(h).concat(f(h)):i(h),m=v.length,b=0;m>b;)p=v[b++],r&&!l.call(h,p)||(n[p]=h[p]);return n}:u},function(e,t,n){e.exports={default:n(83),__esModule:!0}},function(e,t,n){n(84);var r=n(13).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},function(e,t,n){var r=n(34),i=n(65).f;n(72)("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},function(e,t,n){e.exports={default:n(86),__esModule:!0}},function(e,t,n){n(66),n(5),n(49),n(87),n(105),n(106),e.exports=n(13).Promise},function(e,t,n){"use strict";var r,i,o,s,a=n(10),c=n(12),u=n(14),d=n(88),f=n(11),l=n(19),p=n(15),h=n(89),v=n(90),m=n(94),b=n(95).set,_=n(97)(),g=n(98),y=n(99),S=n(100),w=n(101),x="Promise",C=c.TypeError,I=c.process,T=I&&I.versions,E=T&&T.v8||"",R=c[x],k="process"==d(I),M=function(){},O=i=g.f,A=!!function(){try{var e=R.resolve(1),t=(e.constructor={})[n(46)("species")]=function(e){e(M,M)};return(k||"function"==typeof PromiseRejectionEvent)&&e.then(M)instanceof t&&0!==E.indexOf("6.6")&&S.indexOf("Chrome/66")===-1}catch(r){}}(),P=function(e){var t;return!(!l(e)||"function"!=typeof(t=e.then))&&t},j=function(e,t){if(!e._n){e._n=!0;var n=e._c;_(function(){for(var r=e._v,i=1==e._s,o=0,s=function(t){var n,o,s,a=i?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{a?(i||(2==e._h&&L(e),e._h=1),a===!0?n=r:(d&&d.enter(),n=a(r),d&&(d.exit(),s=!0)),n===t.promise?u(C("Promise-chain cycle")):(o=P(n))?o.call(n,c,u):c(n)):u(r)}catch(f){d&&!s&&d.exit(),u(f)}};n.length>o;)s(n[o++]);e._c=[],e._n=!1,t&&!e._h&&N(e)})}},N=function(e){b.call(c,function(){var t,n,r,i=e._v,o=D(e);if(o&&(t=y(function(){k?I.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=k||D(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){b.call(c,function(){var t;k?I.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,
reason:e._v})})},V=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),j(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw C("Promise can't be resolved itself");(t=P(e))?_(function(){var r={_w:n,_d:!1};try{t.call(e,u(F,r,1),u(V,r,1))}catch(i){V.call(r,i)}}):(n._v=e,n._s=1,j(n,!1))}catch(r){V.call({_w:n,_d:!1},r)}}};A||(R=function(e){h(this,R,x,"_h"),p(e),r.call(this);try{e(u(F,this,1),u(V,this,1))}catch(t){V.call(this,t)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(102)(R.prototype,{then:function(e,t){var n=O(m(this,R));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=k?I.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&j(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=u(F,e,1),this.reject=u(V,e,1)},g.f=O=function(e){return e===R||e===s?new o(e):i(e)}),f(f.G+f.W+f.F*!A,{Promise:R}),n(45)(R,x),n(103)(x),s=n(13)[x],f(f.S+f.F*!A,x,{reject:function(e){var t=O(this),n=t.reject;return n(e),t.promise}}),f(f.S+f.F*(a||!A),x,{resolve:function(e){return w(a&&this===s?R:this,e)}}),f(f.S+f.F*!(A&&n(104)(function(e){R.all(e).catch(M)})),x,{all:function(e){var t=this,n=O(t),r=n.resolve,i=n.reject,o=y(function(){var n=[],o=0,s=1;v(e,!1,function(e){var a=o++,c=!1;n.push(void 0),s++,t.resolve(e).then(function(e){c||(c=!0,n[a]=e,--s||r(n))},i)}),--s||r(n)});return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=O(t),r=n.reject,i=y(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t,n){var r=n(36),i=n(46)("toStringTag"),o="Arguments"==r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(n){}};e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(14),i=n(91),o=n(92),s=n(18),a=n(38),c=n(93),u={},d={},t=e.exports=function(e,t,n,f,l){var p,h,v,m,b=l?function(){return e}:c(e),_=r(n,f,t?2:1),g=0;if("function"!=typeof b)throw TypeError(e+" is not iterable!");if(o(b)){for(p=a(e.length);p>g;g++)if(m=t?_(s(h=e[g])[0],h[1]):_(e[g]),m===u||m===d)return m}else for(v=b.call(e);!(h=v.next()).done;)if(m=i(v,_,h.value,t),m===u||m===d)return m};t.BREAK=u,t.RETURN=d},function(e,t,n){var r=n(18);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(o){var s=e.return;throw void 0!==s&&r(s.call(e)),o}}},function(e,t,n){var r=n(28),i=n(46)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){var r=n(88),i=n(46)("iterator"),o=n(28);e.exports=n(13).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(18),i=n(15),o=n(46)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||void 0==(n=r(s)[o])?t:i(n)}},function(e,t,n){var r,i,o,s=n(14),a=n(96),c=n(44),u=n(23),d=n(12),f=d.process,l=d.setImmediate,p=d.clearImmediate,h=d.MessageChannel,v=d.Dispatch,m=0,b={},_="onreadystatechange",g=function(){var e=+this;if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},y=function(e){g.call(e.data)};l&&p||(l=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return b[++m]=function(){a("function"==typeof e?e:Function(e),t)},r(m),m},p=function(e){delete b[e]},"process"==n(36)(f)?r=function(e){f.nextTick(s(g,e,1))}:v&&v.now?r=function(e){v.now(s(g,e,1))}:h?(i=new h,o=i.port2,i.port1.onmessage=y,r=s(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(r=function(e){d.postMessage(e+"","*")},d.addEventListener("message",y,!1)):r=_ in u("script")?function(e){c.appendChild(u("script"))[_]=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(s(g,e,1),0)}),e.exports={set:l,clear:p}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(12),i=n(95).set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,c="process"==n(36)(s);e.exports=function(){var e,t,n,u=function(){var r,i;for(c&&(r=s.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(o){throw e?n():t=void 0,o}}t=void 0,r&&r.enter()};if(c)n=function(){s.nextTick(u)};else if(!o||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var d=a.resolve(void 0);n=function(){d.then(u)}}else n=function(){i.call(r,u)};else{var f=!0,l=document.createTextNode("");new o(u).observe(l,{characterData:!0}),n=function(){l.data=f=!f}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";function r(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=i(t),this.reject=i(n)}var i=n(15);e.exports.f=function(e){return new r(e)}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},function(e,t,n){var r=n(12),i=r.navigator;e.exports=i&&i.userAgent||""},function(e,t,n){var r=n(18),i=n(19),o=n(98);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e),s=n.resolve;return s(t),n.promise}},function(e,t,n){var r=n(16);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},function(e,t,n){"use strict";var r=n(12),i=n(13),o=n(17),s=n(21),a=n(46)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(46)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(s){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],s=o[r]();s.next=function(){return{done:n=!0}},o[r]=function(){return s},e(o)}catch(a){}return n}},function(e,t,n){"use strict";var r=n(11),i=n(13),o=n(12),s=n(94),a=n(101);r(r.P+r.R,"Promise",{finally:function(e){var t=s(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then(function(){return n})}:e,n?function(n){return a(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var r=n(11),i=n(98),o=n(99);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){e.exports={default:n(108),__esModule:!0}},function(e,t,n){n(109),e.exports=n(13).Object.keys},function(e,t,n){var r=n(48),i=n(32);n(72)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){e.exports={default:n(111),__esModule:!0}},function(e,t,n){n(66),n(5),n(49),n(112),n(119),n(122),n(124),e.exports=n(13).Map},function(e,t,n){"use strict";var r=n(113),i=n(114),o="Map";e.exports=n(115)(o,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(i(this,o),e);return t&&t.v},set:function(e,t){return r.def(i(this,o),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(17).f,i=n(30),o=n(102),s=n(14),a=n(89),c=n(90),u=n(9),d=n(52),f=n(103),l=n(21),p=n(57).fastKey,h=n(114),v=l?"_s":"size",m=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,u){var d=e(function(e,r){a(e,d,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,void 0!=r&&c(r,n,e[u],e)});return o(d.prototype,{clear:function(){for(var e=h(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=h(this,t),r=m(n,e);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[v]--}return!!r},forEach:function(e){h(this,t);for(var n,r=s(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!m(h(this,t),e)}}),l&&r(d.prototype,"size",{get:function(){return h(this,t)[v]}}),d},def:function(e,t,n){var r,i,o=m(e,t);return o?o.v=n:(e._l=o={i:i=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:m,setStrong:function(e,t,n){u(e,t,function(e,n){this._t=h(e,t),this._k=n,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?d(0,n.k):"values"==t?d(0,n.v):d(0,[n.k,n.v]):(e._t=void 0,d(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){var r=n(19);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";var r=n(12),i=n(11),o=n(57),s=n(22),a=n(16),c=n(102),u=n(90),d=n(89),f=n(19),l=n(45),p=n(17).f,h=n(116)(0),v=n(21);e.exports=function(e,t,n,m,b,_){var g=r[e],y=g,S=b?"set":"add",w=y&&y.prototype,x={};return v&&"function"==typeof y&&(_||w.forEach&&!s(function(){(new y).entries().next()}))?(y=t(function(t,n){d(t,y,e,"_c"),t._c=new g,void 0!=n&&u(n,b,t[S],t)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in w&&(!_||"clear"!=e)&&a(y.prototype,e,function(n,r){if(d(this,y,e),!t&&_&&!f(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),_||p(y.prototype,"size",{get:function(){return this._c.size}})):(y=m.getConstructor(t,e,b,S),c(y.prototype,n),o.NEED=!0),l(y,e),x[e]=y,i(i.G+i.W+i.F,x),_||m.setStrong(y,e,b),y}},function(e,t,n){var r=n(14),i=n(35),o=n(48),s=n(38),a=n(117);e.exports=function(e,t){var n=1==e,c=2==e,u=3==e,d=4==e,f=6==e,l=5==e||f,p=t||a;return function(t,a,h){for(var v,m,b=o(t),_=i(b),g=r(a,h,3),y=s(_.length),S=0,w=n?p(t,y):c?p(t,0):void 0;y>S;S++)if((l||S in _)&&(v=_[S],m=g(v,S,b),e))if(n)w[S]=m;else if(m)switch(e){case 3:return!0;case 5:return v;case 6:return S;case 2:w.push(v)}else if(d)return!1;return f?-1:u||d?d:w}}},function(e,t,n){var r=n(118);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(19),i=n(62),o=n(46)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&(t=t[o],null===t&&(t=void 0))),void 0===t?Array:t}},function(e,t,n){var r=n(11);r(r.P+r.R,"Map",{toJSON:n(120)("Map")})},function(e,t,n){var r=n(88),i=n(121);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){var r=n(90);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){n(123)("Map")},function(e,t,n){"use strict";var r=n(11);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){n(125)("Map")},function(e,t,n){"use strict";var r=n(11),i=n(15),o=n(14),s=n(90);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,a,c=arguments[1];return i(this),t=void 0!==c,t&&i(c),void 0==e?new this:(n=[],t?(r=0,a=o(c,arguments[2],2),s(e,!1,function(e){n.push(a(e,r++))})):s(e,!1,n.push,n),new this(n))}})}},function(e,t,n){e.exports={default:n(127),__esModule:!0}},function(e,t,n){n(128);var r=n(13).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(11);r(r.S+r.F*!n(21),"Object",{defineProperty:n(17).f})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(107),o=r(i),s=n(130),a=r(s),c=n(73),u=r(c),d=n(133),f=r(d),l=n(2),p=r(l),h=n(1),v=n(134),m=h.tagLogger("Service"),b=n(137),_=n(141),g=n(138),y=n(147),S=n(148),w=new S({onExtLoaded:function(){m.info("Share desktop ext. had loaded.")}}),x=n(145),C=n(149),I=n(150);e.exports=h.prototypeExtend({__init__:function(){var e=this;m.warn("emedia version: ",window._emediaVersion||"unkown"),m.warn("UserAgent: ",navigator.userAgent);var t=h.parseURL("__log_level___");t&&(emedia.LOG_LEVEL=parseInt(t)),e.namespace=Math.uuidFast(),emedia.useCurrentXService=e,void 0===e.useRTCCfg&&(e.useRTCCfg=emedia.config.useRTCCfgIfServerReturn),"string"==typeof e.useRTCCfg&&(e.useRTCCfg=JSON.parse(e.useRTCCfg)),e.inboundAudio=C.inboundAudio.bind(e),e.inboundVideo=C.inboundVideo.bind(e),e.outboundAudio=C.outboundAudio.bind(e),e.outboundVideo=C.outboundVideo.bind(e),e._cache_receive_sessions=[]},AVPubstream:x.extend({__init__:function(){var e=this;e.type=0,e._located=!0,e.mutedMuted=!0,e.constaints&&(e.constaints.video||(e.voff=1),e.constaints.audio||(e.aoff=1)),e.constaints||(e.constaints={audio:!0,video:!0}),emedia.config.maxVideoBitrate&&(e.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(e.abitrate=emedia.config.maxAudioBitrate)}}),AudioMixerPubstream:new x.extend({__init__:function(){var e=this;if(e.type=2,e._located=!0,e.mutedMuted=!0,e.constaints||(e.constaints={audio:!0,video:!1}),e.constaints){var t=!!e.constaints.audio;e.constaints.video||(e.constaints.video=!1),e.constaints.video||(e.voff=1),e.constaints.audio||(e.aoff=1),t===!1&&(e.aoff=1)}emedia.config.maxVideoBitrate&&(e.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(e.abitrate=emedia.config.maxAudioBitrate)},onGotRemoteMediaStream:function(e){var t=this;if(!t.remotePlayAudioObject){var n="__o_remote_play_audio_"+t.id,r=document.querySelector("#"+n);r||(r=document.createElement("audio"),r.style.display="none",r.id="__o_remote_play_audio_"+t.id,r.autoplay=!0,r.playsinline=!0,document.body.appendChild(r)),t.remotePlayAudioObject=r}t.remotePlayAudioObject.srcObject=e}}),ShareDesktopPubstream:x.extend({voff:0,__init__:function(){var e=this;e.type=1,e._located=!0,e.mutedMuted=!0,e.constaints={audio:!this.aoff,video:!0},emedia.config.maxVideoBitrate&&(e.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(e.abitrate=emedia.config.maxAudioBitrate)}}),__assertCurrent:function(){var e=this;if(!e.current)throw m.error("Please call emedia.service.setup(ticket)"),"Please call emedia.service.setup(ticket)";if(e.current.closed)throw m.error("current closed"),"current closed"},hasAudioMixers:function(){var e=this;e.__assertCurrent();for(var t in e.current.audioMixers){var n=e.current.audioMixers[t];if(n&&n.located())return!0}},getMediaDevices:function(e,t,n){function r(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];e?e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||m.info("Some other kind of source/device: ",o):r.push(o)}t&&t(r)}"function"==typeof e&&(n=t,t=e,e=void 0),navigator.mediaDevices.enumerateDevices().then(r).catch(function(e){m.warn("navigator.getUserMedia error: ",e),n&&n(e)})},attachSinkId:function(e,t){"undefined"!=typeof e.sinkId?e.setSinkId(t).then(function(){m.info("Success, audio output device attached: "+t)}).catch(function(e){var t=e;"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device: "+e),m.warn(t)}):m.warn("Browser does not support output device selection.")},_stopTracks:function(e){emedia.stopTracks(e),e&&m.warn("Stream tracks stop. it = ",e)},_enableVideoTracks:function(e,t){emedia.enableVideoTracks(e,t)},_enableAudioTracks:function(e,t){emedia.enableAudioTracks(e,t)},openUserMedia:function(e){m.debug("begin open user media",e);var t=this;if(!e)throw m.error("require pubS"),"require pubS";return{then:function(n,r){function i(){n.apply(null,arguments);var r=e.localStream;r&&(r.oninactive=t._onStreamInactive.bind(t,e,r),r.onactive=t._onStreamActive.bind(t,e,r))}if(e instanceof t.AVPubstream)t._openCamera(e,i,r);else if(e instanceof t.ShareDesktopPubstream)t._openSharedDesktop(e,i,r);else{if(!(e instanceof t.AudioMixerPubstream))throw m.error("Unspported pubS"),"Unspported pubS";t._openCamera(e,i,r)}}}},_openSharedDesktop:function(e,t,n){function r(e){var r={audio:!0};e.constaints&&("object"===(0,p.default)(e.constaints.audio)&&e.constaints.audio||e.constaints.audio||(r.audio=!1)),o.__getUserMedia(r,function(n,r){var i=new MediaStream;i._located=!0,r&&r.getAudioTracks().forEach(function(e){i.addTrack(e)}),e.localStream&&e.localStream.getVideoTracks().forEach(function(e){i.addTrack(e)}),e.localStream=i,t&&t(o.current,i)},n)}var i,o=this;return e._localMediaStream&&(i=e._localMediaStream.getVideoTracks())&&i.length>0?(e.localStream=e._localMediaStream,void(e.constaints.audio?r(e):t&&t(o.current,stream))):void w.openDesktopMedia(e.screenOptions||["screen","window","tab"],function(i){if(i instanceof g.OpenDesktopMedia){var s=i.desktopStreamId;m.warn("desktop streamId",s);var a={audio:!1,video:{mandatory:h.extend(e.mandatory||{},{chromeMediaSource:"desktop",chromeMediaSourceId:s}),optional:[]}};o.__getUserMedia(a,function(n,i){e.localStream=i,e.constaints.audio?r(e):t&&t(o.current,i)},n)}else o.current&&o.current.onEvent(new g.ShareDesktopExtensionNotFound({member:o.current})),n&&n(i)})},_openCamera:function(e,t,n){function r(n,r){i.__controlStream(e,r),e.localStream=r,t&&t(i.current,r)}var i=this,o=e.constaints||{audio:!0,video:!0};i.__getUserMedia(o,r.bind(o),n)},__controlStream:function(e,t){emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)},__getUserMedia:function(e,t,n){function r(e){m.debug("[WebRTC-API] getUserMedia() error: ",e),emedia.stopTracks(s),o.current&&o.current.onEvent(new g.OpenMediaError({member:o.current,event:e})),n&&n(new g.OpenMediaError({member:o.current,event:e}))}function i(n){o.current&&!o.current.closed&&(o.current._openedRtcMediaStreams[n.id]=n,n._bindAttendee=o.current,n._bindAttendeeId=o.current.getMemberId(),m.info("stream bind attendee.",n.id,o.current.ticket&&o.current.ticket.id,o.current.getMemberId(),o.current.memName)),emedia._yetGetUserMedia=!0,s=n;var i=n.getVideoTracks(),a=n.getAudioTracks();if(i.length>0){var c=i[0];m.debug(n.id,"using video device: ",c.id,c.label,c.kind,c.enabled)}if(a.length>0){var u=a[0];m.debug(n.id,"using audio device: ",u.id,u.label,u.kind,u.enabled)}return n._located=!0,"boolean"!=typeof n.active||n.active?void(t&&t(o.current,n)):(m.error("media stream not active. it is",n.id),void r({constraint:e,name:"NotAllowedStreamNonactive",message:"stream non-active"}))}m.debug("get user media. using constaints",e);var o=this;e=h.extend({},e);var s;o.__sysGetUserMedia(e,i,r)},_onStreamInactive:function(e,t,n){var r=this;m.warn("media stream inactive. it =",t.id),e.onMediaInactive&&r.current&&h.forEach(r.current._cacheStreams,function(i,o){o.located()&&o.localStream&&o.localStream.id===t.id&&(o._webrtc&&o._webrtc.closed||e.onMediaInactive.call(o,t,n,r))})},_onStreamActive:function(e,t,n){var r=this;m.warn("media stream active. it =",t.id),e.onMediaActive&&r.current&&h.forEach(r.current._cacheStreams,function(i,o){o.located()&&o.localStream&&o.localStream.id===t.id&&e.onMediaActive.call(o,t,n,r)})},__sysGetUserMedia:function(e,t,n){var r=function(){var e=(0,f.default)(a.default.mark(function t(e,n,r){var i,o,s;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("object"===(0,p.default)(emedia.config.globalConstraints)&&("object"===(0,p.default)(emedia.config.globalConstraints.audio)&&e.audio&&("boolean"==typeof e.audio?e.audio=h.extend({},emedia.config.globalConstraints.audio):e.audio=h.extend({},emedia.config.globalConstraints.audio,e.audio)),"object"===(0,p.default)(emedia.config.globalConstraints.video)&&e.video&&("boolean"==typeof e.video?e.video=h.extend({},emedia.config.globalConstraints.video):e.video=h.extend({},emedia.config.globalConstraints.video,e.video))),m.info("navigator.mediaDevices.getUserMedia constaints = ",(0,u.default)(e)),i=new MediaStream,o=void 0,s=void 0,!e.audio){t.next=14;break}return t.prev=5,t.next=8,navigator.mediaDevices.getUserMedia({audio:!0});case 8:o=t.sent,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),console.error("getUserMedia audio error",t.t0);case 14:if(!e.video){t.next=24;break}return t.prev=15,t.next=18,navigator.mediaDevices.getUserMedia({video:e.video});case 18:s=t.sent,t.next=24;break;case 21:t.prev=21,t.t1=t.catch(15),console.error("getUserMedia video error",t.t1);case 24:o&&o.getAudioTracks().forEach(function(e){i.addTrack(e)}),s&&s.getVideoTracks().forEach(function(e){i.addTrack(e)}),o||s?n(i):r({message:"getUserMedia error: not have input device"});case 27:case"end":return t.stop()}},t,this,[[5,11],[15,21]])}));return function(t,n,r){return e.apply(this,arguments)}}();r(e,t,n)},attachMediaStream:window.attachMediaStream.bind({logger:m}),setup:function(e,t){var n=this;m.count(),m.debug("recv ticket",e,t),m.debug("use sdk version",window._emediaVersion),m.debug(navigator.userAgent),t=t||{};var r=t;if(h.isPlainObject(t))t=(0,u.default)(t);else try{r=JSON.parse(t)}catch(i){}"string"==typeof e&&(e=JSON.parse(e));var o,s;if(o=s=e.memName,emedia._lastSetupConfr=e.confrId,emedia._lastSetupMemName=s,emedia._lastSetupDate=new Date,emedia._lastSetupTktId=e.tktId,n.current&&!n.current.closed){var a=new g.CurrentCalling;throw n.current.onEvent(a),m.error("confr not close. calling..."),a}var c=n.Attendee||_,d=c.extend(y),f=n.current=new d({_service:n,service:n,autoSub:emedia.config.autoSub,getCopyIntervalMillis:emedia.config.getCopyIntervalMillis,sysUserId:o,memName:s,resource:n.resource,nickName:n.nickName,ticket:e,ext:t,extObj:r,sessionFactory:function(){return n.newSession(this,e)}},n.listeners||{});return f},getStreamById:function(e){var t=this.current&&this.current._cacheStreams[e];return t&&h.extend(!1,{},t)},getStreamsByRtcId:function(e){if(this.current&&this.current._cacheStreams){var t=[];return h.forEach(this.current._cacheStreams,function(n,r){r.rtcId===e&&t.push(r)}),t}},getMemberById:function(e){var t=this.current&&this.current._cacheMembers[e];return t&&h.extend(!1,{},t)},exit:function(e){m.warn("User click exit ",e),this.current&&this.current.exit(e)},join:function(e,t){m.debug("begin join ...");var n=this;return n.__assertCurrent(),n.current._memberId?(m.warn("Had joined. igrone it"),void(e&&e(n.memId))):(n.current._session._sessionId=void 0,void n.current.join(e,t))},withpublish:function(e){var t=this;if(!e||!e.localStream)throw m.error("pubS null or stream not open"),"pubS null or stream not open";return t.__assertCurrent(),t.current._memberId?m.warn("Had joined. igrone it"):t.current._session._sessionId=void 0,t.current.withpublish(e)},push:function(e,t,n){m.debug("begin push ...");var r=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw m.error("pubS or stream open"),"pubS or stream open";r.__assertCurrent(),r.current.push(e,t,n,!1)},subscribe:function(e,t,n,r){var i=this;if(m.info("begin subscribe ",e,r),t&&h.isPlainObject(t)&&(r=t,t=n=void 0),n&&h.isPlainObject(n)&&(r=n,n=t,t=void 0),emedia.isSafari){var o=function(){try{var e=u.shift();e&&e.onSub&&e.onSub.apply(e,arguments)}finally{a()}},s=function(){try{var e=u.shift();e&&e.subfail&&e.subfail.apply(e,arguments)}finally{a()}},a=function(){u.length>0&&i.__subscribe(u[0].streamId,o,s,u[0].subArgs)},c={streamId:e,onSub:t,subfail:n,subArgs:r},u=i.__safari_subs||(i.__safari_subs=[]);u.push(c),1===u.length&&a()}else i.__subscribe(e,t,n,r)},__subscribe:function(e,t,n,r){var i=this;i.__assertCurrent(),2==arguments.length&&(n=t,t=void 0),t&&h.isPlainObject(t)&&(r=t,t=void 0),n&&h.isPlainObject(n)&&(r=n,n=void 0),r||(r={subSVideo:!0,subSAudio:!0});var o=(i.current._cacheStreams[e],i.current._getWebrtc(e)),s=o&&o.isConnected(),a=s&&o.getRemoteStream();if(a&&(s=a.active)){var c=a.getAudioTracks().length,u=a.getVideoTracks().length;c||r.subSAudio!==!0?u||r.subSVideo!==!0||(s=!1):s=!1}return m.info("sub stream",e,", use prertcpeer =",s),s?(i.current.subscribeStream(o._rtcId,e,n,r,t),void(t&&t())):(o&&!o.closed&&i.current.closeWebrtc(o.getRtcId(),!0,!1),void i.current.createWebrtcAndSubscribeStream(e,{onGotRemote:function(e){t&&t(e)},onEvent:function(e){n&&n(e)}},void 0,r))},closePubstream:function(e){e.located()&&(emedia.stopTracks(e._localMediaStream),emedia.stopTracks(e.localStream))},hungup:function(e){var t=this.getStreamById(e);try{this._hungup(e)}finally{this.onHungup&&t&&this.onHungup(t)}},_hungup:function(e){var t=this;t.__assertCurrent();var n=t.current,r=n._cacheStreams[e];r&&!r.closeReason&&r.updateAttributes({closeReason:"UserHangup"});var i=r&&r.rtcId;if(i&&(n.closeWebrtc(i),r.located()&&(1!==r.type&&r._localMediaStream&&emedia.stopTracks(r._localMediaStream),r.remotePlayAudioObject&&document.body.removeChild(r.remotePlayAudioObject),n._cacheStreams[e]&&n.onRemoveStream(r),h.removeAttribute(n._cacheStreams,e),t._streamAutomators&&h.removeAttribute(t._streamAutomators,e))),r&&!r.located()){if(n._linkedStreams[r.id]&&h.removeAttribute(n._linkedStreams,r.id),m.warn("Hangeup remove from _linkedStreams. stream = ",r.id),r=n._cacheStreams[e],!r)return;r.updateAttributes({rtcId:void 0,_webrtc:void 0,mediaStream:void 0});var o=new x(r);n.onUpdateStream(o,new o.Update(o))}},postMessage:function(e,t,n,r){var i=this,o=t;"string"!=typeof t&&(t=(0,u.default)(t)),i.__assertCurrent();var s,a=i.current,c=a._linkedStreams[e];s=c&&c.owner?c.owner.id:e;var t=a.newMessage({op:1003,memId:s,arg:t});a.postMessage(t,(n||r)&&function(e){if(r&&r(e,o),0!=e.result){var i=new g.RemoteControlFail({memId:s,failed:e.result,cause:e.msg,type:"postMessage",postMessage:t});return a.onEvent(i),void(n&&n(i,o))}})},torchRemote:function(e,t,n,r){var i=this;"function"==typeof t&&(r=n,n=t,t=void 0),void 0!==t&&(t=t?1:0),i.__assertCurrent();var o=i.current,s=o._linkedStreams[e];if(!s||s.located())throw m.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var a=s.torch,t=void 0===t?s.torch?0:1:t,c={op2:20,streamId:e,tor:t},d=o.newMessage({op:1002,memId:s.owner.id,arg:(0,u.default)(c),_reqOps:[100206]});s.updateAttributes({torch:t}),o.postMessage(d,function(e){if(0!=e.result){var t=new g.RemoteControlFail({stream:s,failed:e.result,cause:e.msg,type:"torch_control"});return o.onEvent(t),s.updateAttributes({torch:a}),void(r&&r(t,s.torch))}n&&n(s.torch)})},freezeFrameRemote:function(e,t,n){var r=this;r.__assertCurrent();var i=r.current,o=i._linkedStreams[e];if(!o||o.located())throw m.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var s=!o.freezeFrame,a={op2:20,streamId:e,frz:s?1:0},c=i.newMessage({op:1002,memId:o.owner.id,arg:(0,u.default)(a),_reqOps:[100204]});o.updateAttributes({freezeFrame:s}),i.postMessage(c,function(e){if(0!=e.result){var r=new g.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"freeze_control"});return i.onEvent(r),o.updateAttributes({freezeFrame:!o.freezeFrame}),void(n&&n(r,o.freezeFrame))}t&&t(o.freezeFrame)})},base64Img2Blob:function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],r=window.atob(t[1]),i=r.length,o=new Uint8Array(i),s=0;s<i;++s)o[s]=r.charCodeAt(s);return new Blob([o],{type:n})},blob2URL:function(e){return URL.createObjectURL(e)},imagesPngContext2URL:function(e){var t=this;return t.blob2URL(t.blob2URL(e))},downloadFile:function(e,t,n){var r=this,i=document.createElement("a");i.style.display="none";var o,s=t?r.base64Img2Blob(t):n;i.download=e,i.href=o=r.blob2URL(s),i.rel="noopener";var a=document.createEvent("HTMLEvents");a.initEvent("click",!1,!1),i.dispatchEvent(a),document.body.appendChild(i),i.click(),i.parentNode.removeChild(i),setTimeout(function(){URL.revokeObjectURL&&URL.revokeObjectURL(o)},4e4)},videoCaptureBase64Context2URL:function(e){var t=this;return t.imagesPngContext2URL(t.getCaptureBase64Context(e))},getCaptureBase64Context:function(e){var t=document.createElement("canvas");t.id="__capture_video_"+(new Date).getTime();t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);var r=t.toDataURL("images/png");return r},captureVideo:function(e,t,n){var r=this,i=r.getCaptureBase64Context(e);return t&&(n=n||"capture_"+(new Date).getTime(),r.downloadFile(n,i)),i},capturePictureRemote:function(e,t,n,r){var i=this;i.__assertCurrent();var o=i.current,s=o._linkedStreams[e];if(!s||s.located())throw m.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var a={op2:20,streamId:e,pic:1,rspBase64Pic:t===!0},c=o.newMessage({op:1002,memId:s.owner.id,arg:(0,u.default)(a),_reqOps:[100205]});o.postMessage(c,function(e){if(0!=e.result){var i=new g.RemoteControlFail({stream:s,failed:e.result,cause:e.msg,type:"capture_control"});return o.onEvent(i),void(r&&r(i))}if(!t)return void(n&&n());if(!e.arg)return void(r&&r(new g.RemoteControlFail({stream:s,failed:e.result,cause:"Not found base64 pic"})));var a=JSON.parse(e.arg);n&&n(a.pic)})},zoomRemote:function(e,t,n,r){var i=this;i.__assertCurrent();var o=i.current,s=o._linkedStreams[e];if(!s||s.located())throw m.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";s._zoom||s.updateAttributes({_zoom:1});var a=s._zoom*t;if(!(a<1)){s.updateAttributes({_zoom:a});var c={op2:20,streamId:e,zoom:Math.round(1e4*a)},d=o.newMessage({op:1002,memId:s.owner.id,arg:(0,u.default)(c),_reqOps:[100201]});o.postMessage(d,function(e){if(0!=e.result){var t=new g.RemoteControlFail({stream:s,failed:e.result,cause:e.msg,type:"zoom_control"});return o.onEvent(t),void(n&&n(t))}r&&r()})}},_getPosition:function(e){for(var t=0,n=0;e;)n+=e.offsetLeft,t+=e.offsetTop,e=e.offsetParent;return{clientX:n,clientY:t}},eventXYAtMedia:function(e,t){var n=h.getDomPageRect(t),r=n.width,i=n.height,o=t.videoWidth,s=t.videoHeight;if(s/o>i/r){var a=o/s;s=i,o=s*a}else{var a=s/o;o=r,s=o*a}var c,u,d=e;if((c=h.isFloat(d.x))&&(d.x=d.x*r),(u=h.isFloat(d.y))&&(d.y=d.y*i),!(Math.abs(d.x)<(r-o)/2||r-Math.abs(d.x)<(r-o)/2||Math.abs(d.y)<(i-s)/2||i-Math.abs(d.y)<(i-s)/2))return d.x=d.x<0?Math.floor(d.x+(r-o)/2):Math.floor(d.x-(r-o)/2),d.y=d.y<0?Math.floor(d.y+(i-s)/2):Math.floor(d.y-(i-s)/2),c&&(d.x=d.x/o),u&&(d.y=d.y/s),{x:d.x,y:d.y,width:o,height:s}},eventXYAtVideo:function(e,t){var n=h.getDomPageRect(t),r=n.width,i=n.height,o=t.videoWidth,s=t.videoHeight;if(s/o>i/r){var a=o/s;s=i,o=s*a}else{var a=s/o;o=r,s=o*a}var c,u;return(c=h.isFloat(e.x))&&(e.x=e.x*o),(u=h.isFloat(e.y))&&(e.y=e.y*s),e.x=e.x<0?Math.floor(e.x-(r-o)/2):Math.floor(e.x+(r-o)/2),e.y=e.y<0?Math.floor(e.y-(i-s)/2):Math.floor(e.y+(i-s)/2),c&&(e.x=e.x/r),u&&(e.y=e.y/i),e},getClickXY:function(e,t){var n=this,r=t||window.event,i=document.documentElement.scrollLeft||document.body.scrollLeft,o=document.documentElement.scrollTop||document.body.scrollTop,s=r.pageX||r.clientX+i,a=r.pageY||r.clientY+o,c=n._getPosition(e);m.info("Video tag position ",c.clientX,":",c.clientY);var u=e.videoWidth,d=e.videoHeight;if(d/u>e.offsetHeight/e.offsetWidth){var f=u/d;d=e.offsetHeight,u=d*f,c.clientX+=(e.offsetWidth-u)/2}else{var f=d/u;u=e.offsetWidth,d=u*f,c.clientY+=(e.offsetHeight-d)/2}return m.info("Media position ",c.clientX,":",c.clientY),m.info("Media xy ",u,":",d),m.info("Click position ",s,":",a),{mediaWidth:u,mediaHeight:d,x:s-c.clientX,y:a-c.clientY}},focusExpoRemote:function(e,t,n,r,i){var o=this,s=n||window.event,a=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,u=s.pageX||s.clientX+a,d=s.pageY||s.clientY+c,f=o._getPosition(t);m.info("Video tag position ",f.clientX,":",f.clientY);var l=t.videoWidth,p=t.videoHeight;if(p/l>t.offsetHeight/t.offsetWidth){var h=l/p;p=t.offsetHeight,l=p*h,f.clientX+=(t.offsetWidth-l)/2}else{var h=p/l;l=t.offsetWidth,p=l*h,f.clientY+=(t.offsetHeight-p)/2}m.info("Media position ",f.clientX,":",f.clientY),m.info("Media xy ",l,":",p),m.info("Click position ",u,":",d),o._focusExpo(e,l,p,u-f.clientX,d-f.clientY,r,i)},_focusExpo:function(e,t,n,r,i,o,s){var a=this;if(!(r<=0||r>t||i<=0||i>n)){a.__assertCurrent();var c=a.current,d=c._linkedStreams[e];if(!d||d.located())throw m.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";
var f={op2:20,streamId:e,focus:1,expo:1,x:0===t?0:Math.round(1e4*r/t),y:0===n?0:Math.round(1e4*i/n)},l=c.newMessage({op:1002,memId:d.owner.id,arg:(0,u.default)(f),_reqOps:[100202,100203]});c.postMessage(l,function(e){if(0!=e.result){var t=new g.RemoteControlFail({stream:d,failed:e.result,cause:e.msg,type:"focus_expo_control"});return c.onEvent(t),void(o&&o(t))}s&&s()})}},_republish:function(e,t,n){m.info("Republish stream. it = ",e.id);var r,i=this;if(e.id){var o=i.current.__getWebrtcFor(e.id);o&&i.current.closeWebrtc(o,!0),r=i.current._getWebrtc(e.id)}var s;switch(e.type){case 0:emedia.stopTracks(e._localMediaStream),s=new i.AVPubstream(e);break;case 1:emedia.stopAndRemoveAudioTracks(e._localMediaStream),s=new i.ShareDesktopPubstream(e);break;case 2:emedia.stopTracks(e._localMediaStream),s=new i.AudioMixerPubstream(e)}setTimeout(function(){i.openUserMedia(s).then(function(){e.localStream=s.localStream,e.isRepublished=!0,e.optimalVideoCodecs=e.optimalVideoCodecs||r&&r.optimalVideoCodecs,i.push(e,t,n)},n)},100)},switchMobileCamera:function(e,t,n){var r=this;if("string"==typeof e?e=r.current._cacheStreams[e]:e.id&&(e=r.current._cacheStreams[e.id]),e.voff)return void m.warn("Stream id = ",e.id," voff, do not chanage camera.");e.constaints||(e.constaints={});var i=h.extend({},e.constaints);e._lastConstaints=i,e.constaints.video="object"===(0,p.default)(e.constaints.video)?e.constaints.video:{},"user"!==e.constaints.video.facingMode&&e.constaints.video.facingMode?e.constaints.video.facingMode="user":e.constaints.video.facingMode={exact:"environment"},r._republish(e,function(e){n&&n(e)},function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints=i),t&&t(n)})},chanageCamera:function(e,t,n){var r=this;return"string"==typeof e?e=r.current._cacheStreams[e]:e.id&&(e=r.current._cacheStreams[e.id]),e.voff?void m.warn("Stream id = ",e.id," voff, do not chanage camera."):void r.getMediaDevices("videoinput",function(i){if(i.length<=1)return void m.warn("Only video input. not chanage");var o=e._cameraIndex;if(null===e._cameraIndex||void 0===e._cameraIndex){var s=e.getLocalMediaStream(),a=s&&s.getVideoTracks(),c=a&&a.length&&a[0];if(c&&c.getCapabilities&&"function"==typeof c.getCapabilities){var u=c.getCapabilities(),d=u&&u.deviceId;for(var f in i){var l=i[f];if(l.deviceId===d||l.label==c.label){o=parseInt(f);break}}}else for(var f in i){var l=i[f];if(l.label==c.label){o=parseInt(f);break}}}for(;o<i.length;){var v=i[o];o=(o+1)%i.length;var l=i[o],a=e.getLocalMediaStream().getVideoTracks();if(!a||0===a.length||l.label!=a[0].label)break}var l=i[o],b=l.label;m.warn("Stream ",e.id,v.label,">>",b),e._cameraIndex=o,e.constaints||(e.constaints={});var _=h.extend({},e.constaints);e._lastConstaints=_,e.constaints.video="object"===(0,p.default)(e.constaints.video)?e.constaints.video:{},e.constaints.video.deviceId={exact:l.deviceId},r._republish(e,function(e){n&&n(e)},function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints=_),t&&t(n)})},t)},chanageConstraints:function(e,t,n,r){function i(){var t=e.getMediaStream();emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)}var o=this;if("string"==typeof e?e=o.current._cacheStreams[e]:e.id&&(e=o.current._cacheStreams[e.id]),!e)return void m.warn("Not found pubS");if(m.info("chanage pubstream constraints. it",e.id,t),v.isObject(t)&&!v.isEqual(e.constaints,t)){var s=e.constaints||{},a=e.voff,c=e.aoff;return e._lastConstaints=s,e.constaints=h.extend(!0,{},s,t),e.aoff=e.constaints.audio?0:1,e.voff=e.constaints.video?0:1,void o._republish(e,function(e){i(),r&&r(e)},function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints=s,e.aoff=c,e.voff=a),n&&n(t)})}i(),r&&r(e.getMediaStream())},voff:function(e,t,n,r){function i(){return t==s?void m.info("pubstream voff not chanage."):(emedia.enableVideoTracks(e.getMediaStream(),!t),void(o.current&&o.current.voff(e,t)))}var o=this;"string"==typeof e&&(e=o.current._cacheStreams[e]);var s=e.voff;if(t=t?1:0,e.voff=t,!t&&e.constaints&&!e.constaints.video){var a=e.constaints.video;return e.constaints.video=!0,void o._republish(e,function(e){i(),r&&r(e)},function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.video=a,e.voff=s),n&&n(t)})}i(),r&&r(e.getMediaStream())},aoff:function(e,t,n,r){function i(){return t==s?void m.info("pubstream aoff not chanage."):(emedia.enableAudioTracks(e.getMediaStream(),!t),void(o.current&&o.current.aoff(e,t)))}var o=this;"string"==typeof e&&(e=o.current._cacheStreams[e]);var s=e.aoff;if(t=t?1:0,e.aoff=t,!t&&e.constaints&&!e.constaints.audio){var a=e.constaints.audio;return e.constaints.audio=!0,void o._republish(e,function(e){i(),r&&r(e)},function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.audio=a,e.aoff=s),n&&n(t)})}i(),r&&r(e.getMediaStream())},iceing:function(e){var t=this;return h.isPlainObject(t.current._linkedStreams[e])},recording:function(e){var t=this;return h.isPlainObject(t.current._records[e])},startRecord:function(e,t){var n=this,r=n.current._linkedStreams[e];if(!r)throw m.error("not at linked streams",e),e+" not at linked streams";r._webrtc||t&&t(!1),n.current.startRecord(r,t)},stopRecord:function(e,t){var n=this,r=n.current._records[e];if(!r)throw m.error("not at recording streams",e),e+" not at recording streams";n.current.stopRecord(r,t)},getCurrentMembers:function(){var e=this;return e.current.getCurrentMembers()},_onCapturePicture:function(e){var t,n=this,r=e.arg.rspBase64Pic,i=e.arg.streamId,o=n.current._cacheStreams[i];if(r){var s;if("function"!=typeof n.getHTMLVideo||!(s=n.getHTMLVideo(i)))return void m.warn("Not support capture picture. caused by htmlVideo not found");t=n.getCaptureBase64Context(s)}else{if("function"!=typeof n.onCapturePicture)return void m.warn("Not support capture picture. caused by onCapturePicture not found");n.onCapturePicture(o)}var a=n.current.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,arg:(0,u.default)(t?{pic:t}:{}),result:0});return n.current.postMessage(a,function(e){m.warn("Send remote control onCapturePicture response. the result = ",e.result,e.msg||"")}),!0},newSession:function(e,t){var n=this,r=n.Session||b,i=new r({ticket:t,owner:e,onTcklC:function(t){e.onTcklC(t.rtcId,t.cands)},onAcptC:function(t){e.onAcptC(t.rtcId,t.sdp,t.cands)},onAnsC:function(t){e.onAnsC(t.rtcId,t.sdp,t.cands)},onTermC:function(t){m.info("Server termc rtc: ",t.rtcId,t.message||t.msg);var r=t.endReason;if(21===r||22===r)h.forEach(e._cacheStreams,function(n,i){if(i.rtcId===t.rtcId){var o;o=21===r?new emedia.event.SwitchVCodes({stream:i,useVCodes:t.useVCodes}):new emedia.event.SubFailNotSupportVCodes({stream:i}),e.onEvent(o)}});else if(23==r){var i=n.listeners.mgr.onPubVideoTooMuch;if(!i||"function"!=typeof i)return;i()}else if(24==r){var o=n.listeners.mgr.onPubDesktopTooMuch;if(!o||"function"!=typeof o)return;o()}else e.closeWebrtc(t.rtcId,!1,!0)},onEnter:function(t){e.onEnter(t.cver,t.mem)},onExit:function(t){e.onExit(t.cver,t.memId,t.reason||0)},onPub:function(t){e.onPub(t.cver,t.memId,t.pubS)},onUnpub:function(t){e.onUnpub(t.cver,t.memId,t.pubSId)},onMems:function(e){},onClose:function(t){e.onClose(t.cver,t.confrId)},onEvent:function(t){e.onEvent(t)},onStreamControl:function(t){e.onStreamControl(t.cver,t.streamId,t.voff,t.aoff,t.sver)},onRoleUpdate:function(t){e._onRoleUpdate(t.role,t.roleToken)},onRemoteControl:function(t){if("string"==typeof t.arg&&(t.arg=JSON.parse(t.arg)),20!==t.arg.op2||!t.arg.pic||!n._onCapturePicture.call(n,t)){if(30===t.arg.op2&&n._onRemotePannelControl)try{return void n._onRemotePannelControl.call(n,t)}catch(r){m.warn(r)}if(21===t.arg.op2){var i=t.arg,o=i.memId,s=i.nickName;if(!o)return void console.warn("onRequestToTalker not have memberId");n._cache_receive_sessions.push(t);var a=n.listeners.mgr.onRequestToTalker,c={memberId:o,nickName:s};return void(a&&"function"==typeof a&&a(c,function(e,t){return n.agreeRequestToTalker(e,t)},function(e){return n.refuseRequestToTalker(e)}))}if(22===t.arg.op2){var d=t.arg,f=d.memId,l=d.nickName;if(!f)return void console.warn("onRequestToAdmin not have memberId");n._cache_receive_sessions.push(t);var p=n.listeners.mgr.onRequestToAdmin,h={memberId:f,nickName:l};return void(p&&"function"==typeof p&&p(h,function(e){return n.agreeRequestToAdmin(e)},function(e){return n.refuseRequestToAdmin(e)}))}if(23===t.arg.op2){var v=n.listeners.mgr.onMuted;if(v&&"function"==typeof v)return void v()}if(24===t.arg.op2){var b=n.listeners.mgr.onUnmuted;if(b&&"function"==typeof b)return void b()}m.warn("Not support remote control");var _=e.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,arg:(0,u.default)(t.arg),result:t&&t.arg&&30===t.arg.op2?-405:-507,msg:"Not support the remote control."});e.postMessage(_,function(e){m.warn("Send remote control response. the result = ",e.result,e.msg||"")})}},onRecvRemoteMessage:function(t){e._onRecvRemoteMessage&&e._onRecvRemoteMessage(t.memId,t.arg,t)},onConfrAttrsUpdated:function(e){var t=function(e){function t(e){var t=[];for(var n in e){var r={};r.key=n,r.val=e[n],r.op="",t.push(r)}return t}function r(e,t){return 0==t.length?e:(t.forEach(function(t){var n=!1;e.forEach(function(r,i){if(r.key==t.key)return e.splice(i,1,t),void(n=!0)}),n||e.push(t)}),e)}if(n.listeners.mgr){var i=n.listeners.mgr.cattrs||[];i=e.cattrs instanceof Array==1?r(i,e.cattrs):t(e.cattrs),n.listeners.mgr.cattrs=i;var o=n.listeners.mgr.onConfrAttrsUpdated;o&&"function"==typeof o&&(o=o.bind(n.listeners.mgr))(i)}},r=function(e){if(e.cstate&&0!=(0,o.default)(e.cstate).length){var t=n.listeners.mgr.onConfrStateUpdated;t&&"function"==typeof t&&(t=t.bind(n.listeners.mgr))(e.cstate)}};e.cattrs instanceof Array==1&&e.cattrs.length>0&&t(e),e.cattrs.constructor==Object&&(0,o.default)(e.cattrs).length>0&&t(e),e.cstate&&r(e)},onAdminChanged:function(e){var t=n.listeners.mgr.onAdminChanged;t&&"function"==typeof t&&t(e)},onRequestToTalkerReply:function(e){var t=n.listeners.mgr.onRequestToTalkerReply;t&&"function"==typeof t&&t(e)},onRequestToAdminReply:function(e){var t=n.listeners.mgr.onRequestToAdminReply;t&&"function"==typeof t&&t(e)},onLivecfgsChanged:function(e){e.liveCfgs&&emedia.config({liveCfgs:e.liveCfgs})}});return i},_judgeTalking:function(e){return!!e&&e.instant>=emedia.config.judgeTalkingByInstantGE},graffitiVideo:function(e,t,n){var r=this,i=r.getStreamById(e),o=new MediaStream;o._located=!0,i._localMediaStream.getAudioTracks().forEach(function(e){o.addTrack(e)});var s=n.captureStream(25);s.getVideoTracks().forEach(function(e){o.addTrack(e)}),t.srcObject=o,i.updateAttributes({localStream:o,isRepublished:!0,optimalVideoCodecs:i.optimalVideoCodecs}),r.push(i)},resetCanvas:function(e){var t;if(arguments.length>1)for(var n=0;n<arguments.length;n++)t=arguments[n],"function"==typeof t&&t(e),"function"!=typeof t&&h.isPlainObject(t)&&h.forEach(t,function(t,n){m.debug("Canvas set ",t," = ",n),e.setAttribute(t,n)})},_random:function(e){return Math.floor(Math.random()*e)},requestFrame:function(e,t){function n(){if(r.requestFrame(),r.canvas){var e=I.prototype.redraw.bind({_canvasContext:r.canvas.getContext("2d")});e(3,3)}}var r,i=this;if("string"==typeof e)r=this.current._cacheStreams[e];else{if(!e.id)return;r=this.current._cacheStreams[e.id]}if(r)return t?void setTimeout(function(){n(),i.requestFrame(r,t)},t):void n()},graffitiCanvas:function(e,t){h.targetDOM(e)&&(t=e,e=!1);var n=this,r=new n.ShareDesktopPubstream({voff:0,aoff:e?0:1});t||(t=document.createElement("canvas")),t.getContext("2d"),r.canvas=t;var i=function(){};return i.prototype.setCanvas=function(e){return this.canvasTag=t,n.resetCanvas(t,e),this},i.prototype.push=function(e,t){var n=this;n._push(e,t)},i.prototype._push=function(i,o){function s(n){n.canvas=t,o&&o(n,t,c),e&&n.requestFrame()}function a(e,t){var r=new MediaStream;r._located=!0,e._localMediaStream&&e._localMediaStream.getAudioTracks().forEach(function(e){r.addTrack(e)}),c.getVideoTracks().forEach(function(e){r.addTrack(e)}),e._localMediaStream=r,e.localStream=r,n.push(e,t)}"function"==typeof i&&(o=i,i=void 0),t.captureStream&&(t.captureStream.enabled=!0);var c=t.captureStream(i||25);return e?n.__getUserMedia({audio:!0},function(e,t){r._localMediaStream=t,a(r,s)}):a(r,s),this},new i},blobRecorder:function(e,t,n,r){function i(){this.blobs=c}var o=this;h.targetDOM(e)&&(e=e.srcObject),t||(t={mimeType:"video/webm;codecs=vp9"}),MediaRecorder.isTypeSupported(t.mimeType)||(m.info(t.mimeType," is not Supported"),t={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(t.mimeType)||(m.info(t.mimeType," is not Supported"),t={mimeType:"video/webm"},MediaRecorder.isTypeSupported(t.mimeType)||(m.info(t.mimeType," is not Supported"),t={mimeType:""})));try{var s=new MediaRecorder(e,t)}catch(a){return void m.error("Exception while creating MediaRecorder: ",a)}var c=[];return s.onstop=r||function(e){m.info("Recorder stopped: ",e)},s.ondataavailable=n||function(e){e.data&&e.data.size>0&&c.push(e.data)},i.prototype.start=function(e){s.start(e)},i.prototype.stop=function(){s.stop()},i.prototype.playurl=function(e){var t=new Blob(this.blobs,e||{type:"video/webm"});return window.URL.createObjectURL(t)},i.prototype.download=function(e,t){var n=new Blob(this.blobs,t||{type:"video/webm"});o.downloadFile(e,void 0,n)},new i},requestToTalker:function(){this.current.requestToTalker()},_get_session_by_memberId_and_op_type:function(e,t){if(e&&t){var n=void 0;return this._cache_receive_sessions.map(function(r){var i=r.arg;if(i&&i instanceof Object&&(0,o.default)(i).length>0){var s=i.memId,a=i.op2;s==e&&a==t&&(n=r)}}),n}},_delete_session_by_memberId_and_op_type:function(e,t){if(e&&t){var n=this;this._cache_receive_sessions.map(function(r,i){var s=r.arg;if(s&&s instanceof Object&&(0,o.default)(s).length>0){var a=s.memId,c=s.op2;a==e&&c==t&&n._cache_receive_sessions.splice(i,1)}})}},agreeRequestToTalker:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,f.default)(a.default.mark(function n(e,t){var r,i,o;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this._get_session_by_memberId_and_op_type(e,21)){n.next=3;break}return n.abrupt("return");case 3:return i=r.arg.memName,o=this.listeners.confrId,n.prev=5,n.next=8,this.listeners.mgr.chanageRoles(3,[i],o);case 8:n.next=16;break;case 10:if(n.prev=10,n.t0=n.catch(5),n.t0.error!=-523){n.next=16;break}if(!t||"function"!=typeof t){n.next=16;break}return t(),n.abrupt("return");case 16:this._delete_session_by_memberId_and_op_type(e,21);case 17:case"end":return n.stop()}},n,this,[[5,10]])}));return e}(),refuseRequestToTalker:function(e){if(!e)return void console.warn("refuseRequestToTalker memberId is required");var t=this._get_session_by_memberId_and_op_type(e,21);t&&(this.current.refuseRequestToTalker(t),this._delete_session_by_memberId_and_op_type(e,21))},requestToAdmin:function(){this.current.requestToAdmin()},agreeRequestToAdmin:function(e){var t=this._get_session_by_memberId_and_op_type(e,22);if(t){var n=t.arg.memName,r=this.listeners.confrId;this.listeners.mgr.chanageRoles(7,[n],r),this._delete_session_by_memberId_and_op_type(e,22)}},refuseRequestToAdmin:function(e){if(!e)return void console.warn("refuseRequestToAdmin memberId is required");var t=this._get_session_by_memberId_and_op_type(e,22);t&&(this.current.refuseRequestToAdmin(t),this._delete_session_by_memberId_and_op_type(e,22))},muteBymemberId:function(e){this.current&&7==this.current.role&&this.current.muteBymemberId(e)},unmuteBymemberId:function(e){this.current&&7==this.current.role&&this.current.unmuteBymemberId(e)}})},function(e,t,n){e.exports=n(131)},function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(132),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(s){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";function n(e,t,n,r){var o=t&&t.prototype instanceof i?t:i,s=Object.create(o.prototype),a=new p(r||[]);return s._invoke=u(e,n,a),s}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function i(){}function o(){}function s(){}function a(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function c(e){function t(n,i,o,s){var a=r(e[n],e,i);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&_.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,s)},function(e){t("throw",e,o,s)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},s)}s(a.arg)}function n(e,n){function r(){return new Promise(function(r,i){t(e,n,r,i)})}return i=i?i.then(r,r):r()}var i;this._invoke=n}function u(e,t,n){var i=I;return function(o,s){if(i===E)throw new Error("Generator is already running");if(i===R){if("throw"===o)throw s;return v()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var c=d(a,n);if(c){if(c===k)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===I)throw i=R,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=E;var u=r(e,t,n);if("normal"===u.type){if(i=n.done?R:T,u.arg===k)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=R,n.method="throw",n.arg=u.arg)}}}function d(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,d(e,t),"throw"===t.method))return k;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var i=r(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,k;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,k):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,k)}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function l(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function h(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function i(){for(;++n<e.length;)if(_.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=m,i.done=!0,i};return r.next=r}}return{next:v}}function v(){return{value:m,done:!0}}var m,b=Object.prototype,_=b.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},y=g.iterator||"@@iterator",S=g.asyncIterator||"@@asyncIterator",w=g.toStringTag||"@@toStringTag",x="object"==typeof e,C=t.regeneratorRuntime;if(C)return void(x&&(e.exports=C));C=t.regeneratorRuntime=x?e.exports:{},C.wrap=n;var I="suspendedStart",T="suspendedYield",E="executing",R="completed",k={},M={};M[y]=function(){return this};var O=Object.getPrototypeOf,A=O&&O(O(h([])));A&&A!==b&&_.call(A,y)&&(M=A);var P=s.prototype=i.prototype=Object.create(M);o.prototype=P.constructor=s,s.constructor=o,s[w]=o.displayName="GeneratorFunction",C.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},C.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,w in e||(e[w]="GeneratorFunction")),e.prototype=Object.create(P),e},C.awrap=function(e){return{__await:e}},a(c.prototype),c.prototype[S]=function(){return this},C.AsyncIterator=c,C.async=function(e,t,r,i){var o=new c(n(e,t,r,i));return C.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},a(P),P[w]="Generator",P[y]=function(){return this},P.toString=function(){return"[object Generator]"},C.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},C.values=h,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(l),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&_.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,k):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),k},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),l(n),k}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;l(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:h(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),k}}}(function(){return this}()||Function("return this")())},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(85),o=r(i);t.default=function(e){return function(){var t=e.apply(this,arguments);return new o.default(function(e,n){function r(i,s){try{var a=t[i](s),c=a.value}catch(u){return void n(u)}return a.done?void e(c):o.default.resolve(c).then(function(e){r("next",e)},function(e){r("throw",e)})}return r("next")})}}},function(e,t,n){(function(e,n){var r,i;!function(){var o="object"==typeof self&&self.self===self&&self||"object"==typeof e&&e.global===e&&e||this||{},s=o._,a=Array.prototype,c=Object.prototype,u="undefined"!=typeof Symbol?Symbol.prototype:null,d=a.push,f=a.slice,l=c.toString,p=c.hasOwnProperty,h=Array.isArray,v=Object.keys,m=Object.create,b=function(){},_=function(e){return e instanceof _?e:this instanceof _?void(this._wrapped=e):new _(e)};t.nodeType?o._=_:(!n.nodeType&&n.exports&&(t=n.exports=_),t._=_),_.VERSION="1.9.1";var g,y=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return function(){return e.apply(t,arguments)}},S=function(e,t,n){return _.iteratee!==g?_.iteratee(e,t):null==e?_.identity:_.isFunction(e)?y(e,t,n):_.isObject(e)&&!_.isArray(e)?_.matcher(e):_.property(e)};_.iteratee=g=function(e,t){return S(e,t,1/0)};var w=function(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var o=Array(t+1);for(i=0;i<t;i++)o[i]=arguments[i];return o[t]=r,e.apply(this,o)}},x=function(e){if(!_.isObject(e))return{};if(m)return m(e);b.prototype=e;var t=new b;return b.prototype=null,t},C=function(e){return function(t){return null==t?void 0:t[e]}},I=function(e,t){return null!=e&&p.call(e,t)},T=function(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0},E=Math.pow(2,53)-1,R=C("length"),k=function(e){var t=R(e);return"number"==typeof t&&t>=0&&t<=E};_.each=_.forEach=function(e,t,n){t=y(t,n);var r,i;if(k(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=_.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},_.map=_.collect=function(e,t,n){t=S(t,n);for(var r=!k(e)&&_.keys(e),i=(r||e).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=t(e[a],a,e)}return o};var M=function(e){var t=function(t,n,r,i){var o=!k(t)&&_.keys(t),s=(o||t).length,a=e>0?0:s-1;for(i||(r=t[o?o[a]:a],a+=e);a>=0&&a<s;a+=e){var c=o?o[a]:a;r=n(r,t[c],c,t)}return r};return function(e,n,r,i){var o=arguments.length>=3;return t(e,y(n,i,4),r,o)}};_.reduce=_.foldl=_.inject=M(1),_.reduceRight=_.foldr=M(-1),_.find=_.detect=function(e,t,n){var r=k(e)?_.findIndex:_.findKey,i=r(e,t,n);if(void 0!==i&&i!==-1)return e[i]},_.filter=_.select=function(e,t,n){var r=[];return t=S(t,n),_.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},_.reject=function(e,t,n){return _.filter(e,_.negate(S(t)),n)},_.every=_.all=function(e,t,n){t=S(t,n);for(var r=!k(e)&&_.keys(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(!t(e[s],s,e))return!1}return!0},_.some=_.any=function(e,t,n){t=S(t,n);for(var r=!k(e)&&_.keys(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(t(e[s],s,e))return!0}return!1},_.contains=_.includes=_.include=function(e,t,n,r){return k(e)||(e=_.values(e)),("number"!=typeof n||r)&&(n=0),_.indexOf(e,t,n)>=0},_.invoke=w(function(e,t,n){var r,i;return _.isFunction(t)?i=t:_.isArray(t)&&(r=t.slice(0,-1),t=t[t.length-1]),_.map(e,function(e){var o=i;if(!o){if(r&&r.length&&(e=T(e,r)),null==e)return;o=e[t]}return null==o?o:o.apply(e,n)})}),_.pluck=function(e,t){return _.map(e,_.property(t))},_.where=function(e,t){return _.filter(e,_.matcher(t))},_.findWhere=function(e,t){return _.find(e,_.matcher(t))},_.max=function(e,t,n){var r,i,o=-(1/0),s=-(1/0);if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e){e=k(e)?e:_.values(e);for(var a=0,c=e.length;a<c;a++)r=e[a],null!=r&&r>o&&(o=r)}else t=S(t,n),_.each(e,function(e,n,r){i=t(e,n,r),(i>s||i===-(1/0)&&o===-(1/0))&&(o=e,s=i)});return o},_.min=function(e,t,n){var r,i,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e){e=k(e)?e:_.values(e);for(var a=0,c=e.length;a<c;a++)r=e[a],null!=r&&r<o&&(o=r)}else t=S(t,n),_.each(e,function(e,n,r){i=t(e,n,r),(i<s||i===1/0&&o===1/0)&&(o=e,s=i)});return o},_.shuffle=function(e){return _.sample(e,1/0)},_.sample=function(e,t,n){if(null==t||n)return k(e)||(e=_.values(e)),e[_.random(e.length-1)];var r=k(e)?_.clone(e):_.values(e),i=R(r);t=Math.max(Math.min(t,i),0);for(var o=i-1,s=0;s<t;s++){var a=_.random(s,o),c=r[s];r[s]=r[a],r[a]=c}return r.slice(0,t)},_.sortBy=function(e,t,n){var r=0;return t=S(t,n),_.pluck(_.map(e,function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")};var O=function(e,t){return function(n,r,i){var o=t?[[],[]]:{};return r=S(r,i),_.each(n,function(t,i){var s=r(t,i,n);e(o,t,s)}),o}};_.groupBy=O(function(e,t,n){I(e,n)?e[n].push(t):e[n]=[t]}),_.indexBy=O(function(e,t,n){e[n]=t}),_.countBy=O(function(e,t,n){I(e,n)?e[n]++:e[n]=1});var A=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;_.toArray=function(e){return e?_.isArray(e)?f.call(e):_.isString(e)?e.match(A):k(e)?_.map(e,_.identity):_.values(e):[]},_.size=function(e){return null==e?0:k(e)?e.length:_.keys(e).length},_.partition=O(function(e,t,n){e[n?0:1].push(t)},!0),_.first=_.head=_.take=function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:_.initial(e,e.length-t)},_.initial=function(e,t,n){return f.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},_.last=function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:_.rest(e,Math.max(0,e.length-t))},_.rest=_.tail=_.drop=function(e,t,n){return f.call(e,null==t||n?1:t)},_.compact=function(e){return _.filter(e,Boolean)};var P=function(e,t,n,r){r=r||[];for(var i=r.length,o=0,s=R(e);o<s;o++){var a=e[o];if(k(a)&&(_.isArray(a)||_.isArguments(a)))if(t)for(var c=0,u=a.length;c<u;)r[i++]=a[c++];else P(a,t,n,r),i=r.length;else n||(r[i++]=a)}return r};_.flatten=function(e,t){return P(e,t,!1)},_.without=w(function(e,t){return _.difference(e,t)}),_.uniq=_.unique=function(e,t,n,r){_.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=S(n,r));for(var i=[],o=[],s=0,a=R(e);s<a;s++){var c=e[s],u=n?n(c,s,e):c;t&&!n?(s&&o===u||i.push(c),o=u):n?_.contains(o,u)||(o.push(u),i.push(c)):_.contains(i,c)||i.push(c)}return i},_.union=w(function(e){return _.uniq(P(e,!0,!0))}),_.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=R(e);r<i;r++){var o=e[r];if(!_.contains(t,o)){var s;for(s=1;s<n&&_.contains(arguments[s],o);s++);s===n&&t.push(o)}}return t},_.difference=w(function(e,t){return t=P(t,!0,!0),_.filter(e,function(e){return!_.contains(t,e)})}),_.unzip=function(e){for(var t=e&&_.max(e,R).length||0,n=Array(t),r=0;r<t;r++)n[r]=_.pluck(e,r);return n},_.zip=w(_.unzip),_.object=function(e,t){for(var n={},r=0,i=R(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n};var j=function(e){return function(t,n,r){n=S(n,r);for(var i=R(t),o=e>0?0:i-1;o>=0&&o<i;o+=e)if(n(t[o],o,t))return o;return-1}};_.findIndex=j(1),_.findLastIndex=j(-1),_.sortedIndex=function(e,t,n,r){n=S(n,r,1);for(var i=n(t),o=0,s=R(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<i?o=a+1:s=a}return o};var N=function(e,t,n){return function(r,i,o){var s=0,a=R(r);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(r,i),r[o]===i?o:-1;if(i!==i)return o=t(f.call(r,s,a),_.isNaN),o>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(r[o]===i)return o;return-1}};_.indexOf=N(1,_.findIndex,_.sortedIndex),_.lastIndexOf=N(-1,_.findLastIndex),_.range=function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i},_.chunk=function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(f.call(e,r,r+=t));return n};var D=function(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=x(e.prototype),s=e.apply(o,i);return _.isObject(s)?s:o};_.bind=w(function(e,t,n){if(!_.isFunction(e))throw new TypeError("Bind must be called on a function");var r=w(function(i){return D(e,r,t,this,n.concat(i))});return r}),_.partial=w(function(e,t){var n=_.partial.placeholder,r=function(){for(var i=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===n?arguments[i++]:t[a];for(;i<arguments.length;)s.push(arguments[i++]);return D(e,r,this,this,s)};return r}),_.partial.placeholder=_,_.bindAll=w(function(e,t){t=P(t,!1,!1);var n=t.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=_.bind(e[r],e)}}),_.memoize=function(e,t){var n=function(r){var i=n.cache,o=""+(t?t.apply(this,arguments):r);return I(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return n.cache={},n},_.delay=w(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),_.defer=_.partial(_.delay,_,1),_.throttle=function(e,t,n){var r,i,o,s,a=0;n||(n={});var c=function(){a=n.leading===!1?0:_.now(),r=null,s=e.apply(i,o),r||(i=o=null)},u=function(){var u=_.now();a||n.leading!==!1||(a=u);var d=t-(u-a);return i=this,o=arguments,d<=0||d>t?(r&&(clearTimeout(r),r=null),a=u,s=e.apply(i,o),r||(i=o=null)):r||n.trailing===!1||(r=setTimeout(c,d)),s};return u.cancel=function(){clearTimeout(r),a=0,r=i=o=null},u},_.debounce=function(e,t,n){var r,i,o=function(t,n){r=null,n&&(i=e.apply(t,n))},s=w(function(s){if(r&&clearTimeout(r),n){var a=!r;r=setTimeout(o,t),a&&(i=e.apply(this,s))}else r=_.delay(o,t,this,s);return i});return s.cancel=function(){clearTimeout(r),r=null},s},_.wrap=function(e,t){return _.partial(t,e);
},_.negate=function(e){return function(){return!e.apply(this,arguments)}},_.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},_.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},_.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},_.once=_.partial(_.before,2),_.restArguments=w;var L=!{toString:null}.propertyIsEnumerable("toString"),V=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],F=function(e,t){var n=V.length,r=e.constructor,i=_.isFunction(r)&&r.prototype||c,o="constructor";for(I(e,o)&&!_.contains(t,o)&&t.push(o);n--;)o=V[n],o in e&&e[o]!==i[o]&&!_.contains(t,o)&&t.push(o)};_.keys=function(e){if(!_.isObject(e))return[];if(v)return v(e);var t=[];for(var n in e)I(e,n)&&t.push(n);return L&&F(e,t),t},_.allKeys=function(e){if(!_.isObject(e))return[];var t=[];for(var n in e)t.push(n);return L&&F(e,t),t},_.values=function(e){for(var t=_.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r},_.mapObject=function(e,t,n){t=S(t,n);for(var r=_.keys(e),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=t(e[a],a,e)}return o},_.pairs=function(e){for(var t=_.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},_.invert=function(e){for(var t={},n=_.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},_.functions=_.methods=function(e){var t=[];for(var n in e)_.isFunction(e[n])&&t.push(n);return t.sort()};var U=function(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],s=e(o),a=s.length,c=0;c<a;c++){var u=s[c];t&&void 0!==n[u]||(n[u]=o[u])}return n}};_.extend=U(_.allKeys),_.extendOwn=_.assign=U(_.keys),_.findKey=function(e,t,n){t=S(t,n);for(var r,i=_.keys(e),o=0,s=i.length;o<s;o++)if(r=i[o],t(e[r],r,e))return r};var W=function(e,t,n){return t in n};_.pick=w(function(e,t){var n={},r=t[0];if(null==e)return n;_.isFunction(r)?(t.length>1&&(r=y(r,t[1])),t=_.allKeys(e)):(r=W,t=P(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var s=t[i],a=e[s];r(a,s,e)&&(n[s]=a)}return n}),_.omit=w(function(e,t){var n,r=t[0];return _.isFunction(r)?(r=_.negate(r),t.length>1&&(n=t[1])):(t=_.map(P(t,!1,!1),String),r=function(e,n){return!_.contains(t,n)}),_.pick(e,r,n)}),_.defaults=U(_.allKeys,!0),_.create=function(e,t){var n=x(e);return t&&_.extendOwn(n,t),n},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isMatch=function(e,t){var n=_.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var s=n[o];if(t[s]!==i[s]||!(s in i))return!1}return!0};var B,q;B=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return!1;if(e!==e)return t!==t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&q(e,t,n,r)},q=function(e,t,n,r){e instanceof _&&(e=e._wrapped),t instanceof _&&(t=t._wrapped);var i=l.call(e);if(i!==l.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return u.valueOf.call(e)===u.valueOf.call(t)}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(_.isFunction(s)&&s instanceof s&&_.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var c=n.length;c--;)if(n[c]===e)return r[c]===t;if(n.push(e),r.push(t),o){if(c=e.length,c!==t.length)return!1;for(;c--;)if(!B(e[c],t[c],n,r))return!1}else{var d,f=_.keys(e);if(c=f.length,_.keys(t).length!==c)return!1;for(;c--;)if(d=f[c],!I(t,d)||!B(e[d],t[d],n,r))return!1}return n.pop(),r.pop(),!0},_.isEqual=function(e,t){return B(e,t)},_.isEmpty=function(e){return null==e||(k(e)&&(_.isArray(e)||_.isString(e)||_.isArguments(e))?0===e.length:0===_.keys(e).length)},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isArray=h||function(e){return"[object Array]"===l.call(e)},_.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},_.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(e){_["is"+e]=function(t){return l.call(t)==="[object "+e+"]"}}),_.isArguments(arguments)||(_.isArguments=function(e){return I(e,"callee")});var G=o.document&&o.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof G&&(_.isFunction=function(e){return"function"==typeof e||!1}),_.isFinite=function(e){return!_.isSymbol(e)&&isFinite(e)&&!isNaN(parseFloat(e))},_.isNaN=function(e){return _.isNumber(e)&&isNaN(e)},_.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===l.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){if(!_.isArray(t))return I(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!p.call(e,i))return!1;e=e[i]}return!!n},_.noConflict=function(){return o._=s,this},_.identity=function(e){return e},_.constant=function(e){return function(){return e}},_.noop=function(){},_.property=function(e){return _.isArray(e)?function(t){return T(t,e)}:C(e)},_.propertyOf=function(e){return null==e?function(){}:function(t){return _.isArray(t)?T(e,t):e[t]}},_.matcher=_.matches=function(e){return e=_.extendOwn({},e),function(t){return _.isMatch(t,e)}},_.times=function(e,t,n){var r=Array(Math.max(0,e));t=y(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},_.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},_.now=Date.now||function(){return(new Date).getTime()};var z={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},H=_.invert(z),Y=function(e){var t=function(t){return e[t]},n="(?:"+_.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};_.escape=Y(z),_.unescape=Y(H),_.result=function(e,t,n){_.isArray(t)||(t=[t]);var r=t.length;if(!r)return _.isFunction(n)?n.call(e):n;for(var i=0;i<r;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=n,i=r),e=_.isFunction(o)?o.call(e):o}return e};var K=0;_.uniqueId=function(e){var t=++K+"";return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var X=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},$=/\\|'|\r|\n|\u2028|\u2029/g,Z=function(e){return"\\"+J[e]};_.template=function(e,t,n){!t&&n&&(t=n),t=_.defaults({},t,_.templateSettings);var r=RegExp([(t.escape||X).source,(t.interpolate||X).source,(t.evaluate||X).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,function(t,n,r,s,a){return o+=e.slice(i,a).replace($,Z),i=a+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";var s;try{s=new Function(t.variable||"obj","_",o)}catch(a){throw a.source=o,a}var c=function(e){return s.call(this,e,_)},u=t.variable||"obj";return c.source="function("+u+"){\n"+o+"}",c},_.chain=function(e){var t=_(e);return t._chain=!0,t};var Q=function(e,t){return e._chain?_(t).chain():t};_.mixin=function(e){return _.each(_.functions(e),function(t){var n=_[t]=e[t];_.prototype[t]=function(){var e=[this._wrapped];return d.apply(e,arguments),Q(this,n.apply(_,e))}}),_},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];_.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],Q(this,n)}}),_.each(["concat","join","slice"],function(e){var t=a[e];_.prototype[e]=function(){return Q(this,t.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return String(this._wrapped)},r=[],i=function(){return _}.apply(t,r),!(void 0!==i&&(n.exports=i))}()}).call(this,n(135),n(136)(e))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){function r(e,r){try{s.onWebsocketEvent(new f.WSClose({url:s.thisWsUri,retry:n,online:s.online,cause:e,event:r,session:s}))}finally{t&&t(new f.WSClose({url:s.thisWsUri,retry:n,online:s.online,cause:e,event:r,session:s}))}}function i(e){if(!s.connected(s.thisWsUri))return void d.debug("current dont connect. the message = ",e);if(u.isPlainObject(e)&&!(e instanceof h))throw d.error("message not a Messages"),"message not a Messages";if(s.sessId&&e.sessId!=s.sessId)return void d.warn("self.sessId && message.sessId != self.sessId",e);var t=(0,c.default)(e);s.thisWsUri===s._websocket.url&&s._websocket.send(t),s.thisWsUri===s._websocket.url&&d.debug("Done send req:",t,s._websocket.url),s.thisWsUri===s._websocket.url||d.debug("Donot send(url not equal): req:",t,s._websocket.url)}function o(){if(s.connected(s.thisWsUri)){if(0===s._bufferedMessages.length)return;for(var e,t=[];e=s._bufferedMessages.shift();)if(e.sessId||s.sessId||200==e.op){if(200===e.op){i(e);break}s.sessId&&!e.sessId&&(e.sessId=s.sessId);var r=i(e);r&&t.push(r)}else t.push(e),d.warn("tmp store message, util enter success!",e);t.length>0&&Array.prototype.push.apply(s._bufferedMessages,t)}else if(0!==n&&s.online)!s.connected();else{var o=u.extend(!1,{},s._callbacks),a=[];for(var c in o){var f=o[c];n>0&&!s.online?a.push(f):s.onMessage({op:1001,tsxId:c,result:-9527,msg:"sdk rsp fail. retry fail or online = "+s.online})}s._bufferedMessages=s._bufferedMessages||[],a.length>0&&Array.prototype.push.apply(s._bufferedMessages,a)}}var s=this;if(s.connected(s.thisWsUri))return e&&e(s),d.info("Session connected. dont continue connect"),void(s.notifyNewMessage&&s.notifyNewMessage());if(!s.online)return void r();s.notifyNewMessage=o,d.info("Session begin connect.");var a=s._websocket;a&&(d.warn("will close. websocket state",a.readyState,a.url,s.thisWsUri),a.close(1e3));try{d.info("Connecting",s.thisWsUri,n),a=s._websocket=new WebSocket(s.thisWsUri)}catch(l){return d.warn(l),void r(l)}a.onopen=function(n){var r=this.url;if(r!==s.thisWsUri)return void d.warn("ignore the onopen. caused by websocket url not ",s.thisWsUri,r);try{d.info("websocket connected:",r),t&&(t=null),e&&e(s),s.onWebsocketEvent(new f.WSConnected({event:n,session:s}))}finally{}},a.onmessage=function(e){var t=this.url;if(t!==s.thisWsUri)return void d.warn("ignore recv data. caused by websocket url not ",s.thisWsUri,t,e.data);d.debug("recv data",e.data);var n=JSON.parse(e.data);n&&1001==n.op&&d.debug("recv message: rsp:",n),n&&1001!=n.op&&d.debug("recv message: evt:",n),s.onMessage(n)},a.onclose=function(e){var t=this.url;return d.info("Disconnected:",t,s.thisWsUri,e),t!==s.thisWsUri?void d.warn("ignore onclose. caused by websocket url not ",s.thisWsUri,t):(s.notifyNewMessage(),void(1e3!==e.code&&r(void 0,e)))},a.onerror=function(e){d.info("On error:",e),s.onWebsocketEvent(new f.WSError({event:e,online:s.online,session:s,url:this.url}))}}var o=n(2),s=r(o),a=n(73),c=r(a),u=n(1),d=u.tagLogger("Sess"),f=n(138),l=0,p=n(139).default,h=u.prototypeExtend({setSessId:function(e){return e&&(this.sessId=e),this},setOp:function(e){return e&&(this.op=e),200===e&&(this.res={type:emedia.config.clientType,ver:window._emediaVersion||emedia.config.version,agent:emedia.config.userAgent,ops:emedia.config.acptOps}),this},setTsxId:function(e){return e&&(this.tsxId=e),this},setTicket:function(e){return e&&(this.tkt=e),this},setSdp:function(e){return e&&(this.sdp=e),this},setCands:function(e){return e&&(this.cands=e),this},setSubSId:function(e){return e&&(this.subSId=e),this},setMemId:function(e){return e&&(this.memId=e),this},setPubS:function(e){e&&(this.pubS=u.extend(!1,{},e));var t=this.pubS;return t.ext&&u.isPlainObject(t.ext)&&(t.ext=(0,c.default)(t.ext)),t&&u.forEach(t,function(e,n){(u.isPlainObject(n)||"function"==typeof n)&&"resolution"!=e&&u.removeAttribute(t,e)}),t&&u.removeAttribute(t,"localStream"),t&&u.removeAttribute(t,"_localMediaStream"),t&&u.removeAttribute(t,"_webrtc"),this},setRtcId:function(e){return e&&(this.rtcId=e),this},setCver:function(e){return e&&(this.cver=e),this},setEndReason:function(e){return e&&(this.endReason=e),this},setNickName:function(e){return e&&(this.nickName=e),this},setResource:function(e){return e&&(this.resource=e),this},setReason:function(e){return e&&(this.reason=e),this},setConfrId:function(e){return e&&(this.confrId=e),this},setVoff:function(e){return"undefined"==typeof e||(this.voff=e?1:0),this},setAoff:function(e){return"undefined"==typeof e||(this.aoff=e?1:0),this},setFlag:function(e){return 0===e&&(this.flag=0),1===e&&(this.flag=1),this},setExt:function(e){return e&&u.isPlainObject(e)&&(e=(0,c.default)(e)),e&&(this.ext=e),this}}),v=emedia.__session_globalCount=0;e.exports=u.prototypeExtend({_events:{0:"onReqP2P",1:"onNewCfr",2:"onDelCfr",3:"onReqTkt",100:"onPing",101:"onPong",102:"onInitC",103:"onReqC",104:"onAcptC",105:"onTcklC",106:"onAnsC",107:"onTermC",300:"onEnter",301:"onExit",302:"onPub",303:"onUnpub",304:"onMems",204:"onClose",400:"onStreamControl",401:"onJoin",412:"onRoleUpdate",1002:"onRemoteControl",1003:"onRecvRemoteMessage",402:"onConfrAttrsUpdated",413:"onAdminChanged",452:"onLivecfgsChanged"},__init__:function(){function e(){navigator.onLine?r.online=!0:r.online=!1}function t(e){r.online=!0,d.warn("online online online"),r.closed||r._reconnect(emedia.config.reconnect)}function n(e){r.online=!1,d.warn("offline offline offline"),r.__checkConnectIntervalId&&clearTimeout(r.__checkConnectIntervalId),r.__retryConnectIntervalId&&clearTimeout(r.__retryConnectIntervalId),r.__retryConnectIntervalId&&delete r.__retryConnectIntervalId,r._websocket&&r._websocket.close(1e3)}var r=this;r._bufferedMessages=[],r._callbacks={},e(),window.addEventListener("online",t,!0),window.addEventListener("offline",n,!0),d.info("online status = ",r.online)},_nextWsUri:function(){var e=this,t=e.ticket.url;emedia.config.useDeployMore&&(emedia.mgr.rtc_url_config=null,emedia.mgr.rtc_url_config=new p(emedia.config.rtcConfigUrl||""),t=emedia.mgr.rtc_url_config.replace_ws(t));var n=emedia.config&&emedia.config.convertWebsocketURLOfTicket||emedia.convertWebsocketURLOfTicket;if("function"==typeof n){var r=t;t=n(t),d.warn(r,"-->",t)}if(t.startsWith("/")){if(emedia.config.wsorigin)t=emedia.config.wsorigin+t;else{var i=window.location.href,o=i.startsWith("https")?"wss://":"ws://",s=i.indexOf("://")+3,a=i.indexOf("/",s),c=i.substring(s,a);t=o+c+t}d.warn("websocket url. update. {} -> {}",e.ticket.url,t)}else emedia.config.wsorigin&&d.warn("emedia.config.wsorigin invalidate. causeby server url {}",t);return t+=t.indexOf("?")>=0?"&"+l++:"?"+l++},_reconnect:function(e){function t(){d.warn("Reconnected. at ",e,r._websocket.url),r.__retryConnectIntervalId&&clearTimeout(r.__retryConnectIntervalId),r.__retryConnectIntervalId&&delete r.__retryConnectIntervalId;var t=r.newMessage().setOp(200).setSessId(r._sessionId).setTicket(r.ticket).setNickName(r.nickName||r.ticket.memName).setResource(r.resource).setExt(r.owner.ext);r.postMessage(t,function(e){if(0==e.result){var n=r.owner;u.forEach(n._cacheStreams,function(e,t){if(!n._maybeNotExistStreams[e]&&t._webrtc){var r=t._webrtc;r.closed||(d.warn("network chanage. webrtc will rebuild.",r._rtcId,r.__id),n.onICEClosed(r))}}),r.onEvent(new f.EnterSuccess({ip:r.owner.ip})),r.owner.onMembers(e.cver,e.mems),r.owner.onStreams(e.cver,e.streams),r.notifyNewMessage()}else try{r.onEvent(new f.EnterFail({me:r.owner,cause:new f.RspFail({request:t,response:e})}))}finally{e.result!==-9527&&r.onEvent(new f.ServerRefuseEnter({failed:e.result,msg:e.msg}))}})}function n(i){return e<=0?(d.warn("Reconnect end. but fail.",i.url,e),void(r.__retryConnectIntervalId&&delete r.__retryConnectIntervalId)):void(e&&(r.__retryConnectIntervalId=setTimeout(function(){r.connect(t,n,--e)},emedia.config.reconnectDelay)))}var r=this;r.connect(t,n,--e)},__checkConnect:function(){var e=this;e.__checkConnectIntervalId&&clearTimeout(e.__checkConnectIntervalId),emedia.config.checkConnectIntervalMillis&&(e.__checkConnectIntervalId=setTimeout(function(){try{e.online&&!e.connected()&&(e.__retryConnectIntervalId&&d.debug("online, reconnecting..."),e.__retryConnectIntervalId||d.debug("online, but disconnect. will reconnect"),e.__retryConnectIntervalId||e._reconnect(emedia.config.reconnect))}finally{e.__checkConnect()}},emedia.config.checkConnectIntervalMillis))},connect:function(e,t,n){function r(){try{e.apply(s,arguments)}finally{s.__checkConnect()}}function o(e){try{t.apply(s,arguments)}finally{n||e.url!==a||s.onEvent(new f.ServerRefuseEnter({failed:-95270,msg:"sdk reconnect fail. "+a+"|"+e.url}))}}var s=this,a=s.thisWsUri=s._nextWsUri();"undefined"!=typeof n&&d.warn("begin connect... at retry = ",n,a),i.call(s,r,o,n)},connected:function(e){var t=this,n=t.online&&t._websocket&&(!e||e===t._websocket.url)&&t._websocket.readyState==WebSocket.OPEN;return n},onWebsocketEvent:function(e){var t=this;t.onEvent(e)},register:function(e){if("object"===("undefined"==typeof e?"undefined":(0,s.default)(e)))for(var t in e)this.bind(t,e[t])},bind:function(e,t){var n,r=this;if(!(n=r._events[e]))throw d.error("Not supported event = ",e),"Not supported event = "+e;r[n]=t},getSessionId:function(){return this._sessionId},newMessage:function(e){return new h(e)},__modifyMessage:function(e){if(e&&e.sdp&&("string"==typeof e.sdp&&(e.sdp=u.parseJSON(e.sdp)),e.sdp.type&&(e.sdp.type=e.sdp.type.toLowerCase()),e.cctx&&(e.sdp.cctx=e.cctx)),e&&e.cands){"string"==typeof e.cands&&(e.cands=u.parseJSON(e.cands));for(var t=0;t<e.cands.length;t++)"string"==typeof e.cands[t]&&(e.cands[t]=u.parseJSON(e.cands[t])),e.cands[t].sdpMLineIndex=e.cands[t].mlineindex,e.cands[t].sdpMid=e.cands[t].mid,delete e.cands[t].mlineindex,delete e.cands[t].mid,e.cctx&&(e.cands[t].cctx=e.cctx)}if(e&&e.mems){if(!u.isArray(e.mems))return;var n=e.mems;e.mems={},u.forEach(n,function(t,n){n.name&&(n.memName=n.name),e.mems[n.id]=n;var r=n.acptOps={};if(u.forEach(emedia.config.baseAcptOps,function(e,t){r[t]=!0}),n.res&&u.forEach(n.res.ops,function(e,t){r[t]=!0}),n&&n.ext)try{e.mems[n.id].ext=JSON.parse(n.ext)}catch(i){d.debug(i)}})}if(e&&e.mem){e.mem.name&&(e.mem.memName=e.mem.name);var r=e.mem.acptOps={};if(u.forEach(emedia.config.baseAcptOps,function(e,t){r[t]=!0}),e.mem.res&&u.forEach(e.mem.res.ops,function(e,t){r[t]=!0}),e.mem&&e.mem.ext)try{e.mem.ext=JSON.parse(e.mem.ext)}catch(i){d.debug(i)}}if(e&&e.streams){if(!u.isArray(e.streams))return;var o=e.streams;e.streams={},u.forEach(o,function(t,n){if(e.streams[n.id]=n,n&&n.ext)try{e.streams[n.id].ext=JSON.parse(n.ext)}catch(r){d.debug(r)}})}if(e&&e.pubS&&e.pubS&&e.pubS.ext)try{e.pubS.ext=JSON.parse(e.pubS.ext)}catch(i){d.debug(i)}if(e&&e.ext)try{e.ext=JSON.parse(e.ext)}catch(i){d.debug(i)}return e},onMessage:function(e){function t(e){var t=n._events[e.op],r=n[t];return r?void r.call(n,e):void d.warn("Not supported event = ",e)}var n=this;if(1001!=e.op&&!e.sessId)throw d.error("message sessId error. server evt data error"),"message sessId error. server evt data error";if(1001!=e.op&&n._sessionId&&n._sessionId!=e.sessId)throw d.error("message sessId error. server and local not equal"),"message sessId error. server and local not equal";if(1004===e.op)return void t(e);if(1001==e.op&&e.arg){var r=JSON.parse(e.arg),i=r.op2;if(21==i){var o=e,s=o.result;return void n.onRequestToTalkerReply(s)}if(22==i){var a=e,c=a.result;return void n.onRequestToAdminReply(c)}}e=n.__modifyMessage(e);var l,p=u.removeAttribute(n._callbacks,e.tsxId);if(p&&200===p.op){n._sessionId=e.sessId;var h="string"==typeof e.yourIp?e.yourIp:void 0;if("string"==typeof n._session_ip&&h!=n._session_ip&&(l=n._session_ip),d.info(n._sessionId,"ip is",h,l),n._session_ip=h,n.owner.ip=h,0===e.result){for(var v in n._bufferedMessages){var m=n._bufferedMessages[v];m.sessId||200===m.op||(m.sessId=e.sessId)}setTimeout(function(){n.notifyNewMessage()},100),1001==e.op&&(e.cattrs||e.cstate)&&n.onConfrAttrsUpdated(e)}else for(var b;b=n._bufferedMessages.shift();)200!==b.op&&n.onMessage({op:1001,tsxId:b.tsxId,result:-9527,msg:"sdk enter fail. sdk callback. enter result = "+e.result})}return n.owner&&n.owner.closed?void d.warn("self closed. me is "+n.owner.getMemberId()+", session_id = "+n.getSessionId()+". drop message",e):(n.onEvent(new f.RecvResponse({request:p,response:e})),p&&p.__callback__&&1004!==e.op?(p.__callback__(e),void(l&&n.onWebsocketEvent(new f.NetworkChanaged({preIp:l,nowIp:n._session_ip})))):e.op&&1001!=e.op?(t(e),void(l&&n.onWebsocketEvent(new f.NetworkChanaged({preIp:l,nowIp:n._session_ip})))):void d.debug("Igron message. caused by op not found.",e))},__modifyMessageForPost:function(e){if(e.cands){for(var t=[],n=e.cands,r=0;r<n.length;r++){var i;0==r&&n[r].cctx&&(e.cctx=n[r].cctx),i="string"==typeof n[r]?{type:"candidate",candidate:n[r],mlineindex:0,mid:"audio"}:{type:"candidate",candidate:n[r].candidate,mlineindex:n[r].sdpMLineIndex,mid:n[r].sdpMid},t.push((0,c.default)(i))}e.cands=t}if(e.sdp&&"string"!=typeof e.sdp){var o={type:e.sdp.type,sdp:e.sdp.sdp};e.sdp.cctx&&(e.cctx=e.sdp.cctx),e.sdp=o,e.sdp.type=e.sdp.type.toUpperCase(),e.sdp=u.stringifyJSON(e.sdp)}return e.pubS&&u.removeAttribute(e.pubS,"_located"),e.pubS&&u.removeAttribute(e.pubS,"mutedMuted"),e.pubS&&u.removeAttribute(e.pubS,"mediaStream"),e.pubS&&u.removeAttribute(e.pubS,"isRepublished"),e.pubS&&u.removeAttribute(e.pubS,"optimalVideoCodecs"),"function"==typeof e.post&&u.removeAttribute(e,"post"),e},postMessage:function(e,t,n){1002==e.op&&console.log("postMessage 1002",(0,c.default)(e));var r=this;if(e.tsxId||(e.tsxId="MSG"+Date.now()+"-"+v++),e.memId){var i=r.owner._cacheMembers[e.memId],o=e,s=o.arg,a=!1;if(s&&(s=JSON.parse(s),21!=s.op2&&22!=s.op2&&23!=s.op2&&24!=s.op2||(a=!0)),!i&&!a)return d.warn("Member not found at local. memberId = "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not found at local. memberId = "+e.memId}));var f=e._reqOps;if(f||(f=[],f.push(e.op)),!a)for(var l in f){var p=f[l];if(!i.acptOps[p])return d.warn("Member not accept op "+p+", "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not accept op "+p+", "+e.memId}))}}if(u.removeAttribute(e,"_reqOps"),r._sessionId&&r._sessionId!=e.sessId)return d.warn("sessionId not excepted. self._sessionId = "+r._sessionId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"sessionId not excepted."}));if(r.closed)return d.warn("session closed.",e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"session closed"}));var h=u.extend({},e);return(e=r.__modifyMessageForPost(e))?(200===e.op?(r._bufferedMessages.unshift(e),t&&setTimeout(function(){r._callbacks[e.tsxId]&&(d.error("Enter timeout. fail."),r.onMessage({op:1001,tsxId:e.tsxId,result:-9527,msg:"enter timeout. millis = "+emedia.config.enterTimeout}))},emedia.config.enterTimeout)):r._bufferedMessages.push(e),t&&(r._callbacks[e.tsxId]=u.extend(e,{__callback__:t.bind(r.owner)})),r.notifyNewMessage&&r.notifyNewMessage(),void(n&&t&&setTimeout(function(){var e=r._callbacks[e.tsxId];e&&e.__callback__&&e.__callback__({op:1001,tsxId:h.tsxId,result:-408,msg:"Message request timeout."}),u.removeAttribute(r._callbacks,e.tsxId)},n))):(d.warn("Message drop. callback success.",e),void(t&&t({op:1001,tsxId:h.tsxId,result:0,msg:"Message drop. callback success."})))},close:function(e){d.warn("sessiong closing, reason = ",e);var t=this;t.notifyNewMessage&&t.notifyNewMessage(),t.closed=!0,t.seqno=0,t._websocket&&(0==e||100==e?t._websocket.close(1e3):t._websocket.close()),t.__retryConnectIntervalId&&clearTimeout(t.__retryConnectIntervalId),t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId,t.__checkConnectIntervalId&&clearTimeout(t.__checkConnectIntervalId),t.__checkConnectIntervalId&&delete t.__checkConnectIntervalId,t.owner=null,t._bufferedMessages=[],t._callbacks={},d.warn("session closed")}})},function(e,t,n){"use strict";var r=n(1),i=(r.logger,r.prototypeExtend({msg:"",__init__:function(){this.day=new Date},execTime:function(){var e=this.day.getHours();e<10&&(e="0"+e);var t=this.day.getMinutes();t<10&&(t="0"+t);var n=this.day.getSeconds();return n<10&&(n="0"+n),e+":"+t+":"+n}})),o=i.extend({_webrtcDesc:function(){var e=(this.webrtc,this.webrtc.getRtcId());return e}});e.exports={Exception:i.extend(),NetworkChanaged:i.extend({message:function s(){var s=this.execTime()+" : Network chanage ("+this.preIp+" -> "+this.nowIp+").";return s}}),WSClose:i.extend({message:function a(){var a=this.execTime()+" WSClose: Websocket close ("+(this.retry||0)+").";return this.online||(a+=" offline."),this.event&&(a+=" wscode: "+this.event.code),this.cause&&(a+=" cause: "+this.cause.message),this.url&&(a+=" url: "+this.url),a+=" retry: "+(this.retry||0),this.session&&this.session.getSessionId()&&(a=a+", sess = "+this.session.getSessionId()),a}}),WSError:i.extend({message:function c(){var c=this.execTime()+" WSError: Websocket error. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState)+". online = "+this.online;return this.session&&this.session.getSessionId()&&(c=c+", sess = "+this.session.getSessionId()),this.url&&(c+=" url: "+this.url),c}}),WSConnected:i.extend({message:function u(){var u=this.execTime()+" WSConnected: Websocket success. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState);return this.session&&this.session.getSessionId()&&(u=u+", sess = "+this.session.getSessionId()),u}}),ICEChanage:o.extend({message:function(){return this.execTime()+" ICEChanage: "+this._webrtcDesc()+" state: "+this.state}}),AddIceCandError:o.extend({message:function(){return this.execTime()+" AddIceCandError: "+this._webrtcDesc()+", add cand error"}}),ICEConnectFail:o.extend({message:function(){return this.execTime()+" ICEConnectFail: "+this._webrtcDesc()+" failed"}}),ICEConnected:o.extend({message:function(){return this.execTime()+" ICEConnected: "+this._webrtcDesc()+" connected"}}),ICEDisconnected:o.extend({message:function(){return this.execTime()+" ICEDisconnected: "+this._webrtcDesc()+" disconnected"}}),ICEClosed:o.extend({message:function(){return this.execTime()+" ICEClosed: "+this._webrtcDesc()+" closed"}}),ICERemoteMediaStream:o.extend({message:function(){return this.execTime()+" ICERemoteMediaStream: "+this._webrtcDesc()+" got remote stream"}}),StreamState:i.extend({message:function(){return this.execTime()+" StreamState:  stream "+this.stream.id+" state: "+this.state+" "+this.msg},iceFail:function(){this.state=1,this.msg="network anomaly. media lost"}}),OpenMediaError:i.extend({message:function(){return this.execTime()+" OpenMediaError:  open media error. caused by "+(this.event.name?this.event.name:this.event.message?this.event.message:this.event.toString())}}),Hangup:i.extend({message:function(){return this.self?"hangup id = "+(this.self.id||"--")+" reason："+(this.reason||0):this.execTime()+" Hangup: "+(this.parnter&&(this.parnter.name||this.parnter.id||" ")||"")+" hangup, reason："+(this.reason||0)}}),ServerRefuseEnter:i.extend({message:function(){return this.execTime()+" ServerRefuseEnter: server refuse, cause："+this.failed+", msg:"+(this.msg||"")}}),RspFail:i.extend({__init__:function(){this.day=new Date,this.failed=this.response.result,this.msg=this.response.msg||this.response.message||"--"},message:function(){return this.execTime()+" RspFail: "+this.request.tsxId+", "+(this.response.sessId||"--")+" op: "+this.request.op+", cause: "+this.failed+" "+this.msg}}),RecvResponse:i.extend({__init__:function(){this.day=new Date,this.failed=this.response.result,this.msg=this.response.msg},message:function(){return this.request?this.execTime()+" RecvResponse: "+(this.request&&this.request.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.request&&this.request.op)+", cause: "+this.failed+" "+this.msg:this.execTime()+" RecvMessage: "+(this.response&&this.response.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.response&&this.response.op)+" "+this.msg}}),EnterFail:i.extend({message:function(){return this.execTime()+" EnterFail: enter fail："+(this.cause?this.cause.message():"unkown")}}),EnterSuccess:i.extend({message:function(){return this.execTime()+" EnterSuccess: enter success "+(this.ip?", ip = "+this.ip:"")}}),PushSuccess:i.extend({message:function(){return this.execTime()+" PushSuccess: push success, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId}}),PushFail:i.extend({message:function(){return this.execTime()+" PushFail: push fail, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),RemoteControlFail:i.extend({message:function(){return this.execTime()+" RemoteControlFail: "+(this.type||"remote control")+" fail, "+(this.stream?this.stream.id:"")+" failed = "+this.failed+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubSuccess:i.extend({message:function(){return this.execTime()+" SubSuccess: sub success, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId}}),SubFail:i.extend({message:function(){return this.execTime()+" SubFail: sub fail, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubFailNotSupportVCodes:i.extend({message:function(){return this.execTime()+" SubFailNotSupportVCodes: sub fail, streamId = "+this.stream.id+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubFailSafariNotAllowSubBeforePub:i.extend({message:function(){return this.execTime()+" SubFailSafariNotAllowSubBeforePub: sub fail, streamId = "+this.stream.id+" cause：Safari without access to capture devices, WebKit only exposes Server Reflexive and TURN ICE candidates, which expose IPs that could already be gathered by websites."}}),SwitchVCodes:i.extend({message:function(){return this.execTime()+" SwitchVCodes: pub streamId = "+this.stream.id}}),CurrentCalling:i.extend({message:function(){return this.execTime()+" CurrentCalling: warn! current calling..."}}),OpenDesktopMedia:i.extend({message:function(){return this.execTime()+" OpenDesktopMedia: shared desktop, desktopStreamId = "+desktopStreamId}}),OpenDesktopMediaAccessDenied:i.extend({message:function(){return this.execTime()+" OpenDesktopMediaAccessDenied: shared desktop not allow"}}),ShareDesktopExtensionNotFound:i.extend({message:function(){return this.execTime()+" ShareDesktopExtensionNotFound: shared desktop plugin required"}}),OtherDeviceAnswer:i.extend({message:function(){return this.execTime()+" other device answer, webrtc = "+this.rtcId}}),AudioMixerStreamNotAllowSub:i.extend({message:function(){return this.execTime()+" audio mixer stream not allow sub, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}),AudioMixerStreamNotAllowOnlySubVideo:i.extend({message:function(){return this.execTime()+" audio mixer stream not allow only sub video, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}),AudioMixerStreamRepeatPublish:i.extend({message:function(){return this.execTime()+" audio mixer stream repeat publish";
}})}},function(e,t,n){"use strict";(function(e){function r(e){return e&&e.__esModule?e:{default:e}}function i(e){this.rtcconfig=void 0,this.rtcConfigUrl=e,this.get_rtcconfig()}Object.defineProperty(t,"__esModule",{value:!0});var o=n(107),s=r(o),a=n(140),c=r(a);i.prototype={get_rtcconfig:function(){var t={url:"https://rs.easemob.com/easemob/rtcconfig.json",async:!1};this.rtcConfigUrl&&(t.url=this.rtcConfigUrl);var n=this,r=void 0;try{e.ajax((0,c.default)({},t,{success:function(e){console.log("get_rtcconfig success"),e&&(0,s.default)(e).length>0&&(n.rtcconfig=e,r=e)},error:function(e){return console.error("DeployMore get error",e),e}}))}catch(i){return}return r},replace_ws:function(e){if(this.rtcconfig&&this.rtcconfig.ws){var t="wss://"+this.rtcconfig.ws+"/",n=/wss.*com\//;return e.replace(n,t)}return e},_get_info_from_candifate:function(e){if(!e)return{};var t={};return e=e.split(" "),t.ip=e[4],t.port=e[5],t},_can_replace:function(e,t,n){return!!(e&&t&&n)&&(!!e.src.ip&&(e.src.ip==t&&!(e.src.min_port>n||e.src.max_port<n)))},_replace_candidate:function(e){var t=this._get_info_from_candifate(e),n=t.ip,r=t.port,i=this;return this.rtcconfig.rtc.candidate_map.map(function(t){if(i._can_replace(t,n,r)){var o=t.dst.ip,s=Number(r)-Number(t.src.min_port),a=Number(t.dst.min_port)+Number(s),c=e.split(" ");c[4]=o,c[5]=a,e=c.join(" ")}}),e},replace_candidates:function(e){if(!this.rtcconfig)return e;var t=this;return e=e.map(function(e){return e&&e.candidate?(e.candidate=t._replace_candidate(e.candidate),e):e})},replace_trun_url:function(e){if(this.rtcconfig&&this.rtcconfig.turn){var t=e.iceServers;if(!t)return e;if(t instanceof Array==0)return e;var n=this.rtcconfig.turn;return t=t.map(function(e){e.url&&(e.url="turn:"+n)}),e}return e}},t.default=i}).call(this,n(75))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(78),o=r(i);t.default=o.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(73),o=r(i),s=n(78),a=r(s),c=n(1),u=c.tagLogger("Me"),d=n(142),f=n(138),l=n(145),p=d.extend({__init__:function(){var e=this;if(e._session||e.sessionFactory&&(e._session=e.sessionFactory()),!e._session)throw u.error("Require session"),"Require session";e._cver=0,e._cacheMembers={},e._cacheStreams={},e._streamAutomators={},e._mediaMeters={},e._openedRtcMediaStreams={},e._linkedStreams={},e._maybeNotExistStreams={},e._records={},e._ices={},e.audioMixers={},e.closed=!1,e._nextStreamSeqno=0,e.getMediaMeterIntervalMillis=e.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis},getCurrentMembers:function(){var e=this,t=[];return c.forEach(e._cacheMembers,function(e,n){var r=c.extend(!0,{},n);t.push(r)}),t},newStream:function(e){var t=this;return new l(e,{__init__:function(){var e=this;if(e.rtcId||e._webrtc&&(e.rtcId=e._webrtc.getRtcId()),e._webrtc||e.rtcId&&(e._webrtc=t._ices[e.rtcId]),e.__create_id=t._nextStreamSeqno++,e.memId&&!e.owner&&(e.owner=c.extend({},t._cacheMembers[e.memId]),!e.owner&&!e.located()))throw u.error("Remote stream, not owner. it = ",e.id),"Remote stream, not owner. it = "+e.id}})},getConfrId:function(){return this.ticket.confrId},isCaller:function(){var e=this;return e.isP2P()&&e.ticket.caller==e.ticket.memName},isCallee:function(){var e=this;return e.isP2P()&&e.ticket.callee==e.ticket.memName},isP2P:function(){var e=this;return e.ticket&&("P2P"==e.ticket.type||"p2p"==e.ticket.type)},isConfr:function(){var e=this;return e.ticket&&("CONFR"==e.ticket.type||"confr"==e.ticket.type)},onEvent:function(e){},join:function(e,t){var n=this;return emedia.requireTrustBeforeJoin()?void n.someBrowsersRequireGetUserMedia(function(){n._join(e,t)},t):void n._join(e,t)},_join:function(e,t){function n(e){try{if(e instanceof f.WSClose&&e.retry)return;e instanceof f.EnterFail||(e=new f.EnterFail({attendee:o,cause:e})),o.onEvent(e),t&&t(e)}finally{}}function r(t){if(0==t.result){o.reflushSupportVCodes(t.vcodes),o.setMemberId(t.memId),o.role=t.role,o.onEvent(new f.EnterSuccess({ip:o.ip})),e&&e(t.memId);try{o.__rtc_cfg=t.rtcCfg,"string"==typeof t.rtcCfg&&(o.__rtc_cfg=JSON.parse(t.rtcCfg))}finally{o.onMembers(t.cver,t.mems),o.onStreams(t.cver,t.streams)}}else try{n(new f.RspFail({request:s,response:t}))}finally{t.result!==-9527&&o.onEvent(new f.ServerRefuseEnter({failed:t.result,msg:t.msg}))}}function i(){s=o.newMessage().setOp(200).setTicket(o.ticket).setNickName(o.nickName||o.ticket.memName).setResource(o.resource).setExt(o.ext),o.postMessage(s,r)}u.debug("begin join ...");var o=this;console.log("Attendee self",o);var s;return o._memberId?(u.warn("Had joined. igrone it"),void(e&&e(o.memId))):(o.connect(i,n),void u.debug("join",o.ticket.url))},withpublish:function(e){function t(t,s){function a(e){try{if(e instanceof f.WSClose&&e.retry)return;e instanceof f.EnterFail||(e=new f.EnterFail({attendee:n,cause:e})),n.onEvent(e),s&&s(e)}finally{emedia.stopTracks(o),i&&n.closeWebrtc(i.getRtcId())}}function c(o){if(0==o.result){n.reflushSupportVCodes(o.vcodes),n.setMemberId(o.memId),n.role=o.role,n.onEvent(new f.EnterSuccess({ip:n.ip}));var s=n.newStream(e);s.updateAttributes({_localMediaStream:e.localStream,rtcId:i.getRtcId(),_webrtc:i,id:o.streamId,csrc:o.csrc,owner:{id:o.memId,nickName:n.nickName,name:n.sysUserId,ext:n.extObj},optimalVideoCodecs:l}),t&&t(o.memId,s),i.useIp=n.ip,n.onEvent(new f.PushSuccess({stream:s,hidden:!0})),o.sdp&&n.ansC(i.getRtcId(),o.sdp),o.cands&&n.tcklC(i.getRtcId(),o.cands);try{n.__rtc_cfg=o.rtcCfg,"string"==typeof o.rtcCfg&&(n.__rtc_cfg=JSON.parse(o.rtcCfg)),n.__rtc_cfg&&n.__rtc_cfg.iceServers&&n.__rtc_cfg.iceServers.length>0&&(u.warn("Server rsp one rtc cfg. publish will republish"),n._service&&setTimeout(function(){n._service._republish(s)},200))}finally{n.onMembers(o.cver,o.mems),n.onStreams(o.cver,o.streams)}}else try{a(new f.RspFail({request:r,response:o}))}finally{o.result!==-9527&&n.onEvent(new f.ServerRefuseEnter({failed:o.result,msg:o.msg}))}}function d(){u.debug("enter and pubs");var t,o,s=e.localStream;2===e.type&&(t={offerToReceiveAudio:!0,offerToReceiveVideo:!1},o={subSVideo:!1,subSAudio:!0}),i=n.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:l,offerOptions:t,subArgs:o,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),n.setLocalStream(s,i.getRtcId()),n.doOffer(i.getRtcId(),function(t){r=n.newMessage().setOp(200).setTicket(n.ticket).setNickName(n.nickName||n.ticket.memName).setResource(n.resource).setSdp(t).setRtcId(i.getRtcId()).setPubS(e).setExt(n.ext),n.postMessage(r,c)})}if(1===arguments.length&&(s=t,t=void 0),n._memberId)return u.warn("Had joined. igrone it"),void(t&&t(n.memId));var l=n.getOptimalVideoCodecs();n.connect(d,a),u.debug("join",n.ticket.url)}var n=this;if(!e||!e.localStream)throw u.error("pubS null or stream not open"),"pubS null or stream not open";var r,i,o=e&&e.localStream;return{join:t}},push:function(e,t,n,r){function i(t){try{var i=a.newStream(e);i.updateAttributes({_localMediaStream:e.localStream,_webrtc:d,rtcId:d&&d.getRtcId(),owner:{id:a.getMemberId(),nickName:a.nickName,name:a.sysUserId,ext:a.extObj}});var t=new f.PushFail({stream:i,cause:t,hidden:r&&t.hidden===!0});a.onEvent(t),t.hidden||n&&n(t)}finally{l&&t.hidden!==!0&&emedia.stopTracks(l),d&&a.closeWebrtc(d.getRtcId(),t.hidden===!0)}}function o(n,r){if(0!=r.result)return void i(new f.RspFail({request:c,response:r,hidden:r.retrying===!0}));var o=a.newStream(e);o.updateAttributes({_localMediaStream:e.localStream,_webrtc:n,rtcId:n.getRtcId(),id:r.streamId,csrc:r.csrc,owner:{id:a.getMemberId(),nickName:a.nickName,name:a.sysUserId,ext:a.extObj},optimalVideoCodecs:p}),o.id&&2===o.type&&(a.audioMixers[o.id]=o);try{a.onEvent(new f.PushSuccess({stream:o,hidden:!0}))}finally{r.sdp&&a.ansC(n.getRtcId(),r.sdp),r.cands&&a.tcklC(n.getRtcId(),r.cands),t&&t(o)}}function s(e){u.debug("pubs");var t,n,r=e.localStream;if(2===e.type&&(t={offerToReceiveAudio:!0,offerToReceiveVideo:!1},n={subSVideo:!1,subSAudio:!0}),d=a.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:p,offerOptions:t,subArgs:n,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),a.setLocalStream(r,d.getRtcId()),e.constaints&&e.constaints.video){var i=e.constaints.video,s=i.width,f=i.height;if(s&&f){var l=s.exact||s.min,h=f.exact||f.min,v={w:l,h:h};e.resolution=v}}a.doOffer(d.getRtcId(),function(t){c=a.newMessage().setOp(102).setRtcId(d.getRtcId()).setSdp(t).setPubS(e),a.postMessage(c,function(e){o(d,e)})})}u.debug("begin push ...");var a=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw u.error("pubS or stream open"),"pubS or stream open";var c,d,l=e.localStream;if(!e.rtcId&&2===e.type&&!emedia.config.allowRepeatAudioMixerPublish&&a._service.hasAudioMixers())return void i(new f.AudioMixerStreamRepeatPublish);var p=e.optimalVideoCodecs||a.getOptimalVideoCodecs();s(e),u.debug("push",a.ticket.url)},isSafari:function(){return emedia.isSafari},someBrowsersRequireGetUserMedia:function(e,t){var n=this;if(emedia.youInSomeBrowsers()&&!emedia._yetGetUserMedia){if(n.__tryingOpenMedia===!0)n.__tryingOpenMediaWaitSuceess=n.__tryingOpenMediaWaitSuceess||[],n.__tryingOpenMediaWaitFail=n.__tryingOpenMediaWaitFail||[],"function"==typeof e&&n.__tryingOpenMediaWaitSuceess.push(e),"function"==typeof t&&n.__tryingOpenMediaWaitFail.push(t);else{var r=function(t,r){emedia._yetGetUserMedia=!0,emedia.stopTracks(r),setTimeout(function(){n.__tryingOpenMedia=!1,e&&e.apply(n),n.__tryingOpenMediaWaitSuceess&&c.forEach(n.__tryingOpenMediaWaitSuceess,function(e,t){t.apply(n)}),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]},300)},i=function(e){n.__tryingOpenMedia=!1,u.error("Some browsers must getUserMedia, gather cands. now try get audio. fail. subfail"),t&&t.call(n,e),n.__tryingOpenMediaWaitFail&&c.forEach(n.__tryingOpenMediaWaitFail,function(t,r){r.call(n,e)}),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]};n.__tryingOpenMedia=!0,n._service.__getUserMedia({audio:!0},r,function(e){n._service.__getUserMedia({video:!0},r,i)})}return!0}return!1},createWebrtcAndSubscribeStream:function(e,t,n,r){function i(n){u.warn("sub stream error",e,n),_&&p._webrtc&&p._webrtc.setSubArgs(_),_&&p.updateAttributes({subArgs:_}),n=new f.SubFail({stream:p,hidden:n.hidden===!0,cause:n}),t&&t.onEvent&&t.onEvent(n),a.onEvent&&a.onEvent(n)}function o(){p.updateAttributes(p.subArgs)}function s(){var i=a.createWebrtc({iceServerConfig:n,optimalVideoCodecs:b,offerOptions:y,onGotMediaStream:function(e){t.onGotRemote&&t.onGotRemote(p)}},p.iceRebuildCount),o=i.getRtcId();u.warn(o," sub stream ",e,b),p.updateAttributes({_webrtc:i,rtcId:o,owner:c.extend({},l)}),r&&p._webrtc&&p._webrtc.setSubArgs(r),r&&p.updateAttributes({subArgs:r})}var a=this;t||(t={});var d=a._cacheStreams[e],l=a._cacheMembers[d.memId],p=d;r=r||p.subArgs||{subSVideo:!0,subSAudio:2!==d.type};var h=d.vcodes||[],v=l&&l.vcodes||[],m=a.supportVCodes,b=a._getOptimalVideoCodecsSubset(h,v,m);r=r||p.subArgs;var _=p.subArgs,g=!(p.vcodes&&p.vcodes.length>0);emedia.isSafari&&(g=g||!!p.voff);var y={offerToReceiveAudio:!0,offerToReceiveVideo:r.subSVideo&&!g};y.offerToReceiveAudio||y.offerToReceiveVideo||u.warn("offerToReceiveAudio == false and offerToReceiveVideo == false"),a.someBrowsersRequireGetUserMedia(function(){s(),a.offerCall(p.rtcId,null,e,i,o)},function(t){u.error("Some browsers must getUserMedia, gather cands. now try get audio. fail. subfail",e),i(t)})||(s(),a.offerCall(p.rtcId,null,e,i,o))},_getOptimalVideoCodecsSubset:function(e,t,n){var r=this,i=[];if(e&&e.length>0&&n[e[0]]&&i.push(e[0]),0==i.length)for(var o=0;o<r._orderVCodes.length;o++)c.forEach(t,function(e,t){t==r._orderVCodes[o]&&i.push(t)});return i},subscribeStream:function(e,t,n,r,i){var o=this,s=o._ices[e],a=o._cacheStreams[t],u=o._cacheMembers[a.memId],d=a;d.updateAttributes({_webrtc:s,rtcId:e,owner:c.extend({},u)});var l=d.subArgs;if(r=r||{subSVideo:!0,subSAudio:!0},d.updateAttributes({subArgs:d.subArgs||{subSVideo:!0,subSAudio:!0}}),d._webrtc&&d._webrtc.setSubArgs(d._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!d.subArgs.subSVideo&&r.subSVideo&&!d.voff){var p=a.vcodes,h=u.vcodes,v=o.supportVCodes;o._getOptimalVideoCodecsSubset(p,h,v)}r&&d._webrtc&&d._webrtc.setSubArgs(r),r&&d.updateAttributes({subArgs:r});var m=o.newMessage().setOp(205).setRtcId(e).setSubSId(t);r&&c.extend(m,r),o.postMessage(m,function(e){if(0!=e.result){l&&d._webrtc&&d._webrtc.setSubArgs(l),l&&d.updateAttributes({subArgs:l});var t=new f.SubFail({stream:d,cause:new f.RspFail({request:m,response:e})});return n&&n(t),void o.onEvent(t)}d.updateAttributes(d.subArgs);var t=new f.SubSuccess({stream:d,hidden:!0});o._updateRemoteStream(d,d._webrtc.getRemoteStream()),o.onEvent(t),"function"==typeof i&&i()})},unsubscribeStream:function(e){var t=this,n=t._cacheStreams[e],r=n._webrtc&&n._webrtc.getRtcId();if(r){try{var i=t.newMessage().setOp(206).setRtcId(r).setSubSId(e);t.postMessage(i)}finally{t.closeWebrtc(r)}return r}},onEnter:function(e,t){var n=this;if(e&&(n._cver=e),t&&!n._cacheMembers[t.id]){n._cacheMembers[t.id]=t;var r={};t.res&&t.res.vcodes&&t.res.vcodes.length>0&&c.forEach(t.res.vcodes,function(e,t){r[t]||(r[t]=!0,n.supportVCodes[t]&&n.supportVCodes[t]++)}),n.onAddMember(c.extend({},t))}},_onFinally:function(){var e=this;e._cacheMembers={},e._cacheStreams={},e._linkedStreams={},e._ices={},e._maybeNotExistStreams={};var t=[];if(c.forEach(e._openedRtcMediaStreams,function(e,n){n.active!==!1&&t.push(n)}),t.length>0)for(var n=0;n<t.length;n++)try{var r=t[n];u.info("exit, close stream = ",r.id),emedia.stopTracks(r)}catch(i){u.error(i)}u.warn("finally. all clean.")},_onRoleUpdate:function(e,t){var n=this;u.info("Role ",e," <-",n.role),u.info(t),n.role=e,n.roleToken=t,n.onRoleUpdate&&n.onRoleUpdate(e,t)},onExit:function(e,t,n){var r=this;if(e&&(r._cver=e),t!=r.getMemberId()){var i=r._cacheMembers[t];i&&(i.res&&i.res.vcodes&&i.res.vcodes.length>0&&c.forEach(i.res.vcodes,function(e,t){r.supportVCodes[t]--}),r._onRemoveMember(i,n),r.onEvent(new f.Hangup({reason:n,parnter:i})))}else{u.warn("Me exit. ",n,t);try{r.closed||r.close(n)}catch(o){r.onEvent(new f.Hangup({reason:n,self:{id:r._memberId}})),r.onMeExit&&r.onMeExit(n),u.warn(o)}}},onPub:function(e,t,n){var r=this;if(!r._cacheMembers[t])throw u.error("No found member. when pub"),"No found member. when pub";var i=r.newStream(n),o=r._cacheStreams[n.id];if(e&&(r._cver=e),o&&i.sver!==o.sver)return u.info("Onpub. the steam ",o.id," republish. sver ",o.sver,i.sver),!i||i.aoff===o.aoff&&i.voff==o.voff||r.onStreamControl(void 0,n.id,i.voff,i.aoff),c.extend(o,i),void r._onRepublishStream(o);var s=i;return s.updateAttributes({owner:r._cacheMembers[t]}),r._cacheStreams[n.id]=s,r._onAddStream(r.newStream(s)),r.autoSub&&r.createWebrtcAndSubscribeStream(n.id,{onGotRemote:function(e){}}),s},onUnpub:function(e,t,n){var r=this,i=r._cacheStreams[n];r._onRemovePubstream(r._cacheMembers[t],i),e&&(r._cver=e)},onClose:function(e,t,n){var r=this;try{r.close(n||0)}finally{r.onConfrClose&&r.onConfrClose(t,n)}},__getWebrtcFor:function(e){var t=this,n=t._cacheStreams[e]&&t._cacheStreams[e]._webrtc;return n&&n.getRtcId()},_getWebrtc:function(e){var t=this,n=t._cacheStreams[e]&&t._cacheStreams[e]._webrtc;return n},_updateRemoteStream:function(e,t){e.located()&&2===e.type?emedia.enableAudioTracks(t,!0):emedia.enableAudioTracks(t,!(e.aoff||e.subArgs&&e.subArgs.subSAudio===!1)),emedia.enableVideoTracks(t,!(e.voff||e.subArgs&&e.subArgs.subSVideo===!1))},onStreamControl:function(e,t,n,r,i){var o=this,s=o._cacheStreams[t];s.updateAttributes({voff:n,aoff:r});var c=s._webrtc;c&&c._remoteStream&&o._updateRemoteStream(s,c._remoteStream);var d=o.newStream(s);o.onUpdateStream&&o.onUpdateStream(d,new d.Update({voff:n,aoff:r})),e&&(o._cver=e),i&&s.updateAttributes({sver:i}),emedia.isSafari&&!n&&c&&!c.closed&&c.offerOptions&&!c.offerOptions.offerToReceiveVideo&&(u.warn("stream video turn on. but sub not video, will close it, repsub stream",c.getRtcId(),c.__id,t),o.closeWebrtc(c.getRtcId(),!0,!1),o.createWebrtcAndSubscribeStream(t,{onGotRemote:function(e){var t=(0,a.default)(o._service.__safari_subs,{});t&&t instanceof Array&&t.map(function(n,r){n.streamId==e.id&&t.splice(r,1)}),o._service.__safari_subs=t},onEvent:function(e){var t=(0,a.default)(o._service.__safari_subs,{});t&&t instanceof Array&&t.map(function(e,n){e.streamId==s.id&&t.splice(n,1)}),o._service.__safari_subs=t}},void 0,s.subArgs))},aoff:function(e,t,n){var r=this,i=r.__getWebrtcFor(e.id);if(!i)throw u.error("pubS not publish",e.id),"pubS not publish"+e.id;var o=r._linkedStreams[e.id];o.updateAttributes({aoff:t}),e.updateAttributes({aoff:t});var s=r.newMessage().setOp(400).setRtcId(i).setVoff(e.voff).setAoff(t);r.postMessage(s,n),r.onUpdateStream&&r.onUpdateStream(e,new e.Update({aoff:t}))},voff:function(e,t,n){var r=this,i=r.__getWebrtcFor(e.id);if(!i)throw u.error("pubS not publish",e.id),"pubS not publish"+e.id;var o=r._linkedStreams[e.id];o.updateAttributes({voff:t}),e.updateAttributes({voff:t});var s=r.newMessage().setOp(400).setRtcId(i).setVoff(t).setAoff(e.aoff);r.postMessage(s,n),r.onUpdateStream&&r.onUpdateStream(e,new e.Update({voff:t}))},startRecord:function h(e,t){var n=this,r=e.rtcId,h=n.newMessage().setOp(500).setRtcId(r).setFlag(1);n.postMessage(h,function(i){u.warn("record ",r,i.result,i.msg),t&&t(0===i.result),0===i.result&&(n._records[e.id]=c.extend(!1,{},e))})},stopRecord:function v(e,t){var n=this,r=e.rtcId,v=n.newMessage().setOp(500).setRtcId(r).setFlag(0);n.postMessage(v,function(e){u.warn("stop record ",r,e.result,e.msg),t&&t(0===e.result)}),n._records[e.id]&&c.removeAttribute(n._records,e.id)},onMembers:function(e,t){var n=this,r=[];c.forEach(n._cacheMembers,function(e,n){t[e]||r.push(n)}),c.forEach(r,function(e,t){n.onExit(void 0,t.id)});var i=[];c.forEach(t,function(e,t){(t.name&&t.name!=n.memName||!t.name&&e!=n.getMemberId())&&(n._cacheMembers[e]||i.push(t),n._cacheMembers[e]&&c.extend(n._cacheMembers[e],t))}),c.forEach(i,function(e,t){n.onEnter(void 0,t)}),e&&(n._cver=e)},onStreams:function(e,t){var n=this,r=[];c.forEach(n._cacheStreams,function(e,n){n.located()||t[e]||r.push(n)}),c.forEach(r,function(e,t){n.onUnpub(void 0,t.memId,t.id)});var i=[];c.forEach(t,function(e,t){(t.memName&&t.memName!=n.memName||!t.memName&&t.memId!=n.getMemberId())&&(n._cacheStreams[e]||i.push(t),n._cacheStreams[e]&&c.extend(n._cacheStreams[e],t))}),c.forEach(i,function(e,t){n.onPub(void 0,t.memId,t)}),c.forEach(n._cacheStreams,function(e,r){var i;r.located()||(i=t[e]),!i||i.aoff===r.aoff&&i.voff==r.voff||n.onStreamControl(void 0,e,i.voff,i.aoff),i&&i.sver!==r.sver&&(c.extend(r,i),n._onRepublishStream(r))}),e&&(n._cver=e)},_onRemoveMember:function(e,t){var n=this;u.info("remove",e,t);var r=[];c.forEach(n._cacheStreams,function(t,n){(n.memId||n.owner&&n.owner.id)===e.id&&r.push(n)}),c.forEach(r,function(e,r){n._onRemovePubstream(r.owner,r,t)}),c.removeAttribute(n._cacheMembers,e.id),n.onRemoveMember&&n.onRemoveMember(e,t)},_onAddStream:function(e){u.info("add stream ",e.id),u.debug("add stream ",e);var t=this;t.onAddStream(e)},_onRemovePubstream:function(e,t,n){function r(e){2===e.type&&(c.removeAttribute(i.audioMixers,e.id),e.remotePlayAudioObject&&document.body.removeChild(e.remotePlayAudioObject)),n||(n="Unpub"),e&&!e.closeReason&&e.updateAttributes({closeReason:n});i.unsubscribeStream(e.id),c.removeAttribute(i._cacheStreams,e.id);if(i._streamAutomators&&c.removeAttribute(i._streamAutomators,e.id),i._monitSoundChanagedStreams&&c.removeAttribute(i._monitSoundChanagedStreams,e.id),i.onRemoveStream){var e=i.newStream(e);i.onRemoveStream(e)}}var i=this;if(t&&0!=t.id)try{var o=c.removeAttribute(i._mediaMeters,t.id);o&&o._finally()}finally{r(t)}},_onRepublishStream:function(e){var t=this;if(!t._ices[e.rtcId]&&!emedia.subscribed(e)||t._maybeNotExistStreams[e.id])t.onUpdateStream(e);else{t.unsubscribeStream(e.id);t.createWebrtcAndSubscribeStream(e.id,{onGotRemote:function(e){}})}},_onRecvRemoteMessage:function(e,t,n){var r=this;u.debug("Recv remote message",e,t);var i,o=r._cacheMembers[e];try{i=JSON.parse(t)}catch(s){}r.onRecvRemoteMessage&&r.onRecvRemoteMessage(o||e,i||t,n)},_onSoundChanage:function(e,t,n){emedia.config._printSoundData&&u.info("Stream id "+t.id+", meter "+(n&&n.instant.toFixed(2)+" "+n.slow.toFixed(2)+" "+n.clip.toFixed(2)+" "+(n.trackAudioLevel||"--")+" "+(n.trackTotalAudioEnergy||"--"))),n||(n={instant:0,slow:0,clip:0}),emedia.config.logVolumeWhenInstantGE&&emedia.config.logVolumeWhenInstantGE>0&&n.instant>=emedia.config.logVolumeWhenInstantGE&&n.instant<3*emedia.config.logVolumeWhenInstantGE&&u.info("Stream id "+t.id+", webrtc = "+(t._webrtc?t._webrtc.getRtcId():"null")+", media streamId = "+(t.getMediaStream()?t.getMediaStream().id:"null")+", instant >= "+emedia.config.logVolumeWhenInstantGE+", meter instant="+n.instant+", slow="+n.slow+", clip="+n.clip);var r=this;0===n.instant&&(n.instant=n.trackAudioLevel||n.trackTotalAudioEnergy||0),r.onSoundChanage(e,t,n),r._service._judgeTalking(n)&&r.onTalking(e,t,n)},onAddMember:function(e){},onRemoveMember:function(e,t){},onAddStream:function(e){},onRemoveStream:function(e){},onUpdateStream:function(e,t){},onRecvRemoteMessage:function(e,t){},onSoundChanage:function(e,t,n){},onTalking:function(e,t,n){},_sendRequestMessage:function(e){if(e){var t=this,n=function(){var e="";for(var n in t._cacheMembers){var r=t._cacheMembers[n];if(r.role==emedia.mgr.Role.ADMIN){e=r.id;break}}return e},r=n();if(!r)return void console.warn("this confrence have not admin");var i=this._memberId,s=this.memName,c=this.nickName,u=this.newMessage(),d={op:1002,memId:r,arg:(0,o.default)({op2:e,memId:i,memName:s,nickName:c||s}),tsxTime:(new Date).getTime(),_reqOps:["1002"+e]};(0,a.default)(u,d),this.postMessage(u)}},requestToTalker:function(){this._sendRequestMessage(21)},_send_action_request_message:function(e,t,n){if(t&&e&&void 0!==n){var r=t.tsxId,i=t.arg,s=i.memId,c=this.newMessage(),u={op:1001,arg:(0,o.default)({op2:e,memId:s}),memId:s,result:n,tsxId:r,_reqOps:["1002"+e]};(0,a.default)(c,u),this.postMessage(c)}},refuseRequestToTalker:function(e){this._send_action_request_message(21,e,1)},refuseRequestToAdmin:function(e){this._send_action_request_message(22,e,1)},requestToAdmin:function(){this._sendRequestMessage(22)},_sendControlAudioMessage:function(e,t){if(e&&t){var n=this.newMessage(),r={op:1002,memId:e,arg:(0,o.default)({op2:t,memId:e}),tsxTime:(new Date).getTime(),_reqOps:[100223,100224]};(0,a.default)(n,r),this.postMessage(n)}},muteBymemberId:function(e){this._sendControlAudioMessage(e,23)},unmuteBymemberId:function(e){this._sendControlAudioMessage(e,24)}});e.exports=p},function(e,t,n){"use strict";var r=n(1),i=r.tagLogger("Member"),o=n(138),s=n(143);e.exports=r.prototypeExtend({__init__:function(){var e=this;if(!e._session)throw i.error("Require session"),"Require session";e.closed=!1,e._ices={},e.supportVCodes={},e.audioMixers={}},reflushSupportVCodes:function(e){var t=this;return t.supportVCodes={},t._orderVCodes=e,e&&0!=e.length?void r.forEach(e,function(e,n){t.supportVCodes[n]=1}):void i.warn("Not config support vcodes")},getOptimalVideoCodecs:function(){var e=this;if(!e._orderVCodes||0==e._orderVCodes.length)return/Chrome/.test(navigator.userAgent)?"VP8":/Safari/.test(navigator.userAgent)&&/Version\/11/.test(navigator.userAgent)?"H264":"VP8";var t=0;r.forEach(e._cacheMembers,function(){t++});for(var n,i=0,o=0;o<e._orderVCodes.length;o++){var s=e._orderVCodes[o];if(0==i&&(i=e.supportVCodes[s]),e.supportVCodes[s]>t)return s;e.supportVCodes[s]>i&&(i=e.supportVCodes[s],n=s)}return n||e._orderVCodes&&e._orderVCodes.length>0&&e._orderVCodes[0]},setMemberId:function(e){this._memberId=e},getMemberId:function(){return this._memberId||this.id},createWebrtc:function(e,t){var n=this;e||(e={}),r.extend(e,{_rebuildCount:t||0}),n._service.useRTCCfg===!0&&n.__rtc_cfg?e.iceServerConfig=r.extend(!0,{},n.__rtc_cfg):r.isPlainObject(n._service.useRTCCfg)&&(e.iceServerConfig=r.extend(!0,{},n._service.useRTCCfg));var a=new s({confrAttendee:n,useIp:n.ip,onIceStateChange:function(e){var t=e;i.debug("evt.target ice state",t);try{if("failed"==t)return n.onEvent(new o.ICEConnectFail({webrtc:a})),void(a.onEvent&&a.onEvent(new o.ICEConnectFail({webrtc:a})));if("connected"==t)return n.onEvent(new o.ICEConnected({webrtc:a})),void(a.onEvent=null);if("closed"==t)return n.onEvent(new o.ICEClosed({webrtc:a})),void(a.onEvent&&a.onEvent(new o.ICEClosed({webrtc:a})));if("disconnected"==t)return n.onEvent(new o.ICEDisconnected({webrtc:a})),void(a.onEvent&&a.onEvent(new o.ICEDisconnected({webrtc:a})))}finally{n._onIceStateChange&&n._onIceStateChange(a,e)}},onIceCandidate:function(e){n._onIceCandidate&&e&&n._onIceCandidate(a,e)},onGotRemoteStream:function(e){i.info("got stream.",a._rtcId,a.__id,e),a.onGotMediaStream&&a.onGotMediaStream(e),n.onEvent(new o.ICERemoteMediaStream({webrtc:a}))},onAddIceCandidateError:function(e){n.onEvent(new o.AddIceCandError({webrtc:a,event:e}))},onSetSessionDescriptionError:function(e){i.warn("onSetSessionDescriptionError : Failed to set session description: "+e.toString()),n.onEvent&&n.onEvent(new o.ICEConnectFail({webrtc:a,event:e}))},onCreateSessionDescriptionError:function(e){i.warn("Failed to create session description: "+e.toString()),n.onEvent&&n.onEvent(new o.ICEConnectFail({webrtc:a,event:e}))}},e);return n._ices||(n._ices={}),n._ices[a.getRtcId()]&&n._howDoWebrtcWhenCrtExsitsWebrtc(a),n._ices[a.getRtcId()]=a,n._ices[a.__id]=a,n._iceCreateRtcPeerConnection(a.getRtcId()),i.debug("create rtc ",a),a},_howDoWebrtcWhenCrtExsitsWebrtc:function(e){var t=this;t.closeWebrtc(e.getRtcId(),!0,!1)},connect:function(e,t){var n=this;n._session.connect(e,t)},connected:function(){var e=this;return e._session.connected()},newMessage:function a(e){var t=this,a=t._session.newMessage(e);return a.post=function(e,n){t.postMessage(this,e,n)},a},message:function c(e){var t=this,c=t._session.newMessage(e);return c.post=function(e,n){t.postMessage(this,e,n)},c},postMessage:function(e,t,n){var r=this;try{e.sessId||(e.sessId=r._session._sessionId),r._session.postMessage(e,t,n)}catch(o){t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"post message. exception"}),i.warn(o)}},onEvent:function(e){},_onIceStateChange:function(e,t){var n=this;i.info(e.getRtcId(),t),n.onEvent(new o.ICEChanage({webrtc:e,state:t}))},_onIceCandidate:function(e,t){var n,i=this;r.isArray(t)?n=t:(n=[],n.push(t));var s=i.newMessage().setOp(105).setRtcId(e.getRtcId()).setCands(n);i.postMessage(s,function(e){if(0!=e.result)return void i.onEvent(new o.RspFail({request:s,response:e}))})},_initC:function(e,t,n,s,a,c){var u=this;if(t&&t.rtcId!==e.getRtcId())throw i.error("stream and webrtc rtcId not equal."),"stream and webrtc rtcId not equal.";var d=u.newMessage().setOp(102).setRtcId(e.getRtcId()).setSdp(n).setSubSId(s);e.subArgs&&r.extend(d,e.subArgs),t&&t.located()&&d.setPubS(t),u.postMessage(d,function(n){if(0!=n.result)return u.onEvent(new o.RspFail({request:d,response:n})),void(a&&a(new o.RspFail({request:d,response:n,hidden:n.retrying===!0})));t&&!t.id&&n.streamId&&t.updateAttributes({id:n.streamId});try{c&&c()}catch(r){i.warn(r)}n.sdp&&u.ansC(e.getRtcId(),n.sdp,n.cands),n.mems&&u.onMembers&&u.onMembers(n.cver,n.mems),n.streams&&u.onStreams&&u.onStreams(n.cver,n.streams)})},_acptC:function(e,t,n){var r=this,i=r.newMessage().setOp(104).setRtcId(e.getRtcId()).setSdp(t);r.postMessage(i,function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:i,response:e})),void(n&&n(new o.RspFail({request:i,response:e})))})},_ansCAndPubstream:function(e,t,n,s,a){var c=this,u=c.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(n);e.subArgs&&r.extend(u,e.subArgs),t&&t.located()&&(t=r.extend({},t),r.removeAttribute(t,"mutedMuted"),r.removeAttribute(t,"_located"),u.setPubS(t)),c.postMessage(u,function(e){if(0!=e.result)return c.onEvent(new o.RspFail({request:u,response:e})),void(s&&s(new o.RspFail({request:u,response:e,hidden:e.retrying===!0})));t&&!t.id&&e.streamId&&t.updateAttributes({id:e.streamId});try{a&&a()}catch(n){i.warn(n)}})},_ansC:function(e,t,n){var r=this,i=r.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(t);r.postMessage(i,function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:i,response:e})),void(n&&n(new o.RspFail({request:i,response:e})))})},_termC:function(e,t,n){var r=this,i="string"==typeof e?e:e.getRtcId(),s=r.newMessage().setOp(107).setRtcId(i).setEndReason(t);r.postMessage(s,function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:s,response:e})),void(n&&n(new o.RspFail({request:s,response:e})))})},_iceCreateRtcPeerConnection:function(e){var t=this;t._ices[e].createRtcPeerConnection(),i.debug("create rtc peer connection",e)},doOffer:function(e,t,n){var r=this,i=r._ices[e];i.createOffer(function(e){t(e)})},offerCall:function(e,t,n,r,i){var o=this,s=o._ices[e];s.createOffer(function(e){o._initC&&o._initC(s,t,e,n,r,i)})},accept:function(e,t){var n=this,r=n._ices[e];r.createPRAnswer(function(e){n._acptC&&n._acptC(r,e,t)})},answerCall:function(e,t,n,r){var i=this,o=i._ices[e];o.createAnswer(function(e){i._ansCAndPubstream&&i._ansCAndPubstream(o,t,e,n,r)})},answer:function(e,t){var n=this,r=n._ices[e];r.createAnswer(function(e){n._ansC&&n._ansC(r,e,t)})},onTcklC:function(e,t){var n=this;n._addIceCandidate(t,e)},onAcptC:function(e,t,n){var r=this;r._iceSetRemoteSDP(t,e),n&&r._addIceCandidate(n,e)},onAnsC:function(e,t,n){var r=this;r._iceSetRemoteSDP(t,e),n&&r._addIceCandidate(n,e)},_addIceCandidate:function(e,t){var n=this;if(!e||0==e.length)return void i.warn("drop cands",e);var r=n._ices[t];r&&r.addIceCandidate(e)},closeWebrtc:function(e,t,n){var o=this,s=o._ices[e];if(r.forEach(o._cacheStreams,function(t,n){if(n.rtcId===e&&!n.located())try{var s=r.removeAttribute(o._mediaMeters,t);s&&s._finally()}catch(a){i.warn(a)}n.rtcId===e&&2===n.type&&r.removeAttribute(o.audioMixers,n.id)}),!s||s.closed)return i.warn("Webrtc not exsits or closed",s&&s.closed),n&&s&&r.forEach(o._cacheStreams,function(t,n){n.rtcId===e&&(r.removeAttribute(o._linkedStreams,t),i.warn("Webrtc close, remvoe from _linkedStreams",t))}),void(n||o._termC(e,0));if(o._records){var a=function(e){try{o.stopRecord(e)}catch(t){i.warn(t)}finally{r.removeAttribute(o._records,e.id)}};r.forEach(o._records,function(t,n){n.rtcId===e&&a(n)})}try{n||s&&o._termC(s,t&&s._localStream?-10:0)}finally{s&&s.close(t),s&&o.onWebrtcTermC&&o.onWebrtcTermC(s),t||s&&r.forEach(o._cacheStreams,function(t,s){s.rtcId===e&&(s.located()&&(emedia.stopTracks(s._localMediaStream),s&&!s.closeReason&&s.updateAttributes({closeReason:"WebrtcClose"}),o._cacheStreams[t]&&o._linkedStreams[t]&&o.onRemoveStream(s),r.removeAttribute(o._cacheStreams,t),o._streamAutomators&&r.removeAttribute(o._streamAutomators,t),o._monitSoundChanagedStreams&&r.removeAttribute(o._monitSoundChanagedStreams,t),i.info("Webrtc close. Remove stream",t,". from cache")),n&&(r.removeAttribute(o._linkedStreams,t),i.info("Webrtc close. Remove stream",t,". from _linkedStreams")))})}return s},__close:function(e){i.warn("closing, reason = ",e);var t=this;if(!t.closed){if(t.closed=!0,t.__getCopyInterval&&(clearInterval(t.__getCopyInterval),i.warn("Stop interval get copy")),t._ices)for(var n in t._ices)t.closeWebrtc(n,!1);var r=t.newMessage().setOp(201).setReason(e||0);t.postMessage(r)}},exit:function(e){var t=this;return e?(e&&t._closeMyConfr(11),void setTimeout(function(){t.close(0)},100)):void t.close(0)},_closeMyConfr:function(e){var t=this,n=t.newMessage().setOp(204).setReason(e||0);t.postMessage(n,function(e){i.warn("Close confr ",e.result,e.msg)})},close:function(e,t){var n=this;if(!n.closed)try{r.forEach(n._cacheStreams||{},function(e,t){t.located()&&t._localMediaStream&&emedia.stopTracks(t._localMediaStream);
}),n.__close(e),r.forEach(n._cacheStreams,function(e,t){n.onRemoveStream(t)}),r.forEach(n._cacheMembers,function(e,t){})}finally{try{setTimeout(function(){n._session&&n._session.close(e)},500),n.onEvent(new o.Hangup({reason:e,failed:t,self:{id:n._memberId}})),n.onMeExit&&n.onMeExit(e,t)}catch(s){i.error(s)}finally{n._onFinally&&n._onFinally()}}},webrtcState:function(e){var t=this,n=t._ices[e];return n.iceConnectionState()},_iceSetRemoteSDP:function(e,t){var n=this,r=n._ices[t];r&&r.setRemoteDescription(e)},setLocalStream:function(e,t){var n=this,r=n._ices[t];r.setLocalStream(e)},onWebrtcTermC:function(e){}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(73),o=r(i),s=n(107),a=r(s),c=n(1),u=c.tagLogger("Webrtc"),d=n(144),f=n(139).default,l={headerSection:null,audioSection:null,videoSection:null,_parseHeaderSection:function(e,t,n){var r=t;return n===-1||(r=t===-1?n:Math.min(t,n)),r>=0?e.slice(0,r):e},_parseAudioSection:function(e,t,n){var r=t;if(r>=0)return e.slice(r,n<r?e.length:n)},_parseVideoSection:function(e,t,n){var r=n;if(r>=0)return e.slice(r,t<r?e.length:t)},spiltSection:function(e){var t=this;t._preSDP=e;var n=t._preAudioIndex=e.indexOf("m=audio"),r=t._preVideoIndex=e.indexOf("m=video");t.headerSection=t._parseHeaderSection(e,n,r),t.audioSection=t._parseAudioSection(e,n,r),t.videoSection=t._parseVideoSection(e,n,r)},setVideoBitrate:function(e){e&&this.videoSection&&(this.videoSection=this.setBitrate(this.videoSection,e))},setVideoMinBitrate:function(e){this.setAllFmtpBitrate({"x-google-min-bitrate":e})},setVideoMaxBitrate:function(e){this.setAllFmtpBitrate({"x-google-max-bitrate":e})},setVideoStartBitrate:function(e){this.setAllFmtpBitrate({"x-google-start-bitrate":e})},setAllFmtpBitrate:function(e){if(this.videoSection){var t={};(0,a.default)(e).forEach(function(n){var r=e[n],i=n+"="+r,o=new RegExp("(a=fmtp\\:\\d+\\s\\S*;?)("+n+"=\\d+)(;?\\S*)","g");t[n]={field:i,regex:o}}),this.videoSection=this.videoSection.replace(/(a=fmtp\:\d+[^\r\n]+)([\r\n]+)/g,function(e,n,r){return n.indexOf("apt=")>=0?e:((0,a.default)(t).forEach(function(e){var r=t[e],i=r.regex,o=r.field,s=n.replace(i,function(e,t,n,r){return t+o+r});s.indexOf(e)<0?(s.endsWith(";")||(s+=";"),n=s+o):n=s}),n+r)})}},setFmtpBitrate:function(e,t){if(t&&this.videoSection){var n=e+"="+t,r=new RegExp("(a=fmtp\\:\\d+\\s\\S*;?)("+e+"=\\d+)(;?\\S*)","g");this.videoSection=this.videoSection.replace(/(a=fmtp\:\d+[^\r\n]+)([\r\n]+)/g,function(t,i,o){var s=i.replace(r,function(e,t,r,i){return t+n+i});return s.indexOf(e)<0&&(s.endsWith(";")||(s+=";"),s+=n),s+o})}},setAudioBitrate:function(e){e&&this.audioSection&&(this.audioSection=this.setBitrate(this.audioSection,e))},setBitrate0:function(e,t){return e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1AS$2"+t),e.indexOf("b=AS")<0&&(e=e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b=AS:"+t+"$2")),e},setBitrate:function(e,t){var n="AS";return emedia.isFirefox&&(t=1e3*(t>>>0),n="TIAS"),e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1"+n+"$2"+t),e.indexOf("b="+n+":")<0&&(e=e.indexOf("c=IN ")<0?e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b="+n+":"+t+"$2"):e.replace(/c=IN ([^\r\n]+)([\r\n]+)/,"c=IN $1$2b="+n+":"+t+"$2")),e},updateVideoSection:function(e,t){var n=this;n.videoSection&&(n.videoSection=n.videoSection.replace(e,t))},updateAudioSection:function(e,t){var n=this;n.audioSection&&(n.audioSection=n.audioSection.replace(e,t))},updateVideoSendonly:function(){var e=this;e.videoSection&&(e.videoSection=e.videoSection.replace(/sendrecv/g,"sendonly"))},updateVideoRecvonly:function(){var e=this;e.videoSection&&(e.videoSection=e.videoSection.replace(/sendrecv/g,"recvonly"))},updateAudioSendonly:function(){var e=this;e.audioSection&&(e.audioSection=e.audioSection.replace(/sendrecv/g,"sendonly"))},updateAudioRecvonly:function(){var e=this;e.audioSection&&(e.audioSection=e.audioSection.replace(/sendrecv/g,"recvonly"))},updateACodes:function(e){var t=this;if(e&&t.audioSection){if("string"==typeof e){var n=[];n.push(e),e=n}for(var r={},i=/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi,n=t._parseLine(t.audioSection,i),o=0;o<n.length;o++){var s=n[++o],a=n[++o];r[a]=s}for(var d=[],o=0;o<e.length;o++){var f=r[e[o]];f&&d.push(f)}0==d.length&&(t._webrtc?u.warn("Not found acodes map",e,t._webrtc._rtcId,t._webrtc.__id):u.warn("Not found acodes map",e));var l=t.audioSection.indexOf("\r"),p=t.audioSection.substring(0,l),h=p.split(" ");Array.prototype.push.apply(d,h.slice(3));var v=[],m={};c.forEach(d,function(e,t){0==v.length?(v.push(t),m[t]=!0):m[t]||(v.push(t),m[t]=!0)}),h.splice(3,h.length-3,v.join(" ")),p=h.join(" "),t._webrtc&&u.warn(p,t._webrtc._rtcId,t._webrtc.__id),t.audioSection=p+t.audioSection.substring(l)}},updateVCodes:function(e){var t=this;if(e&&t.videoSection){if("string"==typeof e){var n=[];n.push(e),e=n}for(var r={},i=/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi,n=t._parseLine(t.videoSection,i),o=0;o<n.length;o++){var s=n[++o],a=n[++o];r[a]=s}var d=/a=fmtp:(\d+) .*profile-level-id=42e01f;?.*/gi,f=t._parseLine(t.videoSection,d);f&&f.length>=2&&(r.H264=f[1]);for(var l=[],o=0;o<e.length;o++){var p=r[e[o]];p&&l.push(p)}0==l.length&&(t._webrtc?u.warn("Not found vcodes map",e,t._webrtc._rtcId,t._webrtc.__id):u.warn("Not found vcodes map",e));var h=t.videoSection.indexOf("\r"),v=t.videoSection.substring(0,h),m=v.split(" ");Array.prototype.push.apply(l,m.slice(3));var b=[],_={};c.forEach(l,function(e,t){0==b.length?(b.push(t),_[t]=!0):_[t]||(b.push(t),_[t]=!0)}),m.splice(3,m.length-3,b.join(" ")),v=m.join(" "),t._webrtc&&u.warn(v,t._webrtc._rtcId,t._webrtc.__id),t.videoSection=v+t.videoSection.substring(h)}},removeSSRC:function(e){for(var t=[],n=e.split(/a=ssrc:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},removeField_msid:function(e){for(var t=[],n=e.split(/a=msid:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);e=t.join("\n"),t=[],n=e.split(/[\n]+/g);for(var r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},updateHeaderMsidSemantic:function(e){var t=this,n="a=msid-semantic: WMS "+e,r=t.headerSection.split(/a=msid\-semantic: WMS.*/g),i=[];switch(r.length){case 1:i.push(r[0]);break;case 2:i.push(r[0]),i.push(n),i.push("\n");break;case 3:i.push(r[0]),i.push(n),i.push("\n"),i.push(r[2]),i.push("\n")}return t.headerSection=i.join("")},updateAudioSSRCSection:function(e,t,n,r){var i=this;i.audioSection&&(i.audioSection=i.removeSSRC(i.audioSection)),i.audioSection&&(i.audioSection=i.removeField_msid(i.audioSection)),i.audioSection&&(i.audioSection=i.audioSection+i.ssrcSection(e,t,n,r))},updateVideoSSRCSection:function(e,t,n,r){var i=this;i.videoSection&&(i.videoSection=i.removeSSRC(i.videoSection)),i.videoSection&&(i.videoSection=i.removeField_msid(i.videoSection)),i.videoSection&&(i.videoSection=i.videoSection+i.ssrcSection(e,t,n,r))},getUpdatedSDP:function(e){var t=this;void 0!==e&&null!=e||(e=t._preAudioIndex<t._preVideoIndex);var n;t.videoSection&&t.videoSection.replace(/a=mid:([^\r\n]+)/,function(e,t){return n=t,e});var r;t.audioSection&&t.audioSection.replace(/a=mid:([^\r\n]+)/,function(e,t){return r=t,e});var i;if(e){var o=["a=group:BUNDLE"];t.audioSection&&o.push(r),t.videoSection&&o.push(n),i=t.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,o.join(" ")),t.audioSection&&(i+=t.audioSection),t.videoSection&&(i+=t.videoSection)}else{var o=["a=group:BUNDLE"];t.videoSection&&o.push(n),t.audioSection&&o.push(r),i=t.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,o.join(" ")),t.videoSection&&(i+=t.videoSection),t.audioSection&&(i+=t.audioSection)}return i},parseMsidSemantic:function(e){var t=this,n=/a=msid\-semantic:\s*WMS (\S+)/gi,r=t._parseLine(e,n);return r&&2==r.length&&(t.msidSemantic={line:r[0],WMS:r[1]}),t.msidSemantic},ssrcSection:function(e,t,n,r){var i=["a=ssrc:"+e+" cname:"+t,"a=ssrc:"+e+" msid:"+n+" "+r,"a=ssrc:"+e+" mslabel:"+n,"a=ssrc:"+e+" label:"+r,""];return i.join("\n")},parseSSRC:function(e){var t=this,n=new RegExp("a=(ssrc):(\\d+) (\\S+):(\\S+)","ig"),r=t._parseLine(e,n);if(r){for(var i={lines:[],updateSSRCSection:t.ssrcSection},o=0;o<r.length;o++){var s=r[o];if(s.indexOf("a=ssrc")>=0)i.lines.push(s);else switch(s){case"ssrc":case"cname":case"msid":case"mslabel":case"label":i[s]=r[++o]}}return i}},_parseLine:function(e,t){for(var n,r=[];null!=(n=t.exec(e));)for(var i=0;i<n.length;i++)r.push(n[i]);if(r.length>0)return r}},p=function(e,t){c.extend(this,l),this._webrtc=t,this.spiltSection(e)};p.isAudioVideo=function(e){var t=e.indexOf("m=audio"),n=e.indexOf("m=video");return t<n},p.isVideoPreAudio=function(e){var t=e.indexOf("m=audio"),n=e.indexOf("m=video");return t>=0&&n>=0&&n<t};var h=emedia.__rtc_globalCount=0,v=c.prototypeExtend({closed:!1,sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},offerOptions:{offerToReceiveAudio:!0,offerToReceiveVideo:!0},optimalVideoCodecs:null,optimalAudioCodecs:null,__init__:function(){var e=this;e._rtcId||(e._rtcId="RTC"+h++),e.__id="_i_"+h++,e.__setRemoteSDP=!1,e.__tmpRemoteCands=[],e.__tmpLocalCands=[],e._rtcPeerConnection=null,e.cctx=e.__id,emedia&&emedia.config&&emedia.config.forceUseVideoCodecs&&emedia.config.forceUseVideoCodecs.length>0&&(e.optimalVideoCodecs=emedia.config.forceUseVideoCodecs),emedia&&emedia.config&&emedia.config.forceUseAudioCodecs&&emedia.config.forceUseAudioCodecs.length>0&&(e.optimalAudioCodecs=emedia.config.forceUseAudioCodecs),emedia&&emedia.config&&"number"==typeof emedia.config.forceVideoBitrate&&(e.vbitrate=emedia.config.forceVideoBitrate),emedia&&emedia.config&&"number"==typeof emedia.config.forceMinVideoBitrate&&(e.vminBitrate=emedia.config.forceMinVideoBitrate),emedia&&emedia.config&&"number"==typeof emedia.config.forceAudioBitrate&&(e.abitrate=emedia.config.forceAudioBitrate),u.info("Webrtc created. optimal video codecs:",e.optimalVideoCodecs,"audio codecs:",e.optimalAudioCodecs,"vbitrate:",e.vbitrate,"vminBitrate:",e.vminBitrate,"abitrate:",e.abitrate,e._rtcId,e.__id)},getRtcId:function(){return this._rtcId},iceState:function(){var e=this;return e._rtcPeerConnection.iceConnectionState},setSubArgs:function(e){var t=this;t.subArgs=e},getReceiversOfPeerConnection:function(){var e=this;if(e._rtcPeerConnection&&"closed"!=e._rtcPeerConnection.iceConnectionState)return e._rtcPeerConnection.getReceivers()},updateRemoteBySubArgs:function(){var e=this;e.subArgs&&e._remoteStream&&(emedia.enableVideoTracks(e._remoteStream,!(e.subArgs&&e.subArgs.subSVideo===!1)),emedia.enableAudioTracks(e._remoteStream,!(e.subArgs&&e.subArgs.subSAudio===!1)),u.info("enable tracks remote stream",e._remoteStream,e.subArgs,e._rtcId,e.__id,e.closed))},createRtcPeerConnection:function(e){function t(e){u.info("states: connectionState",r.connectionState,", iceConnectionState",r.iceConnectionState,"@",n._rtcId,n.__id,n.closed);try{var t=r.iceConnectionState||r.connectionState;"failed"!=r.connectionState&&"failed"!=r.iceConnectionState&&"closed"!=r.iceConnectionState&&"closed"!=r.iceConnectionState||(t="failed",console.log("sqx state",t)),n.lastIceConnectionState!==t&&(n.lastIceConnectionState=t,n.onIceStateChange(t))}finally{}}var n=this;u.debug("begin create peer connection ......",n._rtcId,n.__id,n.closed),e||(e=n.iceServerConfig),e||emedia.isEdge?(e||(e={}),!e.iceServers&&(e.iceServers=[]),e.rtcpMuxPolicy="require",e.bundlePolicy="max-bundle",e.relayOnly&&(e.iceTransportPolicy="relay")):e=null,emedia&&emedia.config&&"function"==typeof emedia.config.reconfigRTCConfiguration&&(e=emedia.config.reconfigRTCConfiguration(e)),emedia.config.useDeployMore&&(emedia.mgr.rtc_url_config||(emedia.mgr.rtc_url_config=new f(emedia.config.rtcConfigUrl||"")),e&&e.iceServers&&(e=emedia.mgr.rtc_url_config.replace_trun_url(e))),u.info("create pc, set config:",e,n._rtcId,n.__id,n.closed);var r=n._rtcPeerConnection=new RTCPeerConnection(e);r.__peerId=n._rtcId,u.debug("created local peer connection object",r,n._rtcId),r.onicecandidate=function(e){var t=e.candidate;if("icecandidate"==e.type&&(!t||"string"==typeof t.protocol&&"tcp"===t.protocol.toLowerCase()||/ TCP /.test(t.candidate)))return void u.debug("On ICE candidate: drop",t,n._rtcId,n.__id,n.closed);if(!t.candidate)throw u.error("Not found candidate. candidate is error"),"Not found candidate. candidate is error,";return t.cctx=n.cctx,n.__setRemoteSDP?(u.debug("On ICE candidate ok: ",t,n._rtcId,n.__id,n.closed),void n._onIceCandidate(t)):((n.__tmpLocalCands||(n.__tmpLocalCands={})).push(t),void u.debug("On ICE candidate ok: but tmp buffer caused by not set remote sdp: ",t,n._rtcId,n.__id,n.closed))},n.lastIceConnectionState="",r.onconnectionstatechange=t.bind(n),r.onicestatechange=t.bind(n),r.oniceconnectionstatechange=t.bind(n),r.onsignalingstatechange=function(e){u.info("states: signaling",r.signalingState,"@",n._rtcId,n.__id,n.closed)},null===r.ontrack&&n._onTrack&&(r.ontrack=function(e){n._onTrack(e)}),r.onaddstream=function(e){n._onGotRemoteStream(e)}},addTrack:function(e,t){var n=this;e.forEach(function(e){n._rtcPeerConnection.addTrack(e,t),u.debug("Added track(",e.id,e.kind,e.label,") of stream(",t.id,") to RtcPeerConnection",n._rtcId,n.__id,n.closed)})},setLocalStream:function(e){var t=this;if(t._localStream=e,t._rtcPeerConnection.addTrack)e.getTracks().forEach(function(n){t._rtcPeerConnection.addTrack(n,e),u.debug("Added track(",n.enabled,n.id,n.kind,n.label,") of localStream(",e.id,") to RtcPeerConnection",t._rtcId,t.__id,t.closed)});else{t._rtcPeerConnection.addStream(e);var n=e.getVideoTracks(),r=e.getAudioTracks();n&&n.length>0&&u.debug("RtcPeerConnection video: ",n[0].enabled,n[0].id,n[0].kind,n[0].label,t._rtcId,t.__id,t.closed),r&&r.length>0&&u.debug("RtcPeerConnection audio: ",r[0].enabled,r[0].id,r[0].kind,r[0].label,t._rtcId,t.__id,t.closed)}u.debug("Added local stream to RtcPeerConnection",e.id,e.active,t._rtcId,t.__id,this.closed)},removeStream:function(e){this._rtcPeerConnection.removeStream(e),u.debug("Remove stream from RtcPeerConnection",e,self._rtcId,self.__id,this.closed)},getLocalStream:function(){return this._localStream},getRemoteStream:function(){return this._remoteStream},createOffer:function(e,t){u.info("start create offer... self.offerOption str",(0,o.default)(this.offerOptions)),u.info("start create offer... self.offerOption",this.offerOptions);var n=this,r=c.extend({},n.offerOptions),i=n.subArgs?{offerToReceiveAudio:!0,offerToReceiveVideo:!0}:JSON.parse((0,o.default)(n.offerOptions));return n._rtcPeerConnection.createOffer(i).then(function(t){if(u.info("original offer sdp",t),n.offerDescription=t,emedia.isEdge&&(t.sdp=t.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f")),emedia.isFirefox?n.fireFoxOfferVideoPreAudio=n.__offerVideoPreAudio=p.isVideoPreAudio(t.sdp):n.__offerVideoPreAudio=p.isVideoPreAudio(t.sdp),t.sdp=t.sdp.replace(/m=video 0/g,"m=video 9"),u.warn("setLocalDescription. modify offer. if 'm=video 0' -> 'm=video 9'; if H264, 'profile-level-id=42e01f'",n._rtcId,n.__id),n.optimalVideoCodecs&&n.optimalVideoCodecs.length>0||n.optimalAudioCodecs&&n.optimalAudioCodecs.length>0||r&&(r.offerToReceiveVideo===!1||r.offerToReceiveAudio===!1)){var o=new p(t.sdp,n);n.optimalVideoCodecs&&o.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&o.updateACodes(n.optimalAudioCodecs),i&&r.offerToReceiveVideo===!1&&o.updateVideoSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),i&&r.offerToReceiveAudio===!1&&o.updateAudioSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),t.sdp=o.getUpdatedSDP()}if(u.debug("setLocalDescription start",n._rtcId,n.__id,n.closed,n.optimalVideoCodecs,n.optimalAudioCodecs),emedia.config.useDTX){t.sdp=t.sdp.replace(/a=rtpmap:(.*)CN\/(.*)\r\n/g,"");var s=t.sdp.match(/a=rtpmap:(.*)\sopus/)[1];t.sdp=t.sdp.replace(new RegExp("a=fmtp:"+s+"(.*)\\r\\n"),"a=fmtp:"+s+"$1;usedtx=1\r\n")}n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then(function(){t.cctx=n.cctx,(e||n.onCreateOfferSuccess.bind(n))(t)})},t||n._onCreateSessionDescriptionError.bind(n,i))},createPRAnswer:function(e,t){var n=this;return u.info(" createPRAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then(function(t){u.debug("_____________PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),t.type="pranswer",t.sdp=t.sdp.replace(/a=recvonly/g,"a=inactive");var r=new p(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),t.sdp=r.getUpdatedSDP(),n.__prAnswerDescription=t,u.debug("inactive PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),u.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then(function(){r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP(),u.debug("Send PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreatePRAnswerSuccess.bind(n))(t)})},t||n._onCreateSessionDescriptionError.bind(n,n.sdpConstraints))},createAnswer:function(e,t){var n=this;return u.info("createAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then(function(t){function r(e){var n=e.parseMsidSemantic(e.headerSection);if(n){"*"==n.WMS&&e.updateHeaderMsidSemantic(n.WMS="MS_0000");var r=e.parseSSRC(e.audioSection),i=e.parseSSRC(e.videoSection);r&&e.updateAudioSSRCSection(1e3,"CHROME0000",n.WMS,r.label||"LABEL_AUDIO_1000"),i&&e.updateVideoSSRCSection(2e3,"CHROME0000",n.WMS,i.label||"LABEL_VIDEO_2000"),t.sdp=e.getUpdatedSDP()}}u.debug("_____________________Answer ",n._rtcId,n.__id,n.closed),t.type="answer";var i=new p(t.sdp,n);n.optimalVideoCodecs&&i.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&i.updateACodes(n.optimalAudioCodecs),emedia.supportPRAnswer?r(i):t.sdp=i.getUpdatedSDP(),n.__answerDescription=t,u.debug("Answer ",n._rtcId,n.__id,n.closed),u.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then(function(){emedia.supportPRAnswer&&(i.updateHeaderMsidSemantic("MS_0000"),i.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),i.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=i.getUpdatedSDP()),u.debug("Send Answer ",n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreateAnswerSuccess.bind(n))(t)})},t||n._onCreateSessionDescriptionError.bind(n,n.sdpConstraints))},_printStats:function(e){var t=this;t.confrAttendee&&emedia.config.remainLastStatsCount&&e&&e.getTracks().forEach(function(e){t._printTrackStats(e)})},_printTrackStats:function(e){var t=this;if(t.confrAttendee&&emedia.config.remainLastStatsCount){var n=t.confrAttendee._trackStats&&t.confrAttendee._trackStats[e.id];if(n){for(var r in n){var i=n[r];for(var o in i){var s=i[o];if(s)for(var a=s.curIndex,d=0;d<emedia.config.remainLastStatsCount;d++){a=(a-1)%emedia.config.remainLastStatsCount;var f=s[a];if(!f||void 0===f.data)break;u.info("[track]",t._rtcId,t.__id,e.kind,e.id,r,o,f.data,f.timestamp.toLocaleString())}}}c.removeAttribute(t.confrAttendee._trackStats,e.id)}}},close:function(e,t,n){var r=this;if(u.warn("webrtc closing",r._rtcId,r.__id,r.closed),r.__iceWaitIntervalId&&clearTimeout(r.__iceWaitIntervalId),!r.closed){t=t===!0,r.closed=!0;try{var i=function(){if(r._rtcPeerConnection&&r._rtcPeerConnection.close(),u.info("peer connection close. it is",r._rtcPeerConnection&&r._rtcPeerConnection.__peerId),!n&&emedia.isSafari){r._rtcPeerConnection.iceConnectionState||r._rtcPeerConnection.connectionState;setTimeout(function(){r._rtcPeerConnection.iceConnectionState||r._rtcPeerConnection.connectionState;r.onIceStateChange&&r.onIceStateChange("closed")},200)}},o=r._localStream,s=r._remoteStream;emedia.config.printStatsWhenPCClose?r.getStats(function(){i(),o&&r._printStats(o),s&&r._printStats(s)}):i()}catch(a){u.warn(a)}finally{r._localStream&&e===!1&&emedia.stopTracks(r._localStream),r._remoteStream&&emedia.stopTracks(r._remoteStream),r._remoteStream=null,t||r.onClose&&r.onClose(),n===!0&&(u.info("Webrtc close. but retry build. will onIceStateChange(failed). eg. emedia.config iceWaitBuildMillis",r._rtcId,r.__id),r.onIceStateChange&&r.onIceStateChange("failed")),u.warn("webrtc closed. closed:",r._rtcId,r.__id,r.closed)}}},addIceCandidate:function(e){console.log("addIceCandidate candidate",(0,o.default)(e));var t=this,n=c.isArray(e)?e:[e];if(emedia.mgr.rtc_url_config&&(n=emedia.mgr.rtc_url_config.replace_candidates(n)),emedia&&emedia.config&&"function"==typeof emedia.config.reChanageCandidate){for(var r=[],i=0;i<n.length;i++){e=n[i];var s=emedia.config.reChanageCandidate(e);s&&(u.info("Candidate rechanage. addons. it =",e,"->",s),c.isArray(s)?Array.prototype.push.apply(r,s):r.push(s))}n=r}t._addIceCandidate(n)},_addIceCandidate:function(e){var t=this;if(t._rtcPeerConnection){u.debug("Add ICE candidate: ",e,t._rtcId,t.__id,t.closed);var n=c.isArray(e)?e:[e];if(!t.__setRemoteSDP)return Array.prototype.push.apply(t.__tmpRemoteCands||(t.__tmpRemoteCands={}),n),void u.debug("Add ICE candidate but tmp buffer caused by not set remote sdp: ",e,t._rtcId,t.__id,t.closed);for(var r=0;r<n.length;r++)if(e=n[r],e.cctx&&e.cctx!=t.cctx)u.warn("addIceCandidate fail drop. cctx not equal. ",e,t._rtcId,t.__id,t.closed);else{if(t.fireFoxOfferVideoPreAudio===!0){var i=e.sdpMLineIndex;e.sdpMLineIndex=parseInt(e.sdpMid.replace(/[^0-9]*/,"")),u.warn("Firefox sdp section video pre audio, sdp mline index update ",i,"->",e.sdpMLineIndex)}e.candidate&&""!==e.candidate?t._rtcPeerConnection.addIceCandidate(new RTCIceCandidate(e)).then(t.onAddIceCandidateSuccess.bind(t),t._onAddIceCandidateError.bind(t,e)):u.warn("Add ICE candidate fail. drop it ",e,t._rtcId,t.__id,t.closed)}}},setRemoteDescription:function(e){var t=this;return t._setRemoteDescription(e)},_setRemoteDescription:function(e){var t=this;if(t.__iceWaitIntervalId&&(clearTimeout(t.__iceWaitIntervalId),t.__iceWaitIntervalId=null,u.info("emedia.config iceWaitBuildMillis, clear ice wait interval id",t._rtcId,t.__id)),u.debug("setRemoteDescription start. ",t._rtcId,t.__id,t.closed),t.offerDescription){if(e.cctx&&e.cctx!=t.cctx)return void u.warn("setRemoteDescription fail drop. cctx not equal. ",e,t._rtcId,t.__id,t.closed);if(t.fireFoxOfferVideoPreAudio===!0||t.__offerVideoPreAudio===!0){var n=new p(e.sdp,t);e.sdp=n.getUpdatedSDP(!1),u.info("Remote sdp.2. switch audio video",e.sdp)}}else e.cctx&&(t.cctx=e.cctx);if(e.sdp=e.sdp.replace(/UDP\/TLS\/RTP\/SAVPF/g,"RTP/SAVPF"),u.warn("setRemoteDescription. UDP/TLS/RTP/SAVPF -> RTP/SAVPF; if firefox: switch audio video;",t._rtcId,t.__id),t.vbitrate||t.abitrate||t.vminBitrate){var n=new p(e.sdp,t);t.vbitrate&&n.setVideoBitrate(t.vbitrate),t.vminBitrate&&n.setVideoMinBitrate(t.vminBitrate),t.abitrate&&n.setAudioBitrate(t.abitrate),u.warn("vbitrate = ",t.vbitrate,"vminBitrate = ",this.vminBitrate,", abitrate = ",t.abitrate,t._rtcId,t.__id),e.sdp=n.getUpdatedSDP("undefined"==typeof t.__offerVideoPreAudio||null===t.__offerVideoPreAudio?void 0:!t.__offerVideoPreAudio)}return u.debug("final remote sdp =",e.sdp,t._rtcId,t.__id),e=t.__remoteDescription=new RTCSessionDescription(e),t._rtcPeerConnection.setRemoteDescription(e).then(function(){t.__setRemoteSDP=!0,t._onSetRemoteSuccess.apply(t,arguments),t.__tmpLocalCands&&t.__tmpLocalCands.length>0&&(u.debug("After setRemoteDescription. send cands",t._rtcId,t.__id,t.closed),t._onIceCandidate(t.__tmpLocalCands),t.__tmpLocalCands=[]),t.__tmpRemoteCands&&t.__tmpRemoteCands.length>0&&(u.debug("After setRemoteDescription. add tmp cands",t._rtcId,t.__id,t.closed),t._addIceCandidate(t.__tmpRemoteCands),t.__tmpRemoteCands=[])},t._onSetSessionDescriptionError.bind(t,e))},iceConnectionState:function(){var e=this;return e._rtcPeerConnection.iceConnectionState},isConnected:function(){var e=this,t=e.lastIceConnectionState;return"connected"===t||"completed"===t},_onGotRemoteStream:function(e){var t=this;t._remoteStream=e.stream||e.streams[0],t._remoteStream._rtcId=t._rtcId,t._remoteStream.__rtc_c_id=t.__id,u.debug("On got remote stream",t._remoteStream?t._remoteStream.id+"_"+t._remoteStream.active:"null",t._rtcId,t.__id),t._remoteStream&&t._remoteStream.getTracks().forEach(function(e){u.debug("remote stream",t._remoteStream.id," track =",e.enabled,e.id,e.kind,e.label,t._rtcId,t.__id)}),t.updateRemoteBySubArgs(),this.onGotRemoteStream(this._remoteStream,e),u.debug("received remote stream, you will see the other.",t._rtcId,t.__id,this.closed)},_onSetRemoteSuccess:function(){u.info("onSetRemoteSuccess success",this._rtcId,this.__id),this.onSetRemoteSuccess.apply(this,arguments),this.offerDescription&&this.__remoteDescription&&this.__remoteDescription.sdp&&this._onAnswerCodes(this.__remoteDescription.sdp)},_onAnswerCodes:function(e){var t=this,n=new p(e,this);if(n.videoSection){var r=d.parseRtpParameters(n.videoSection);if(!r.codecs||0===r.codecs.length)return void u.info("not found any video codes. @ ",t._rtcId,t.__id);var i=[],o={};c.forEach(r.codecs,function(e,t){o[t.name]!==!0&&(o[t.name]=!0,i.push(t.name))}),t.finalVCodeChoices=i,t.onVCodeChoices&&t.onVCodeChoices(i)}},onSetRemoteSuccess:function(){},onAddIceCandidateSuccess:function(){u.debug("addIceCandidate success",this._rtcId,this.__id)},_onAddIceCandidateError:function(e,t){u.error("failed to add ICE Candidate: "+t.toString(),", error candidate:",e,this._rtcId,this.__id),this.onAddIceCandidateError(t)},onAddIceCandidateError:function(e){},_onIceCandidate:function(e){u.debug("onIceCandidate:",e,this._rtcId,this.__id),this.onIceCandidate(e)},onIceCandidate:function(e){},onIceStateChange:function(e){u.debug("onIceStateChange : ICE state ",e)},_onCreateSessionDescriptionError:function(e,t){u.error("Failed to create session description: "+t.toString()," offerOptionsOrSDPConstraints:",e,this._rtcId,this.__id),this.onCreateSessionDescriptionError(t)},onCreateSessionDescriptionError:function(e){},onCreateOfferSuccess:function(e){u.debug("create offer success",this._rtcId,this.__id)},onCreatePRAnswerSuccess:function(e){u.debug("create answer success",this._rtcId,this.__id)},onCreateAnswerSuccess:function(e){u.debug("create answer success",this._rtcId,this.__id)},_onSetSessionDescriptionError:function(e,t){u.error("onSetSessionDescriptionError : Failed to set session description: ",t.toString(),this._rtcId,this.__id),e&&e.type&&e.sdp&&u.error("error sdp: type=",e.type,"sdp=",e.sdp,this._rtcId,this.__id),this.onSetSessionDescriptionError(t)},onSetSessionDescriptionError:function(e){},_onSetLocalSessionDescriptionSuccess:function(){var e=this;u.debug("onSetLocalSessionDescriptionSuccess : setLocalDescription complete",this._rtcId,this.__id),emedia.config.iceWaitBuildMillis&&(this.__iceWaitIntervalId&&clearTimeout(this.__iceWaitIntervalId),this.__iceWaitIntervalId=setTimeout(function(){u.info("emedia.config iceWaitBuildMillis, timeout, will close webrtc, will retry build by onIceStateChange(failed)",e._rtcId,e.__id),e.onIceStateChange&&e.onIceStateChange("failed")},emedia.config.iceWaitBuildMillis),u.info("emedia.config iceWaitBuildMillis, start timeout",e._rtcId,e.__id)),this.onSetLocalSessionDescriptionSuccess(),this.__answerDescription&&this.__answerDescription.sdp&&this._onAnswerCodes(this.__answerDescription.sdp)},onSetLocalSessionDescriptionSuccess:function(){},onGotRemoteStream:function(e){u.debug("Got remote stream. ",e,this._rtcId,this.__id)},getStats:function(e){var t=this;return t._rtcPeerConnection?"function"!=typeof emedia.config.rtcStatsTypeMath?(u.warn("Get stats, but config rtcStatsTypeMather, ",this._rtcId,this.__id),void(e&&e())):void t._rtcPeerConnection.getStats(null).then(function(n){n.forEach(function(e,n){emedia.config.rtcStatsTypeMath(e,n)&&u.info("Rtc stats",e,t._rtcId,t.__id)}),e&&e(n)}):(u.warn("Get stats, but peer connection not exsits, ",this._rtcId,this.__id),void(e&&e()))}});e.exports=v},function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){var n=r.matchPrefix(e+t,"a=fingerprint:");
return{role:"auto",fingerprints:n.map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i={usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var s=i[o],a=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var c=r.parseRtpMap(a),u=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=u.length?r.parseFmtp(u[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var d=r.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};var s=r.matchPrefix(e,"a=sctpmap:");if(s.length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i,o=void 0!==t?t:2;i=e?e:r.generateSessionId();var s=n||"thisisadapterortc";return"v=0\r\no="+s+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){var t=r.splitLines(e),n=t[0].split(" ");return n[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=r},function(e,t,n){"use strict";var r=n(1),i=n(146);emedia.subscribed=function(e){return!!e._located||(2===e.type?!(e._located||!e._webrtc):void 0!==e._webrtc)};var o=r.prototypeExtend({voff:0,aoff:0,__init__:function(){var e=this;if(!e._mediaStream)throw _logger.error("_mediaStream empty"),"_mediaStream empty";if(e.hasEnabledTracks(e._mediaStream)){if(!e.__audioContext)throw _logger.error("require audioContext"),"require audioContext";e.__soundMeter=new i(e.__audioContext),e.__soundMeter.connectToSource(e._mediaStream,function(t){if(t)throw t;e.__worked=e.__soundMeter.__worked=!0})}},hasEnabledTracks:function(e){return emedia.hasEnabledTracks(e)},getSoundMeters:function(){var e=this;if(e.__soundMeter&&e.__worked){if(!e._mediaStream.active)return void(e.__worked&&e._finally());if(e.hasEnabledTracks(e._mediaStream))return{instant:e.__soundMeter.instant,slow:e.__soundMeter.slow,clip:e.__soundMeter.clip}}},_finally:function(){var e=this;e.__soundMeter&&(e.__soundMeter.stop(),e.__worked=e.__soundMeter.__worked=!1)}});e.exports=r.prototypeExtend({__undefinedEQDelete:!0,Update:r.prototypeExtend({ifAoff:function(e){this.if("aoff",e)},ifVoff:function(e){this.if("voff",e)},ifMediaStream:function(e){this.if("mediaStream",e)},if:function(e,t){"undefined"!=typeof this[e]&&t(this[e])}}),located:function(){return this._located||!1},webrtc:function(e){return e&&(this._webrtc=e),this},getMediaStream:function(){return"undefined"!=typeof this.mediaStream?this.mediaStream:this._located?this._localMediaStream:this._webrtc&&(this._webrtc.getRemoteStream()||this._webrtc.getLocalStream())},requestFrame:function(){this._localMediaStream&&this._localMediaStream.getVideoTracks().forEach(function(e){"function"==typeof e.requestFrame&&e.requestFrame()})},getLocalMediaStream:function(){return this._localMediaStream},getRemoteMediaStream:function(){if(this._webrtc&&"undefined"!=typeof this._webrtc.getRemoteStream())return this._webrtc.getRemoteStream()},mutedNeed:function(){return this.mutedMuted||!1},ifMediaStream:function(e){return"undefined"!=typeof this.mediaStream?void e(this.mediaStream):this._located&&"undefined"!=typeof this._localMediaStream?void e(this._localMediaStream):!this._located&&this._webrtc&&"undefined"!=typeof this._webrtc.getRemoteStream()?void e(this._webrtc.getRemoteStream()):void 0},subscribed:function(){return emedia.subscribed(this)},updateAttributes:function(){for(var e=this,t=0;t<arguments.length;t++){var n=arguments[t];if(r.isPlainObject(n))for(var i in n){var o=n[i];e[i]=o}}},getHtmlDOMID:function(){return"_m_"+this.owner.id+"_s_"+this.id},MediaSoundMeter:o,StreamSoundMeter:r.prototypeExtend({__init__:function(){var e=this;if(!e._stream||"function"!=typeof e._stream.getMediaStream)throw _logger.error("_stream empty or not found method getMediaStream"),"_stream empty or not found method getMediaStream";if(e._streamId=e._stream.id,e._streamCreateId=e._stream.__create_id,e._mediaStream=e._mediaStream,2===e._stream.type&&!e._stream.located()&&!e._webrtc)throw _logger.error("require webrtc. when type = 2 and not located"),"require webrtc. when type = 2 and not located";e.__mediaSoundMeter=e.__mediaSoundMeter||new o({__audioContext:e.__audioContext,_mediaStream:e._mediaStream}),e.__mediaSoundMeter.useCount=(e.__mediaSoundMeter.useCount||0)+1},onSoundMeters:function(e){var t=this,n={instant:0,slow:0,clip:0};if(t._stream.aoff)return t._finally(),e(n),n;if(2!==t._stream.type&&t._stream.subArgs&&void 0!==t._stream.subArgs.subSAudio&&!t._stream.subArgs.subSAudio)return t._finally(),e(n),n;if(0==t._stream.id||2===t._stream.type&&!t._stream.located()&&(!t._stream.subArgs||!t._stream.subArgs.subSAudio)){var i=t._webrtc.getReceiversOfPeerConnection();if(!i||0===i.length)return e(n),n;var o;for(var s in i)"audio"===i[s].track.kind&&(o=i[s]);if(!o)return e(n),n;if("function"==typeof o.getContributingSources){var a=o.getContributingSources();if(emedia.config._printSoundData&&r.logger.debug(t._stream.id,t._stream.csrc,"rtpContributingSources ",a),!a||0===a.length)return e(n),n;var c;for(var s in a)a[s].source==t._stream.csrc&&(c=t._stream.csrc);if(emedia.config._printSoundData&&r.logger.debug(t._stream.id,t._stream.csrc,"source ",c),void 0===c)return e(n),n}}var u=t.__mediaSoundMeter.getSoundMeters()||n,d=2===t._stream.type?t._webrtc:t._stream._webrtc;(emedia.meterWithTrackAudioLevel||0===u.instant)&&d&&!d.closed&&d._rtcPeerConnection&&d._rtcPeerConnection.getStats().then(function(t){t.size>0&&t.forEach(function(t){"track"!==t.type||"audio"!==t.kind&&"audio"!==t.trackIdentifier||(u.trackAudioLevel=t.audioLevel,u.trackTotalAudioEnergy=t.totalAudioEnergy,e(u))})}),e(u)},_finally:function(){var e=this;2===e._stream.type&&e._stream.located()&&e._remoteMediaSoundMeters&&e._remoteMediaSoundMeters._finally(),e.__mediaSoundMeter.useCount--,0===e.__mediaSoundMeter.useCount&&e.__mediaSoundMeter._finally()}})})},function(e,t,n){"use strict";function r(e){this.context=e,this.instant=0,this.slow=0,this.clip=0,this.script=e.createScriptProcessor(2048,1,1);var t=this;this.script.onaudioprocess=function(e){var n,r=e.inputBuffer.getChannelData(0),i=0,o=0;for(n=0;n<r.length;++n)i+=r[n]*r[n],Math.abs(r[n])>.99&&(o+=1);t.instant=Math.sqrt(i/r.length),t.slow=.95*t.slow+.05*t.instant,t.clip=o/r.length}}r.prototype.connectToSource=function(e,t){console.log("SoundMeter connecting");try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),"undefined"!=typeof t&&t(null)}catch(n){console.error(n),"undefined"!=typeof t&&t(n)}},r.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e.exports=r},function(e,t,n){"use strict";var r=n(1),i=r.tagLogger("Handler"),o=n(138),s=r.prototypeExtend({onEvent:function(e){function t(){try{n.handleEvent(e)}catch(t){i.warn(t)}}this.mgr&&this.mgr.upload_stats&&this.mgr.upload_stats.upload_event(e);var n=this;if(e&&i.info("[EVT]",e.message(),e.hidden||""),e instanceof o.ServerRefuseEnter&&e.failed&&e.failed===-95270&&(e.failed=-9527),e instanceof emedia.event.StreamState&&e.stream&&e.stream.located())return void t();try{e.hidden||n.onNotifyEvent&&n.onNotifyEvent(e)}finally{t()}},handleEvent:function(e){var t=this;if(e instanceof o.RecvResponse)t._onRecvResponse(e);else if(e instanceof o.ServerRefuseEnter)i.warn("Server refuse, ",e.failed,e.msg),t.onServerRefuseEnter(e);else if(e instanceof o.NetworkChanaged)i.warn("Network chanaged, ",e.preIp,e.nowIp),t.onNetworkChanaged(e);else if(e instanceof o.EnterFail)i.warn("Enter fail, result = ",e.failed),t.onEnterFail();else if(e instanceof o.WSClose)t.onWSClose();else if(e instanceof o.WSConnected)i.warn("Websocket connected");else if(e instanceof o.ICEConnected){var n=e.webrtc;t.onICEConnected(n)}else if(e instanceof o.ICEConnectFail){var n=e.webrtc;t.onICEConnectFail(n)}else if(e instanceof o.ICEDisconnected){var n=e.webrtc;t.onICEDisconnected(n)}else if(e instanceof o.ICEClosed){var n=e.webrtc;t.onICEClosed(n)}else if(e instanceof o.ICERemoteMediaStream)t.onICERemoteMediaStream(e.webrtc);else if(e instanceof o.PushSuccess){t._cacheStreams[e.stream.id]=t._linkedStreams[e.stream.id]=e.stream;var s=t.newStream(e.stream);if(e.hidden&&!t._maybeNotExistStreams[e.stream.id]&&!s.isRepublished)return void t._onAddStream(s);emedia._yetGetUserMedia=!0;try{e.hidden!==!0&&s&&t.onUpdateStream(s,new s.Update({voff:s.voff,aoff:s.aoff,mediaStream:s.getMediaStream()}))}finally{emedia.isSafari&&r.forEach(t._cacheStreams,function(e,n){n._autoSubWhenPushStream===!0&&(r.removeAttribute(n,"_autoSubWhenPushStream"),t.createWebrtcAndSubscribeStream(n.id))})}}else if(e instanceof o.SubSuccess)console.log("__event.SubSuccess",e),t._linkedStreams[e.stream.id]=e.stream,e.stream.updateAttributes({_zoom:1});else if(e instanceof o.PushFail){if(e.hidden!==!0){var a=r.removeAttribute(t._linkedStreams,e.stream.id);if(i.warn("PushFail remove from _linkedStreams",e.stream.id,a),a){var s=t.newStream(e.stream);t.onRemoveStream(s)}}}else if(e instanceof o.SubFail){if(e.hidden!==!0){r.removeAttribute(t._linkedStreams,e.stream.id),i.warn("SubFail remove from _linkedStreams",e.stream.id);var s=t.newStream(e.stream);s.updateAttributes({rtcId:void 0,_webrtc:void 0,mediaStream:void 0}),t.onUpdateStream(s,new s.Update(s))}}else if(e instanceof o.SubFailNotSupportVCodes){var c=e.stream;i.warn("Rtc donot support pub VCodes. close. sub fail.",c.rtcId," -> ",c.id);try{t.onNotSupportPublishVideoCodecs&&t.onNotSupportPublishVideoCodecs(c)}catch(u){i.warn(u)}}else if(e instanceof o.EnterSuccess)console.log("__event.EnterSuccess",e),t.onEnterSuccess();else if(e instanceof o.SwitchVCodes){var c=e.stream,d=e.useVCodes,n=c._webrtc;i.warn("Rtc switch VCodes. ",c.id,d),d&&0!=d.length||i.warn("Rtc switch VCodes. error! useVCodes is empty ",c.id,d);var f;if(emedia.config&&emedia.config.forceUseVideoCodecs&&emedia.config.forceUseVideoCodecs.length>0&&(f=emedia.config.forceUseVideoCodecs,r.isArray(f)||(f=[],f.push(emedia.config.forceUseVideoCodecs))),f){if("string"==typeof f&&f!==d[0])return void i.warn("Rtc switch VCodes. igrone . useVCodes !== forceUseVideoCodecs ",c.id,n._rtcId,d,f);if(r.isArray(f)&&f[0]!==d[0])return void i.warn("Rtc switch VCodes. igrone ddd . useVCodes == forceUseVideoCodecs ",c.id,n._rtcId,d,f)}if(n&&n.optimalVideoCodecs){if("string"==typeof n.optimalVideoCodecs&&n.optimalVideoCodecs==d[0])return void i.warn("Rtc switch VCodes. igrone . useVCodes == optimalVideoCodecs ",c.id,n._rtcId,d);if(r.isArray(n.optimalVideoCodecs)&&n.optimalVideoCodecs.length>0&&n.optimalVideoCodecs[0]==d[0])return void i.warn("Rtc switch VCodes. igrone ddd . useVCodes == optimalVideoCodecs ",c.id,n._rtcId,d)}c.updateAttributes({optimalVideoCodecs:d}),n&&t.closeWebrtc(n.getRtcId(),!0),setTimeout(function(){c.updateAttributes({iceRebuildCount:1}),t.iceRebuild(c),i.warn("Rtc switch VCodes. iceRebuild end.",c.id,d)},300)}},_onRecvResponse:function(e){var t=this,n=e.request,r=e.response;if(n&&r&&200!==n.op&&1002!==n.op&&0!==r.result){i.warn("Server refuse. when request = ",n);var o=e.failed;switch(o){case-9527:case-95270:break;case-500:case-502:case-504:case-508:case-510:t.close(4,o);break;case-506:t.close(11,o);break;case-501:t.close(11,o)}}},onServerRefuseEnter:function(e){var t=this,n=e.failed;switch(n){case-9527:case-95270:t.close(4,-9527);break;case-500:case-502:case-504:case-508:case-510:t.close(4,n);break;case-506:t.close(11,n);break;default:t.close(2)}},onEnterFail:function(){var e=this;e.__getCopyInterval&&clearInterval(e.__getCopyInterval)},onNetworkChanaged:function(e){var t=this,n=e.nowIp;emedia.config.rebuildPeerConnectionWhenNetworkChanaged&&setTimeout(function(){var e={};r.forEach(t._cacheStreams,function(r,o){if(!t._maybeNotExistStreams[r]&&o._webrtc){var s=o._webrtc;e[o.rtcId]||(s.closed||"string"!=typeof s.useIp||s.useIp===n||(i.warn("network chanage. webrtc will rebuild.",s._rtcId,s.__id),t.onICEClosed(s)),e[o.rtcId]=!0)}})},100)},onEnterSuccess:function(){var e=this;setTimeout(function(){e._failIcesRebuild()},50),e.getCopyIntervalMillis&&e.getCopyIntervalMillis>0&&(i.warn("Run interval get copy. interval = ",e.getCopyIntervalMillis),e.__getCopyInterval&&clearInterval(e.__getCopyInterval),e.__getCopyInterval=setInterval(function(){e._session.connected()?e._sysCopy.apply(e):(i.warn("Warn! cannot get copy. cause offline."),e.__getCopyInterval&&clearInterval(e.__getCopyInterval))},e.getCopyIntervalMillis)),e.getMediaMeterIntervalMillis&&e.getMediaMeterIntervalMillis>0&&e._intervalGetMediaMeters()},_intervalGetMediaMeters:function(){function e(){return t.__getMediaMetersIntervalFlag&&emedia.cancelAnimationFrame(t.__getMediaMetersIntervalFlag),t.getMediaMeterIntervalMillis?void(t.__getMediaMetersIntervalFlag=emedia.requestAnimationFrame(function(n){"function"==typeof emedia.AudioContext&&t._flushMediaMetersByAudioContext.apply(t),!(t.closed!==!1)&&e()},t.getMediaMeterIntervalMillis)):void i.warn("Ontalking closed. please use getMediaMeterIntervalMillis")}var t=this;e()},_flushMediaMetersByAudioContext:function(){var e=this;r.forEach(e._cacheStreams,function(t,n){e._monitSoundChanagedStreams&&!e._monitSoundChanagedStreams[t]||"0"!=n.id&&e._updateMetersOrNewOne.call(e,t,n)});var t=[];r.forEach(e._mediaMeters,function(n,r){var i=e._cacheStreams[n];i&&e._updateMetersOrNewOne.call(e,n,i),i||t.push(n)}),r.forEach(t,function(t,n){r.removeAttribute(e._mediaMeters,n)})},_updateMetersOrNewOne:function(e,t){var n=this,i=n._mediaMeters[e];if(!(2!==t.type||t.located()||t.subArgs&&t.subArgs.subSAudio)){var o=n._oneAudioMixers();if(!o||i&&i._webrtc&&o._webrtc.__id!=i._webrtc.__id)return i&&i._finally(),r.removeAttribute(n._mediaMeters,e),void n._onSoundChanage.call(n,t.owner,t)}return i&&i._streamCreateId===t.__create_id&&i.__mediaSoundMeter.__worked?(i.onSoundMeters(function(e){n._onSoundChanage.call(n,t.owner,t,e)}),i):(i&&(i._streamCreateId!==t.__create_id||i.__mediaSoundMeter.__worked)&&(i&&i._finally(),r.removeAttribute(n._mediaMeters,e),n._onSoundChanage.call(n,t.owner,t)),t.aoff?void 0:(i=n._newMediaMeters(t),i&&(n._mediaMeters[e]&&n._mediaMeters[e]._finally(),n._mediaMeters[e]=i),i))},_newAudioContext:function(){if(emedia.__usingWebAudio)return emedia.__audioContext},_newMediaMeters:function(e){var t,n=this;if(2===e.type&&e.subArgs&&e.subArgs.subSAudio&&e._webrtc&&e._webrtc.getRemoteStream()){var r=new e.StreamSoundMeter({_stream:e,_mediaStream:e._webrtc.getRemoteStream(),_webrtc:e._webrtc,__audioContext:n._newAudioContext()});return r}if(2===e.type&&e.located()){var r=new e.StreamSoundMeter({_stream:e,_mediaStream:e._localMediaStream,__audioContext:n._newAudioContext()});return r}if(2===e.type&&!e.located()){var i=n._oneAudioMixers();if(!i||!i._webrtc||i._webrtc.closed)return;if(i&&(void 0===i._remoteMediaSoundMeters||!i._remoteMediaSoundMeters.__worked)&&i._webrtc&&i._webrtc.getRemoteStream()&&(i._remoteMediaSoundMeters=new i.MediaSoundMeter({_mediaStream:i._webrtc.getRemoteStream(),__audioContext:n._newAudioContext()})),!i._remoteMediaSoundMeters)return;var r=new e.StreamSoundMeter({_stream:e,_webrtc:i._webrtc,__mediaSoundMeter:i._remoteMediaSoundMeters});return r}if(!e.aoff&&(t=e.getMediaStream())){var r=new e.StreamSoundMeter({_stream:e,_mediaStream:t,__audioContext:n._newAudioContext()});return r}},_oneAudioMixers:function(){var e=this,t=e._cacheStreams[0];if(t&&t._webrtc&&!t._webrtc.closed)return t;for(var n in e.audioMixers){var r=e.audioMixers[n];if(r.located())return r}},onWSClose:function(){var e=this;e.__getCopyInterval&&clearInterval(e.__getCopyInterval),i.info("Websocket closed.")},onICEDisconnected:function(e){var t=this;t.__networkWeakInterval&&clearTimeout(t.__networkWeakInterval),t.__networkWeakInterval=setTimeout(function(){t.onNetworkWeak&&t.onNetworkWeak()},1e3),r.forEach(t._linkedStreams,function(n,o){if(o.rtcId==e.getRtcId()){var s;(s=t._maybeNotExistStreams[n])||(s=t._maybeNotExistStreams[n]=r.extend({},o),s.updateAttributes({iceRebuildCount:1})),i.info("Stream maybe not exist. caused by disconnected",o.id)}})},onICEConnectFail:function(e){var t=this;for(var n in t._linkedStreams){var s=t._linkedStreams[n];if(s.rtcId==e.getRtcId()){if(s._webrtc&&s._webrtc.__id!==e.__id){i.warn("Stream use other webrtc rtcId = ",s.rtcId,", id: ",s._webrtc.__id,e.__id);continue}var a;if((a=t._maybeNotExistStreams[n])||(a=t._maybeNotExistStreams[n]=r.extend({},s),a.updateAttributes({iceRebuildCount:1})),a){var c=new o.StreamState({stream:a});c.iceFail(),t.onEvent(c)}if(i.info("ice fail. webrtc = ",e.getRtcId()," problem stream is ",a.iceRebuildCount,a.id),a.iceRebuildCount>emedia.config.iceRebuildCount)i.info("ice fail. webrtc = ",e.getRtcId()," rebuild fail. problem stream is ",a.id),a.located()?t.onEvent(new o.PushFail({stream:s,cause:"pub ice rebuild failed."})):t.onEvent(new o.SubFail({stream:s,cause:"sub ice rebuild failed."})),t.closeWebrtc(e.getRtcId(),!1);else{var u=t._records[a.id];a._localMediaStream?i.info("ice fail. webrtc = ",e.getRtcId()," will rebuild. remain local stream. ",a.id):i.info("ice fail. webrtc = ",e.getRtcId()," will rebuild.",a.id),t.closeWebrtc(e.getRtcId(),!0),u&&(t._records[a.id]=u),function(e){setTimeout(function(){t.iceRebuild(e)},emedia.config.iceRebuildIntervalMillis)}(a),i.info("ice fail. webrtc = ",e.getRtcId()," will rebuilding. problem stream is ",a.id)}2===s.type&&r.removeAttribute(t.audioMixers,s.id)}}},onICEClosed:function(e){var t=this;if(e.closed){i.warn("Webrtc will be removed. by __id = ",e.__id,", rtcId = ",e.getRtcId());var n=r.removeAttribute(t._ices,e.__id);n?i.warn("Webrtc removed. by id = ",n.__id,", rtcId = ",n.getRtcId()):i.warn("Webrtc removed. by id = ",e.__id,", rtcId = ",e.getRtcId());var o=t._ices[e.getRtcId()];o&&o.__id===n.__id&&(n=r.removeAttribute(t._ices,e.getRtcId()),i.warn("Webrtc removed. by rtcId = ",n.getRtcId(),", __id = ",n.__id))}else i.info("ICE self closed. not allow. will rebuild",e.getRtcId()),t.onICEConnectFail(e)},onICEConnected:function(e){var t=this;r.forEach(t._cacheStreams,function(n,s){if(s.rtcId==e.getRtcId()){if(s.updateAttributes({finalVCodeChoices:e.finalVCodeChoices}),t._maybeNotExistStreams[n]){r.removeAttribute(t._maybeNotExistStreams,s.id),t._linkedStreams[n]=s,i.info("ice reconnected. webrtc = ",e.getRtcId(),"will update stream = ",s.id);var a=t._records[s.id];a&&a.rtcId!==s.rtcId&&(t.startRecord(s),i.warn("Re record. for ",s.id,", after rebuild ice.",a.rtcId,"->",s.rtcId))}else i.info("ice connected. webrtc = ",e.getRtcId(),s.id),s.located()&&t.onEvent(new o.PushSuccess({stream:s})),s.located()||t.onEvent(new o.SubSuccess({stream:s}));2===s.type&&(t.audioMixers[s.id]=s)}})},onICERemoteMediaStream:function(e){var t=this;r.forEach(t._cacheStreams,function(n,r){if(r.rtcId==e.getRtcId()&&(!r.located()||2===r.type)){var i=e.getRemoteStream();if(t._updateRemoteStream(r,i),r.onGotRemoteMediaStream)r.onGotRemoteMediaStream.call(r,i);else{var r=t.newStream(r);r.updateAttributes({mediaStream:e.getRemoteStream()}),t.onUpdateStream(r,new r.Update({mediaStream:r.mediaStream}))}}})},_failIcesRebuild:function(){var e=this,t=1;r.forEach(e._maybeNotExistStreams,function(n,r){setTimeout(function(){e.iceRebuild(r)},100*t)})},iceRebuild:function(e){var t=this;return t.connected()?t._linkedStreams[e.id]&&t._cacheStreams[e.id]?void(e.iceRebuildCount>emedia.config.iceRebuildCount?(i.info("ice rebuild fail. count too many. stream is ",e.id),e.located()?t.onEvent(new o.PushFail({stream:e,cause:"pub ice rebuild failed."})):t.onEvent(new o.SubFail({stream:e,cause:"sub ice rebuild failed."}))):t.connected()?(i.info("ice try rebuild. count",e.iceRebuildCount,". stream is ",e.id),t.rebuildIce(e),e.iceRebuildCount++):i.warn("ice rebuild. stop. cause by not websocket disconnect",e.id)):(i.info("ice rebuild fail. it yet closed. stream is ",e.id,e.rtcId),r.removeAttribute(t._maybeNotExistStreams,e.id),r.removeAttribute(t._linkedStreams,e.id),void i.warn("iceRebuild, remvoe from _linkedStreams",e.id)):(e.updateAttributes({iceRebuildCount:1}),void i.warn("Websocket disconnect. waiting. rebuild count reset",e.iceRebuildCount,e.id))},rebuildIce:function(e){var t=this;return t._cacheStreams[e.id]?(i.warn("Begin rebuild ice ",e.iceRebuildCount,e.id),e.located()?(e.updateAttributes({isRepublished:!0}),t.push(e,void 0,void 0,!0)):t.createWebrtcAndSubscribeStream(e.id),void i.warn("Finish rebuild ice ",e.iceRebuildCount,e.id,t._cacheStreams[e.id].rtcId)):void i.warn("Begin rebuild ice. not found stream at local",e.iceRebuildCount,e.id)},_sysCopy:function(){var e=this,t=e.newMessage().setOp(1e3).setCver(e._cver||0);e.postMessage(t,function(t){return 0!=t.result?void i.warn("Get copy fail. result = ",t.result):void((e._cver||0)<t.cver&&(e._cver=t.cver,e.onMembers(t.cver,t.mems||{}),e.onStreams(t.cver,t.streams||{}),i.info("Got copy success.")))})}});e.exports=s},function(e,t,n){"use strict";var r=n(1),i=r.tagLogger("Desktop"),o=n(138);window.__shareDesktopMessageCount__=0,e.exports=r.prototypeExtend({__RTC_PAGE_MSG_TYPE__:"RTC-SD-PAGE",__RTC_EXT_MSG_TYPE__:"RTC-SD-EXT",__init__:function(){var e=this;e.__extLoaded=e.rsdExtLoaded(),e.__extLoaded&&e.__onRsdExtLoad(),window.addEventListener("load",function(t){if(!e.__extLoaded){var n=e.rsdExtLoaded();e.__extLoaded=n}}),window.addEventListener("message",function(t){if(t.data){var n=t.data;if(n.type&&n.type===e.__RTC_EXT_MSG_TYPE__&&n.evname)return i.info("got ext-msg: ",n),"extLoaded"===n.evname?void(e.__extLoaded||(e.__extLoaded=!0,setTimeout(e.__onRsdExtLoad(),50))):void e.__onMessage(n)}})},rsdExtLoaded:function(){var e=document.getElementById("RTC-Share-Deskto-installed-ele-rat1abrr");return!(!emedia.isElectron&&!e)},__sendMessage:function(e,t){var n=this,o="tsx_"+__shareDesktopMessageCount__++ +"_"+Math.random().toString(36).substr(2,4);if(!n.__extLoaded)throw i.error("Rtc share desktop not loaded"),"Rtc share desktop not loaded";e.tsxId=o,n["on_"+o]=function(){t&&t.apply(n,arguments),r.removeAttribute(n,"on_"+o)},window.postMessage&&window.postMessage(e,"*")},__onMessage:function(e){var t=this,n=e.tsxId;t["on_"+n]&&t["on_"+n](e)},__onRsdExtLoad:function(){var e=this;e.onExtLoaded&&e.onExtLoaded()},openDesktopMedia:function(e,t){var n=this;if(emedia.isElectron)return void n.openDesktopMediaInElectron(e,t);if(!n.__extLoaded||!n.rsdExtLoaded())return void t(new o.ShareDesktopExtensionNotFound);var r={type:n.__RTC_PAGE_MSG_TYPE__,evname:"chooseDesktopMedia",screenOptions:e};n.__sendMessage(r,function(e){t("onAccessApproved"===e.evname&&e.streamId?new o.OpenDesktopMedia({desktopStreamId:e.streamId}):new o.OpenDesktopMediaAccessDenied)})},openDesktopMediaInElectron:function(e,t){e||(e=["screen","window"]);var n={types:e,thumbnailSize:{width:230,height:230}};emedia.electron.desktopCapturer.getSources(n).then(function(e){if("function"!=typeof emedia.chooseElectronDesktopMedia)return void t(new o.OpenDesktopMedia({desktopStreamId:e[0].id}));for(var n=0;n<e.length;n++){var r=e[n];r.hxThumbDataURL=r.thumbnail.toDataURL()}emedia.chooseElectronDesktopMedia(e,function(e){var n;n=e&&e.id?e.id:e,t(new o.OpenDesktopMedia({desktopStreamId:n}))},function(){t(new o.OpenDesktopMediaAccessDenied({message:function(){return"User denied access"}}))})}).catch(function(e){return t(new o.OpenDesktopMediaAccessDenied({error:e}))})}})},function(e,t,n){"use strict";var r,i=n(1),o=i.tagLogger("PCStats");e.exports=r=i.prototypeExtend({__init__:function(){this._webrtc||this._stream&&(this._webrtc=this._stream._webrtc),this.samplesDatas={},this.gatherResults={},this._bysamples={},this._inbound_!==!1&&(this._bysamples["inbound-rtp"]=["bytesRateReceived","packageLossRate","bytesReceived","packetsLost","packetsReceived","pliCount","framesDecoded"]),this._outbound_!==!1&&(this._bysamples["outbound-rtp"]=["bytesRateSent","bytesSent","packetsSent","qpSum","pliCount"])},_onGatherResult:function(e,t,n,r){var i=this;if(i._service&&i._service.current&&emedia.config.remainLastStatsCount){var o=i._service.current._trackStats;o||(o=i._service.current._trackStats={});var s=(o[e]||(o[e]={}))[t];s||(s=o[e][t]={});var a=s[n];a||(a=s[n]=new Array(emedia.config.remainLastStatsCount)),void 0===a.curIndex&&(a.curIndex=0),a[a.curIndex]={data:r,timestamp:new Date},a.curIndex=(a.curIndex+1)%emedia.config.remainLastStatsCount}"function"==typeof this.onGatherResult&&this.onGatherResult(e,t,n,r)},stats:function(e){return this._webrtc&&this._webrtc._rtcPeerConnection?this._webrtc._rtcPeerConnection.getStats(e):void o.warn("not found webrtc or peer connection")},statsOfTrack:function(e){if(!e instanceof window.MediaStreamTrack)throw o.error("selector not a MediaStreamTrack"),"selector not a MediaStreamTrack";return this.stats(e)},audioTrack:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0]:void 0},videoTrack:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0]:void 0},gatherTrack:function(e,t){var n=this;t=e.kind||t,t=t&&t.toLowerCase();var r=e.id;this.statsOfTrack(e).then(function(i){n.samplesDatas[r]||(n.samplesDatas[r]={});var s=n.samplesDatas[r];i.forEach(function(r,i){var a=n._bysamples[r.type],c=r.mediaType||i.indexOf("ideo")>=0&&"video"||i.indexOf("udio")>=0&&"audio"||void 0;if(a&&a.length&&(emedia.config._printDebugStats===!0&&o.debug(i,r,e,c,t),!c||c===t)){var u=s[r.type]||(s[r.type]={});a.forEach(function(n){var i=u[n]||(u[n]=[]),o={timestamp:r.timestamp,kind:r.mediaType||e.kind||t};"packageLossRate"===n?o[n]={packetsLost:r.packetsLost,packetsReceived:r.packetsReceived}:"bytesRateReceived"===n?o[n]=r.bytesReceived:"bytesRateSent"===n?o[n]=r.bytesSent:o[n]=r[n],i.push(o)})}})})},gatherWebrtcMediaStream:function(e,t){var n=this;return t?"audio"===t.toLowerCase()?void e.getAudioTracks().forEach(function(e){n.gatherTrack(e,e.kind||t.toLowerCase())}):"video"===t.toLowerCase()?void e.getVideoTracks().forEach(function(e){n.gatherTrack(e,e.kind||t.toLowerCase())}):void 0:void e.getTracks().forEach(function(e){n.gatherTrack(e)})},gatherWebrtc:function(){this._webrtc._localStream&&this.gatherWebrtcMediaStream(this._webrtc._localStream),this._webrtc._remoteStream&&this.gatherWebrtcMediaStream(this._webrtc._remoteStream)},_gather_inbound_rtp_packageLossRate:function(e){if(!e||0===e.length)return 0;var t=0,n=0;if(e.length>1)for(var r=1;r<e.length;r++){var i=e[r],o=e[r-1];i.packageLossRate.packetsReceived!=o.packageLossRate.packetsReceived?(t+=(i.packageLossRate.packetsLost-o.packageLossRate.packetsLost)/(i.packageLossRate.packetsReceived-o.packageLossRate.packetsReceived),n++):(t=0,n=0)}return e.length>=emedia.config.statsSeconds&&e.shift(),0==n?0:t/n},_gatherBytesRate:function(e,t,n){if(!n||0===n.length)return 0;
var r=n[n.length-1][t]-n[0][t],i=n[n.length-1].timestamp-n[0].timestamp;return n.length>=emedia.config.statsSeconds&&n.shift(),0===i?0:parseFloat(1e3*r/i).toFixed(2)},_gather:function(e,t,n){e=e.replace(/[^\w]/g,"_"),t=t.replace(/[^\w]/g,"_");var r=i.list("_gather",e,t).join("_");if("function"==typeof this[r])return this[r](n);if(t.startsWith("bytesRate"))return this._gatherBytesRate(e,t,n);var o=n.shift();return o&&o[t]||0},_statsCount:function(){function e(){i.forEach(r.samplesDatas,function(e,n){var i=r.gatherResults[e]=r.gatherResults[e]||{};t(e,i,n)})}function t(e,t,r){i.forEach(r,function(r,i){var o=t[r]||(t[r]={});n(e,o,r,i)})}function n(e,t,n,o){i.forEach(o,function(i,o){var s=t[i]=r._gather(n,i,o);r._onGatherResult(e,n,i,s)})}var r=this;e()},gather:function(){this.gatherWebrtc(),this._statsCount()},intervalGather:function(e){this._intervalId&&clearInterval(this._intervalId),this._intervalId=setInterval(this.gather.bind(this),e||1e3)},stopIntervalGather:function(){this._intervalId&&clearInterval(this._intervalId)}});var s={},a=r.echo=function(e){i.forEach(e,function(e,t){if(!s[t.id]&&t._webrtc&&!t._webrtc.closed&&t.getMediaStream()){var n;s[t.id]=n=new r({_webrtc:t._webrtc}),n._mediaStream=t.getMediaStream()}else!s[t.id]||t._webrtc&&!t._webrtc.closed&&t.getMediaStream()||i.removeAttribute(s,t.id)});var t=[];i.forEach(s,function(n,r){e&&e[n]?(r.gatherWebrtcMediaStream(r._mediaStream),r._statsCount()):t.push(n)}),i.forEach(t,function(e,t){i.removeAttribute(s,t)})};r.intervalEcho=function(e,t){return setInterval(function(){a(e)},t)},i.forEach(["inbound","outbound"],function(e,t){i.forEach(["Audio","Video"],function(e,n){!function(e,t){var n;r[e+t]=n=function(o,s,a){n.__intervalIds||(n.__intervalIds={});var c;c=this instanceof emedia.XService?this:emedia.useCurrentXService;var u=o.id+"___"+c.namespace,d=n.__intervalIds&&n.__intervalIds[u];return d&&clearInterval(d),d=setInterval(function(){var a=n[u];if(!a&&o&&o._webrtc&&!o._webrtc.closed&&o.getMediaStream()?(n[u]=a=new r({_webrtc:o._webrtc,_inbound_:"inbound"===e,_outbound_:"outbound"===e}),a._service=c,s&&(a.onGatherResult=s),a._mediaStream=o.getMediaStream()):!a||o&&o._webrtc&&!o._webrtc.closed&&o._webrtc.__id===a._webrtc.__id&&o.getMediaStream()&&a._mediaStream&&a._mediaStream.id===o.getMediaStream().id||(i.removeAttribute(n,u),a=null),!a){var f;return void(o&&c&&(f=c.getStreamById(o.id))?o=f:d&&clearInterval(d))}a.gatherWebrtcMediaStream(a._mediaStream,t),a._statsCount()},a),n.__intervalIds[u]=d,d}}(t,n)})})},function(e,t,n){"use strict";function r(e){var t;return t=document.createElement("canvas"),e.appendChild(t),t.style.cssText="position: absolute; background: transparent; width: 100%; height: 100%",t.width=e.offsetWidth,t.height=e.offsetHeight,s.warn("Canvas",t.width,t.height),t}var i,o=n(1),s=o.tagLogger("DefaultTrack"),a=n(151);e.exports=i=a.extend({__init__:function(){this._canvas||(this._canvas=r(this._target)),this._canvasContext||(this._canvasContext=this._canvas.getContext("2d"))},resizeCanvas:function(){},_calPosition:function(){var e=a.prototype._calPosition.apply(this,arguments);return e.x=Math.floor(e.x*this._canvas.width/e.width),e.y=Math.floor(e.y*this._canvas.height/e.height),e},_draw:function(e,t,n,r,i,o){var s=this,a=s._canvasContext;(!t||t<=1)&&(t=2);var c=a.getImageData(e.x-t/2,e.y-t/2,t,t),u=function(e,t,n,r,i){for(var o=0,s=e.data;o<s.length;o+=4){var a={r:void 0===t?s[o]:t,g:void 0===n?s[o+1]:n,b:void 0===r?s[o+2]:r,alpha:void 0===i?s[o+3]:i};s[o]=a.r,s[o+1]=a.g,s[o+2]=a.b,s[o+3]=a.alpha}};c&&u(c,n,r,i,o),a.putImageData(c,e.x,e.y)},redraw:function(e,t,n,r,o,s){var a=this,c=i.prototype._draw.bind(a);c({x:e,y:t},2)},onMouseTrigger:function(e,t){e.isLeftKey()&&this._draw(e.xy,8,189,56,51,255),e.isRightKey()&&this._draw(e.xy,8,45,23,189,255),e.isWheelKey()&&this._draw(e.xy,8,58,189,76,255)},onMouseTrack:function(e,t,n){this._draw(e,2,227,18,247,255)}})},function(e,t,n){"use strict";var r=n(1),i=(r.tagLogger("MouseTrack"),n(152));e.exports=r.prototypeExtend({_scale:1,__init__:function(){},getTargetPageXY:function(){var e=this;return e._target&&r.extend({},r.getDomPageRect(e._target))},onMouseTrack:function(e,t,n){},onMouseTrigger:function(e,t){},_onMouseTrack:function(e,t,n){this.onMouseTrack&&this.onMouseTrack(e,t,n)},_onMouseTrigger:function(e,t){this.onMouseTrigger&&this.onMouseTrigger(e,t)},track:function(e){var t=this,n=e=r.extend({},e),i=t.getTargetPageXY();i&&(e=t._calPosition(e),n={x:e.x,y:e.y,pageX:i.x+e.x,pageY:i.y+e.y}),t._onMouseTrack(n,t._lastPageXY,t._lastTrigger),t._lastPageXY=n},trigger:function(e){var t=this;e=new i(e);var n,r=t.getTargetPageXY();r&&(n=t._calPosition(e.xy),e.xy={x:n.x,y:n.y,pageX:r.x+n.x,pageY:r.y+n.y}),e._time||(e._time=(new Date).getTime()),t._onMouseTrigger(e,t._lastTrigger),t._lastTrigger=e},releaseTrigger:function(){this._lastTrigger=void 0,this._lastPageXY=void 0,this.onReleaseTrigger&&this.onReleaseTrigger(this._lastTrigger)},_calPosition:function(e){var t=this;t._referenceVideo&&(e=emedia.Service.prototype.eventXYAtVideo.call(null,e,t._referenceVideo));var n=t.getTargetPageXY();if(!n)return e;r.isFloat(e.x)&&void 0!==e.width&&(e.x=e.x*e.width*t._scale*(n.width/e.width)),r.isFloat(e.y)&&void 0!==e.height&&(e.y=e.y*e.height*t._scale*(n.height/e.height)),r.isFloat(e.x)&&void 0===e.width&&(e.x=e.x*t._scale*n.width),r.isFloat(e.y)&&void 0===e.height&&(e.y=e.y*t._scale*n.height),r.isInt(e.x)&&void 0!==e.width&&(e.x=e.x*t._scale*(n.width/e.width)),r.isInt(e.y)&&void 0!==e.height&&(e.y=e.y*t._scale*(n.height/e.height)),r.isInt(e.x)&&void 0===e.width&&(e.x=e.x*t._scale),r.isInt(e.y)&&void 0===e.height&&(e.y=e.y*t._scale);var i=Math.floor(e.x),o=Math.floor(e.y);return i<0&&(i=n.width+i),o<0&&(o=n.width+o),{x:i,y:o,width:n.width,height:n.height}}})},function(e,t,n){"use strict";var r=n(1),i=(r.tagLogger("MouseTrigger"),{LEFT:1,WHEEL:2,RIGHT:4,WHEEL_ROLL_UP:8,WHEEL_ROLL_DOWN:16,KEY_UP:0,KEY_DOWN:1,MOVE:2,KEYBOARD_DOWN:3,KEYBOARD_UP:4});e.exports=r.prototypeExtend({_timeoutMillis:500,_time:(new Date).getTime(),isKeyup:function(){return i.KEY_UP==this.oper},isKeydown:function(){return i.KEY_DOWN==this.oper},isWheelup:function(){return i.WHEEL_ROLL_UP==this.btn},isWheeldown:function(){return i.WHEEL_ROLL_DOWN==this.btn},isLeftKey:function(){return i.LEFT==this.btn},isRightKey:function(){return i.RIGHT==this.btn},isWheelKey:function(){return i.WHEEL==this.btn},isWheelRoll:function(){return this.isWheeldown()||this.isWheelup()},timeout:function(){var e=(new Date).getTime();return e-this._time>=this._timeoutMillis},_toString:function(){return r.list("btn:",this.btn,", oper:",this.oper,", timeout:",this.timeout(),", at (",this.xy.x,", ",this.xy.y,")").join("")}}),e.exports.BTN=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(73),o=r(i),s=n(1),a=s.tagLogger("AddonsP2P"),c=n(138),u=function(e){var t=e.extend({postMessage:function(t,n){var r=this,i=t.tsxId;t.tsxId||(i=t.tsxId="MSG"+Date.now()+"-"+emedia.__session_globalCount++),e.prototype.postMessage.call(r,t,n),function(e){var t=r.owner;t.isP2P()&&r._callbacks[e]&&setTimeout(function(){var t=r._callbacks[e];if(t&&1004===t.op){var n=r.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,result:0,msg:"3000ms not recv response. will success callback. "+t.tsxId});r.onMessage(n)}},3e3)}(i)},__modifyMessageForPost:function(t){var n=this;t=e.prototype.__modifyMessageForPost.call(n,t);var r=n.owner;if(r.isP2P()){if(102===t.op||105===t.op){var i=n.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,result:0,streamId:t.rtcId+(r.isCaller()?"__Caller":"__Callee"),sver:1});if(setTimeout(function(){n.onMessage(i)},100),!t._cached_){var a=s.extend({_cached_:!0},t);s.removeAttribute(a,"tsxId"),102===t.op&&(r.__cache_[t.rtcId]=[]).push(a),105===t.op&&r.__cache_[t.rtcId]&&r.__cache_[t.rtcId].push(a),r.__cache_[t.rtcId]&&(r.__cache_[t.rtcId].selfId=r.getMemberId())}}if(s.removeAttribute(t,"_cached_"),t.memId){var c=n.newMessage({op:1004,sessId:s.removeAttribute(t,"sessId"),memId:s.removeAttribute(t,"memId"),tsxId:s.removeAttribute(t,"tsxId"),arg:(0,o.default)(t)});t=c}switch(t.op){case 205:var i=n.newMessage({op:1001,tsxId:t.tsxId,result:0});return void setTimeout(function(){n.onMessage(i)},50);case 102:case 104:case 105:case 106:case 107:if(t.endReason===-10)return;case 1001:case 400:var c=n.newMessage({op:1004,sessId:s.removeAttribute(t,"sessId"),tsxId:s.removeAttribute(t,"tsxId"),arg:(0,o.default)(t)});t=c;break;case 303:case 206:return}}return t},onP2PMessage:function(e){var t=this,n=t.owner;if(t.owner.isConfr())return void a.warn("Recv p2p ctrl message. when CONFR. ignore");var r=JSON.parse(e.arg);if(r.memId=e.memId,r.tsxId=e.tsxId,r.sessId=e.sessId,400===r.op&&(r.streamId=r.rtcId+(t.owner.isCaller()?"__Callee":"__Caller")),1001!==r.op){var i=t.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,sessId:e.sessId,result:0,msg:"Web sdk success recv"});102!==r.op&&105!==r.op||s.extend(i,{streamId:r.rtcId+(n.isCaller()?"__Callee":"__Caller"),sver:1}),t.postMessage(i)}!function(e){setTimeout(function(){t.onMessage(e)},10)}(r)}});return s.extend(t.prototype._events,{1004:"onP2PMessage"}),t},d=function(e){var t=e.extend({__init__:function(){var t=this;e.prototype.__init__.call(t),t.__cache_={};var n=t.iceRebuild;t.iceRebuild=function(e){var t=this;return t.isP2P()&&e.rtcId?e._webrtc&&e._webrtc.answerWebrtc===!0?void a.warn("Stream not auto iceRebuild. caused by answer webrtc. it = ",e.id,e):e.located()?void n.call(t,e):void a.warn("Stream not auto iceRebuild. caused by not located. it = ",e.id,e):void n.call(t,e)}},onEnter:function(t,n){var r=this;try{e.prototype.onEnter.call(r,t,n)}finally{if(!r.isP2P()||!(n=r._cacheMembers[n.id]))return;s.forEach(r.__cache_,function(e,t){t.answered!==!0&&s.forEach(t,function(e,t){!function(e){e.memId=n.id,r.postMessage(e)}(t)})})}},rejectAnswer:function(e,t,n,r){var i=this,o=i.newMessage().setOp(107).setRtcId(t).setMemId(e).setEndReason(n);i.postMessage(o,function(e){if(0!=e.result)return i.onEvent(new c.RspFail({request:o,response:e})),void(r&&r(new c.RspFail({request:o,response:e})))})},closeWebrtc:function(t,n,r){var i=this,o=!1;if(i.isP2P()){var c=i._ices[t];if(c){var u=c.iceConnectionState();o="failed"===u,o=o&&c._rebuildCount<emedia.config.iceRebuildCount,a.warn("Webrtc state failed. it is ",t,c._rebuildCount,emedia.config.iceRebuildCount,c.__id)}}if(e.prototype.closeWebrtc.call(i,t,n,r||o),i.isP2P()&&!r&&o&&s.forEach(i._cacheStreams,function(e,n){n.rtcId===t&&(i._linkedStreams[e]=n,a.warn("Reput stream to _linkedStreams",e))}),i.isP2P()&&!n){s.removeAttribute(i.__cache_,t);var d=s.extend({},i._cacheStreams);s.forEach(d,function(e,n){if(t===n.rtcId){s.removeAttribute(i._linkedStreams,n.id);var r=s.removeAttribute(i._cacheStreams,n.id);if(i._streamAutomators&&s.removeAttribute(i._streamAutomators,n.id),a.warn("P2P close webrtc. remove stream from _cacheStreams. it = ",n.id,n),r._localMediaStream&&i._service._stopTracks(r._localMediaStream),i.onRemoveStream){var n=i.newStream(n);i.onRemoveStream(n)}}})}},subscribeStream:function(t,n,r,i){var o=this;if(!o.isP2P())return void e.prototype.subscribeStream.call(o,t,n,r,i);var s=o._ices[t],u=o._cacheStreams[n],d=u;if(d.updateAttributes({_webrtc:s,rtcId:t}),i=i||{subSVideo:!0,subSAudio:!0},d.updateAttributes({subArgs:d.subArgs||{subSVideo:!0,subSAudio:!0}}),d._webrtc&&d._webrtc.setSubArgs(d._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!d.subArgs.subSVideo&&i.subSVideo&&d.voff)throw a.error("Sub not allow. stream voff"),"Sub not allow. stream voff";if(!d.subArgs.subSAudio&&i.subSAudio&&d.aoff)throw a.error("Sub not allow. stream aoff"),"Sub not allow. stream aoff";if(d.subArgs.subSVideo&&!i.subSVideo&&!d.voff&&emedia.isSafari)throw a.error("Sub not allow. safari close sub video. will error"),"Sub not allow. safari close sub video. will error";i&&d._webrtc&&d._webrtc.setSubArgs(i),i&&d.updateAttributes({subArgs:i});var f=new c.SubSuccess({stream:d,hidden:!0});o._updateRemoteStream(d,d._webrtc.getRemoteStream()),o.onEvent(f)},unsubscribeStream:function(t){var n=this;if(!n.isP2P())return void e.prototype.unsubscribeStream.call(n,t)},onPub:function(t,n,r){var i=this;if(!i.isP2P())return void e.prototype.onPub.call(i,t,n,r);var o=e.prototype.onPub.call(i,t,n,r);return o},onStreams:function(t,n){var r=this;return r.isP2P()?void a.warn("P2P ingrone the onStreams"):void e.prototype.onStreams.call(r,t,n)},_howDoWebrtcWhenCrtExsitsWebrtc:function(t){var n=this;return n.isP2P()?void n.closeWebrtc(t.getRtcId(),!0,!0):void e.prototype._howDoWebrtcWhenCrtExsitsWebrtc.call(n,t)},createWebrtcAndSubscribeStream:function(t,n,r,i){function o(e){a.warn("sub stream error",t,e),_&&p._webrtc&&p._webrtc.setSubArgs(_),_&&p.updateAttributes({subArgs:_}),e=new c.SubFail({stream:p,hidden:e.hidden===!0,cause:e}),n&&n.onEvent&&n.onEvent(e),d.onEvent&&d.onEvent(e)}function u(e){e&&S.setLocalStream(e),S.setRemoteDescription(p.sdp),p.cands&&p.cands.length>0&&S.addIceCandidate(p.cands)}var d=this;if(!d.isP2P())return void e.prototype.createWebrtcAndSubscribeStream.call(d,t,n,r,i);var d=this;n||(n={});var f=d._cacheStreams[t],l=d._cacheMembers[f.owner.id],p=f;i=i||p.subArgs||{subSVideo:!0,subSAudio:!0};var h=f.vcodes,v=l.vcodes,m=d.supportVCodes,b=d._getOptimalVideoCodecsSubset(h,v,m);i=i||p.subArgs;var _=p.subArgs,g=!(p.vcodes&&p.vcodes.length>0),y={offerToReceiveAudio:!0,offerToReceiveVideo:i.subSVideo&&g};y.offerToReceiveAudio||y.offerToReceiveVideo||a.warn("offerToReceiveAudio == false and offerToReceiveVideo == false");var S=d.createWebrtc({_rtcId:p.rtcId,iceServerConfig:r,optimalVideoCodecs:b,offerOptions:y,onGotMediaStream:function(e){var t=new c.SubSuccess({stream:p,hidden:!0});n.onGotRemote&&n.onGotRemote(p),d.onEvent&&d.onEvent(t)}},p.iceRebuildCount),w=S.getRtcId();a.warn(w," sub stream ",t,b);var x=p._webrtc;if(p.updateAttributes({_webrtc:S,rtcId:w,owner:s.extend({},l)}),d._ices[w]=S,S.answerWebrtc=!0,i&&p._webrtc&&p._webrtc.setSubArgs(i),i&&p.updateAttributes({subArgs:i}),w==="rtc-"+d.ticket.confrId){var C=(d.__lastCalleePub,d._cacheStreams[w+(d.isCaller()?"__Caller":"__Callee")]),C=new d._service.AVPubstream(C||{constaints:{audio:!p.aoff,video:!p.voff}});x&&x.getLocalStream()&&d._service._stopTracks(x.getLocalStream()),d._service.openUserMedia(C).then(function(){var e=d.newStream(C);e.updateAttributes({_localMediaStream:C.localStream,_webrtc:S,rtcId:S.getRtcId(),id:w+(d.isCaller()?"__Caller":"__Callee"),owner:{id:d.getMemberId(),nickName:d.nickName,name:d.sysUserId,ext:d.extObj}}),d.onEvent(new c.PushSuccess({stream:e,hidden:!0})),u(C.localStream),d.answerCall(w,C,o)},o)}else u(),d.answer(w,o)}});return t},f=function(e,t,n){var r=e.extend({Session:t,Attendee:n,__init__:function(){var t=this;e.prototype.__init__.call(t),void 0!==t.useRTCCfg&&t.useRTCCfg!==!1&&null!==t.useRTCCfg||(t.useRTCCfg=emedia.config.forceUseRTCCfgIfServerReturnWhenP2P)},push:function(t,n,r){var i=this;if(i.current&&i.current.isP2P()){if(2===t.type)throw a.error("P2P do not allow audio_mixer"),"P2P do not allow audio_mixer";if(t instanceof i.AVPubstream&&!t.rtcId){var o=i.current._cacheStreams["rtc-"+i.current.ticket.confrId+"__Caller"]||i.current._cacheStreams["rtc-"+i.current.ticket.confrId+"__Callee"];o||(t.rtcId="rtc-"+i.current.ticket.confrId)}}e.prototype.push.call(i,t,n,r)},newSession:function(t,n){var r=this,i=e.prototype.newSession.call(r,t,n),o=i.onTermC,u=i.onAnsC;return s.extend(i,{onInitC:function(e){if(t.isP2P()){if(e.rtcId==="rtc-"+t.ticket.confrId){var n=e.rtcId+(t.isCaller()?"__Callee":"__Caller"),r=t._cacheStreams[n];if(r&&r.owner&&r.owner.id!==e.memId)return t.rejectAnswer(e.memId,e.rtcId,10),void t.postMessage(t.newMessage({op:1001,memId:e.memId,tsxId:e.tsxId,result:-554,msg:"Other device call it. you no."}))}e.pubS.sdp=e.sdp,e.pubS.cands=e.cands,e.pubS.id=e.rtcId+(t.isCaller()?"__Callee":"__Caller"),e.pubS._located=!1,e.pubS.memId=e.memId,e.pubS.rtcId=e.rtcId,e.pubS.sver=0;var r=t._cacheStreams[e.pubS.id];r&&(e.pubS.sver=r.sver+1,s.removeAttribute(t._maybeNotExistStreams,e.pubS.id)),t.onPub.call(t,++t._cver,e.memId,e.pubS)}},onTermC:function(e){if(!t.isP2P())return void o.call(t,e);if(e.endReason===-20){var n=t._cacheStreams[e.rtcId+"__Caller"];return a.warn("Begin re-publish. 20",n),void(n&&r._republish(n))}if(e.memId&&e.memId!==t.getMemberId()){var i=[];return s.forEach(t._cacheStreams,function(e,t){i.push(t)}),i=i.sort(function(e,n){var r=-1;return e.id>n.id&&(r=1),t.isCallee()?0-r:r}),void s.forEach(i,function(n,r){r&&r.owner&&r.owner.id===e.memId&&e.rtcId===r.rtcId&&(e.endReason!==-10&&o.call(t,e),e.rtcId==="rtc-"+t.ticket.confrId&&t.onUnpub(++t._cver,e.memId,r.id),10===e.endReason&&t.onEvent(new c.OtherDeviceAnswer({rtcId:e.rtcId,stream:r}))),r&&r.owner&&r.owner.id===t.getMemberId()&&e.rtcId===r.rtcId&&(t.closeWebrtc(e.rtcId),t.onUnpub(++t._cver,r.owner.id,r.id))})}e.endReason!==-10&&o.call(t,e),10===e.endReason&&t.onEvent(new c.OtherDeviceAnswer({rtcId:e.rtcId}))},onAnsC:function(e){if(!t.isP2P())return void u.call(t,e);if(!t.__cache_[e.rtcId])return void a.warn("Webrtc ",e.rtcId,"not created. drop the answer");if(t.__cache_[e.rtcId].answered===!0)return a.warn("Webrtc ",e.rtcId,"had been ansC"),t.rejectAnswer(e.memId,e.rtcId,10),void t.postMessage(t.newMessage({op:1001,memId:e.memId,tsxId:e.tsxId,result:-554,msg:"Other device sub it. you no."}));try{if(e.pubS){var n=t.newStream(e.pubS);n.updateAttributes({_webrtc:t._ices[e.rtcId],rtcId:e.rtcId,id:e.rtcId+(t.isCaller()?"__Callee":"__Caller"),owner:t._cacheMembers[e.memId]}),t._cacheStreams[n.id]?t._cacheStreams[n.id]=n:t.onPub.call(t,++t._cver,e.memId,n),t.onEvent(new c.SubSuccess({stream:n,hidden:!0}))}var r=t._cacheMembers[e.memId];u.call(t,e),s.forEach(t._cacheMembers,function(n,i){n!==e.memId&&r.memName===i.memName&&t.rejectAnswer(n,e.rtcId,10)})}finally{t.__cache_[e.rtcId].answered=!0}}})}});return r};e.exports=function(e){var t=e.prototype.Session||n(137),r=u(t.extend({})),i=e.prototype.Attendee||n(141),o=d(i.extend({}));return f(e,r,o)}},function(e,t,n){"use strict";(function(e){function r(e){return e&&e.__esModule?e:{default:e}}function i(t){if(!t||0==(0,p.default)(t).length)return void console.warn("options is not have");if(!t.key)return void console.warn("options.key is not have");var n=t.key,r=t.val,i=t.success,o=t.error,s=t.type;if(!this.__current_confrId)return void console.warn("please set_confr_attrs after joined");var a=this._confrs[this.__current_confrId].roleToken;if(!a)return void console.warn("roleToken is not have");var c={roleToken:a,cattrs:[{key:n,val:r,op:s}]};e.ajax({type:"POST",url:emedia.config.restPrefix+"/easemob/rtc/confr/attrs/update",data:(0,g.default)(c),contentType:"application/json",success:function(e){i&&"function"==typeof i&&i(e)},error:function(e){o&&"function"==typeof o&&o(e)}})}function o(t,n){var r={type:"POST",url:emedia.config.restPrefix+"/easemob/rtc/confr/attrs/update",data:(0,g.default)({roleToken:t,cstate:{muteAll:n}}),contentType:"application/json"};return new b.default(function(t,n){e.ajax((0,v.default)({},r,{success:function(e){0==e.error?t(e):n(e)},error:function(e){n(e)}}))})}Object.defineProperty(t,"__esModule",{value:!0}),t.outer=void 0;var s=n(130),a=r(s),c=n(78),u=r(c),d=n(133),f=r(d),l=n(107),p=r(l),h=n(140),v=r(h),m=n(85),b=r(m),_=n(73),g=r(_),y=n(155),S=n(134),w=r(S),x=n(75),C=r(x),I={};y.single.onMemberJoin=function(e,t){emedia.decodeMemeberName(e),this.onMemberJoined(e,y.single._confr(t))},y.single.onMemberLeave=function(e,t,n){emedia.decodeMemeberName(e),this.onMemberExited(e,t,y.single._confr(n))},y.single._onRoleUpdated=function(e,t){this.onRoleChanged(e,y.single._confr(t))},y.single._onAddMemberStream=function(e,t){e&&emedia.decodeMemeberName(e.owner),this.onStreamAdded(e.owner,e,y.single._confr(t))},y.single._onRemoveMemberStream=function(e,t){e&&emedia.decodeMemeberName(e.owner),this.onStreamRemoved(e.owner,e,y.single._confr(t))},y.single._onUpdateMemberStream=function(e,t,n){e&&emedia.decodeMemeberName(e.owner),this.onStreamUpdated&&this.onStreamUpdated(e.owner,e,t,y.single._confr(n))},y.single.onExit=function(e,t,n){this.onConferenceExit(e,t,y.single._confr(n))},I.onMemberJoined=function(e){},I.onMemberExited=function(e,t){},I.onRoleChanged=function(e){},I.onStreamAdded=function(e,t){},I.onStreamRemoved=function(e,t){},I.onConferenceExit=function(e,t){},I.joinConferenceWithTicket=y.single.joinUseTicket,I.joinConference=y.single.joinUsePassword,I.getConferenceTkt=y.single.reqTkt,I.publish=function(e,t,n){return y.single.shareVideoWithAudio(e.video,e.audio,t,n)},I.unpublish=function(e){return y.single.hungup(e)},I.unsubscribe=function(e){return y.single.hungup(e)},I.exitConference=function(e){return y.single.exit(e||!1)},I.getConferenceInfo=function(e,t){return y.single.selectConfr(e,t)},I.createConference=y.single.createConfrSptMnPrg,I.grantRole=function(e,t,n){return y.single.chanageRoles(n,t,e.id)},I.degradeRole=function(t,n,r){if(t){if(!n||n instanceof Array==0||0==n.length)return void console.warn("members is must Array also length > 0");if(r){var i=this._confrs[t];if(!i)return void console.warn("confr is not exist");var o=i.role,s=i.roleToken;if(Number(r)>=Number(o))return void console.warn("only degradeRole,oldRole: "+o+" >>> toRole: "+r);var a={type:"POST",url:emedia.config.restPrefix+"/easemob/rtc/role/degrade",data:(0,g.default)({roleToken:s,uids:n,role:r}),contentType:"application/json"};return new b.default(function(t,n){e.ajax((0,v.default)({},a,{success:function(e){0==e.error?t(e):n(e)},error:function(e){n(e)}}))})}}},I.kickMembersById=function(e,t){return y.single.kickMember(t,e.id)},I.destroyConference=function(e){return y.single.disbandConfr(e,e.roleToken)},I.setConferenceAttrs=function(e){e.type="UPDATE",i.call(this,e)},I.deleteConferenceAttrs=function(e){e.type="DEL",i.call(this,e)},I.onConfrStateUpdated=function(e){var t=this,n=function(){var n=e.muteAll;if(void 0!==n){if(void 0===t._temp_muteAll)t._temp_muteAll=n;else{if(n===t._temp_muteAll)return;t._temp_muteAll=n}n?t.onMuteAll&&"function"==typeof t.onMuteAll&&t.onMuteAll():t.onUnMuteAll&&"function"==typeof t.onUnMuteAll&&t.onUnMuteAll()}},r=this.__current_confrId;if(r){var i=this._services[r];if(i){var o=i.current;o&&o.role&&o.role!=this.Role.ADMIN&&n()}}},I.joinRoom=function(){var t=(0,f.default)(a.default.mark(function n(t){var r,i,o,s,c,d,f,l,p,h,m,_,y,S,w,x,C,I,T,E;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=function(t){var n=emedia.config,r=n.restPrefix,i=n.appkey;if(!i)throw new Error("in joinRoom appkey is not defined");var o=i.split("#")[0],s=i.split("#")[1],a=r+"/"+o+"/"+s+"/conferences/room";return new b.default(function(n,r){var i={url:a,data:(0,g.default)(t),type:"POST",contentType:"application/json",success:function(e){e.error?r(e):n(e)},error:function(e){r(e)}};e.ajax(i)})},i=this,o=function(t){var n=emedia.config.restPrefix+"/easemob/rtc/req/ticket?_ct="+(new Date).getTime();t.region&&(n+="&REGION="+t.region),t.confrId&&(n+="&CONFRID="+t.confrId);var r={type:"POST",url:n,data:(0,g.default)(t),contentType:"application/json",dataType:"json"};return new b.default(function(t,n){e.ajax((0,v.default)({},r,{success:function(e){0==e.error?t(e):n(e)},error:function(e){n(e)}}))})},s=t.roomName,c=t.password,d=t.role,f=t.config,l=this.identityName,p=this.identityToken,s){n.next=7;break}throw new Error("the roomName is required at joinRoom");case 7:if(c){n.next=9;break}throw new Error("the password is required at joinRoom");case 9:if(l){n.next=11;break}throw new Error("the memName is required at joinRoom");case 11:if(p){n.next=13;break}throw new Error("the token is required at joinRoom");case 13:if(d){n.next=15;break}throw new Error("the role is required at joinRoom");case 15:return h=(0,v.default)({roomName:s,password:c,memName:l,token:p},f),f&&f.supportWechatMiniProgram&&(h.useVCodes=["H264","VP8"]),n.next=19,r(h);case 19:return m=n.sent,_=m.confrId,y={uid:l,token:p,confrId:_,password:c,role:d,terminal:this._terminalInfo},n.next=24,o(y);case 24:return S=n.sent,S.mixed=11===S.type||12===S.type,S.id=S.serverConfrId=S.confrId=_,this._confrs[_]=(0,u.default)(this._confrs[_]||{},S),w=S.ticket,x=f?f:{},C=x.nickName,I=x.ext,T=m.isCreator,n.next=33,i.joinConferenceWithTicket(_,w,(0,v.default)({nickName:C},I));case 33:return E=n.sent,T&&(E.isCreator=T),n.abrupt("return",E);case 36:case"end":return n.stop()}},n,this)}));return function(e){return t.apply(this,arguments)}}(),I.requestToTalker=function(e){if(!e)return void console.warn("requestToTalker confrId is required");var t=this._services[e];t.requestToTalker()},I.requestToAdmin=function(e){if(!e)return void console.warn("requestToTalker confrId is required");var t=this._services[e];t.requestToAdmin()},I.muteBymemberId=function(e,t){if(!e||!t)return void console.warn("muteBymemberId confrId and memberId is required");var n=this._services[e];n.muteBymemberId(t)},I.unmuteBymemberId=function(e,t){if(!e||!t)return void console.warn("muteBymemberId confrId and memberId is required");var n=this._services[e];n.unmuteBymemberId(t)},I.muteAll=function(e){if(!e)throw new Error("muteAll confrId is required");var t=this._confrs[e];if(!t)throw new Error("confr is not exist");var n=t.role,r=t.roleToken;if(7!=n)throw new Error("only admin can action");if(!r)throw new Error("roleToken is not exist");var i=!0;return o.call(this,r,i)},I.unmuteAll=function(e){if(!e)throw new Error("unmuteAll confrId is required");var t=this._confrs[e];if(!t)throw new Error("confr is not exist");var n=t.role,r=t.roleToken;if(7!=n)throw new Error("only admin can action");if(!r)throw new Error("roleToken is not exist");var i=!1;return o.call(this,r,i)},I.addLive=function(t,n){if(!t)throw new Error("addLive confrId is required");if(!n)throw new Error("addLive liveCfg is required");var r=this._confrs[t];if(!r)throw new Error("confr is not exist");var i=r.role,o=r.roleToken;if(7!=i)throw new Error("only admin can addLive");if(!o)throw new Error("addLive roleToken is required");var s=emedia.config.restPrefix+"/easemob/rtc/livecfg",a={confrId:t,roleToken:o,liveCfg:n};return new b.default(function(t,n){e.ajax({url:s,type:"POST",data:(0,g.default)(a),contentType:"application/json",dataType:"json",success:function(e){0==e.error?t(e):n(e)},error:function(e){n(e)}})})},I.updateLiveLayout=function(t,n,r){if(!t)throw new Error("updateLiveLayout confrId is required");if(!n)throw new Error("updateLiveLayout liveId is required");if(!r)throw new Error("updateLiveLayout regions is required");var i=this._confrs[t];if(!i)throw new Error("confr is not exist");var o=i.role,s=i.roleToken;if(7!=o)throw new Error("only admin can updateLiveLayout");if(!s)throw new Error("updateLiveLayout roleToken is required");var a=emedia.config.restPrefix+"/easemob/rtc/live/layout",c={confrId:t,liveId:n,regions:r,roleToken:s};return new b.default(function(t,n){e.ajax({url:a,type:"POST",data:(0,g.default)(c),contentType:"application/json",dataType:"json",success:function(e){0==e.error?t(e):n(e)},error:function(e){n(e)}})})},I.deleteLive=function(t,n){if(!t)throw new Error("deleteLive confrId is required");if(!n)throw new Error("deleteLive liveId is required");var r=this._confrs[t];if(!r)throw new Error("confr is not exist");var i=r.role,o=r.roleToken;if(7!=i)return void console.warn("only admin can deleteLive");if(!o)return void console.error("updateLiveLayout roleToken is required");var s=emedia.config.restPrefix+"/easemob/rtc/delete/live",a={confrId:t,liveId:n,roleToken:o};return new b.default(function(t,n){e.ajax({url:s,type:"DELETE",data:(0,g.default)(a),contentType:"application/json",dataType:"json",success:function(e){0==e.error?t(e):n(e)},error:function(e){n(e)}})})},emedia.decodeMemeberName=function(e){if("function"!=typeof emedia.decodeMemeberNameString)return e;if("string"==typeof e)return emedia.decodeMemeberNameString(e);if(w.default.isArray(e)){for(var t=0;t<e.length;t++)e[t]=emedia.decodeMemeberName(e[t]);return e}return e.name?(e.globalName=e.name,void(e.memName=e.name=emedia.decodeMemeberName(e.name))):e.memName?(e.globalName=e.memName,void(e.memName=e.name=emedia.decodeMemeberName(e.memName))):void 0},emedia.ConfrType=y.single.ConfrType,emedia.Role=y.single.Role,emedia.StreamType=y.single.StreamType,(0,C.default)(function(){var e=window.WebIM;if(e&&e.conn&&"function"==typeof e.conn.onOpened){var t=function(){emedia.decodeMemeberNameString=function(t){if("string"==typeof t){if(t.indexOf(e.conn.orgName)<0)return t;var n=t.indexOf("_");n<0?n=0:n++;var r=t.indexOf("@");return r<0&&(r=t.length),t.substring(n,r)}return t},y.single.setIdentity(e.conn.orgName+"#"+e.conn.appName+"_"+e.conn.user,e.conn.token),emedia.config({appkey:e.conn.appKey,restPrefix:e.conn.apiUrl})},n=e.conn.onOpened;e.conn.onOpened=function(){n.apply(e.conn,arguments),t()},e.conn.token&&t()}});t.outer=w.default.extend(y.single,I)}).call(this,n(75))},function(e,t,n){"use strict";(function(e){function r(e){return e&&e.__esModule?e:{default:e}}function i(){this._confrs={},this._services={},this._events={},this._videos={},this.dns_current=0,this.dns_urls=["https://rs.easemob.com","http://182.92.174.78","http://112.126.66.111"],this.restPrefixArr=[],this.restIndex=0}function o(e,t,n,r){var o=this,s=void 0,a=void 0;if(arguments.length>=0&&"object"===(0,G.default)(arguments[0])){var c=arguments[0];s=c.region,e=c.confrType,t=c.password,n=c.rec,r=c.recMerge,a=c.liveCfg}return"string"==typeof e&&(e=parseInt(e)),ne.Observable.create(i.prototype.createConfr.call(o,{region:s,uid:o.identityName,token:o.identityToken,confrType:e,password:t,terminal:o._terminalInfo,rec:n,recMerge:r,liveCfg:a})).pipe((0,re.map)(function(e){return e.mixed=11===e.type||12===e.type,e.id=e.serverConfrId=e.confrId,o._confrs[e.confrId]=Q.default.extend({},e),X.default.removeAttribute(e,"rtcCfg"),e}),ue)}function s(e,t,n,r,o){var s=this,a={};if(arguments.length>=0&&"object"===(0,G.default)(arguments[0])){var c=arguments[0];a=(0,B.default)({uid:s.identityName,token:s.identityToken,terminal:s._terminalInfo},c)}else a={uid:s.identityName,token:s.identityToken,terminal:s._terminalInfo,confrType:e,password:t,rec:n,recMerge:r,supportWechatMiniProgram:o};return a.confrType&&(a.confrType=parseInt(a.confrType)),o&&(a.useVCodes=["VP8","H264"]),ne.Observable.create(i.prototype.createConfr.call(s,a)).pipe((0,re.map)(function(e){return e.mixed=11===e.type||12===e.type,e.id=e.serverConfrId=e.confrId,s._confrs[e.confrId]=Q.default.extend({},e),X.default.removeAttribute(e,"rtcCfg"),e}),ue)}function a(e,t){var n,r=this;if(arguments.length>=0&&"object"===(0,G.default)(arguments[0])){var o=arguments[0];e=o.confrId,t=o.password,n=o.role}var s=r._confr(e),a={uid:r.identityName,token:r.identityToken,confrId:s&&s.id||e,password:t,role:n,terminal:r._terminalInfo};return r._confrs[e]&&(a.roleToken=r._confrs[e].roleToken),ne.Observable.create(i.prototype.reqTkt.call(r,a)).pipe((0,re.map)(function(t){return t.mixed=11===t.type||12===t.type,t.id=t.serverConfrId=t.confrId=e,r._confrs[e]=X.default.extend(r._confrs[e]||{},t),X.default.removeAttribute(t,"rtcCfg"),t}),ue)}function c(e,t,n){var r=this,o=r._confr(n),s=r._service(n),a={confrId:o&&o.id||n,uids:t,role:e,roleToken:o.roleToken};return ne.Observable.create(i.prototype.chanageRoles.call(r,a)).pipe((0,re.map)(function(e){return s&&s.current&&s.current._sysCopy(),o.id}),ue)}function u(e,t){var n=this,r=n._confr(e),o={confrId:r&&r.id||e,roleToken:r&&r.roleToken||t};return ne.Observable.create(i.prototype.disbandConfr.call(n,o)).pipe((0,re.map)(function(t){return setTimeout(function(){n.upload_stats&&(n.upload_stats.stop(),delete n.upload_stats)},3e3),X.default.removeAttribute(n._confrs,e),r.id}),ue)}function d(e,t){var n=this,r=n._confr(t),o={confrId:r&&r.id||t,uids:e,roleToken:r.roleToken};return ne.Observable.create(i.prototype.kickMember.call(n,o)).pipe((0,re.map)(function(e){return r.id}),ue)}function f(e,t){var n=this,r=n._confr(e),o={uid:n.identityName,token:n.identityToken,confrId:r&&r.id||e,password:t};return r&&(o.password=t||r.password,o.roleToken=r.roleToken),ne.Observable.create(i.prototype.selectConfr.call(n,o)).pipe(ue);
}function l(e,t){}function p(e,t){var n=this,r=n._confr(e),i=n._service(e);switch(r.type){case 0:case 10:break;case 11:break;case 12:var o=new n.ZeroStream;if(i.current._cacheStreams[o.id]=o,i.current.role==fe.Role.AUDIENCE)return M.call(n,e,o,!1,!0).pipe((0,re.concatMap)(function(){return(0,ne.of)(X.default.extend({},n._confrs[e]))}));break;case 13:case 14:return(0,ne.throwError)("not support conf type: "+r.type);default:return(0,ne.throwError)("not support conf type: "+r.type)}return(0,ne.of)(X.default.extend({},n._confrs[e]))}function h(e,t,n){var r=this;return emedia.ctrl.support(n,function(t,n,i){r.onHasRemoteControl(t,n,i,e)},function(t,n,i){r.onRemoteFreeControl(t,n,i,e)}),se.info("support remote control. ",e,t),(0,ne.of)(X.default.extend({},r._confrs[e]))}function v(e,t,n){var r=this;if(r.joined(e))return(0,ne.throwError)("had joined confr "+e+", if you want join again, please call exitConference");var i=r._events[e]=new r.EventsObservable(r,e,function(t){l.call(r,e,t)});r.confrEventsObserver&&i.subscribe(r.confrEventsObserver);var o=r._service(e);return o=r._services[e]=new emedia.XService({listeners:i,nickName:n&&n.nickName}),o.setup(t,n),ne.Observable.create(function(t){if(emedia.config.uploadStats){r.upload_stats=new te.default(emedia);try{r.upload_stats.connect_ws()}catch(n){console.error("upload_stats.connect_ws error",n)}}o.join(function(n){if(r.upload_stats){var i=o.current._session._sessionId;r.upload_stats.join_success(i)}r.__current_confrId=e,r._confrs[e].joinId=n,r._confrs[e].role=o.current&&o.current.role,t.next(r._confrs[e]),t.complete()},function(e){r.upload_stats&&r.upload_stats.join_fail(),o.exit(),t.error({errorType:"join_fail",error:-200,errorMessage:e.message()})})}).pipe((0,re.concatMap)(function(t,n){return h.call(r,e,t,o)}),(0,re.concatMap)(function(t,n){return p.call(r,e,t)}),ue)}function m(e,t,n){var r=this;return a.call(r,e,t,n).pipe((0,re.concatMap)(function(t,i){return v.call(r,e,t.ticket,n)}))}function b(e,t,n){var r=this;return f.call(r,e,t,n).pipe((0,re.concatMap)(function(i,o){return m.call(r,e,t,n)}))}function _(e,t){var n=this,r=n._service(e);return ne.Observable.create(function(e){r.openUserMedia(t).then(function(){e.next(t),e.complete()},function(t){e.error({errorType:"open_user_media_fail",error:-201,errorMessage:t.message()})})}).pipe(ue)}function g(e,t){var n=this,r=n._service(e);return ne.Observable.create(function(e){r.push(t,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"push_fail",error:-203,errorMessage:t.message()})})}).pipe(ue)}function y(e,t,n){var r=this,i=(r._confr(n),r._service(n));return e="string"==typeof e?i.getStreamById(e):i.getStreamById(e.id),e?t?Q.default.isEqual(t,e.constaints.video)?w.call(r,n,e,0):x.call(r,n,e,t):w.call(r,n,e,1):(0,ne.throwError)("pub stream not exsits. it is "+e)}function S(e,t){if(this.upload_stats&&e&&t){var n=this._services[this.__current_confrId].current;if(n){var r={event:e,rtcId:t.rtcId,sId:t.id,sessionId:n._session._sessionId,streamType:t.type,voff:t.voff,aoff:t.aoff};this.upload_stats.upload_event(r)}}}function w(e,t,n){var r=this,i=r._service(e);return ne.Observable.create(function(e){i.voff(t,n,function(t){e.error({errorType:"voff_fail",error:-203,errorMessage:t.message()})},function(){var o=i.getStreamById(t.id);e.next(o),e.complete();var s=1==n?8:6;S.bind(r)(s,o)})}).pipe(ue)}function x(e,t,n){var r=this,i=r._service(e);return ne.Observable.create(function(e){var r={};Q.default.isObject(t.constaints)&&(r=X.default.extend(!0,{},t.constaints)),r.video=n,i.chanageConstraints(t,r,function(t){e.error({errorType:"ChanageVideoConstraints_fail",error:-203,errorMessage:t.message()})},function(){e.next(i.getStreamById(t.id)),e.complete()})}).pipe(ue)}function C(e,t,n){var r=this,i=r._confr(n),o=r._service(n);return e="string"==typeof e?o.getStreamById(e):o.getStreamById(e.id),e?i.type!==r.ConfrType.COMMUNICATION_MIX&&i.type!==r.ConfrType.LIVE||1!==e.type||t?I.call(r,n,e,t):(se.warn("confr mix. not allow desktop with audio."),(0,ne.throwError)("confr mix. not allow desktop with audio.")):(0,ne.throwError)("pub stream not exsits. it is "+e)}function I(e,t,n){var r=this,i=r._service(e);return ne.Observable.create(function(e){i.aoff(t,n,function(t){e.error({errorType:"aoff_fail",error:-203,errorMessage:t.message()})},function(){var o=i.getStreamById(t.id);e.next(o),e.complete();var s=1==n?7:5;S.bind(r)(s,o)})}).pipe(ue)}function T(e,t,n,r){var i=this,o=i._confr(e),s=i._service(e);if(s.current.role==i.Role.AUDIENCE)return(0,ne.throwError)("Audience not allow publish");if(o.av)return(0,ne.throwError)("Audio and video stream has been published. not allow repeat publish.");var a=o.mixed?s.AudioMixerPubstream:s.AVPubstream,c=o.av=new a({constaints:t,aoff:0,voff:0,ext:r});return _.call(i,o.id,c).pipe((0,re.concatMap)(function(e){return n&&X.default.targetDOM(n)&&attachMediaStream(n,e.localStream),g.call(i,o.id,e,r)}),(0,re.map)(function(e){return o.av=e,n&&i.streamBindVideo(o.av,n),o.type==i.ConfrType.LIVE&&i.hungup(0),X.default.extend({},e)}),(0,re.catchError)(function(e,t){throw o.av&&i.hungup(o.av),o.av=void 0,se.error(e),e}))}function E(e){var t=this,n=t._confr(e),r=t._service(e);return r.current.role==t.Role.AUDIENCE?(0,ne.throwError)("Audience not allow publish"):ne.Observable.create(function(e){r.switchMobileCamera(n.av,function(t){e.error({errorType:"switch_camera_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(ue)}function R(e){var t=this,n=t._confr(e),r=t._service(e);return r.current.role==t.Role.AUDIENCE?(0,ne.throwError)("Audience not allow publish"):ne.Observable.create(function(e){r.chanageCamera(n.av,function(t){e.error({errorType:"switch_camera_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(ue)}function k(e){var t=e.confrId,n=e.constaints,r=e.videoTag,i=e.ext,o=e.stopSharedCallback,s=this,a=s._confr(t),c=s._service(t);if(c.current.role==s.Role.AUDIENCE)return(0,ne.throwError)("Audience not allow publish");if(a.desktop)return(0,ne.throwError)("desktop stream has been published. not allow repeat publish.");if((a.type===s.ConfrType.COMMUNICATION_MIX||a.type===s.ConfrType.LIVE)&&n.audio)return se.warn("confr mix. not allow desktop with audio."),(0,ne.throwError)("confr mix. not allow desktop with audio.");n.audio||!a.av||a.av.aoff||se.warn("repeat audio. desktop and av");var u=a.desktop=new c.ShareDesktopPubstream({screenOptions:n.video&&n.video.screenOptions||["screen","window","tab"],mandatory:n.video&&n.video.mandatory||{},vbitrate:n.video&&n.video.bitrate,abitrate:n.audio&&n.audio.bitrate,aoff:n.audio?0:1,ext:i,onMediaInactive:function(){"function"==typeof o&&o()}});return _.call(s,a.id,u).pipe((0,re.concatMap)(function(e){return r&&X.default.targetDOM(r)&&attachMediaStream(r,e.localStream),g.call(s,a.id,e,i)}),(0,re.map)(function(e){return a.desktop=e,r&&X.default.targetDOM(r)&&s.streamBindVideo(a.desktop,r),X.default.extend({},e)}),(0,re.catchError)(function(e,t){throw a.desktop=void 0,se.error(e),e}))}function M(e,t,n,r,i){var o=this,s="string"==typeof t?t:t.id,a=o._confr(e),c=o._service(e);return 2===t.type&&1==r&&0!=t.id&&(r=!1,se.warn("Mixed audio stream. not allow repeat sub audio. force reset subSAudio = false")),i&&X.default.targetDOM(i)&&o.streamBindVideo(s,i),ne.Observable.create(function(e){c.subscribe(s,function(t){try{if("0"!=s){var n=c.getStreamById(s),r={video:n.subArgs?n.subArgs.subSVideo:!n.voff,audio:n.subArgs?n.subArgs.subSAudio:!n.aoff};2===n.type&&(r.audio=!0),o._onMemberMediaChanaged(n.owner,n,r,a.confrId)}}finally{e.next(t),e.complete()}},function(t){e.error({errorType:"sub_fail",error:-203,errorMessage:t.message()})},{subSVideo:n,subSAudio:r})}).pipe(ue)}function O(e,t,n){var r=this,i=r._service(n);e=i.current._cacheStreams["string"==typeof e?e:e.id];var o=t||r.crtAndReturnVideo(e.owner,e);if(o){r._videos[e.id]=o,o.setAttribute("autoplay","autoplay"),o.setAttribute("playsinline","playsinline"),o.setAttribute("hx_stream",e.id),e.aoff?o.setAttribute("aoff","aoff"):o.removeAttribute("aoff"),e.voff?o.setAttribute("voff","voff"):o.removeAttribute("voff"),e.ifMediaStream(function(e){o&&attachMediaStream(o,e),o.hasAttribute("flow")&&r.onMediaTransmission(o,function(e,t,n,r){(0,$.default)(o).trigger("onMediaTransmission",[e,t,n,r])})});var s=(0,$.default)(o);s.off("hungup"),s.on("hungup",function(t,i,o){r.hungup(e,n),o&&o()}),s.off("subscribe"),s.on("subscribe",function(t,i,o,s,a){e.located()?s&&s("local stream not allow sub"):(i=e.subArgs&&e.subArgs.subSVideo||!0,o=e.subArgs&&e.subArgs.subSAudio||!0,r.subscribe(e.owner,e,i,o,n).then(a).catch(s))}),s.off("pauseVideo"),s.on("pauseVideo",function(t,o,a){e=i.current._cacheStreams["string"==typeof e?e:e.id],e.located()?(s[0].__constaints_video=e.constaints&&e.constaints.video,r.pauseVideo(e,n).then(a).catch(o)):r.subscribe(e.owner,e,!1,e.subArgs&&e.subArgs.subSAudio||!e.aoff,n).then(a).catch(o)}),s.off("resumeVideo"),s.on("resumeVideo",function(t,o,a,c){e=i.current._cacheStreams["string"==typeof e?e:e.id],e.located()?(void 0===c&&(c=s[0].__constaints_video,void 0!==c&&null!=c||(c=!0)),s[0].__constaints_video=void 0,r.resumeVideo(e,c,n).then(a).catch(o)):r.subscribe(e.owner,e,!0,e.subArgs&&e.subArgs.subSVideo||!e.voff,n).then(a).catch(o)}),s.off("pauseAudio"),s.on("pauseAudio",function(t,i,o){e.located()?r.pauseAudio(e,n).then(o).catch(i):r.subscribe(e.owner,e,e.subArgs.subSVideo,!1,n).then(o).catch(i)}),s.off("resumeAudio"),s.on("resumeAudio",function(t,i,o){e.located()?r.resumeAudio(e,n).then(o).catch(i):r.subscribe(e.owner,e,e.subArgs.subSVideo,!0,n).then(o).catch(i)}),s.off("remoteControl"),s.on("remoteControl",function(t,i,s,a,c,u,d,f){if(e.located())throw se.error("not allow remote control at local"),"not allow remote control at local";r.remoteControl(e,o,o,i,s,a,c,u,d,f,n)}),s.off("chanageCamera"),s.on("chanageCamera",function(e,t,i){r.chanageCamera(n).then(i).catch(t)}),s.off("captureVideo"),s.on("captureVideo",function(e,t,i,s){var a=r.captureVideo(o,i,s,n);t&&t(a)}),s.off("capturePictureRemote"),s.on("capturePictureRemote",function(t,i,o){r.capturePictureRemote(e,!1,n).then(o).catch(i)}),s.off("freezeFrameRemote"),s.on("freezeFrameRemote",function(t,i,o){r.freezeFrameRemote(e,n).then(o).catch(i)}),s.off("zoomRemote"),s.on("zoomRemote",function(t,i,o,s){r.zoomRemote(e,i,n).then(s).catch(o)}),s.off("torchRemote"),s.on("torchRemote",function(t,i,o,s){r.torchRemote(e,i,n).then(s).catch(o)}),s.off("freeRemoteControl"),s.on("freeRemoteControl",function(t,i,o){try{r.freeRemoteControl(e,n)}finally{o&&o()}});var a={video:!e.voff,audio:!e.aoff,voff:e.voff,aoff:e.aoff};e.located()||(a={video:e.subArgs?e.subArgs.subSVideo:!e.voff,audio:e.subArgs?e.subArgs.subSAudio:!e.aoff,voff:e.voff,aoff:e.aoff}),s.trigger("onMediaChanaged",[a,e,e.owner,n]),o.getAttribute("sound")&&(i.current._monitSoundChanagedStreams=i.current._monitSoundChanagedStreams||{},i.current._monitSoundChanagedStreams[e.id]=e.id)}}function A(e,t,n,r){var i=this;"string"!=typeof t&&(t=t.id);var o=(i._confr(e),i._service(e));return ne.Observable.create(function(e){o.focusExpoRemote(t,n,r,function(t){e.error({errorType:"focusexpo_remote_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(ue)}function P(e,t,n){var r=this;"string"!=typeof t&&(t=t.id);var i=(r._confr(e),r._service(e));return ne.Observable.create(function(e){i.capturePictureRemote(t,n,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"capture_remote_fail",error:-203,errorMessage:t.message()})})}).pipe(ue)}function j(e,t,n){var r=this;"string"!=typeof t&&(t=t.id);var i=(r._confr(e),r._service(e));return ne.Observable.create(function(e){i.zoomRemote(t,n,function(t){e.error({errorType:"capture_remote_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(ue)}function N(e,t,n){var r=this;"string"!=typeof t&&(t=t.id);var i=(r._confr(e),r._service(e));return ne.Observable.create(function(e){i.torchRemote(t,n,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"torch_remote_fail",error:-203,errorMessage:t.message()})})}).pipe(ue)}function D(e,t){var n=this;"string"!=typeof t&&(t=t.id);var r=(n._confr(e),n._service(e));return ne.Observable.create(function(e){r.freezeFrameRemote(t,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"freeze_remote_fail",error:-203,errorMessage:t.message()})})}).pipe(ue)}Object.defineProperty(t,"__esModule",{value:!0}),t.single=void 0;var L=n(130),V=r(L),F=n(133),U=r(F),W=n(140),B=r(W),q=n(2),G=r(q),z=n(73),H=r(z),Y=n(85),K=(r(Y),n(1)),X=r(K),J=n(75),$=r(J),Z=n(134),Q=r(Z),ee=n(156),te=r(ee),ne=n(160),re=n(262),ie=n(145),oe=r(ie),se=X.default.tagLogger("mgr");window.emedia=window.emedia||{};var ae={createConfr:"/easemob/rtc/req/ticket",reqTkt:"/easemob/rtc/req/ticket",chanageRoles:"/easemob/rtc/chanage/roles",disbandConfr:"/easemob/rtc/disband/conference",kickMember:"/easemob/rtc/kick/member",selectConfr:"/easemob/rtc/select/confr"};i.prototype.ConfrType={COMMUNICATION:10,COMMUNICATION_MIX:11,LIVE:12,P2P:13,INTERCOMM:14},i.prototype.Role={ADMIN:7,TALKER:3,AUDIENCE:1},i.prototype.StreamType={VIDEO:0,DESKTOP:1,MIXVIDEO:2};var ce=function(e,t){return function(n){$.default.ajax({type:"POST",url:e,data:(0,H.default)(t),contentType:"application/json",dataType:"json",success:function(r,i,o){se.debug("REST: ",r," -> ",t,e),0===r.error?(X.default.removeAttribute(r,"error"),n.next(r),n.complete()):(X.default.extend(r,{errorType:"server_refuse"}),n.error(r))},error:function(r,i,o){var s={errorType:"http_error",error:r.status,errorMessage:o};se.debug("REST: ",s," -> ",t,e),n.error({errorType:"http_error",error:r.status,errorMessage:o})}})}};!function(e){X.default.forEach(e,function(e,t){i.prototype[e]=function(n){var r=t;r=r+"?_ct="+(new Date).getTime(),n.region&&(r=r+"&REGION="+n.region),n.confrId&&(r=r+"&CONFRID="+n.confrId);var i=this.createUrl(r,e);return ce(i,n)}})}(ae),i.prototype.get_dns_config=function(){var t=this,n=function(e,n){var r=e.rest.hosts;r&&(t.restPrefixArr=r.filter(function(e){return"https"==e.protocol}),t.update_rest_prefix(),t.check_rest_prefix())},r=function(e,n,r){console.log("getHttpDNS error",e,r),t.dns_current++,t.dns_current<=t.dns_urls.length-1&&t.get_dns_config()},i={url:this.dns_urls[this.dns_current]+"/easemob/server.json",dataType:"json",type:"GET",data:{app_key:encodeURIComponent(emedia.config.appkey)},success:n,error:r};se.info("get_dns_config options",i),e.ajax(i)},i.prototype.check_rest_prefix=function(){var t={grant_type:"password",password:"123456",timestamp:(new Date).getTime(),username:"e432598ea3a34ba8ba196df046efdf90"},n=this,r=emedia.config.appkey.split("#")[0],i=emedia.config.appkey.split("#")[1],o=emedia.config.restPrefix+"/"+r+"/"+i+"/token",s={url:o,data:(0,H.default)(t),type:"POST",contentType:"application/json",success:function(){se.info("check_rest_prefix success")},error:function(){se.error("check_rest_prefix error rest",emedia.config.restPrefix),n.restIndex++,n.restIndex<n.restPrefixArr.length&&(n.update_rest_prefix(),n.check_rest_prefix())}};e.ajax(s)},i.prototype.update_rest_prefix=function(){var e=this.restPrefixArr[this.restIndex],t=e.protocol+"://"+e.domain;emedia.config({restPrefix:t})},i.prototype.createUrl=function(e,t){var n=emedia.config&&emedia.config.restPrefix||"";return n+e},i.prototype.setUrlCreator=function(e){this.createUrl=e.bind(this)},i.prototype.destroy=function(){},i.prototype.ZeroStream=oe.default.extend({__init__:function(){var e=this;e.type=2,e.id="0",e._located=!1,e.mutedMuted=!1},onGotRemoteMediaStream:function(e){var t=this;if(!t.remotePlayAudioObject){var n=("__o_remote_play_audio_"+t.id,document.createElement("audio"));n.style.display="none",n.id="__o_remote_play_audio_"+t.id,n.autoplay=!0,n.playsinline=!0,t.remotePlayAudioObject=n,document.body.appendChild(n)}t.remotePlayAudioObject.srcObject=e}}),i.prototype.setIdentity=function(e,t,n){emedia.config.isHttpDNS&&!window.WebIM&&this.get_dns_config(),this.identityName=e,this.identityToken=t,this.ext=n,this._terminalInfo={browser:emedia.browser,browserVersion:emedia.browserVersion,version:window._emediaVersion||emedia.config.version,userAgent:emedia.config.userAgent},se.info("set identity: ",e,t),this.destroy(),emedia.config({autoSub:!1,onlyEnter:!0})},i.prototype.EventsObservable=n(360).default;var ue=(0,re.catchError)(function(e,t){throw se.error(e),e}),de=X.default.extend(new i,{_confr:function(e){var t=this;return e||(e=t.__current_confrId),t._confrs[e]},_service:function(e){var t=this;return e||(e=t.__current_confrId),this._services[e]},getStreamById:function(e,t){var n=this,r=n._service(t);return r&&r.getStreamById(e)},getMemberById:function(e,t){var n=this,r=n._service(t);return r&&r.getMemberById(e)},streamBindVideo:function(e,t,n){O.call(this,e,t,n)},getBindVideoBy:function(e){var t=this;if("string"!=typeof e&&e&&e.id&&(e=e.id),"string"!=typeof e)throw se.error("Bad stream ",e),"Bad stream "+e;return t._videos[e]},createConfr:function(e,t,n,r){return o.apply(this,arguments).toPromise()},createConfrSptMnPrg:function(e,t,n,r){return s.apply(this,arguments).toPromise()},reqTkt:function(e,t){return a.apply(this,arguments).toPromise()},chanageRoles:function(e,t,n){return c.apply(this,arguments).toPromise()},disbandConfr:function(e,t){return u.apply(this,arguments).toPromise()},kickMember:function(e,t){return d.apply(this,arguments).toPromise()},selectConfr:function(e,t){return f.apply(this,arguments).toPromise()},joinUsePassword:function(e,t,n){return b.call(this,e,t,n).toPromise()},joinUseTicket:function(e,t,n){return v.call(this,e,t,n).toPromise()},joined:function(e){return e&&this._confrs[e]&&this._confrs[e].joinId},shareDesktopWithAudio:function(e){if(navigator.mediaDevices.getDisplayMedia&&!emedia.isElectron)return this.shareDesktopWithAudioNew(e);var t=e.videoConstaints,n=e.withAudio,r=e.videoTag,i=e.ext,o=e.confrId,s=e.sharedCallback,a=e.stopSharedCallback,c=this;X.default.targetDOM(r)||(o=i,i=r,r=void 0);var u={video:t,audio:n},d={confrId:o,constaints:u,videoTag:r,ext:i,sharedCallback:s,stopSharedCallback:a};return k.call(c,d).toPromise()},shareDesktopWithAudioNew:function(){function e(e){return t.apply(this,arguments)}var t=(0,U.default)(V.default.mark(function n(e){var t,r,i,o,s,a,c,u,d;return V.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.confrId,r=e.withAudio,i=e.ext,o=e.video,s=e.stopSharedCallback,t){n.next=3;break}throw new Error("shareDesktop confrId is required");case 3:return a={video:o||!0,audio:r},n.next=6,navigator.mediaDevices.getDisplayMedia(a);case 6:return c=n.sent,c._located=!0,u={localStream:c,type:1,aoff:r?0:1,voff:0,constaints:a,_located:!0},n.prev=9,n.next=12,g.call(this,t,u,i).toPromise();case 12:return d=n.sent,c.getVideoTracks()[0].addEventListener("ended",function(){"function"==typeof s&&s(d.id)}),n.abrupt("return",d);case 17:n.prev=17,n.t0=n.catch(9);case 19:case"end":return n.stop()}},n,this,[[9,17]])}));return e}(),changeCamera:function(e){return R.call(this,e).toPromise()},switchMobileCamera:function(e){return E.call(this,e).toPromise()},shareVideoWithAudio:function(e,t,n,r,i){var o=this;X.default.targetDOM(n)||(i=r,r=n,n=void 0);var s={video:e,audio:t};return T.call(o,i,s,n,r).toPromise()},captureVideo:function(e,t,n,r){var i=this,o=i._service(r);return o.captureVideo(e,t,n)},openUserMedia:function(e,t){var n=this,r=n._service(t);return ne.Observable.create(function(t){r.__getUserMedia(e,function(e,n){t.next(n),t.complete()},function(e){t.error(e)})}).pipe(ue).toPromise()},mediaDevices:function(e){return"function"==typeof e&&(e=void 0),ne.Observable.create(function(t){navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];o.deviceId;e||r.push(o),e&&e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||se.info("Some other kind of source/device: ",o)}t.next(r),t.complete()}).catch(function(e){se.warn("navigator.getUserMedia error: ",e),t.error(e)})}).pipe(ue).toPromise()},resumeVideo:function(e,t,n){return y.call(this,e,t||!0,n).toPromise()},pauseVideo:function(e,t){return y.call(this,e,!1,t).toPromise()},resumeAudio:function(e,t){return C.call(this,e,!1,t).toPromise()},pauseAudio:function(e,t){return C.call(this,e,!0,t).toPromise()},freezeFrameRemote:function(e,t){return D.call(this,t,e).toPromise()},torchRemote:function(e,t,n){return N.call(this,n,e,t).toPromise()},zoomRemote:function(e,t,n){return j.call(this,n,e,t).toPromise()},capturePictureRemote:function(e,t){return P.call(this,t,e,!1).toPromise()},focusExpoRemote:function(e,t,n,r){return A.call(this,r,e,t,n).toPromise()},onFocusExpoRemoteWhenClickVideo:function(e,t,n,r){var i=this;return"function"==typeof t&&(r=n,n=t,t=void 0),(0,$.default)(e).off(t||"click"),(0,$.default)(e).on(t||"click",function(t){var o=e.getAttribute("hx_stream");i.focusExpoRemote(o,e,t).then(r).catch(n)}),t},offEventAtTag:function(e,t){t&&(0,$.default)(e).off(t)},hungup:function(e,t){var n,r=this;n="string"==typeof e?e:e.id||e+"";var i=r._service(t),o=r._confr(t);if(!o||!i)return void se.warn("when hungup stream. not found confr and service.",e);i.hungup(n);var s=!1;if(o.av&&(s=o.av.id===n)&&(o.av=void 0),o.desktop&&o.desktop.id===n&&(o.desktop=void 0),s&&o.type==r.ConfrType.LIVE&&i.current.role==fe.Role.AUDIENCE){var a=i.current&&i.current._cacheStreams[0];r.subscribe(i.current,a,!1,!0,t)}},subscribe:function(e,t,n,r,i,o){var s=this;return X.default.targetDOM(i)||(o=i,i=void 0),M.call(s,o,t,n,r,i).toPromise()},exit:function(e,t){var n=this,r=n._service(t);return r?(r.exit(e),void setTimeout(function(){n.upload_stats&&(n.upload_stats.stop(),delete n.upload_stats)},3e3)):void se.warn("when exit. not found service.",t)},_onExit:function(e,t,n){var r=this;try{r.__current_confrId=void 0,r.onExit(t,n,e)}finally{X.default.removeAttribute(r._confrs,e),X.default.removeAttribute(r._services,e),X.default.removeAttribute(r._videos,e),X.default.removeAttribute(r._events,e),r.cattrs=void 0,setTimeout(function(){r.upload_stats&&(r.upload_stats.stop(),delete r.upload_stats)},3e3)}},onExit:function(e,t,n){},_onRoleUpdated:function(e,t){},onMemberJoin:function(e,t){},onMemberLeave:function(e,t,n){},_onRecvRemoteMessage:function(e,t,n){},crtAndReturnVideo:function(e,t,n){},unloadVideo:function(e,t,n,r){},remoteControl:function(e,t,n,r,i,o,s,a,c,u,d){var f=this,l=f._service(d);r=!!r;var p="string"==typeof e?e:e.id;r?emedia.ctrl.mirrorControlled(l,p,t,n,i,o,s,a,c,u):emedia.ctrl.controlled(l,p,t,n,i,o,s,a,c,u)},freeRemoteControl:function(e,t){var n=this,r=n._service(t),i="string"==typeof e?e:e.id;emedia.ctrl.disControlled(r,i)},zeptoTrigger:function(e,t){var n=[];return Array.prototype.push.apply(n,Array.prototype.slice.call(arguments,2)),ne.Observable.create(function(r){var i=[function(){r.error.apply(r,arguments)},function(){r.next.apply(r,arguments),r.complete()}];Array.prototype.push.apply(i,n),(0,$.default)(e).trigger(t,i)}).pipe(ue).toPromise()},_onAddMemberStream:function(e,t){},_onRemoveMemberStream:function(e,t){},_onUpdateMemberStream:function(e,t,n){},_onMemberMediaChanaged:function(e,t,n,r){var i=this._videos[t.id];n&&(n.voff=t.voff,n.aoff=t.aoff),i&&(0,$.default)(i).trigger("onMediaChanaged",[n,t,e,r])},onMediaChanaged:function(e,t){this.addVideoEventListener(e,"onMediaChanaged",t)},_onMemberSoundChanaged:function(e,t,n,r){var i=this._videos[t.id];i&&(0,$.default)(i).trigger("onSoundChanaged",[n,t,e,r])},onSoundChanaged:function(e,t){if(!emedia.config.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis<=0)throw se.error("monit sound chanaged not config. please config getMediaMeterIntervalMillis"),"monit sound chanaged not config. please config getMediaMeterIntervalMillis";e.setAttribute("sound","sound"),this.addVideoEventListener(e,"onSoundChanaged",t)},onMediaTransmission:function(e,t){if(!emedia.helper||"function"!=typeof emedia.helper.inboundVideo)return void se.warn("please import helper. <script>");var n=this._service(),r=e.getAttribute("hx_stream"),i=r&&n.getStreamById(r),o=e.getAttribute("flowWebrtc");i&&i._webrtc&&o==i._webrtc.__id||(e.hasAttribute("flow")&&i&&i._webrtc?(i.located()?emedia.helper.outboundVideo(i,t,1e3):emedia.helper.inboundVideo(i,t,1e3),e.setAttribute("flowWebrtc",i._webrtc.__id)):(this.addVideoEventListener(e,"onMediaTransmission",t),e.setAttribute("flow","flow")))},_onTalking:function(e,t,n,r){},_onNotSupportMemberPublishVideoCodecs:function(e,t,n){var r=this._videos[t.id];r&&(0,$.default)(r).trigger("onNotSupportVideoCodecs",[t,e,n])},onNotSupportVideoCodecs:function(e,t){this.addVideoEventListener(e,"onNotSupportVideoCodecs",t)},_onStreamIceStateChanged:function(e,t,n,r){var i=this._videos[t.id];i&&(0,$.default)(i).trigger("onIceStateChanged",[n,t,e,r])},onIceStateChanged:function(e,t){this.addVideoEventListener(e,"onIceStateChanged",t)},onHasRemoteControl:function(e,t,n,r){var i=this._videos[e.id];i&&(0,$.default)(i).trigger("onRemoteControl",[t,n,e,r])},onRemoteControl:function(e,t){this.addVideoEventListener(e,"onRemoteControl",t)},onRemoteFreeControl:function(e,t,n,r){var i=this._videos[e.id];i&&(0,$.default)(i).trigger("onFreeControl",[t,n,e,r])},onFreeControl:function(e,t){this.addVideoEventListener(e,"onFreeControl",t)},addVideoEventListener:function(e,t,n){(0,$.default)(e).off(t),(0,$.default)(e).on(t,function(){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);n&&n.apply(e,t)})}});Q.default.each(["hungup","subscribe","pauseVideo","resumeVideo","pauseAudio","resumeAudio","chanageCamera","freeRemoteControl","capturePictureRemote","freezeFrameRemote"],function(e,t){var n=e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()});de["trigger"+n]=function(t){var n=[];return n.push(t),n.push(e),Array.prototype.push.apply(n,Array.prototype.slice.call(arguments,1)),de.zeptoTrigger.apply(de,n)}}),de.triggerTorchRemote=function(e,t){return ne.Observable.create(function(n){(0,$.default)(e).trigger("torchRemote",[t,function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])}).pipe(ue).toPromise()},de.triggerZoomRemote=function(e,t){return ne.Observable.create(function(n){(0,$.default)(e).trigger("zoomRemote",[t,function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])}).pipe(ue).toPromise()},de.triggerSubscribe=function(e,t,n){return ne.Observable.create(function(r){(0,$.default)(e).trigger("subscribe",[t,n,function(){r.error.apply(r,arguments)},function(){r.next.apply(r,arguments),r.complete()}])}).pipe(ue).toPromise()},de.triggerRemoteControl=function(e,t,n,r,i,o,s,a){(0,$.default)(e).trigger("remoteControl",[t,n,r,i,o,s,a])},de.triggerCaptureVideo=function(e,t,n){return ne.Observable.create(function(r){(0,$.default)(e).trigger("captureVideo",[function(){r.next.apply(r,arguments),r.complete()},t,n])}).pipe(ue).toPromise()};var fe=t.single=de}).call(this,n(75))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(157),o=r(i),s=n(130),a=r(s),c=n(133),u=r(c),d=n(78),f=r(d),l=n(2),p=r(l),h=n(73),v=r(h),m=n(107),b=r(m),_=n(158),g=r(_),y=n(159),S=r(y),w=n(138),x=r(w),C=function(){function e(t){(0,g.default)(this,e),this.emedia=t,this.streams=[],this._intervals_get=null,this._intervals_upload=null,this.data=[],this.counterId=1,this.prev_obj={},this.sessionId=null,this.network_quality_obj={},this.network_quality_threshold={RTT:{time:8e3,value:500},aPLR:{time:8e3,value:18},vPLR:{time:8e3,value:23},disconnect:{time:5e3}},this.re_timer_count=0}return(0,S.default)(e,[{key:"_get_url",value:function(){var e="",t=this.emedia.useCurrentXService.current;if(!t)return e;var n=t.ticket,r=n.qoeUpUrl,i=n.memName;i=i.split("_")[1];var o=emedia.config.appkey,s=o.split("#")[0],a=o.split("#")[1],c=(new Date).getTime(),u=emedia.mgr.identityToken;return e=r+"?orgName="+s+"&appName="+a+"&memName="+i+"&ts="+c+"&access_token="+u}},{key:"connect_ws",value:function(){var e=this._get_url();if(!e)return void console.error("upload stats not have ws url");var t=new WebSocket(e),n=this;t.onopen=function(){console.log("upload stats ws connected"),n.ws_connected=!0,n.socket=t,n.re_connect&&(console.log("has Reconnectioned"),console.log("before joinS"),n.sessionId&&(console.log("have sessID"),n.join_success(n.sessionId)))},t.onclose=function(e){n._stop_timer(),n.ws_connected=!1,console.error("upload stats ws close",e),!n.exited_meeting&&navigator.onLine&&n.reconnection()},t.message=function(e){console.log("upload stats ws recv msg",e)},t.onerror=function(e){console.error("upload stats ws error",e)},window.addEventListener("online",function(){n.re_timer_count=0,n.reconnection()})}},{key:"reconnection",value:function(){if(!this.ws_connected){var e=this;this.reconnection_timer=setInterval(function(){e.ws_connected||e.re_timer_count>=10?clearInterval(e.reconnection_timer):(console.log("reconnection..."),e.re_connect=!0,e.connect_ws(),e.re_timer_count++)},5e3)}}},{key:"start",value:function(){var e=this;this._intervals_get=setInterval(e.get.bind(this),2e3),this._intervals_upload=setInterval(e.upload.bind(this),500)}},{key:"join_success",value:function(e){e&&(this.sessionId=e,this.data.unshift(this._get_init_data()),this.start())}},{key:"join_fail",value:function(){var e={type:0,result:1,errorInfo:"join fail"};this.socket&&this.socket.send(e)}},{key:"get",value:function(){if(this.emedia.useCurrentXService&&this.emedia.useCurrentXService.current&&this.emedia.useCurrentXService.current._cacheStreams){var e=this.emedia.useCurrentXService.current._cacheStreams,t=this;(0,b.default)(e).map(function(n){t.push_stats_to_data(e[n])})}}},{key:"upload",value:function(){if(0==this.data.length)return void console.warn("upload_stats upload fun -- this.data.length == 0");if(this.socket){var e=this.data.shift();void 0==e.counterId&&(e.counterId=this.counterId,this.counterId=this.counterId+1),this.socket.send((0,v.default)(e))}}},{key:"upload_event",value:function(e){if(e){var t=this._get_format_event_obj(e);t&&this.data.splice(1,0,t)}}},{key:"_get_format_event_obj",value:function(e){var t={type:2,time:(new Date).getTime()};if("object"!=(0,p.default)(e.event)&&void 0!=e.event)return(0,f.default)(t,e);var n=this.sessionId;if(e instanceof x.default.ICEConnected){var r=this._get_ice_connect_state_obj(e.webrtc,2);t=(0,f.default)(t,r)}else if(e instanceof x.default.ICEConnectFail){var i=this._get_ice_connect_state_obj(e.webrtc,4);t=(0,f.default)(t,i)}else if(e instanceof x.default.ICEDisconnected){var o=this._get_ice_connect_state_obj(e.webrtc,5);t=(0,f.default)(t,o)}else if(e instanceof x.default.PushSuccess){if(!e.hidden)return;var s=e.stream,a=s.rtcId,c=s.voff,u=s.aoff,d=s.type,l={event:14,sessionId:n,rtcId:a,voff:c,aoff:u,streamType:d,result:0};t=(0,f.default)(t,l)}else if(e instanceof x.default.SubSuccess){var h=e.stream,v=h.rtcId,m=h.id,b=h.type,_=h.memId,g=h.memName,y={event:16,rtcId:v,sId:m,sessionId:n,result:0,streamType:b,subMemName:g,subMemId:_};t=(0,f.default)(t,y)}else if(e instanceof x.default.EnterSuccess){var S={event:0,ip:e.ip};t=(0,f.default)(t,S)}if(void 0!=t.event)return t}},{key:"_get_ice_connect_state_obj",value:function(e,t){var n=this.emedia.useCurrentXService.current,r=null;for(var i in n._linkedStreams)n._linkedStreams[i].rtcId==e.getRtcId()&&(r=n._linkedStreams[i]);if(!r)return{};var o={event:20,rtcId:r.rtcId,connState:t,isPub:r.located(),sId:r.id,rtcCfg:r.rtcCfg,voff:r.voff,aoff:r.aoff};if(!r.located()){var s={subSId:r.id,subMemName:r.memName,subMemId:r.memId,subVideo:r.subSVideo,subAudio:r.subSAudio};o=(0,f.default)(o,s)}return o}},{key:"stop",value:function(){this.exited_meeting=!0,this.socket.close(),this._stop_timer()}},{key:"_stop_timer",value:function(){clearInterval(this._intervals_get),clearInterval(this._intervals_upload)}},{key:"push_stats_to_data",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u.default)(a.default.mark(function n(e){var t,r;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e._webrtc){
n.next=2;break}return n.abrupt("return");case 2:return n.next=4,e._webrtc._rtcPeerConnection.getStats();case 4:t=n.sent,r=this._get_format_upload_obj(t,e),this.data.push(r);case 7:case"end":return n.stop()}},n,this)}));return e}()},{key:"_get_init_data",value:function(){var e={},t=this.emedia.useCurrentXService.current;if(t){var n=this.emedia.config,r=n.appkey,i=n.version,o=t.confrId,s=t._memberId,a=t.memName,c=this.sessionId,u=this.emedia,d=u.browser,f=u.browserVersion;u.isWifi;return e={type:0,counterId:0,appkey:r,confrId:o,memId:s,memName:a,time:(new Date).getTime(),joinConfrTime:t.ticket.timestamp,sessionId:c,networkType:"WIFI",sdkOS:"Web",sdkVersion:i,deviceInfo:d,osVersion:f,result:0}}}},{key:"_get_format_upload_obj",value:function(e,t){var n={type:1,time:(new Date).getTime(),streamType:t.type,sId:t.id,rtcId:t.rtcId};if(t.located()){n.isPub=!0;var r=this._get_outbound_stats(e);n=(0,f.default)(n,r)}else{n.isPub=!1,n.subMemName=t.memName,n.subMemId=t.memId;var i=this._get_inbound_stats(e);n=(0,f.default)(n,i)}return n=this._calc_KBps_and_PLR(n),n=this._set_stats_int(n)}},{key:"_get_outbound_stats",value:function(e){var t={};return e.forEach(function(e){"outbound-rtp"==e.type&&("audio"==e.mediaType&&(t.aP=e.packetsSent,t.aB=e.bytesSent),"video"==e.mediaType&&(t.vW=e.frameWidth,t.vH=e.frameHeight,t.vP=e.packetsSent,t.vB=e.bytesSent)),"remote-inbound-rtp"==e.type&&("audio"==e.kind&&(t.aPL=e.packetsLost),"video"==e.kind&&(t.vPL=e.packetsLost)),"media-source"==e.type&&("audio"==e.kind&&(t.audioInputLevel=1e3*e.audioLevel),"video"==e.kind&&(t.vFps=e.framesPerSecond)),"candidate-pair"==e.type&&(t.RTT=1e3*e.totalRoundTripTime/e.responsesReceived)}),t}},{key:"_get_inbound_stats",value:function(e){var t={};return e.forEach(function(e){"inbound-rtp"==e.type&&(("audio"==e.kind||e.id.indexOf("AudioStream")>-1)&&(t.aP=e.packetsReceived,t.aPL=e.packetsLost,t.aB=e.bytesReceived),("video"==e.kind||e.id.indexOf("VideoStream")>-1)&&(t.vP=e.packetsReceived,t.vPL=e.packetsLost,t.vB=e.bytesReceived)),"track"==e.type&&("video"==e.kind&&(t.vW=e.frameWidth,t.vH=e.frameHeight,t.vFR=e.framesReceived),"audio"==e.kind&&(t.audioInputLevel=1e3*e.audioLevel)),"candidate-pair"==e.type&&(t.RTT=1e3*e.totalRoundTripTime/e.responsesReceived)}),t}},{key:"_calc_KBps_and_PLR",value:function(e){var t=e.sId,n=e.aB,r=e.vB,i=e.time;e.aKBps=this._get_KBps_by_sId(t,"audio",n,i)||0,e.vKBps=this._get_KBps_by_sId(t,"video",r,i)||0;var o=e.aP,s=e.aPL,a=e.vP,c=e.vPL,u=this._get_PLR_by_sId(t,"audio",o,s),d=this._get_PLR_by_sId(t,"video",a,c);if((u||0==u)&&(e.aPLR=u),(d||0==d)&&(e.vPLR=d),!e.isPub){var f=e.vFR;if(this.prev_obj[t]&&this.prev_obj[t].video&&this.prev_obj[t].video.framesReceived){var l=this.prev_obj[t].time,p=this.prev_obj[t].video.framesReceived,h=(i-l)/1e3,v=(f-p)/h;v<0&&(v=0),e.vFps=v}}var m=this._get_w_quality(e);if(2!=m){var b={time:(new Date).getTime(),event:4,type:2,counterId:this.counterId,sessionId:this.sessionId,rtcId:e.rtcId,sId:e.sId,isPub:e.isPub,streamType:e.sId,aoff:e.aoff,voff:e.voff,subMemName:e.subMemName,subMemId:e.subMemId};this.data.push(b)}if(this.emedia.mgr&&this.emedia.mgr.onNetworkQuality){var _=this.emedia.mgr.onNetworkQuality;"function"==typeof _&&_(e.sId,m)}return this._set_prev_obj(e),delete e.aB,delete e.vB,delete e.vFR,delete e.RTT,e}},{key:"_set_stats_int",value:function(e){var t=["audioInputLevel","vKBps","vFps","vW","vH","vP","vPL","vPLR","aKBps","aP","aPL","aPLR"];for(var n in e)t.indexOf(n)>-1&&(e[n]=Math.round(e[n]));return e}},{key:"_get_KBps_by_sId",value:function(e,t,n,r){if(!e||!t||!n)return null;var i=this.prev_obj[e];if(!i||!i[t]||!i[t].bytes)return null;var o=i.time,s=i[t].bytes,a=parseInt(r-o),c=n-s;c<0&&(c=0);var u=c/(a/1e3).toFixed(2);return u/1e3}},{key:"_get_PLR_by_sId",value:function(e,t,n,r){if(!e)return null;if(!t||!n||!r)return 0;var i=this.prev_obj[e];if(!(i&&i[t]&&i[t].packets&&i[t].packets_lost))return 0;var o=i[t],s=o.packets,a=o.packets_lost,c=n-s,u=r-a,d=u/(c+u);return d=Math.round(100*d)}},{key:"_set_prev_obj",value:function(e){var t=e.sId;if(t){var n=e.aB,r=e.vB,i=e.time,o=e.aP,s=e.aPL,a=e.vP,c=e.vPL,u=e.vFR,d={},f={};n&&(d.bytes=n),o&&(d.packets=o),(s||0==s)&&(d.packets_lost=s),r&&(f.bytes=r),a&&(f.packets=a),(c||0==c)&&(f.packets_lost=c),u&&(f.framesReceived=u),0==(0,b.default)(d).length&&0==(0,b.default)(f).length||(this.prev_obj[t]||(this.prev_obj[t]={}),this.prev_obj[t].time=i,(0,b.default)(d).length>0&&(this.prev_obj[t].audio=d),(0,b.default)(f).length>0&&(this.prev_obj[t].video=f))}}},{key:"_get_w_quality",value:function(e){var t=(e.RTT,e.aPLR,e.vPLR,e.time),n=e.vKBps,r=e.aKBps,i=e.sId;if(!i)return 2;var s=this,a=function(){var e=s.network_quality_obj[i];if(!e)return s.network_quality_obj[i]={disconnect:{time:t}},!1;if(!e.disconnect)return s.network_quality_obj[i]={disconnect:{time:t}},!1;var n=e.disconnect.time,r=s.network_quality_threshold.disconnect.time;return t-n>=r},c=function(){var e=s.network_quality_obj[i];e&&e.disconnect&&(s.network_quality_obj[i].disconnect=void 0)},u=function(e){if(!e||!t)return!1;var n=s.network_quality_obj[i];if(!n)return s.network_quality_obj[i]=(0,o.default)({},e,{time:t}),!1;if(!n[e])return s.network_quality_obj[i][e]={time:t},!1;var r=n[e].time,a=s.network_quality_threshold[e].time;return t-r>=a},d=function(e){var t=s.network_quality_obj[i];t&&t[e]&&(s.network_quality_obj[i][e]=void 0)};if(n||r){c();for(var f=["RTT","aPLR","vPLR"],l=2,p=0;p<f.length;p++){var h=f[p],v=this.network_quality_threshold[h].value;e[h]>=v?u(h,t)&&(l=1):d(h)}return l}return a()?0:2}}]),e}();t.default=C},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(126),o=r(i);t.default=function(e,t,n){return t in e?(0,o.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(126),o=r(i);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){"use strict";n.r(t);var r=n(161);n.d(t,"Observable",function(){return r.Observable});var i=n(178);n.d(t,"ConnectableObservable",function(){return i.ConnectableObservable});var o=n(183);n.d(t,"GroupedObservable",function(){return o.GroupedObservable});var s=n(175);n.d(t,"observable",function(){return s.observable});var a=n(179);n.d(t,"Subject",function(){return a.Subject});var c=n(184);n.d(t,"BehaviorSubject",function(){return c.BehaviorSubject});var u=n(185);n.d(t,"ReplaySubject",function(){return u.ReplaySubject});var d=n(202);n.d(t,"AsyncSubject",function(){return d.AsyncSubject});var f=n(203);n.d(t,"asapScheduler",function(){return f.asap});var l=n(207);n.d(t,"asyncScheduler",function(){return l.async});var p=n(186);n.d(t,"queueScheduler",function(){return p.queue});var h=n(208);n.d(t,"animationFrameScheduler",function(){return h.animationFrame});var v=n(211);n.d(t,"VirtualTimeScheduler",function(){return v.VirtualTimeScheduler}),n.d(t,"VirtualAction",function(){return v.VirtualAction});var m=n(192);n.d(t,"Scheduler",function(){return m.Scheduler});var b=n(169);n.d(t,"Subscription",function(){return b.Subscription});var _=n(163);n.d(t,"Subscriber",function(){return _.Subscriber});var g=n(194);n.d(t,"Notification",function(){return g.Notification}),n.d(t,"NotificationKind",function(){return g.NotificationKind});var y=n(176);n.d(t,"pipe",function(){return y.pipe});var S=n(177);n.d(t,"noop",function(){return S.noop});var w=n(212);n.d(t,"identity",function(){return w.identity});var x=n(213);n.d(t,"isObservable",function(){return x.isObservable});var C=n(214);n.d(t,"ArgumentOutOfRangeError",function(){return C.ArgumentOutOfRangeError});var I=n(215);n.d(t,"EmptyError",function(){return I.EmptyError});var T=n(180);n.d(t,"ObjectUnsubscribedError",function(){return T.ObjectUnsubscribedError});var E=n(172);n.d(t,"UnsubscriptionError",function(){return E.UnsubscriptionError});var R=n(216);n.d(t,"TimeoutError",function(){return R.TimeoutError});var k=n(217);n.d(t,"bindCallback",function(){return k.bindCallback});var M=n(219);n.d(t,"bindNodeCallback",function(){return M.bindNodeCallback});var O=n(220);n.d(t,"combineLatest",function(){return O.combineLatest});var A=n(231);n.d(t,"concat",function(){return A.concat});var P=n(242);n.d(t,"defer",function(){return P.defer});var j=n(195);n.d(t,"empty",function(){return j.empty});var N=n(243);n.d(t,"forkJoin",function(){return N.forkJoin});var D=n(235);n.d(t,"from",function(){return D.from});var L=n(244);n.d(t,"fromEvent",function(){return L.fromEvent});var V=n(245);n.d(t,"fromEventPattern",function(){return V.fromEventPattern});var F=n(246);n.d(t,"generate",function(){return F.generate});var U=n(247);n.d(t,"iif",function(){return U.iif});var W=n(248);n.d(t,"interval",function(){return W.interval});var B=n(250);n.d(t,"merge",function(){return B.merge});var q=n(251);n.d(t,"never",function(){return q.never});var G=n(196);n.d(t,"of",function(){return G.of});var z=n(252);n.d(t,"onErrorResumeNext",function(){return z.onErrorResumeNext});var H=n(253);n.d(t,"pairs",function(){return H.pairs});var Y=n(254);n.d(t,"partition",function(){return Y.partition});var K=n(257);n.d(t,"race",function(){return K.race});var X=n(258);n.d(t,"range",function(){return X.range});var J=n(201);n.d(t,"throwError",function(){return J.throwError});var $=n(259);n.d(t,"timer",function(){return $.timer});var Z=n(260);n.d(t,"using",function(){return Z.using});var Q=n(261);n.d(t,"zip",function(){return Q.zip});var ee=n(236);n.d(t,"scheduled",function(){return ee.scheduled}),n.d(t,"EMPTY",function(){return j.EMPTY}),n.d(t,"NEVER",function(){return q.NEVER});var te=n(167);n.d(t,"config",function(){return te.config})},function(e,t,n){"use strict";function r(e){if(e||(e=c.config.Promise||Promise),!e)throw new Error("no Promise impl found");return e}n.r(t),n.d(t,"Observable",function(){return u});var i=n(162),o=n(174),s=n(175),a=n(176),c=n(167),u=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=Object(o.toSubscriber)(e,t,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||c.config.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),c.config.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){c.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),Object(i.canReportError)(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=r(t))(function(t,r){var i;i=n.subscribe(function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}},r,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[s.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Object(a.pipeFromArray)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=r(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}()},function(e,t,n){"use strict";function r(e){for(;e;){var t=e,n=t.closed,r=t.destination,o=t.isStopped;if(n||o)return!1;e=r&&r instanceof i.Subscriber?r:null}return!0}n.r(t),n.d(t,"canReportError",function(){return r});var i=n(163)},function(e,t,n){"use strict";n.r(t),n.d(t,"Subscriber",function(){return d}),n.d(t,"SafeSubscriber",function(){return f});var r=n(164),i=n(165),o=n(166),s=n(169),a=n(173),c=n(167),u=n(168),d=function(e){function t(n,r,i){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=o.empty;break;case 1:if(!n){s.destination=o.empty;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new f(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new f(s,n,r,i)}return s}return r.__extends(t,e),t.prototype[a.rxSubscriber]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(s.Subscription),f=function(e){function t(t,n,r,s){var a=e.call(this)||this;a._parentSubscriber=t;var c,u=a;return Object(i.isFunction)(n)?c=n:n&&(c=n.next,r=n.error,s=n.complete,n!==o.empty&&(u=Object.create(n),Object(i.isFunction)(u.unsubscribe)&&a.add(u.unsubscribe.bind(u)),u.unsubscribe=a.unsubscribe.bind(a))),a._context=u,a._next=c,a._error=r,a._complete=s,a}return r.__extends(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;c.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=c.config.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Object(u.hostReportError)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Object(u.hostReportError)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};c.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),c.config.useDeprecatedSynchronousErrorHandling)throw n;Object(u.hostReportError)(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!c.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return c.config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(Object(u.hostReportError)(r),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(d)},function(e,t,n){"use strict";function r(e,t){function n(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function o(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function s(e,t){return function(n,r){t(n,r,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function u(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function d(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function f(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}function h(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function v(e){return this instanceof v?(this.v=e,this):new v(e)}function m(e,t,n){function r(e){d[e]&&(u[e]=function(t){return new Promise(function(n,r){f.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{o(d[e](t))}catch(n){c(f[0][3],n)}}function o(e){e.value instanceof v?Promise.resolve(e.value.v).then(s,a):c(f[0][2],e)}function s(e){i("next",e)}function a(e){i("throw",e)}function c(e,t){e(t),f.shift(),f.length&&i(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,d=n.apply(e,t||[]),f=[];return u={},r("next"),r("throw"),r("return"),u[Symbol.asyncIterator]=function(){return this},u}function b(e){function t(t,i){n[t]=e[t]?function(n){return(r=!r)?{value:v(e[t](n)),done:"return"===t}:i?i(n):n}:i}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n}function _(e){function t(t){r[t]=e[t]&&function(r){return new Promise(function(i,o){r=e[t](r),n(i,o,r.done,r.value)})}}function n(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof f?f(e):e[Symbol.iterator](),r={},t("next"),t("throw"),t("return"),r[Symbol.asyncIterator]=function(){return this},r)}function g(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}n.r(t),n.d(t,"__extends",function(){return r}),n.d(t,"__assign",function(){return x}),n.d(t,"__rest",function(){return i}),n.d(t,"__decorate",function(){return o}),n.d(t,"__param",function(){return s}),n.d(t,"__metadata",function(){return a}),n.d(t,"__awaiter",function(){return c}),n.d(t,"__generator",function(){return u}),n.d(t,"__exportStar",function(){return d}),n.d(t,"__values",function(){return f}),n.d(t,"__read",function(){return l}),n.d(t,"__spread",function(){return p}),n.d(t,"__spreadArrays",function(){return h}),n.d(t,"__await",function(){return v}),n.d(t,"__asyncGenerator",function(){return m}),n.d(t,"__asyncDelegator",function(){return b}),n.d(t,"__asyncValues",function(){return _}),n.d(t,"__makeTemplateObject",function(){return g}),n.d(t,"__importStar",function(){return y}),n.d(t,"__importDefault",function(){return S});var w=function(e,t){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},x=function(){return x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},x.apply(this,arguments)}},function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.r(t),n.d(t,"isFunction",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"empty",function(){return o});var r=n(167),i=n(168),o={closed:!0,next:function(e){},error:function(e){if(r.config.useDeprecatedSynchronousErrorHandling)throw e;Object(i.hostReportError)(e)},complete:function(){}}},function(e,t,n){"use strict";n.r(t),n.d(t,"config",function(){return i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else r&&console.log("RxJS: Back to a better error behavior. Thank you. <3");r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,n){"use strict";function r(e){setTimeout(function(){throw e},0)}n.r(t),n.d(t,"hostReportError",function(){return r})},function(e,t,n){"use strict";function r(e){return e.reduce(function(e,t){return e.concat(t instanceof a.UnsubscriptionError?t.errors:t)},[])}n.r(t),n.d(t,"Subscription",function(){return c});var i=n(170),o=n(171),s=n(165),a=n(172),c=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,c=n._parentOrParents,u=n._unsubscribe,d=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,c instanceof e)c.remove(this);else if(null!==c)for(var f=0;f<c.length;++f){var l=c[f];l.remove(this)}if(Object(s.isFunction)(u))try{u.call(this)}catch(p){t=p instanceof a.UnsubscriptionError?r(p.errors):[p]}if(Object(i.isArray)(d))for(var f=-1,h=d.length;++f<h;){var v=d[f];if(Object(o.isObject)(v))try{v.unsubscribe()}catch(p){t=t||[],p instanceof a.UnsubscriptionError?t=t.concat(r(p.errors)):t.push(p)}}if(t)throw new a.UnsubscriptionError(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;n=new e,n._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(i.indexOf(this)!==-1)return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);n!==-1&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"isArray",function(){return r});var r=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}()},function(e,t,n){"use strict";function r(e){return null!==e&&"object"==typeof e}n.r(t),n.d(t,"isObject",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"UnsubscriptionError",function(){return i});var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),i=r},function(e,t,n){"use strict";n.r(t),n.d(t,"rxSubscriber",function(){return r}),n.d(t,"$$rxSubscriber",function(){return i});var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),i=r},function(e,t,n){"use strict";function r(e,t,n){if(e){if(e instanceof i.Subscriber)return e;if(e[o.rxSubscriber])return e[o.rxSubscriber]()}return e||t||n?new i.Subscriber(e,t,n):new i.Subscriber(s.empty)}n.r(t),n.d(t,"toSubscriber",function(){return r});var i=n(163),o=n(173),s=n(166)},function(e,t,n){"use strict";n.r(t),n.d(t,"observable",function(){return r});var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i(e)}function i(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:o.noop}n.r(t),n.d(t,"pipe",function(){return r}),n.d(t,"pipeFromArray",function(){return i});var o=n(177)},function(e,t,n){"use strict";function r(){}n.r(t),n.d(t,"noop",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"ConnectableObservable",function(){return u}),n.d(t,"connectableObservableDescriptor",function(){return d});var r=n(164),i=n(179),o=n(161),s=n(163),a=n(169),c=n(182),u=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.__extends(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,e=this._connection=new a.Subscription,e.add(this.source.subscribe(new f(this.getSubject(),this))),e.closed&&(this._connection=null,e=a.Subscription.EMPTY)),e},t.prototype.refCount=function(){return Object(c.refCount)()(this)},t}(o.Observable),d=function(){var e=u.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),f=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.__extends(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(i.SubjectSubscriber),l=(function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new l(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.__extends(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(!e)return void(this.connection=null);this.connectable=null;var t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()},t}(s.Subscriber))},function(e,t,n){"use strict";n.r(t),n.d(t,"SubjectSubscriber",function(){return d}),n.d(t,"Subject",function(){return f}),n.d(t,"AnonymousSubject",function(){return l});var r=n(164),i=n(161),o=n(163),s=n(169),a=n(180),c=n(181),u=n(173),d=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r.__extends(t,e),t}(o.Subscriber),f=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.__extends(t,e),t.prototype[u.rxSubscriber]=function(){return new d(this)},t.prototype.lift=function(e){var t=new l(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new a.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new a.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(e.complete(),s.Subscription.EMPTY):(this.observers.push(e),new c.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new i.Observable;return e.source=this,e},t.create=function(e,t){return new l(e,t)},t}(i.Observable),l=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r.__extends(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var t=this.source;return t?this.source.subscribe(e):s.Subscription.EMPTY},t}(f)},function(e,t,n){"use strict";n.r(t),n.d(t,"ObjectUnsubscribedError",function(){return i});var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),i=r},function(e,t,n){"use strict";n.r(t),n.d(t,"SubjectSubscription",function(){return o});var r=n(164),i=n(169),o=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return r.__extends(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);n!==-1&&t.splice(n,1)}}},t}(i.Subscription)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new s(e))}}n.r(t),n.d(t,"refCount",function(){return r});var i=n(164),o=n(163),s=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new a(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return i.__extends(t,e),t.prototype._unsubscribe=function(){
var e=this.connectable;if(!e)return void(this.connection=null);this.connectable=null;var t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t,n,r){return function(i){return i.lift(new u(e,t,n,r))}}n.r(t),n.d(t,"groupBy",function(){return r}),n.d(t,"GroupedObservable",function(){return l});var i=n(164),o=n(163),s=n(169),a=n(161),c=n(179),u=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),d=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=o,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}return i.__extends(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(n){return void this.error(n)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(o){this.error(o)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new c.Subject,n.set(t,i);var s=new l(t,i,this);if(this.destination.next(s),this.durationSelector){var a=void 0;try{a=this.durationSelector(new l(t,i))}catch(o){return void this.error(o)}this.add(a.subscribe(new f(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,n){t.error(e)}),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(o.Subscriber),f=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return i.__extends(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this,t=e.parent,n=e.key;this.key=this.parent=null,t&&t.removeGroup(n)},t}(o.Subscriber),l=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return i.__extends(t,e),t.prototype._subscribe=function(e){var t=new s.Subscription,n=this,r=n.refCountSubscription,i=n.groupSubject;return r&&!r.closed&&t.add(new p(r)),t.add(i.subscribe(e)),t},t}(a.Observable),p=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return i.__extends(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(s.Subscription)},function(e,t,n){"use strict";n.r(t),n.d(t,"BehaviorSubject",function(){return s});var r=n(164),i=n(179),o=n(180),s=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new o.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i.Subject)},function(e,t,n){"use strict";n.r(t),n.d(t,"ReplaySubject",function(){return d});var r=n(164),i=n(179),o=n(186),s=n(169),a=n(193),c=n(180),u=n(181),d=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.__extends(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new f(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new c.ObjectUnsubscribedError;if(this.isStopped||this.hasError?t=s.Subscription.EMPTY:(this.observers.push(e),t=new u.SubjectSubscription(this,e)),i&&e.add(e=new a.ObserveOnSubscriber(e,i)),n)for(var d=0;d<o&&!e.closed;d++)e.next(r[d]);else for(var d=0;d<o&&!e.closed;d++)e.next(r[d].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||o.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&r.splice(0,o),r},t}(i.Subject),f=function(){function e(e,t){this.time=e,this.value=t}return e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"queue",function(){return o});var r=n(187),i=n(190),o=new i.QueueScheduler(r.QueueAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"QueueAction",function(){return o});var r=n(164),i=n(188),o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.__extends(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(i.AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsyncAction",function(){return o});var r=n(164),i=n(189),o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return r.__extends(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){return void 0===n&&(n=0),null!==n&&this.delay===n&&this.pending===!1?t:void clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);return n?n:void(this.pending===!1&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null)))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,r!==-1&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(i.Action)},function(e,t,n){"use strict";n.r(t),n.d(t,"Action",function(){return o});var r=n(164),i=n(169),o=function(e){function t(t,n){return e.call(this)||this}return r.__extends(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(i.Subscription)},function(e,t,n){"use strict";n.r(t),n.d(t,"QueueScheduler",function(){return o});var r=n(164),i=n(191),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(i.AsyncScheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsyncScheduler",function(){return o});var r=n(164),i=n(192),o=function(e){function t(n,r){void 0===r&&(r=i.Scheduler.now);var o=e.call(this,n,function(){return t.delegate&&t.delegate!==o?t.delegate.now():r()})||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return r.__extends(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)return void t.push(e);var n;this.active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}},t}(i.Scheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"Scheduler",function(){return r});var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}()},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=0),function(n){return n.lift(new a(e,t))}}n.r(t),n.d(t,"observeOn",function(){return r}),n.d(t,"ObserveOnOperator",function(){return a}),n.d(t,"ObserveOnSubscriber",function(){return c}),n.d(t,"ObserveOnMessage",function(){return u});var i=n(164),o=n(163),s=n(194),a=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}(),c=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return i.__extends(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){var n=this.destination;n.add(this.scheduler.schedule(t.dispatch,this.delay,new u(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(s.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(s.Notification.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(s.Notification.createComplete()),this.unsubscribe()},t}(o.Subscriber),u=function(){function e(e,t){this.notification=e,this.destination=t}return e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"NotificationKind",function(){return r}),n.d(t,"Notification",function(){return a});var r,i=n(195),o=n(196),s=n(201);!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(r||(r={}));var a=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){var r=this.kind;switch(r){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e=this.kind;switch(e){case"N":return Object(o.of)(this.value);case"E":return Object(s.throwError)(this.error);case"C":return Object(i.empty)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return"undefined"!=typeof t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},function(e,t,n){"use strict";function r(e){return e?i(e):s}function i(e){return new o.Observable(function(t){return e.schedule(function(){return t.complete()})})}n.r(t),n.d(t,"EMPTY",function(){return s}),n.d(t,"empty",function(){return r});var o=n(161),s=new o.Observable(function(e){return e.complete()})},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Object(i.isScheduler)(n)?(e.pop(),Object(s.scheduleArray)(e,n)):Object(o.fromArray)(e)}n.r(t),n.d(t,"of",function(){return r});var i=n(197),o=n(198),s=n(200)},function(e,t,n){"use strict";function r(e){return e&&"function"==typeof e.schedule}n.r(t),n.d(t,"isScheduler",function(){return r})},function(e,t,n){"use strict";function r(e,t){return t?Object(s.scheduleArray)(e,t):new i.Observable(Object(o.subscribeToArray)(e))}n.r(t),n.d(t,"fromArray",function(){return r});var i=n(161),o=n(199),s=n(200)},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToArray",function(){return r});var r=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}}},function(e,t,n){"use strict";function r(e,t){return new i.Observable(function(n){var r=new o.Subscription,i=0;return r.add(t.schedule(function(){return i===e.length?void n.complete():(n.next(e[i++]),void(n.closed||r.add(this.schedule())))})),r})}n.r(t),n.d(t,"scheduleArray",function(){return r});var i=n(161),o=n(169)},function(e,t,n){"use strict";function r(e,t){return t?new o.Observable(function(n){return t.schedule(i,0,{error:e,subscriber:n})}):new o.Observable(function(t){return t.error(e)})}function i(e){var t=e.error,n=e.subscriber;n.error(t)}n.r(t),n.d(t,"throwError",function(){return r});var o=n(161)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsyncSubject",function(){return s});var r=n(164),i=n(179),o=n(169),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return r.__extends(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),o.Subscription.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),o.Subscription.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(i.Subject)},function(e,t,n){"use strict";n.r(t),n.d(t,"asap",function(){return o});var r=n(204),i=n(206),o=new i.AsapScheduler(r.AsapAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsapAction",function(){return s});var r=n(164),i=n(205),o=n(188),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.__extends(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=i.Immediate.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.recycleAsyncId.call(this,t,n,r):void(0===t.actions.length&&(i.Immediate.clearImmediate(n),t.scheduled=void 0))},t}(o.AsyncAction)},function(e,t,n){"use strict";function r(e){var t=o[e];t&&t()}n.r(t),n.d(t,"Immediate",function(){return s});var i=1,o={},s={setImmediate:function(e){var t=i++;return o[t]=e,Promise.resolve().then(function(){return r(t)}),t},clearImmediate:function(e){delete o[e]}}},function(e,t,n){"use strict";n.r(t),n.d(t,"AsapScheduler",function(){return o});var r=n(164),i=n(191),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do if(t=e.execute(e.state,e.delay))break;while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(i.AsyncScheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"async",function(){return o});var r=n(188),i=n(191),o=new i.AsyncScheduler(r.AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"animationFrame",function(){return o});var r=n(209),i=n(210),o=new i.AnimationFrameScheduler(r.AnimationFrameAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AnimationFrameAction",function(){return o});var r=n(164),i=n(188),o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.__extends(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},t.prototype.recycleAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.recycleAsyncId.call(this,t,n,r):void(0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0))},t}(i.AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AnimationFrameScheduler",function(){return o});var r=n(164),i=n(191),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do if(t=e.execute(e.state,e.delay))break;while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(i.AsyncScheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"VirtualTimeScheduler",function(){return s}),n.d(t,"VirtualAction",function(){return a});var r=n(164),i=n(188),o=n(191),s=function(e){function t(t,n){void 0===t&&(t=a),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,function(){return r.frame})||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return r.__extends(t,e),t.prototype.flush=function(){for(var e,t,n=this,r=n.actions,i=n.maxFrames;(t=r[0])&&t.delay<=i&&(r.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=r.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(o.AsyncScheduler),a=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return r.__extends(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(this.active===!0)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(i.AsyncAction)},function(e,t,n){"use strict";function r(e){return e}n.r(t),n.d(t,"identity",function(){return r})},function(e,t,n){"use strict";function r(e){return!!e&&(e instanceof i.Observable||"function"==typeof e.lift&&"function"==typeof e.subscribe)}n.r(t),n.d(t,"isObservable",function(){return r});var i=n(161)},function(e,t,n){"use strict";n.r(t),n.d(t,"ArgumentOutOfRangeError",function(){return i});var r=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),i=r},function(e,t,n){"use strict";n.r(t),n.d(t,"EmptyError",function(){return i});var r=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),i=r},function(e,t,n){"use strict";n.r(t),n.d(t,"TimeoutError",function(){return i});var r=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),i=r},function(e,t,n){"use strict";function r(e,t,n){if(t){if(!Object(f.isScheduler)(t))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r(e,n).apply(void 0,i).pipe(Object(c.map)(function(e){return Object(d.isArray)(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o,c=this,d={context:c,subject:o,callbackFunc:e,scheduler:n};return new s.Observable(function(r){if(n){var s={args:t,subscriber:r,params:d};return n.schedule(i,0,s)}if(!o){o=new a.AsyncSubject;var f=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.next(e.length<=1?e[0]:e),o.complete()};try{e.apply(c,t.concat([f]))}catch(l){Object(u.canReportError)(o)?o.error(l):console.warn(l)}}return o.subscribe(r)})}}function i(e){var t=this,n=e.args,r=e.subscriber,i=e.params,s=i.callbackFunc,c=i.context,u=i.scheduler,d=i.subject;if(!d){d=i.subject=new a.AsyncSubject;var f=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(u.schedule(o,0,{value:r,subject:d}))};try{s.apply(c,n.concat([f]))}catch(l){d.error(l)}}this.add(d.subscribe(r))}function o(e){var t=e.value,n=e.subject;n.next(t),n.complete()}n.r(t),n.d(t,"bindCallback",function(){return r});var s=n(161),a=n(202),c=n(218),u=n(162),d=n(170),f=n(197)},function(e,t,n){"use strict";function r(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new s(e,t))}}n.r(t),n.d(t,"map",function(){return r}),n.d(t,"MapOperator",function(){return s});var i=n(164),o=n(163),s=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.project,this.thisArg))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return i.__extends(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t,n){if(t){if(!Object(f.isScheduler)(t))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r(e,n).apply(void 0,i).pipe(Object(u.map)(function(e){return Object(l.isArray)(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new a.Observable(function(r){var s=o.context,a=o.subject;if(n)return n.schedule(i,0,{params:o,subscriber:r,context:s});if(!a){a=o.subject=new c.AsyncSubject;var u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();return n?void a.error(n):(a.next(e.length<=1?e[0]:e),void a.complete())};try{e.apply(s,t.concat([u]))}catch(f){Object(d.canReportError)(a)?a.error(f):console.warn(f)}}return a.subscribe(r)})}}function i(e){var t=this,n=e.params,r=e.subscriber,i=e.context,a=n.callbackFunc,u=n.args,d=n.scheduler,f=n.subject;if(!f){f=n.subject=new c.AsyncSubject;var l=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(d.schedule(s,0,{err:r,subject:f}));else{var i=e.length<=1?e[0]:e;t.add(d.schedule(o,0,{value:i,subject:f}))}};try{a.apply(i,u.concat([l]))}catch(p){this.add(d.schedule(s,0,{err:p,subject:f}))}}this.add(f.subscribe(r))}function o(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function s(e){var t=e.err,n=e.subject;n.error(t)}n.r(t),n.d(t,"bindNodeCallback",function(){return r});var a=n(161),c=n(202),u=n(218),d=n(162),f=n(197),l=n(170)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null,r=null;return Object(o.isScheduler)(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(s.isArray)(e[0])&&(e=e[0]),Object(u.fromArray)(e,r).lift(new f(n))}n.r(t),n.d(t,"combineLatest",function(){return r}),n.d(t,"CombineLatestOperator",function(){return f}),n.d(t,"CombineLatestSubscriber",function(){return l});var i=n(164),o=n(197),s=n(170),a=n(221),c=n(222),u=n(198),d={},f=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.resultSelector))},e}(),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return i.__extends(t,e),t.prototype._next=function(e){this.values.push(d),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(Object(c.subscribeToResult)(this,r,r,n))}}},t.prototype.notifyComplete=function(e){0===(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.values,s=o[n],a=this.toRespond?s===d?--this.toRespond:this.toRespond:0;o[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"OuterSubscriber",function(){return o});var r=n(164),i=n(163),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";function r(e,t,n,r,a){if(void 0===a&&(a=new i.InnerSubscriber(e,n,r)),!a.closed)return t instanceof s.Observable?t.subscribe(a):Object(o.subscribeTo)(t)(a)}n.r(t),n.d(t,"subscribeToResult",function(){return r});var i=n(223),o=n(224),s=n(161)},function(e,t,n){"use strict";n.r(t),n.d(t,"InnerSubscriber",function(){return o});var r=n(164),i=n(163),o=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.__extends(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeTo",function(){return l});var r=n(199),i=n(225),o=n(226),s=n(228),a=n(229),c=n(230),u=n(171),d=n(227),f=n(175),l=function(e){if(e&&"function"==typeof e[f.observable])return Object(s.subscribeToObservable)(e);if(Object(a.isArrayLike)(e))return Object(r.subscribeToArray)(e);if(Object(c.isPromise)(e))return Object(i.subscribeToPromise)(e);if(e&&"function"==typeof e[d.iterator])return Object(o.subscribeToIterable)(e);var t=Object(u.isObject)(e)?"an invalid object":"'"+e+"'",n="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToPromise",function(){return i});var r=n(168),i=function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,r.hostReportError),t}}},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToIterable",function(){return i});var r=n(227),i=function(e){return function(t){for(var n=e[r.iterator]();;){var i=n.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t}}},function(e,t,n){"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.r(t),n.d(t,"getSymbolIterator",function(){return r}),n.d(t,"iterator",function(){return i}),n.d(t,"$$iterator",function(){return o});var i=r(),o=i},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToObservable",function(){return i});var r=n(175),i=function(e){return function(t){var n=e[r.observable]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"isArrayLike",function(){return r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},function(e,t,n){"use strict";function r(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}n.r(t),n.d(t,"isPromise",function(){return r})},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(o.concatAll)()(i.of.apply(void 0,e))}n.r(t),n.d(t,"concat",function(){return r});var i=n(196),o=n(232)},function(e,t,n){"use strict";function r(){return Object(i.mergeAll)(1)}n.r(t),n.d(t,"concatAll",function(){return r});var i=n(233)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Object(i.mergeMap)(o.identity,e)}n.r(t),n.d(t,"mergeAll",function(){return r});var i=n(234),o=n(212)},function(e,t,n){"use strict";function r(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(i){return i.pipe(r(function(n,r){return Object(u.from)(e(n,r)).pipe(Object(c.map)(function(e,i){return t(n,e,r,i)}))},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new d(e,n))})}n.r(t),n.d(t,"mergeMap",function(){return r}),n.d(t,"MergeMapOperator",function(){return d}),n.d(t,"MergeMapSubscriber",function(){return f});var i=n(164),o=n(222),s=n(221),a=n(223),c=n(218),u=n(235),d=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.project,this.concurrent))},e}(),f=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return i.__extends(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new a.InnerSubscriber(this,void 0,void 0),i=this.destination;i.add(r),Object(o.subscribeToResult)(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return t?Object(s.scheduled)(e,t):e instanceof i.Observable?e:new i.Observable(Object(o.subscribeTo)(e))}n.r(t),n.d(t,"from",function(){return r});var i=n(161),o=n(224),s=n(236)},function(e,t,n){"use strict";function r(e,t){if(null!=e){if(Object(c.isInteropObservable)(e))return Object(i.scheduleObservable)(e,t);if(Object(u.isPromise)(e))return Object(o.schedulePromise)(e,t);if(Object(d.isArrayLike)(e))return Object(s.scheduleArray)(e,t);if(Object(f.isIterable)(e)||"string"==typeof e)return Object(a.scheduleIterable)(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}n.r(t),n.d(t,"scheduled",function(){return r});var i=n(237),o=n(238),s=n(200),a=n(239),c=n(240),u=n(230),d=n(229),f=n(241)},function(e,t,n){"use strict";function r(e,t){return new i.Observable(function(n){var r=new o.Subscription;return r.add(t.schedule(function(){var i=e[s.observable]();r.add(i.subscribe({next:function(e){r.add(t.schedule(function(){return n.next(e)}))},error:function(e){r.add(t.schedule(function(){return n.error(e)}))},complete:function(){r.add(t.schedule(function(){return n.complete();
}))}}))})),r})}n.r(t),n.d(t,"scheduleObservable",function(){return r});var i=n(161),o=n(169),s=n(175)},function(e,t,n){"use strict";function r(e,t){return new i.Observable(function(n){var r=new o.Subscription;return r.add(t.schedule(function(){return e.then(function(e){r.add(t.schedule(function(){n.next(e),r.add(t.schedule(function(){return n.complete()}))}))},function(e){r.add(t.schedule(function(){return n.error(e)}))})})),r})}n.r(t),n.d(t,"schedulePromise",function(){return r});var i=n(161),o=n(169)},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("Iterable cannot be null");return new i.Observable(function(n){var r,i=new o.Subscription;return i.add(function(){r&&"function"==typeof r.return&&r.return()}),i.add(t.schedule(function(){r=e[s.iterator](),i.add(t.schedule(function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(o){return void n.error(o)}t?n.complete():(n.next(e),this.schedule())}}))})),i})}n.r(t),n.d(t,"scheduleIterable",function(){return r});var i=n(161),o=n(169),s=n(227)},function(e,t,n){"use strict";function r(e){return e&&"function"==typeof e[i.observable]}n.r(t),n.d(t,"isInteropObservable",function(){return r});var i=n(175)},function(e,t,n){"use strict";function r(e){return e&&"function"==typeof e[i.iterator]}n.r(t),n.d(t,"isIterable",function(){return r});var i=n(227)},function(e,t,n){"use strict";function r(e){return new i.Observable(function(t){var n;try{n=e()}catch(r){return void t.error(r)}var i=n?Object(o.from)(n):Object(s.empty)();return i.subscribe(t)})}n.r(t),n.d(t,"defer",function(){return r});var i=n(161),o=n(235),s=n(195)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Object(s.isArray)(n))return i(n,null);if(Object(c.isObject)(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return i(r.map(function(e){return n[e]}),r)}}if("function"==typeof e[e.length-1]){var o=e.pop();return e=1===e.length&&Object(s.isArray)(e[0])?e[0]:e,i(e,null).pipe(Object(a.map)(function(e){return o.apply(void 0,e)}))}return i(e,null)}function i(e,t){return new o.Observable(function(n){var r=e.length;if(0===r)return void n.complete();for(var i=new Array(r),o=0,s=0,a=function(a){var c=Object(u.from)(e[a]),d=!1;n.add(c.subscribe({next:function(e){d||(d=!0,s++),i[a]=e},error:function(e){return n.error(e)},complete:function(){o++,o!==r&&d||(s===r&&n.next(t?t.reduce(function(e,t,n){return e[t]=i[n],e},{}):i),n.complete())}}))},c=0;c<r;c++)a(c)})}n.r(t),n.d(t,"forkJoin",function(){return r});var o=n(161),s=n(170),a=n(218),c=n(171),u=n(235)},function(e,t,n){"use strict";function r(e,t,n,o){return Object(d.isFunction)(n)&&(o=n,n=void 0),o?r(e,t,n).pipe(Object(f.map)(function(e){return Object(u.isArray)(e)?o.apply(void 0,e):o(e)})):new c.Observable(function(r){function o(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)}i(e,t,o,r,n)})}function i(e,t,n,r,c){var u;if(a(e)){var d=e;e.addEventListener(t,n,c),u=function(){return d.removeEventListener(t,n,c)}}else if(s(e)){var f=e;e.on(t,n),u=function(){return f.off(t,n)}}else if(o(e)){var l=e;e.addListener(t,n),u=function(){return l.removeListener(t,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var p=0,h=e.length;p<h;p++)i(e[p],t,n,r,c)}r.add(u)}function o(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}function s(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}function a(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}n.r(t),n.d(t,"fromEvent",function(){return r});var c=n(161),u=n(170),d=n(165),f=n(218);(function(){return Object.prototype.toString})()},function(e,t,n){"use strict";function r(e,t,n){return n?r(e,t).pipe(Object(a.map)(function(e){return Object(o.isArray)(e)?n.apply(void 0,e):n(e)})):new i.Observable(function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(o){return void n.error(o)}if(Object(s.isFunction)(t))return function(){return t(i,r)}})}n.r(t),n.d(t,"fromEventPattern",function(){return r});var i=n(161),o=n(170),s=n(165),a=n(218)},function(e,t,n){"use strict";function r(e,t,n,r,c){var u,d;if(1==arguments.length){var f=e;d=f.initialState,t=f.condition,n=f.iterate,u=f.resultSelector||s.identity,c=f.scheduler}else void 0===r||Object(a.isScheduler)(r)?(d=e,u=s.identity,c=r):(d=e,u=r);return new o.Observable(function(e){var r=d;if(c)return c.schedule(i,0,{subscriber:e,iterate:n,condition:t,resultSelector:u,state:r});for(;;){if(t){var o=void 0;try{o=t(r)}catch(s){return void e.error(s)}if(!o){e.complete();break}}var a=void 0;try{a=u(r)}catch(s){return void e.error(s)}if(e.next(a),e.closed)break;try{r=n(r)}catch(s){return void e.error(s)}}})}function i(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(r){return void t.error(r)}else e.needIterate=!0;if(n){var i=void 0;try{i=n(e.state)}catch(r){return void t.error(r)}if(!i)return void t.complete();if(t.closed)return}var o;try{o=e.resultSelector(e.state)}catch(r){return void t.error(r)}if(!t.closed&&(t.next(o),!t.closed))return this.schedule(e)}}n.r(t),n.d(t,"generate",function(){return r});var o=n(161),s=n(212),a=n(197)},function(e,t,n){"use strict";function r(e,t,n){return void 0===t&&(t=o.EMPTY),void 0===n&&(n=o.EMPTY),Object(i.defer)(function(){return e()?t:n})}n.r(t),n.d(t,"iif",function(){return r});var i=n(242),o=n(195)},function(e,t,n){"use strict";function r(e,t){return void 0===e&&(e=0),void 0===t&&(t=s.async),(!Object(a.isNumeric)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=s.async),new o.Observable(function(n){return n.add(t.schedule(i,e,{subscriber:n,counter:0,period:e})),n})}function i(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}n.r(t),n.d(t,"interval",function(){return r});var o=n(161),s=n(207),a=n(249)},function(e,t,n){"use strict";function r(e){return!Object(i.isArray)(e)&&e-parseFloat(e)+1>=0}n.r(t),n.d(t,"isNumeric",function(){return r});var i=n(170)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,r=null,c=e[e.length-1];return Object(o.isScheduler)(c)?(r=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof c&&(n=e.pop()),null===r&&1===e.length&&e[0]instanceof i.Observable?e[0]:Object(s.mergeAll)(n)(Object(a.fromArray)(e,r))}n.r(t),n.d(t,"merge",function(){return r});var i=n(161),o=n(197),s=n(233),a=n(198)},function(e,t,n){"use strict";function r(){return s}n.r(t),n.d(t,"NEVER",function(){return s}),n.d(t,"never",function(){return r});var i=n(161),o=n(177),s=new i.Observable(o.noop)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return a.EMPTY;var n=e[0],c=e.slice(1);return 1===e.length&&Object(s.isArray)(n)?r.apply(void 0,n):new i.Observable(function(e){var t=function(){return e.add(r.apply(void 0,c).subscribe(e))};return Object(o.from)(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})})}n.r(t),n.d(t,"onErrorResumeNext",function(){return r});var i=n(161),o=n(235),s=n(170),a=n(195)},function(e,t,n){"use strict";function r(e,t){return t?new o.Observable(function(n){var r=Object.keys(e),o=new s.Subscription;return o.add(t.schedule(i,0,{keys:r,index:0,subscriber:n,subscription:o,obj:e})),o}):new o.Observable(function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})}function i(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,o=e.obj;if(!r.closed)if(n<t.length){var s=t[n];r.next([s,o[s]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:o}))}else r.complete()}n.r(t),n.d(t,"pairs",function(){return r}),n.d(t,"dispatch",function(){return i});var o=n(161),s=n(169)},function(e,t,n){"use strict";function r(e,t,n){return[Object(s.filter)(t,n)(new a.Observable(Object(o.subscribeTo)(e))),Object(s.filter)(Object(i.not)(t,n))(new a.Observable(Object(o.subscribeTo)(e)))]}n.r(t),n.d(t,"partition",function(){return r});var i=n(255),o=n(224),s=n(256),a=n(161)},function(e,t,n){"use strict";function r(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}n.r(t),n.d(t,"not",function(){return r})},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new s(e,t))}}n.r(t),n.d(t,"filter",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.thisArg))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return i.__extends(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Object(o.isArray)(e[0]))return e[0];e=e[0]}return Object(s.fromArray)(e,void 0).lift(new u)}n.r(t),n.d(t,"race",function(){return r}),n.d(t,"RaceOperator",function(){return u}),n.d(t,"RaceSubscriber",function(){return d});var i=n(164),o=n(170),s=n(198),a=n(221),c=n(222),u=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new d(e))},e}(),d=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return i.__extends(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=e[n],i=Object(c.subscribeToResult)(this,r,r,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},t.prototype.notifyNext=function(e,t,n,r,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==n){var s=this.subscriptions[o];s.unsubscribe(),this.remove(s)}this.subscriptions=null}this.destination.next(t)},t}(a.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t,n){return void 0===e&&(e=0),new o.Observable(function(r){void 0===t&&(t=e,e=0);var o=0,s=e;if(n)return n.schedule(i,0,{index:o,count:t,start:e,subscriber:r});for(;;){if(o++>=t){r.complete();break}if(r.next(s++),r.closed)break}})}function i(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;return n>=r?void i.complete():(i.next(t),void(i.closed||(e.index=n+1,e.start=t+1,this.schedule(e))))}n.r(t),n.d(t,"range",function(){return r}),n.d(t,"dispatch",function(){return i});var o=n(161)},function(e,t,n){"use strict";function r(e,t,n){void 0===e&&(e=0);var r=-1;return Object(a.isNumeric)(t)?r=Number(t)<1&&1||Number(t):Object(c.isScheduler)(t)&&(n=t),Object(c.isScheduler)(n)||(n=s.async),new o.Observable(function(t){var o=Object(a.isNumeric)(e)?e:+e-n.now();return n.schedule(i,o,{index:0,period:r,subscriber:t})})}function i(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(n===-1)return r.complete();e.index=t+1,this.schedule(e,n)}}n.r(t),n.d(t,"timer",function(){return r});var o=n(161),s=n(207),a=n(249),c=n(197)},function(e,t,n){"use strict";function r(e,t){return new i.Observable(function(n){var r;try{r=e()}catch(i){return void n.error(i)}var a;try{a=t(r)}catch(i){return void n.error(i)}var c=a?Object(o.from)(a):s.EMPTY,u=c.subscribe(n);return function(){u.unsubscribe(),r&&r.unsubscribe()}})}n.r(t),n.d(t,"using",function(){return r});var i=n(161),o=n(235),s=n(195)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),Object(o.fromArray)(e,void 0).lift(new f(n))}n.r(t),n.d(t,"zip",function(){return r}),n.d(t,"ZipOperator",function(){return f}),n.d(t,"ZipSubscriber",function(){return l});var i=n(164),o=n(198),s=n(170),a=n(163),c=n(221),u=n(222),d=n(227),f=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.resultSelector))},e}(),l=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:null,i.values=r,i}return i.__extends(t,e),t.prototype._next=function(e){var t=this.iterators;Object(s.isArray)(e)?t.push(new h(e)):"function"==typeof e[d.iterator]?t.push(new p(e[d.iterator]())):t.push(new v(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)return void this.destination.complete();this.active=t;for(var n=0;n<t;n++){var r=e[n];if(r.stillUnsubscribed){var i=this.destination;i.add(r.subscribe(r,n))}else this.active--}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}for(var o=!1,s=[],r=0;r<t;r++){var i=e[r],a=i.next();if(i.hasCompleted()&&(o=!0),a.done)return void n.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),o&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(a.Subscriber),p=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),h=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[d.iterator]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),v=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return i.__extends(t,e),t.prototype[d.iterator]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this.buffer.push(t),this.parent.checkIterators()},t.prototype.subscribe=function(e,t){return Object(u.subscribeToResult)(this,this.observable,this,t)},t}(c.OuterSubscriber)},function(e,t,n){"use strict";n.r(t);var r=n(263);n.d(t,"audit",function(){return r.audit});var i=n(264);n.d(t,"auditTime",function(){return i.auditTime});var o=n(265);n.d(t,"buffer",function(){return o.buffer});var s=n(266);n.d(t,"bufferCount",function(){return s.bufferCount});var a=n(267);n.d(t,"bufferTime",function(){return a.bufferTime});var c=n(268);n.d(t,"bufferToggle",function(){return c.bufferToggle});var u=n(269);n.d(t,"bufferWhen",function(){return u.bufferWhen});var d=n(270);n.d(t,"catchError",function(){return d.catchError});var f=n(271);n.d(t,"combineAll",function(){return f.combineAll});var l=n(272);n.d(t,"combineLatest",function(){return l.combineLatest});var p=n(273);n.d(t,"concat",function(){return p.concat});var h=n(232);n.d(t,"concatAll",function(){return h.concatAll});var v=n(274);n.d(t,"concatMap",function(){return v.concatMap});var m=n(275);n.d(t,"concatMapTo",function(){return m.concatMapTo});var b=n(276);n.d(t,"count",function(){return b.count});var _=n(277);n.d(t,"debounce",function(){return _.debounce});var g=n(278);n.d(t,"debounceTime",function(){return g.debounceTime});var y=n(279);n.d(t,"defaultIfEmpty",function(){return y.defaultIfEmpty});var S=n(280);n.d(t,"delay",function(){return S.delay});var w=n(282);n.d(t,"delayWhen",function(){return w.delayWhen});var x=n(283);n.d(t,"dematerialize",function(){return x.dematerialize});var C=n(284);n.d(t,"distinct",function(){return C.distinct});var I=n(285);n.d(t,"distinctUntilChanged",function(){return I.distinctUntilChanged});var T=n(286);n.d(t,"distinctUntilKeyChanged",function(){return T.distinctUntilKeyChanged});var E=n(287);n.d(t,"elementAt",function(){return E.elementAt});var R=n(290);n.d(t,"endWith",function(){return R.endWith});var k=n(291);n.d(t,"every",function(){return k.every});var M=n(292);n.d(t,"exhaust",function(){return M.exhaust});var O=n(293);n.d(t,"exhaustMap",function(){return O.exhaustMap});var A=n(294);n.d(t,"expand",function(){return A.expand});var P=n(256);n.d(t,"filter",function(){return P.filter});var j=n(295);n.d(t,"finalize",function(){return j.finalize});var N=n(296);n.d(t,"find",function(){return N.find});var D=n(297);n.d(t,"findIndex",function(){return D.findIndex});var L=n(298);n.d(t,"first",function(){return L.first});var V=n(183);n.d(t,"groupBy",function(){return V.groupBy});var F=n(299);n.d(t,"ignoreElements",function(){return F.ignoreElements});var U=n(300);n.d(t,"isEmpty",function(){return U.isEmpty});var W=n(301);n.d(t,"last",function(){return W.last});var B=n(218);n.d(t,"map",function(){return B.map});var q=n(303);n.d(t,"mapTo",function(){return q.mapTo});var G=n(304);n.d(t,"materialize",function(){return G.materialize});var z=n(305);n.d(t,"max",function(){return z.max});var H=n(308);n.d(t,"merge",function(){return H.merge});var Y=n(233);n.d(t,"mergeAll",function(){return Y.mergeAll});var K=n(234);n.d(t,"mergeMap",function(){return K.mergeMap}),n.d(t,"flatMap",function(){return K.mergeMap});var X=n(309);n.d(t,"mergeMapTo",function(){return X.mergeMapTo});var J=n(310);n.d(t,"mergeScan",function(){return J.mergeScan});var $=n(311);n.d(t,"min",function(){return $.min});var Z=n(312);n.d(t,"multicast",function(){return Z.multicast});var Q=n(193);n.d(t,"observeOn",function(){return Q.observeOn});var ee=n(313);n.d(t,"onErrorResumeNext",function(){return ee.onErrorResumeNext});var te=n(314);n.d(t,"pairwise",function(){return te.pairwise});var ne=n(315);n.d(t,"partition",function(){return ne.partition});var re=n(316);n.d(t,"pluck",function(){return re.pluck});var ie=n(317);n.d(t,"publish",function(){return ie.publish});var oe=n(318);n.d(t,"publishBehavior",function(){return oe.publishBehavior});var se=n(319);n.d(t,"publishLast",function(){return se.publishLast});var ae=n(320);n.d(t,"publishReplay",function(){return ae.publishReplay});var ce=n(321);n.d(t,"race",function(){return ce.race});var ue=n(306);n.d(t,"reduce",function(){return ue.reduce});var de=n(322);n.d(t,"repeat",function(){return de.repeat});var fe=n(323);n.d(t,"repeatWhen",function(){return fe.repeatWhen});var le=n(324);n.d(t,"retry",function(){return le.retry});var pe=n(325);n.d(t,"retryWhen",function(){return pe.retryWhen});var he=n(182);n.d(t,"refCount",function(){return he.refCount});var ve=n(326);n.d(t,"sample",function(){return ve.sample});var me=n(327);n.d(t,"sampleTime",function(){return me.sampleTime});var be=n(307);n.d(t,"scan",function(){return be.scan});var _e=n(328);n.d(t,"sequenceEqual",function(){return _e.sequenceEqual});var ge=n(329);n.d(t,"share",function(){return ge.share});var ye=n(330);n.d(t,"shareReplay",function(){return ye.shareReplay});var Se=n(331);n.d(t,"single",function(){return Se.single});var we=n(332);n.d(t,"skip",function(){return we.skip});var xe=n(333);n.d(t,"skipLast",function(){return xe.skipLast});var Ce=n(334);n.d(t,"skipUntil",function(){return Ce.skipUntil});var Ie=n(335);n.d(t,"skipWhile",function(){return Ie.skipWhile});var Te=n(336);n.d(t,"startWith",function(){return Te.startWith});var Ee=n(337);n.d(t,"subscribeOn",function(){return Ee.subscribeOn});var Re=n(339);n.d(t,"switchAll",function(){return Re.switchAll});var ke=n(340);n.d(t,"switchMap",function(){return ke.switchMap});var Me=n(341);n.d(t,"switchMapTo",function(){return Me.switchMapTo});var Oe=n(289);n.d(t,"take",function(){return Oe.take});var Ae=n(302);n.d(t,"takeLast",function(){return Ae.takeLast});var Pe=n(342);n.d(t,"takeUntil",function(){return Pe.takeUntil});var je=n(343);n.d(t,"takeWhile",function(){return je.takeWhile});var Ne=n(344);n.d(t,"tap",function(){return Ne.tap});var De=n(345);n.d(t,"throttle",function(){return De.throttle});var Le=n(346);n.d(t,"throttleTime",function(){return Le.throttleTime});var Ve=n(288);n.d(t,"throwIfEmpty",function(){return Ve.throwIfEmpty});var Fe=n(347);n.d(t,"timeInterval",function(){return Fe.timeInterval});var Ue=n(348);n.d(t,"timeout",function(){return Ue.timeout});var We=n(349);n.d(t,"timeoutWith",function(){return We.timeoutWith});var Be=n(350);n.d(t,"timestamp",function(){return Be.timestamp});var qe=n(351);n.d(t,"toArray",function(){return qe.toArray});var Ge=n(352);n.d(t,"window",function(){return Ge.window});var ze=n(353);n.d(t,"windowCount",function(){return ze.windowCount});var He=n(354);n.d(t,"windowTime",function(){return He.windowTime});var Ye=n(355);n.d(t,"windowToggle",function(){return Ye.windowToggle});var Ke=n(356);n.d(t,"windowWhen",function(){return Ke.windowWhen});var Xe=n(357);n.d(t,"withLatestFrom",function(){return Xe.withLatestFrom});var Je=n(358);n.d(t,"zip",function(){return Je.zip});var $e=n(359);n.d(t,"zipAll",function(){return $e.zipAll})},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"audit",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.durationSelector))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return i.__extends(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=void 0;try{var n=this.durationSelector;t=n(e)}catch(r){return this.destination.error(r)}var i=Object(s.subscribeToResult)(this,t);!i||i.closed?this.clearThrottle():this.add(this.throttled=i)}},t.prototype.clearThrottle=function(){var e=this,t=e.value,n=e.hasValue,r=e.throttled;r&&(this.remove(r),this.throttled=null,r.unsubscribe()),n&&(this.value=null,this.hasValue=!1,this.destination.next(t))},t.prototype.notifyNext=function(e,t,n,r){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=i.async),Object(o.audit)(function(){return Object(s.timer)(e,t)})}n.r(t),n.d(t,"auditTime",function(){return r});var i=n(207),o=n(263),s=n(259)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"buffer",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.closingNotifier))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add(Object(s.subscribeToResult)(r,n)),r}return i.__extends(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=null),function(n){return n.lift(new s(e,t))}}n.r(t),n.d(t,"bufferCount",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,t&&e!==t?this.subscriberClass=c:this.subscriberClass=a}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return i.__extends(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(o.Subscriber),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return i.__extends(t,e),t.prototype._next=function(e){var t=this,n=t.bufferSize,r=t.startBufferEvery,i=t.buffers,o=t.count;this.count++,o%r===0&&i.push([]);for(var s=i.length;s--;){var a=i[s];a.push(e),a.length===n&&(i.splice(s,1),this.destination.next(a))}},t.prototype._complete=function(){for(var t=this,n=t.buffers,r=t.destination;n.length>0;){var i=n.shift();i.length>0&&r.next(i)}e.prototype._complete.call(this)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){var t=arguments.length,n=c.async;Object(d.isScheduler)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new f(e,r,i,n))}}function i(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function o(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext(),a=this;r.closed||(r.add(o.closeAction=i.schedule(s,n,{subscriber:r,context:o})),a.schedule(e,t))}function s(e){var t=e.subscriber,n=e.context;t.closeContext(n)}n.r(t),n.d(t,"bufferTime",function(){return r});var a=n(164),c=n(207),u=n(163),d=n(197),f=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new p(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),l=function(){function e(){this.buffer=[]}return e}(),p=function(e){function t(t,n,r,a,c){var u=e.call(this,t)||this;u.bufferTimeSpan=n,u.bufferCreationInterval=r,u.maxBufferSize=a,u.scheduler=c,u.contexts=[];var d=u.openContext();if(u.timespanOnly=null==r||r<0,u.timespanOnly){var f={subscriber:u,context:d,bufferTimeSpan:n};u.add(d.closeAction=c.schedule(i,n,f))}else{var l={subscriber:u,context:d},p={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:u,scheduler:c};u.add(d.closeAction=c.schedule(s,n,l)),u.add(c.schedule(o,r,p))}return u}return a.__extends(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(e),s.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this,n=t.contexts,r=t.destination;n.length>0;){var i=n.shift();r.next(i.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(i,n,r))}},t.prototype.openContext=function(){var e=new l;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts,n=t?t.indexOf(e):-1;n>=0&&t.splice(t.indexOf(e),1)},t}(u.Subscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new c(e,t))}}n.r(t),n.d(t,"bufferToggle",function(){return r});var i=n(164),o=n(169),s=n(222),a=n(221),c=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.openings,this.closingSelector))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(Object(s.subscribeToResult)(i,n)),i}return i.__extends(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector,n=t.call(this,e);n&&this.trySubscribe(n)}catch(r){this._error(r)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=[],r=new o.Subscription,i={buffer:n,subscription:r};t.push(i);var a=Object(s.subscribeToResult)(this,e,i);!a||a.closed?this.closeBuffer(i):(a.context=i,this.add(a),r.add(a))},t}(a.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new c(e))}}n.r(t),n.d(t,"bufferWhen",function(){return r});var i=n(164),o=n(169),s=n(221),a=n(222),c=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.closingSelector))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return i.__extends(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},t.prototype.notifyNext=function(e,t,n,r,i){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t=this.buffer;this.buffer&&this.destination.next(t),this.buffer=[];var n;try{var r=this.closingSelector;n=r()}catch(i){return this.error(i)}e=new o.Subscription,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(Object(a.subscribeToResult)(this,n)),this.subscribing=!1},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){var n=new c(e),r=t.lift(n);return n.caught=r}}n.r(t),n.d(t,"catchError",function(){return r});var i=n(164),o=n(221),s=n(223),a=n(222),c=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.selector,this.caught))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return i.__extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(r){return void e.prototype.error.call(this,r)}this._unsubscribeAndRecycle();var i=new s.InnerSubscriber(this,void 0,void 0);this.add(i),Object(a.subscribeToResult)(this,n,void 0,void 0,i)}},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new i.CombineLatestOperator(e))}}n.r(t),n.d(t,"combineAll",function(){return r});var i=n(220)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(i.isArray)(e[0])&&(e=e[0].slice()),function(t){
return t.lift.call(Object(s.from)([t].concat(e)),new o.CombineLatestOperator(n))}}n.r(t),n.d(t,"combineLatest",function(){return r});var i=n(170),o=n(220),s=n(235)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(i.concat.apply(void 0,[t].concat(e)))}}n.r(t),n.d(t,"concat",function(){return r});var i=n(231)},function(e,t,n){"use strict";function r(e,t){return Object(i.mergeMap)(e,t,1)}n.r(t),n.d(t,"concatMap",function(){return r});var i=n(234)},function(e,t,n){"use strict";function r(e,t){return Object(i.concatMap)(function(){return e},t)}n.r(t),n.d(t,"concatMapTo",function(){return r});var i=n(274)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new s(e,t))}}n.r(t),n.d(t,"count",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.source))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return i.__extends(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"debounce",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.durationSelector))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r.durationSubscription=null,r}return i.__extends(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),n=Object(s.subscribeToResult)(this,t),n&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=a.async),function(n){return n.lift(new c(e,t))}}function i(e){e.debouncedNext()}n.r(t),n.d(t,"debounceTime",function(){return r});var o=n(164),s=n(163),a=n(207),c=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.dueTime,this.scheduler))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return o.__extends(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(i,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(s.Subscriber)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=null),function(t){return t.lift(new s(e))}}n.r(t),n.d(t,"defaultIfEmpty",function(){return r});var i=n(164),o=n(163),s=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.defaultValue))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return i.__extends(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){void 0===t&&(t=o.async);var n=Object(s.isDate)(e),r=n?+e-t.now():Math.abs(e);return function(e){return e.lift(new u(r,t))}}n.r(t),n.d(t,"delay",function(){return r});var i=n(164),o=n(207),s=n(281),a=n(163),c=n(194),u=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.delay,this.scheduler))},e}(),d=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return i.__extends(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0;var n=this.destination;n.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(this.errored!==!0){var t=this.scheduler,n=new f(t.now()+this.delay,e);this.queue.push(n),this.active===!1&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(c.Notification.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(c.Notification.createComplete()),this.unsubscribe()},t}(a.Subscriber),f=function(){function e(e,t){this.time=e,this.notification=t}return e}()},function(e,t,n){"use strict";function r(e){return e instanceof Date&&!isNaN(+e)}n.r(t),n.d(t,"isDate",function(){return r})},function(e,t,n){"use strict";function r(e,t){return t?function(n){return new f(n,t).lift(new u(e))}:function(t){return t.lift(new u(e))}}n.r(t),n.d(t,"delayWhen",function(){return r});var i=n(164),o=n(163),s=n(161),a=n(221),c=n(222),u=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.delayDurationSelector))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(r){this.destination.error(r)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return t!==-1&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=Object(c.subscribeToResult)(this,e,t);if(n&&!n.closed){var r=this.destination;r.add(n),this.delayNotifierSubscriptions.push(n)}},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(a.OuterSubscriber),f=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return i.__extends(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new l(e,this.source))},t}(s.Observable),l=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return i.__extends(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new s)}}n.r(t),n.d(t,"dematerialize",function(){return r});var i=n(164),o=n(163),s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(t){return e.call(this,t)||this}return i.__extends(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new a(e,t))}}n.r(t),n.d(t,"distinct",function(){return r}),n.d(t,"DistinctSubscriber",function(){return c});var i=n(164),o=n(221),s=n(222),a=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.keySelector,this.flushes))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=n,i.values=new Set,r&&i.add(Object(s.subscribeToResult)(i,r)),i}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values.clear()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(r){return void n.error(r)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new s(e,t))}}n.r(t),n.d(t,"distinctUntilChanged",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.compare,this.keySelector))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return i.__extends(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(r){return this.destination.error(r)}var i=!1;if(this.hasKey)try{var o=this.compare;i=o(this.key,t)}catch(r){return this.destination.error(r)}else this.hasKey=!0;i||(this.key=t,this.destination.next(e))},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){return Object(i.distinctUntilChanged)(function(n,r){return t?t(n[e],r[e]):n[e]===r[e]})}n.r(t),n.d(t,"distinctUntilKeyChanged",function(){return r});var i=n(285)},function(e,t,n){"use strict";function r(e,t){if(e<0)throw new i.ArgumentOutOfRangeError;var n=arguments.length>=2;return function(r){return r.pipe(Object(o.filter)(function(t,n){return n===e}),Object(c.take)(1),n?Object(a.defaultIfEmpty)(t):Object(s.throwIfEmpty)(function(){return new i.ArgumentOutOfRangeError}))}}n.r(t),n.d(t,"elementAt",function(){return r});var i=n(214),o=n(256),s=n(288),a=n(279),c=n(289)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=i),function(t){return t.lift(new c(e))}}function i(){return new s.EmptyError}n.r(t),n.d(t,"throwIfEmpty",function(){return r});var o=n(164),s=n(215),a=n(163),c=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.errorFactory))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return o.__extends(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(a.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return 0===e?Object(a.empty)():t.lift(new c(e))}}n.r(t),n.d(t,"take",function(){return r});var i=n(164),o=n(163),s=n(214),a=n(195),c=function(){function e(e){if(this.total=e,this.total<0)throw new s.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return i.__extends(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return Object(i.concat)(t,o.of.apply(void 0,e))}}n.r(t),n.d(t,"endWith",function(){return r});var i=n(231),o=n(196)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new s(e,t,n))}}n.r(t),n.d(t,"every",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.thisArg,this.source))},e}(),a=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}return i.__extends(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new a)}}n.r(t),n.d(t,"exhaust",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new c(e))},e}(),c=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return i.__extends(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(Object(s.subscribeToResult)(this,e)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return t?function(n){return n.pipe(r(function(n,r){return Object(u.from)(e(n,r)).pipe(Object(c.map)(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new d(e))}}n.r(t),n.d(t,"exhaustMap",function(){return r});var i=n(164),o=n(221),s=n(223),a=n(222),c=n(218),u=n(235),d=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.project))},e}(),f=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return i.__extends(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.hasSubscription=!0,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new s.InnerSubscriber(this,void 0,void 0),i=this.destination;i.add(r),Object(a.subscribeToResult)(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){var t=this.destination;t.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new a(e,t,n))}}n.r(t),n.d(t,"expand",function(){return r}),n.d(t,"ExpandOperator",function(){return a}),n.d(t,"ExpandSubscriber",function(){return c});var i=n(164),o=n(221),s=n(222),a=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.project,this.concurrent,this.scheduler))},e}(),c=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}return i.__extends(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)return void this._complete();var r=this.index++;if(this.active<this.concurrent){n.next(e);try{var i=this.project,o=i(e,r);if(this.scheduler){var s={subscriber:this,result:o,value:e,index:r},a=this.destination;a.add(this.scheduler.schedule(t.dispatch,0,s))}else this.subscribeToProjection(o,e,r)}catch(c){n.error(c)}}else this.buffer.push(e)},t.prototype.subscribeToProjection=function(e,t,n){this.active++;var r=this.destination;r.add(Object(s.subscribeToResult)(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this._next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer,n=this.destination;n.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"finalize",function(){return r});var i=n(164),o=n(163),s=n(169),a=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.callback))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new s.Subscription(n)),r}return i.__extends(t,e),t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new s(e,n,!1,t))}}n.r(t),n.d(t,"find",function(){return r}),n.d(t,"FindValueOperator",function(){return s}),n.d(t,"FindValueSubscriber",function(){return a});var i=n(164),o=n(163),s=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),a=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=o,s.index=0,s}return i.__extends(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this,n=t.predicate,r=t.thisArg,i=this.index++;try{var o=n.call(r||this,e,i,this.source);o&&this.notifyComplete(this.yieldIndex?i:e)}catch(s){this.destination.error(s)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new i.FindValueOperator(e,n,!0,t))}}n.r(t),n.d(t,"findIndex",function(){return r});var i=n(296)},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Object(o.filter)(function(t,n){return e(t,n,r)}):u.identity,Object(s.take)(1),n?Object(a.defaultIfEmpty)(t):Object(c.throwIfEmpty)(function(){return new i.EmptyError}))}}n.r(t),n.d(t,"first",function(){return r});var i=n(215),o=n(256),s=n(289),a=n(279),c=n(288),u=n(212)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new s)}}n.r(t),n.d(t,"ignoreElements",function(){return r});var i=n(164),o=n(163),s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t.prototype._next=function(e){},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new s)}}n.r(t),n.d(t,"isEmpty",function(){return r});var i=n(164),o=n(163),s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(t){return e.call(this,t)||this}return i.__extends(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Object(o.filter)(function(t,n){return e(t,n,r)}):u.identity,Object(s.takeLast)(1),n?Object(c.defaultIfEmpty)(t):Object(a.throwIfEmpty)(function(){return new i.EmptyError}))}}n.r(t),n.d(t,"last",function(){return r});var i=n(215),o=n(256),s=n(302),a=n(288),c=n(279),u=n(212)},function(e,t,n){"use strict";function r(e){return function(t){return 0===e?Object(a.empty)():t.lift(new c(e))}}n.r(t),n.d(t,"takeLast",function(){return r});var i=n(164),o=n(163),s=n(214),a=n(195),c=function(){function e(e){if(this.total=e,this.total<0)throw new s.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return i.__extends(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;if(t.length<n)t.push(e);else{var i=r%n;t[i]=e}},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new s(e))}}n.r(t),n.d(t,"mapTo",function(){return r});var i=n(164),o=n(163),s=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.value))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return i.__extends(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new a)}}n.r(t),n.d(t,"materialize",function(){return r});var i=n(164),o=n(163),s=n(194),a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new c(e))},e}(),c=function(e){function t(t){return e.call(this,t)||this}return i.__extends(t,e),t.prototype._next=function(e){this.destination.next(s.Notification.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(s.Notification.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(s.Notification.createComplete()),e.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){var t="function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t};return Object(i.reduce)(t)}n.r(t),n.d(t,"max",function(){return r});var i=n(306)},function(e,t,n){"use strict";function r(e,t){return arguments.length>=2?function(n){return Object(a.pipe)(Object(i.scan)(e,t),Object(o.takeLast)(1),Object(s.defaultIfEmpty)(t))(n)}:function(t){return Object(a.pipe)(Object(i.scan)(function(t,n,r){return e(t,n,r+1)}),Object(o.takeLast)(1))(t)}}n.r(t),n.d(t,"reduce",function(){return r});var i=n(307),o=n(302),s=n(279),a=n(176)},function(e,t,n){"use strict";function r(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new s(e,t,n))}}n.r(t),n.d(t,"scan",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.accumulator,this.seed,this.hasSeed))},e}(),a=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return i.__extends(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){return this.hasSeed?this._tryNext(e):(this.seed=e,void this.destination.next(e))},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(i.merge.apply(void 0,[t].concat(e)))}}n.r(t),n.d(t,"merge",function(){return r});var i=n(250)},function(e,t,n){"use strict";function r(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?Object(i.mergeMap)(function(){return e},t,n):("number"==typeof t&&(n=t),Object(i.mergeMap)(function(){return e},n))}n.r(t),n.d(t,"mergeMapTo",function(){return r});var i=n(234)},function(e,t,n){"use strict";function r(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new c(e,t,n))}}n.r(t),n.d(t,"mergeScan",function(){return r}),n.d(t,"MergeScanOperator",function(){return c}),n.d(t,"MergeScanSubscriber",function(){return u});var i=n(164),o=n(222),s=n(221),a=n(223),c=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.accumulator,this.seed,this.concurrent))},e}(),u=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return i.__extends(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=this.destination,r=void 0;try{var i=this.accumulator;r=i(this.acc,e,t)}catch(o){return n.error(o)}this.active++,this._innerSub(r,e,t)}else this.buffer.push(e)},t.prototype._innerSub=function(e,t,n){var r=new a.InnerSubscriber(this,void 0,void 0),i=this.destination;i.add(r),Object(o.subscribeToResult)(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(this.hasValue===!1&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.destination;this.acc=t,this.hasValue=!0,o.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer,n=this.destination;n.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(this.hasValue===!1&&this.destination.next(this.acc),this.destination.complete())},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(e){var t="function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t};return Object(i.reduce)(t)}n.r(t),n.d(t,"min",function(){return r});var i=n(306)},function(e,t,n){"use strict";function r(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new o(r,t));var s=Object.create(n,i.connectableObservableDescriptor);return s.source=n,s.subjectFactory=r,s}}n.r(t),n.d(t,"multicast",function(){return r}),n.d(t,"MulticastOperator",function(){return o});var i=n(178),o=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}()},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&Object(a.isArray)(e[0])&&(e=e[0]),function(t){return t.lift(new f(e))}}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return 1===e.length&&Object(a.isArray)(e[0])&&(e=e[0]),n=e.shift(),Object(s.from)(n,null).lift(new f(e))}n.r(t),n.d(t,"onErrorResumeNext",function(){return r}),n.d(t,"onErrorResumeNextStatic",function(){return i});var o=n(164),s=n(235),a=n(170),c=n(221),u=n(223),d=n(222),f=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.nextSources))},e}(),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return o.__extends(t,e),t.prototype.notifyError=function(e,t){this.subscribeToNextSource()},t.prototype.notifyComplete=function(e){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new u.InnerSubscriber(this,void 0,void 0),n=this.destination;n.add(t),Object(d.subscribeToResult)(this,e,void 0,void 0,t)}else this.destination.complete()},t}(c.OuterSubscriber)},function(e,t,n){"use strict";function r(){return function(e){return e.lift(new s)}}n.r(t),n.d(t,"pairwise",function(){return r});var i=n(164),o=n(163),s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return i.__extends(t,e),t.prototype._next=function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return[Object(o.filter)(e,t)(n),Object(o.filter)(Object(i.not)(e,t))(n)]}}n.r(t),n.d(t,"partition",function(){return r});var i=n(255),o=n(256)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return Object(o.map)(i(e,n))(t)}}function i(e,t){var n=function(n){for(var r=n,i=0;i<t;i++){var o=r[e[i]];if("undefined"==typeof o)return;r=o}return r};return n}n.r(t),n.d(t,"pluck",function(){return r});var o=n(218)},function(e,t,n){"use strict";function r(e){return e?Object(o.multicast)(function(){return new i.Subject},e):Object(o.multicast)(new i.Subject)}n.r(t),n.d(t,"publish",function(){return r});var i=n(179),o=n(312)},function(e,t,n){"use strict";function r(e){return function(t){return Object(o.multicast)(new i.BehaviorSubject(e))(t)}}n.r(t),n.d(t,"publishBehavior",function(){return r});var i=n(184),o=n(312)},function(e,t,n){"use strict";function r(){return function(e){return Object(o.multicast)(new i.AsyncSubject)(e)}}n.r(t),n.d(t,"publishLast",function(){return r});var i=n(202),o=n(312)},function(e,t,n){"use strict";function r(e,t,n,r){n&&"function"!=typeof n&&(r=n);var s="function"==typeof n?n:void 0,a=new i.ReplaySubject(e,t,r);return function(e){return Object(o.multicast)(function(){return a},s)(e)}}n.r(t),n.d(t,"publishReplay",function(){return r});var i=n(185),o=n(312)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&Object(i.isArray)(e[0])&&(e=e[0]),t.lift.call(o.race.apply(void 0,[t].concat(e)))}}n.r(t),n.d(t,"race",function(){return r});var i=n(170),o=n(257)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=-1),function(t){return 0===e?Object(s.empty)():e<0?t.lift(new a(-1,t)):t.lift(new a(e-1,t))}}n.r(t),n.d(t,"repeat",function(){return r});var i=n(164),o=n(163),s=n(195),a=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.count,this.source));
},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return i.__extends(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this,n=t.source,r=t.count;if(0===r)return e.prototype.complete.call(this);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new c(e))}}n.r(t),n.d(t,"repeatWhen",function(){return r});var i=n(164),o=n(179),s=n(221),a=n(222),c=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.notifier,t))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(t){if(this.sourceIsBeingSubscribedTo===!1)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},t.prototype._unsubscribe=function(){var e=this,t=e.notifications,n=e.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),n&&(n.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){this.notifications=new o.Subject;var t;try{var n=this.notifier;t=n(this.notifications)}catch(r){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=Object(a.subscribeToResult)(this,t)},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=-1),function(t){return t.lift(new s(e,t))}}n.r(t),n.d(t,"retry",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.count,this.source))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return i.__extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this,r=n.source,i=n.count;if(0===i)return e.prototype.error.call(this,t);i>-1&&(this.count=i-1),r.subscribe(this._unsubscribeAndRecycle())}},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new c(e,t))}}n.r(t),n.d(t,"retryWhen",function(){return r});var i=n(164),o=n(179),s=n(221),a=n(222),c=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.notifier,this.source))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return i.__extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{n=new o.Subject;try{var s=this.notifier;r=s(n)}catch(c){return e.prototype.error.call(this,c)}i=Object(a.subscribeToResult)(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this,t=e.errors,n=e.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),n&&(n.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,n,r,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"sample",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new c(e),r=t.subscribe(n);return r.add(Object(s.subscribeToResult)(n,this.notifier)),r},e}(),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return i.__extends(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=a.async),function(n){return n.lift(new c(e,t))}}function i(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}n.r(t),n.d(t,"sampleTime",function(){return r});var o=n(164),s=n(163),a=n(207),c=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.period,this.scheduler))},e}(),u=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.period=n,o.scheduler=r,o.hasValue=!1,o.add(r.schedule(i,n,{subscriber:o,period:n})),o}return o.__extends(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(s.Subscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new s(e,t))}}n.r(t),n.d(t,"sequenceEqual",function(){return r}),n.d(t,"SequenceEqualOperator",function(){return s}),n.d(t,"SequenceEqualSubscriber",function(){return a});var i=n(164),o=n(163),s=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.compareTo,this.comparator))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new c(t,i))),i}return i.__extends(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this,t=e._a,n=e._b,r=e.comparator;t.length>0&&n.length>0;){var i=t.shift(),o=n.shift(),s=!1;try{s=r?r(i,o):i===o}catch(a){this.destination.error(a)}s||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t}(o.Subscriber),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return i.__extends(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){return new a.Subject}function i(){return function(e){return Object(s.refCount)()(Object(o.multicast)(r)(e))}}n.r(t),n.d(t,"share",function(){return i});var o=n(312),s=n(182),a=n(179)},function(e,t,n){"use strict";function r(e,t,n){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},function(e){return e.lift(i(r))}}function i(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,s=e.windowTime,a=void 0===s?Number.POSITIVE_INFINITY:s,c=e.refCount,u=e.scheduler,d=0,f=!1,l=!1;return function(e){d++,t&&!f||(f=!1,t=new o.ReplaySubject(i,a,u),n=e.subscribe({next:function(e){t.next(e)},error:function(e){f=!0,t.error(e)},complete:function(){l=!0,t.complete()}}));var r=t.subscribe(this);this.add(function(){d--,r.unsubscribe(),n&&!l&&c&&0===d&&(n.unsubscribe(),n=void 0,t=void 0)})}}n.r(t),n.d(t,"shareReplay",function(){return r});var o=n(185)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e,t))}}n.r(t),n.d(t,"single",function(){return r});var i=n(164),o=n(163),s=n(215),a=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.predicate,this.source))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return i.__extends(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new s.EmptyError)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new s(e))}}n.r(t),n.d(t,"skip",function(){return r});var i=n(164),o=n(163),s=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.total))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return i.__extends(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"skipLast",function(){return r});var i=n(164),o=n(163),s=n(214),a=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new s.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new o.Subscriber(e)):t.subscribe(new c(e,this._skipCount))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return i.__extends(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,o=i[r];i[r]=e,this.destination.next(o)}},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new c(e))}}n.r(t),n.d(t,"skipUntil",function(){return r});var i=n(164),o=n(221),s=n(223),a=n(222),c=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.notifier))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var i=new s.InnerSubscriber(r,void 0,void 0);return r.add(i),r.innerSubscription=i,Object(a.subscribeToResult)(r,n,void 0,void 0,i),r}return i.__extends(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(e,t,n,r,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new s(e))}}n.r(t),n.d(t,"skipWhile",function(){return r});var i=n(164),o=n(163),s=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return i.__extends(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(n){this.destination.error(n)}},t}(o.Subscriber)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Object(o.isScheduler)(n)?(e.pop(),function(t){return Object(i.concat)(e,t,n)}):function(t){return Object(i.concat)(e,t)}}n.r(t),n.d(t,"startWith",function(){return r});var i=n(231),o=n(197)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=0),function(n){return n.lift(new o(e,t))}}n.r(t),n.d(t,"subscribeOn",function(){return r});var i=n(338),o=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new i.SubscribeOnObservable(t,this.delay,this.scheduler).subscribe(e)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"SubscribeOnObservable",function(){return a});var r=n(164),i=n(161),o=n(203),s=n(249),a=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=o.asap);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!Object(s.isNumeric)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=o.asap),i}return r.__extends(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=o.asap),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source,i=this.scheduler;return i.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(i.Observable)},function(e,t,n){"use strict";function r(){return Object(i.switchMap)(o.identity)}n.r(t),n.d(t,"switchAll",function(){return r});var i=n(340),o=n(212)},function(e,t,n){"use strict";function r(e,t){return"function"==typeof t?function(n){return n.pipe(r(function(n,r){return Object(u.from)(e(n,r)).pipe(Object(c.map)(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new d(e))}}n.r(t),n.d(t,"switchMap",function(){return r});var i=n(164),o=n(221),s=n(223),a=n(222),c=n(218),u=n(235),d=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.project))},e}(),f=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return i.__extends(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new s.InnerSubscriber(this,void 0,void 0),o=this.destination;o.add(i),this.innerSubscription=Object(a.subscribeToResult)(this,e,t,n,i)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){var n=this.destination;n.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return t?Object(i.switchMap)(function(){return e},t):Object(i.switchMap)(function(){return e})}n.r(t),n.d(t,"switchMapTo",function(){return r});var i=n(340)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new a(e))}}n.r(t),n.d(t,"takeUntil",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new c(e),r=Object(s.subscribeToResult)(n,this.notifier);return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),c=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new s(e,t))}}n.r(t),n.d(t,"takeWhile",function(){return r});var i=n(164),o=n(163),s=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.inclusive))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return i.__extends(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(r){return void n.error(r)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t,n){return function(r){return r.lift(new c(e,t,n))}}n.r(t),n.d(t,"tap",function(){return r});var i=n(164),o=n(163),s=n(177),a=n(165),c=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.nextOrObserver,this.error,this.complete))},e}(),u=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o._tapNext=s.noop,o._tapError=s.noop,o._tapComplete=s.noop,o._tapError=r||s.noop,o._tapComplete=i||s.noop,Object(a.isFunction)(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||s.noop,o._tapError=n.error||s.noop,o._tapComplete=n.complete||s.noop),o}return i.__extends(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=a),function(n){return n.lift(new c(e,t.leading,t.trailing))}}n.r(t),n.d(t,"defaultThrottleConfig",function(){return a}),n.d(t,"throttle",function(){return r});var i=n(164),o=n(221),s=n(222),a={leading:!0,trailing:!1},c=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.durationSelector,this.leading,this.trailing))},e}(),u=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}return i.__extends(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this,t=e._hasValue,n=e._sendValue;t&&(this.destination.next(n),this.throttle(n)),this._hasValue=!1,this._sendValue=null},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=Object(s.subscribeToResult)(this,t))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(t){return this.destination.error(t),null}},t.prototype.throttlingDone=function(){var e=this,t=e._throttled,n=e._trailing;t&&t.unsubscribe(),this._throttled=null,n&&this.send()},t.prototype.notifyNext=function(e,t,n,r,i){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t,n){return void 0===t&&(t=a.async),void 0===n&&(n=c.defaultThrottleConfig),function(r){return r.lift(new u(e,t,n.leading,n.trailing))}}function i(e){var t=e.subscriber;t.clearThrottle()}n.r(t),n.d(t,"throttleTime",function(){return r});var o=n(164),s=n(163),a=n(207),c=n(345),u=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),d=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}return o.__extends(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(i,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(s.Subscriber)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=i.async),function(t){return Object(s.defer)(function(){return t.pipe(Object(o.scan)(function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}},{current:e.now(),value:void 0,last:void 0}),Object(a.map)(function(e){var t=e.current,n=e.last,r=e.value;return new c(r,t-n)}))})}}n.r(t),n.d(t,"timeInterval",function(){return r}),n.d(t,"TimeInterval",function(){return c});var i=n(207),o=n(307),s=n(242),a=n(218),c=function(){function e(e,t){this.value=e,this.interval=t}return e}()},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=i.async),Object(s.timeoutWith)(e,Object(a.throwError)(new o.TimeoutError),t)}n.r(t),n.d(t,"timeout",function(){return r});var i=n(207),o=n(216),s=n(349),a=n(201)},function(e,t,n){"use strict";function r(e,t,n){return void 0===n&&(n=o.async),function(r){var i=Object(s.isDate)(e),o=i?+e-n.now():Math.abs(e);return r.lift(new u(o,i,t,n))}}n.r(t),n.d(t,"timeoutWith",function(){return r});var i=n(164),o=n(207),s=n(281),a=n(221),c=n(222),u=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),d=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.action=null,s.scheduleTimeout(),s}return i.__extends(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(Object(c.subscribeToResult)(e,t))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},t}(a.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return void 0===e&&(e=i.async),Object(o.map)(function(t){return new s(t,e.now())})}n.r(t),n.d(t,"timestamp",function(){return r}),n.d(t,"Timestamp",function(){return s});var i=n(207),o=n(218),s=function(){function e(e,t){this.value=e,this.timestamp=t}return e}()},function(e,t,n){"use strict";function r(e,t,n){return 0===n?[t]:(e.push(t),e)}function i(){return Object(o.reduce)(r,[])}n.r(t),n.d(t,"toArray",function(){return i});var o=n(306)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new c(e))}}n.r(t),n.d(t,"window",function(){return r});var i=n(164),o=n(179),s=n(221),a=n(222),c=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new u(e),r=t.subscribe(n);return r.closed||n.add(Object(a.subscribeToResult)(n,this.windowBoundaries)),r},e}(),u=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new o.Subject,t.next(n.window),n}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new o.Subject;t.next(n)},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=0),function(n){return n.lift(new a(e,t))}}n.r(t),n.d(t,"windowCount",function(){return r});var i=n(164),o=n(163),s=n(179),a=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.windowSize,this.startWindowEvery))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new s.Subject],i.count=0,t.next(i.windows[0]),i}return i.__extends(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,a=0;a<o&&!this.closed;a++)i[a].next(e);var c=this.count-r+1;if(c>=0&&c%t===0&&!this.closed&&i.shift().complete(),++this.count%t===0&&!this.closed){var u=new s.Subject;i.push(u),n.next(u)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(o.Subscriber)},function(e,t,n){"use strict";function r(e){var t=u.async,n=null,r=Number.POSITIVE_INFINITY;return Object(l.isScheduler)(arguments[3])&&(t=arguments[3]),Object(l.isScheduler)(arguments[2])?t=arguments[2]:Object(f.isNumeric)(arguments[2])&&(r=arguments[2]),Object(l.isScheduler)(arguments[1])?t=arguments[1]:Object(f.isNumeric)(arguments[1])&&(n=arguments[1]),function(i){return i.lift(new p(e,n,r,t))}}function i(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function o(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,o=n.openWindow(),a=this,c={action:a,subscription:null},u={subscriber:n,window:o,context:c};c.subscription=r.schedule(s,t,u),a.add(c.subscription),a.schedule(e,i)}function s(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}n.r(t),n.d(t,"windowTime",function(){return r});var a=n(164),c=n(179),u=n(207),d=n(163),f=n(249),l=n(197),p=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new v(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return a.__extends(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(c.Subject),v=function(e){function t(t,n,r,a,c){var u=e.call(this,t)||this;u.destination=t,u.windowTimeSpan=n,u.windowCreationInterval=r,u.maxWindowSize=a,u.scheduler=c,u.windows=[];var d=u.openWindow();if(null!==r&&r>=0){var f={subscriber:u,window:d,context:null},l={windowTimeSpan:n,windowCreationInterval:r,subscriber:u,scheduler:c};u.add(c.schedule(s,n,f)),u.add(c.schedule(o,r,l))}else{var p={subscriber:u,window:d,windowTimeSpan:n};u.add(c.schedule(i,n,p))}return u}return a.__extends(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new h;this.windows.push(e);var t=this.destination;return t.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(d.Subscriber)},function(e,t,n){"use strict";function r(e,t){return function(n){return n.lift(new u(e,t))}}n.r(t),n.d(t,"windowToggle",function(){return r});var i=n(164),o=n(179),s=n(169),a=n(221),c=n(222),u=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.openings,this.closingSelector))},e}(),d=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=Object(c.subscribeToResult)(i,n,n)),i}return i.__extends(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var a=void 0;try{var u=this.closingSelector;a=u(t)}catch(d){return this.error(d)}var f=new o.Subject,l=new s.Subscription,p={window:f,subscription:l};this.contexts.push(p);var h=Object(c.subscribeToResult)(this,a,p);h.closed?this.closeWindow(this.contexts.length-1):(h.context=p,l.add(h)),this.destination.next(f)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(e!==-1){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(a.OuterSubscriber)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new c(e))}}n.r(t),n.d(t,"windowWhen",function(){return r});var i=n(164),o=n(179),s=n(221),a=n(222),c=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.closingSelector))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n=this.window=new o.Subject;this.destination.next(n);var r;try{var i=this.closingSelector;r=i()}catch(s){return this.destination.error(s),void this.window.error(s)}this.add(this.closingNotification=Object(a.subscribeToResult)(this,r))},t}(s.OuterSubscriber)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new a(r,n))}}n.r(t),n.d(t,"withLatestFrom",function(){return r});var i=n(164),o=n(221),s=n(222),a=function(){
function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.observables,this.project))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var a=0;a<o;a++)i.toRespond.push(a);for(var a=0;a<o;a++){var c=n[a];i.add(Object(s.subscribeToResult)(i,c,c,a))}return i}return i.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t;var o=this.toRespond;if(o.length>0){var s=o.indexOf(n);s!==-1&&o.splice(s,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(o.OuterSubscriber)},function(e,t,n){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(i.zip.apply(void 0,[t].concat(e)))}}n.r(t),n.d(t,"zip",function(){return r});var i=n(261)},function(e,t,n){"use strict";function r(e){return function(t){return t.lift(new i.ZipOperator(e))}}n.r(t),n.d(t,"zipAll",function(){return r});var i=n(261)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){this.mgr=e,this.confrId=t,o.apply(this),this.subject=new c.Subject,this.onRemoteStream=n}function o(){a.default.extend(this,{subscribe:function(e,t,n){return this.subject.subscribe(e,t,n)}},{onMeExit:function(e,t){this.mgr._onExit(this.confrId,e,t),this.mgr&&this.mgr.upload_stats&&this.mgr.upload_stats.upload_event({event:1,reason:e,sessionId:this._session._sessionId})},onAddMember:function(e){if(this.mgr.onMemberJoin(e,this.confrId),this.mgr&&this.mgr.upload_stats){var t=e.role,n=e.memName,r=e.id;this.mgr.upload_stats.upload_event({event:10,role:t,addMemName:n,addMemId:r})}},onRemoveMember:function(e,t){if(this.mgr.onMemberLeave(e,t,this.confrId),this.mgr&&this.mgr.upload_stats){var n=e.role,r=e.memName,i=e.id;this.mgr.upload_stats.upload_event({event:11,role:n,removeMemName:r,removeMemId:i})}},onAddStream:function(e){if(0!=e.id&&(e.located()||this.onRemoteStream&&this.onRemoteStream(e),this.mgr.streamBindVideo(e,void 0,this.confrId),this.mgr._onAddMemberStream(e,this.confrId),!e.located()&&this.mgr&&this.mgr.upload_stats)){var t=e.id,n=e.voff,r=e.aoff,i=e.type,o=e.memId,s=e.memName;this.mgr.upload_stats.upload_event({event:12,sId:t,voff:n,aoff:r,streamType:i,addMemId:o,addMemName:s})}},onRemoveStream:function(e){if(0!=e.id){var t=this.mgr._confr(this.confrId);t&&e&&e.located()&&(t.av&&t.av.id===e.id&&(t.av=void 0),t.desktop&&t.desktop.id===e.id&&(t.desktop=void 0));var n=a.default.removeAttribute(this.mgr._videos,e.id);if(this.mgr._onRemoveMemberStream(e,this.confrId),n&&this.mgr.unloadVideo(e.owner,e,n),!e.located()&&this.mgr&&this.mgr.upload_stats){var r=e.id,i=e.type,o=e.memId,s=e.memName;this.mgr.upload_stats.upload_event({event:13,sId:r,streamType:i,removeMemId:o,removeMemName:s})}}},onUpdateStream:function(e,t){if(0!=e.id){var n=this,r=this.mgr._videos[e.id];r&&(t&&t.ifMediaStream(function(e){r&&attachMediaStream(r,e),r&&r.hasAttribute("flow")&&n.mgr.onMediaTransmission(r,function(e,t,n,i){(0,d.default)(r).trigger("onMediaTransmission",[e,t,n,i])})}),e.aoff?r.setAttribute("aoff","aoff"):r.removeAttribute("aoff"),e.voff?r.setAttribute("voff","voff"):r.removeAttribute("voff"));var i={video:!e.voff,audio:!e.aoff};t&&t.ifVoff(function(t){i||(i={}),i.video=!t,e.located()||(i.video=e.subArgs?e.subArgs.subSVideo:!e.voff)}),t&&t.ifAoff(function(t){i||(i={}),i.audio=!t,e.located()||(i.audio=e.subArgs?e.subArgs.subSAudio:!e.aoff,2===e.type&&(i.audio=!0))}),i&&this.mgr._onMemberMediaChanaged(e.owner,e,i,this.confrId),i&&this.mgr._onUpdateMemberStream(e,i,this.confrId)}},onNetworkWeak:function(){},onNotSupportPublishVideoCodecs:function(e){this.mgr._onNotSupportMemberPublishVideoCodecs(e,this.confrId)},onRecvRemoteMessage:function(e,t){this.mgr._onRecvRemoteMessage(e,t,this.confrId)},onSoundChanage:function(e,t,n){this.mgr._onMemberSoundChanaged(e,t,n,this.confrId)},onTalking:function(e,t,n){this.mgr._onTalking(e,t,n,this.confrId)},onRoleUpdate:function(e,t){var n=this.mgr._confrs[this.confrId];t&&(n.roleToken=t),n.role=e,e==this.mgr.Role.AUDIENCE&&(n.av&&this.mgr.hungup(n.av),n.desktop&&this.mgr.hungup(n.desktop)),this.mgr._onRoleUpdated(e,this.confrId),this.mgr&&this.mgr.upload_stats&&this.mgr.upload_stats.upload_event({event:21,role:e,sessionId:this._session._sessionId})},onNotifyEvent:function(e){var t=this;try{if(e instanceof emedia.event.ICEChanage){var n=e.webrtc,r=e.state;a.default.forEach(t._cacheStreams,function(e,i){if(i.rtcId==n.getRtcId()){var o=a.default.extend({},i),s=a.default.extend({},i.owner);t.mgr._onStreamIceStateChanged(s,o,r,t.confrId)}})}}finally{t.subject.next(e)}}})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=r(s),c=n(160),u=n(75),d=r(u);t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){i._overrideCount++,i.overrideObj!==e&&(i.overrideObj=e,o.override=e.listeners.onRemoveMember,o.overrideService=e,e.listeners.onRemoveMember=o)}function o(e,t){try{var n=e&&e.id&&m(o.overrideService,e.id);n&&n.length&&V.forEach(n,function(t,n){F.warn("Remove member. free remote controller. it is ",n.id,n._ctrlStream.id,n._controller.memName,e.id),n._free(),n._callbacks&&n._callbacks.onRemoteFreeControl&&n._callbacks.onRemoteFreeControl(n._ctrlStream,n._controller,n._cId)})}finally{o.override&&o.override.apply(this,arguments)}}function s(e){s._overrideCount++,s.overrideObj!==e&&(s.overrideObj=e,c.override=e.listeners.onRemoveStream,c.overrideService=e,e.listeners.onRemoveStream=c)}function a(e){}function c(e){u(c.overrideService,e),c.override&&c.override.apply(this,arguments)}function u(e,t){I(e,t.id);var n=b(e,t);n&&V.forEach(n,function(e,t){t._free&&t._free()}),V.removeAttribute(e.current.__remoteControls,t.id)}function d(e){if(d._overrideCount++,d.overrideObj!==e){d.overrideObj=e;var t=e.onHungup;e.onHungup=function(n){u(e,n),t&&t.apply(this,arguments)}.bind(e)}}function f(e,t){if(f._overrideCount++,f.overrideObj!==e){f.overrideObj=e;var n=e._onRemotePannelControl;e._onRemotePannelControl=function(e){_(this,e,!1,t),n&&n.apply(this,arguments)}.bind(e)}}function l(e,t,n){var r=[];n&&V.forEach(n.actions,function(e,t){t.xy&&r.push({x:Math.round(1e4*t.xy.x),y:Math.round(1e4*t.xy.y),oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time}),t.xy||r.push({oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time})});var i={op2:30,evt:0,streamId:t.id,actions:r,cId:n.cId};return e.current.newMessage({op:1002,memId:t.owner.id,arg:(0,L.default)(i),_reqOps:[100230]})}function p(e){"string"==typeof e.arg&&(e.arg=JSON.parse(e.arg));var t=e.arg,n=[],r=[];t&&t.actions&&V.forEach(t.actions,function(e,t){void 0!==t.x&&void 0!==t.y&&n.push({xy:{x:t.x/1e4,y:t.y/1e4},oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time}),(void 0===t.x||void 0===t.y)&&r.push({oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time})}),t.mouse=n,t.keyboard=r}function h(e,t,n){e.current.message({op:1001,tsxId:t.tsxId,memId:t.memId,arg:(0,L.default)({cId:t.arg.cId}),result:n}).post()}function v(e,t){h(e,t,-405)}function m(e,t,n){var r=[];return e.current.__remoteControls&&V.forEach(e.current.__remoteControls,function(e,i){n&&i._ctrlStream.id!==n.id||t&&i._controller.id!==t||r.push(i)}),r}function b(e,t,n,r){var i=[];return e.current.__remoteControls&&V.forEach(e.current.__remoteControls,function(e,o){t&&o._ctrlStream.id!==t.id||n&&o._controller.memName!==n.memName||r&&o._cId!==r||i.push(o)}),i}function _(e,t,n,r){function i(){if(!c||!u)return v(e,t),!0;if(1===o.evt){var n=new z({_service:e,_controller:c,_ctrlStream:u,_cId:s,_reqevt:t,_callbacks:r});if(n.hasOtherControl())return n.busy(),!0;var i;return(i=n.controlling())?(V.forEach(i,function(e,t){t._cId=s}),h(e,t,0),!0):(r&&r.onHasRemoteControl&&r.onHasRemoteControl(u,c,n),!0)}if(2===o.evt){var a=b(e,u,c,s);return a&&V.forEach(a,function(n,r){r._free&&r._free(),h(e,t,0)}),r&&r.onRemoteFreeControl&&r.onRemoteFreeControl(u,c,s),!0}}p(t);var o=t.arg,s=o.cId,a=o.streamId,c=e.getMemberById(t.memId),u=e.getStreamById(a);if(n||!i()){var d=b(e,u,c,s);if(n||d&&0!==d.length||v(e,t),d&&V.forEach(d,function(e,t){t._lastRecvTimestamp=(new Date).getTime()}),n){var f=e.current.__remoteControls[u.id];d=d||[],f&&d.push(f)}V.forEach(d,function(r,i){function s(){e.current.message({op:1001,tsxId:t.tsxId,memId:t.memId,arg:(0,L.default)({sn:a}),result:0}).post(function(e){F.debug("Send remote control response. the result = ",e.result,e.msg||"")})}var a=0,c=o.mouse;if(c&&c.length>0)try{V.forEach(c,function(e,t){t.sn>a&&(a=t.sn),t.oper===B.BTN.MOVE?i.mouseTrack&&i.mouseTrack.track(t.xy):i.mouseTrack&&i.mouseTrack.trigger(new B(t))})}catch(u){F.warn(u)}var c=o.keyboard;if(c&&c.length>0)try{V.forEach(c,function(e,t){t.sn>a&&(a=t.sn),i.keyboard&&(t.oper===B.BTN.KEYBOARD_DOWN?i.keyboard.onKeyDown(t.btn):t.oper===B.BTN.KEYBOARD_UP&&i.keyboard.onKeyUp(t.btn))})}catch(u){F.warn(u)}if(n!==!0)try{s()}catch(u){F.warn(u)}})}}function g(e,t,n,r,i){r&&r()}function y(e,t,n,r,i){r&&r()}function S(e,t,n,r,i,o,s){var a=e.eventXYAtMedia(r,n);a&&(a={x:a.x/a.width,y:a.y/a.height},C(e,{xy:a,oper:B.BTN.MOVE,sid:t},s),o&&o(a,i))}function w(e,t,n,r,i,o,s){r.xy=e.eventXYAtMedia(r.xy,n),r.xy&&(r.xy={x:r.xy.x/r.xy.width,y:r.xy.y/r.xy.height},V.extend(r,{sid:t}),C(e,r,s),o&&o(r,i))}function x(e,t,n,r,i,o){C(e,{oper:n,btn:r,sid:t},o),i&&i(n,r)}function C(e,t,n){var r,i=t.sid,o=e.getStreamById(i);e.current.__remoteControls&&(r=e.current.__remoteControls[i])&&_(e,l(e,o,{actions:[t]}),!0);var s=e.current.__pannelBuffers[i],a=s.getUnclearSize();if(s.put(t),a<emedia.config.allowSendWhenLessThan){var c=function u(){for(var t=s.getUnread(),r=0,a=0;t&&a<t.length;a++){var c=t[a];V.removeAttribute(c,"sid"),r<c.sn&&(r=c.sn)}t&&0!==t.length&&(F.debug(i,"buffer remain:",s.getUnclearSize(),", send evt:",t.length),e.current.postMessage(l(e,o,{actions:t,cId:s._cId}),function(e){if(e.result===-402)return void(n&&n.onReject&&n.onReject(o));if(e.result===-403)return void(n&&n.onBusy&&n.onBusy(o));if(e.result===-408)return void(n&&n.onRemoteControlTimeout&&n.onRemoteControlTimeout(o));if(e.result===-507||e.result===-405)return s.clearRead(r),void(n&&n.onNotAllowRemoteControl&&n.onNotAllowRemoteControl(o));0===e.result&&(s._lastRspTimestamp=(new Date).getTime());var t=e.arg;t&&(t=JSON.parse(t))&&!V.isInt(t.sn)?F.warn("rsp.sn not a Number.",t.sn,"for streamId",i):t&&void 0!==t.sn&&s.clearRead(t.sn),u()}))};c()}}function I(e,t){var n,r=e.current.__pannelMouses&&V.removeAttribute(e.current.__pannelMouses,t),i=e.current.__pannelKeyboards&&V.removeAttribute(e.current.__pannelKeyboards,t);if(e.current.__pannelBuffers&&(n=V.removeAttribute(e.current.__pannelBuffers,t)),r&&r.ungrab(),i&&i.ungrab(),a(e),n){var o=e.getStreamById(t);if(n._callbacks&&n._callbacks.onDisControlled&&n._callbacks.onDisControlled(o),o){var s=e.current.newMessage({op:1002,memId:o.owner.id,arg:(0,L.default)({op2:30,streamId:o.id,evt:2,cId:n._cId}),_reqOps:[100230]});e.current.postMessage(s,function(e){0!==e.result&&F.warn("Unkown result：",e.result)})}}}function T(e,t,n,r){var i={};V.forEach(arguments,function(e,t){"function"==typeof t&&(i[t.name]=t)}),R(e,t,n,!0,r,i)}function E(e,t,n,r){var i={};V.forEach(arguments,function(e,t){"function"==typeof t&&(i[t.name]=t)}),R(e,t,n,!1,r,i)}function R(e,t,n,r,i,o){var s=Math.uuidFast();s=s.substr(s.length-6,6);var a=e.getStreamById(t);if(!a._webrtc)throw o&&o.onNotAllowRemoteControl&&o.onNotAllowRemoteControl(a),F.error("Not allow control. cause by the stream not sub"),"Not allow control. cause by the stream not sub";var c={op2:30,streamId:a.id,evt:1,cId:s},u=e.current.newMessage({op:1002,memId:a.owner.id,arg:(0,L.default)(c),_reqOps:[100230]});e.current.postMessage(u,function(c){return c.result===-402?void(o&&o.onReject&&o.onReject(a)):c.result===-403?void(o&&o.onBusy&&o.onBusy(a)):c.result===-408?void(o&&o.onRemoteControlTimeout&&o.onRemoteControlTimeout(a)):c.result===-507||c.result===-405?void(o&&o.onNotAllowRemoteControl&&o.onNotAllowRemoteControl(a)):0===c.result?(k(e,t,n,r,i,o,s,!0),void(o&&o.onAccept&&o.onAccept(a))):(F.warn("Unkown result：",c.result),void(o&&o.onNotAllowRemoteControl&&o.onNotAllowRemoteControl(a)))})}function k(e,t,n,r,i,o,s,a){void 0===i&&(i=n);var c=e.getStreamById(t),u=(e.current.__pannelMouses||(e.current.__pannelMouses={}))[t];if(u&&I(e,t),!c.located()&&!c.owner.acptOps[1003])throw F.error("which do not recv remote message, it is ",c.owner.memName),c.owner.memName+" do not recv remote message";u=new U({_target:i,_focused:!0,onMouseEnter:function(){g.call(u,e,t,n,o&&o.onMouseEnter,o),f&&f.grab()},onMouseExit:function(){y.call(u,e,t,n,o&&o.onMouseExit,o),f&&f.ungrab()},onMouseButton:function(i,s){r===!0&&(i.xy.x=-i.xy.x),w.call(u,e,t,n,i,s,o&&o.onMouseButton,o)},onMouseMove:function(i,s){emedia.config.disableTrack||(r===!0&&(i.x=-i.x),S.call(u,e,t,n,i,s,o&&o.onMouseMove,o))}});var d=e.current.__pannelBuffers||(e.current.__pannelBuffers={});d[t]=new q({_cId:s,_callbacks:o,trackBufferSize:emedia.config.trackBufferSize||1e3});(e.current.__pannelMouses||(e.current.__pannelMouses={}))[t]=u,u.grab();var f;a&&(f=new W({_target:document,_focused:!0,onKeyPress:function(n,r){var i=r?B.BTN.KEYBOARD_DOWN:B.BTN.KEYBOARD_UP,s=n;x.call(f,e,t,i,s,o&&o.onKeyboard,o)}}),(e.current.__pannelKeyboards||(e.current.__pannelKeyboards={}))[t]=f)}function M(e,t,n,r){var i=new U({_target:e,_focused:!0,onMouseEnter:function(){},onMouseExit:function(){t.releaseTrigger()},onMouseButton:function(e,i){e.xy={x:e.xy.x/e.xy.width,y:e.xy.y/e.xy.height},r===!0&&(e.xy.x=-e.xy.x),n&&(e.xy=emedia.Service.prototype.eventXYAtMedia.call(null,e.xy,n)),e.xy&&t.trigger(e)},onMouseMove:function(e,i){e={x:e.x/e.width,y:e.y/e.height},r===!0&&(e.x=-e.x),n&&(e=emedia.Service.prototype.eventXYAtMedia.call(null,e,n)),e&&t.track(e)}});return i.grab(),i}function O(e,t,n){var r=t;r&&(e.mouseTrack=r),e.keyboard=n}function A(e){var t={};V.forEach(arguments,function(e,n){0!=e&&"function"==typeof n&&(t[n.name]=n)}),d(e),s(e),i(e),f(e,t),H(e)}function P(e,t){var n=e.getStreamById(t),r=b(e,n);if(r&&0!==r.length)return r[0]._controller.memName}function j(e,t,n,r){var i=e.getStreamById(t),o={_ctrlStream:i,_controller:i.owner,_service:e};O(o,n,r),(e.current.__remoteControls||(e.current.__remoteControls={}))[t]=o}function N(e,t){V.removeAttribute(e.current.__remoteControls,t)}var D=n(73),L=r(D),V=n(1),F=V.tagLogger("PannelVideo"),U=n(362),W=n(363),B=(n(151),n(152)),q=n(364);i._overrideCount=0,s._overrideCount=0,d._overrideCount=0,f._overrideCount=0;var G=0,z=V.prototypeExtend({__init__:function(){this.id=G++},accept:function(e,t){var n=this;if(n.hasOtherControl())throw n.busy(),F.error("Other has been controled."),"Other has been controled.";var r=!1,i=b(this._service,this._ctrlStream,this._controller);if(i&&V.forEach(i,function(e,t){t.id<n.id?t._free():r=!0}),r)return void n._free();var o=this._service.current.__remoteControls||(this._service.current.__remoteControls={});o[n.id]=n,O(this,e,t),h(this._service,this._reqevt,0)},controlling:function(){var e=this,t=[],n=b(this._service,this._ctrlStream);return n&&V.forEach(n,function(n,r){r._controller.memName===e._controller.memName&&t.push(r)}),t&&t.length?t:void 0},hasOtherControl:function Y(){var e=this,Y=!1,t=b(this._service,this._ctrlStream);return t&&V.forEach(t,function(t,n){n._controller.memName!=e._controller.memName&&(Y=!0)}),Y},busy:function(){h(this._service,this._reqevt,-403)},reject:function(){h(this._service,this._reqevt,-402)},_free:function(){V.removeAttribute(this._service.current.__remoteControls,this.id)},forceDisconnect:function(){var e=b(this._service,this._ctrlStream);e&&V.forEach(e,function(e,t){t._free&&t._free()}),F.info("remote control force disconnect")}}),H=function K(e){if(K.timeoutId&&clearTimeout(K.timeoutId),K.timeoutId=setTimeout(function(){K(e)},emedia.config.ctrlCheckIntervalMillis),e.current){var t;(t=e.current.__remoteControls)&&V.forEach(t,function(e,t){if(void 0!==t.id&&e==t.id){var n=(new Date).getTime();t._lastRecvTimestamp&&n-t._lastRecvTimestamp>emedia.config.ctrlTimeoutMillis&&(F.warn("Timeout for remote controller. it is ",t.id,t._ctrlStream.id,t._controller.memName),t._free(),t._callbacks&&t._callbacks.onRemoteFreeControl&&t._callbacks.onRemoteFreeControl(t._ctrlStream,t._controller,t._cId))}});var n;(n=e.current.__pannelBuffers)&&V.forEach(n,function(t,n){var r=e.getStreamById(t);r&&!r.located()&&e.current.message({op:1002,memId:r.owner.id,arg:(0,L.default)({op2:30,streamId:r.id,evt:3,cId:n._cId}),_reqOps:[100230]}).post(function(e){})})}};e.exports={mirrorControlled:T,controlled:E,disControlled:I,controlling:O,graffiti:M,echoControl:j,disEchoControl:N,support:A,getController:P}},function(e,t,n){"use strict";var r=n(1),i=(r.tagLogger("Mouse"),n(152));e.exports=r.prototypeExtend({__init__:function(){this._handlers=r.extend({mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this),mouseover:this._handleMouseOver.bind(this),mouseout:this._handleMouseOut.bind(this)},this._handlers||{})},onMouseButton:function(e,t){},onMouseMove:function(e,t){},onMouseEnter:function(){},onMouseExit:function(){},_onMouseButton:function(e,t,n){var r=(new Date).getTime(),o=new i({xy:e,oper:t,btn:n,_time:r});this.onMouseButton&&this.onMouseButton(o,this._lastTrigger),this._lastTrigger=o},_onMouseMove:function(e){this.onMouseMove&&this.onMouseMove(e,this._lastTrigger)},_captureMouse:function(){this._target.setCapture&&this._target.setCapture(),this._mouseCaptured=!0},_releaseMouse:function(){this._target.releaseCapture&&this._target.releaseCapture(),this._mouseCaptured=!1},_resetDoubleClickTimer:function(){this._doubleClickTimer=null},_handleMouseOver:function(e){this._mouseExit!==!1&&(this._mouseExit=!1,this.onMouseEnter&&this.onMouseEnter())},_handleMouseOut:function(e){this._mouseExit!==!0&&(this._mouseExit=!0,this.onMouseExit&&this.onMouseExit()),this._lastTrigger=void 0},_handleMouseDown:function(e){this._captureMouse(),this._handleMouseButton(e,i.BTN.KEY_DOWN)},_handleMouseUp:function(e){this._mouseCaptured&&(this._handleMouseButton(e,i.BTN.KEY_UP),this._releaseMouse())},_handleMouseWheel:function(e){if(this._focused){var e=e||window.event,t=r.getEventElementXY(e,this._target,this._scale),n=(e.detail?-1*e.detail:e.wheelDelta/40)>0?i.BTN.WHEEL_ROLL_UP:i.BTN.WHEEL_ROLL_DOWN;this._onMouseButton(t,i.BTN.KEY_DOWN,n),r.stopEvent(e)}},_handleMouseMove:function(e){if(this._focused){var e=e||window.event,t=r.getEventElementXY(e,this._target,this._scale);this._onMouseMove(t),r.stopEvent(e)}},_handleMouseDisable:function(e){if(this._focused){var e=e||window.event,t=r.getEventElementXY(e,this._target,this._scale);try{return!(t.realX>=0&&t.realY>=0&&t.realX<this._target.offsetWidth&&t.realY<this._target.offsetHeight)}finally{r.stopEvent(e)}}},_handleMouseButton:function(e,t){if(this._focused){var n,e=e||window.event,o=r.getEventElementXY(e,this._target,this._scale);if(e.touches||e.changedTouches){if(t==i.BTN.KEY_DOWN){if(null===this._doubleClickTimer)this._lastTouchPos=o;else{clearTimeout(this._doubleClickTimer);var s=this._lastTouchPos.x-o.x,a=this._lastTouchPos.y-o.y;Math.sqrt(s*s+a*a)<20*window.devicePixelRatio&&(o=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}n=i.BTN.LEFT}else n=e.which?1<<e.button:(1&e.button)+2*(2&e.button)+(4&e.button)/2;this._onMouseButton(o,t,n),r.stopEvent(e)}},grab:function(){var e=this._target;r.addEvent(e,"mouseover",this._handlers.mouseover),r.addEvent(e,"mouseout",this._handlers.mouseout),r.addEvent(e,"touchstart",this._handlers.mousedown),r.addEvent(e,"touchend",this._handlers.mouseup),r.addEvent(e,"touchmove",this._handlers.mousemove),r.addEvent(e,"mousedown",this._handlers.mousedown),r.addEvent(e,"mouseup",this._handlers.mouseup),r.addEvent(e,"mousemove",this._handlers.mousemove),r.addEvent(e,r.layoutEngine.gecko?"DOMMouseScroll":"mousewheel",this._handlers.mousewheel),r.addEvent(e,"contextmenu",this._handlers.mousedisable)},ungrab:function(){var e=this._target;r.removeEvent(e,"mouseover",this._handlers.mouseover),r.removeEvent(e,"mouseout",this._handlers.mouseout),r.removeEvent(e,"touchstart",this._handlers.mousedown),r.removeEvent(e,"touchend",this._handlers.mouseup),r.removeEvent(e,"touchmove",this._handlers.mousemove),r.removeEvent(e,"mousedown",this._handlers.mousedown),r.removeEvent(e,"mouseup",this._handlers.mouseup),r.removeEvent(e,"mousemove",this._handlers.mousemove),r.removeEvent(e,r.layoutEngine.gecko?"DOMMouseScroll":"mousewheel",this._handlers.mousewheel),r.removeEvent(e,"contextmenu",this._handlers.mousedisable)}})},function(e,t,n){"use strict";var r=n(1),i=r.tagLogger("Keyboard");e.exports=r.prototypeExtend({__init__:function(){this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this)}},getKey:function(e){return"keyCode"in e&&"key"in e?e.key+":"+e.keyCode:"keyCode"in e?e.keyCode:e.key},onKeyPress:function(e,t){},_onKeyPress:function(e,t){this.onKeyPress&&this.onKeyPress(e,t)},_handleRfbEvent:function(e,t){var n=(e.shiftKey,e.ctrlKey,e.altKey,e.keyCode||e.which);this._onKeyPress(n,"keydown"==t)},_handleKeyDown:function(e){return!this._focused||!this._handleRfbEvent(e,"keydown")||(r.stopEvent(e),!1)},_handleKeyPress:function(e){return!this._focused||(r.stopEvent(e),!1)},_handleKeyUp:function(e){return!this._focused||!this._handleRfbEvent(e,"keyup")||(r.stopEvent(e),!1)},_allKeysUp:function(){},sync:function(e){},grab:function(){var e=this._target;r.addEvent(e,"keydown",this._eventHandlers.keydown),r.addEvent(e,"keyup",this._eventHandlers.keyup),r.addEvent(e,"keypress",this._eventHandlers.keypress),r.addEvent(e,"blur",this._eventHandlers.blur),i.info("keyboard grab at element")},ungrab:function(){var e=this._target;r.removeEvent(e,"keydown",this._eventHandlers.keydown),r.removeEvent(e,"keyup",this._eventHandlers.keyup),r.removeEvent(e,"keypress",this._eventHandlers.keypress),r.removeEvent(e,"blur",this._eventHandlers.blur),this._allKeysUp(),i.info("keyboard upgrab at element")}})},function(e,t,n){"use strict";var r=n(1),i=(r.tagLogger("TotalBuffer"),n(365)),o=n(366),s=n(152);e.exports=r.prototypeExtend({trackBufferSize:100,_trackBufferCompRadio:.25,_sn:1,__init__:function(){this._eventBuffer=new i({_nextsn:this._nextsn.bind(this)}),this._trackBuffer=new o({_nextsn:this._nextsn.bind(this),_compRadio:this._trackBufferCompRadio,mouseTrackBufferSize:this.trackBufferSize})},_nextsn:function(){return this._sn++},put:function(e){e&&void 0!==e.oper&&(e.oper===s.BTN.MOVE?this._trackBuffer.put(e):this._eventBuffer.put(e))},getUnread1:function(e){function t(e,t){return e._time-t.time}var n;if(!e){var r=this._eventBuffer.getUnread(),i=this._trackBuffer.getUnread();return Array.prototype.push.apply(r,i),n=r,n.sort(t),n}n=[];var r=this._eventBuffer._getUnread(e),i=this._trackBuffer._getUnread(e);Array.prototype.push.apply(n,r),Array.prototype.push.apply(n,i),n.sort(t),n=n.slice(0,e>n.length?n.length:e);for(var o=0;o<n.length;o++)n[o].oper===s.BTN.MOVE?this._trackBuffer.getUnread(1):this._eventBuffer.getUnread(1);return n},getUnread:function(e){e||(e=this._eventBuffer.getUnreadSize()+this._trackBuffer.getUnreadSize());for(var t=[];t.length!==e;){var n=this._eventBuffer._getUnread(1),r=this._trackBuffer._getUnread(1);if(void 0===n&&r)t.push(this._trackBuffer.getUnread(1));else if(void 0===r&&n)t.push(this._eventBuffer.getUnread(1));else{if(void 0===r&&void 0===n)return t;n.sn<r.sn?t.push(this._eventBuffer.getUnread(1)):t.push(this._trackBuffer.getUnread(1))}}return t},getUnreadSize:function(){return this._trackBuffer.getUnreadSize()+this._eventBuffer.getUnreadSize()},getUnclearSize:function(){return this._trackBuffer.getUnclearSize()+this._eventBuffer.getUnclearSize()},clearRead:function(e){return this._eventBuffer.clearRead(e)+this._trackBuffer.clearRead(e)}})},function(e,t,n){"use strict";var r=n(1);r.tagLogger("EventBuffer");e.exports=r.prototypeExtend({_buffer:[],_sn:1,_beginIndex:0,_readIndex:0,_endIndex:0,_nextsn:function(){return this._sn++},put:function(e){e&&(e.sn=this._nextsn(),this._buffer.push(e),this._endIndex++)},_getUnread:function(e){return this._readIndex===this._endIndex?1===e?void 0:[]:this._buffer[this._readIndex]},getUnread:function(e){var t;try{return t=this._getUnread(e)}finally{t&&(this._readIndex+=1===e?1:t.length)}},getUnreadSize:function(){return this._endIndex-this._readIndex},getUnclearSize:function(){return this._readIndex-this._beginIndex},clearRead:function(e){if(this._readIndex!==this._beginIndex){for(var t=0,n=this._beginIndex;n<this._readIndex&&this._buffer[n].sn<=e;n++)t++;if(0===t)return 0;for(var n=0;n<t;n++)this._buffer.shift();return this._beginIndex=0,this._readIndex-=t,this._endIndex-=t,t}}})},function(e,t,n){"use strict";var r=n(1);r.tagLogger("TrackBuffer");e.exports=r.prototypeExtend({mouseTrackBufferSize:1e3,_sn:1,_compRadio:.25,_beginIndex:0,_readIndex:0,_endIndex:0,__init__:function(){this._mouseTrackBuffer=new Array(this.mouseTrackBufferSize)},_nextsn:function(){return this._sn++},_index:function(e){return e%this.mouseTrackBufferSize},comp1:function(e){if(!(e>=1)){for(var t=Math.floor(1/e),n=this._beginIndex,r=n+1;n<this._endIndex;){for(var i=2;i<t&&n+i<this._endIndex;i++)this._mouseTrackBuffer[this._index(r++)]=this._mouseTrackBuffer[this._index(n+i)];n+=t}this._endIndex=r}},put1:function(e){if(e){e.sn=this._nextsn(),this._endIndex-this._readIndex===this.mouseTrackBufferSize&&(this.comp1(this._compRadio),this._readIndex=this._beginIndex);var t=this._index(this._beginIndex),n=(this._index(this._readIndex),this._index(this._endIndex)),r=n;r<=t&&r>=0&&this._endIndex>this._beginIndex&&this._beginIndex++,this._mouseTrackBuffer[r]=e,this._endIndex++}},compHalfOfUnread:function(){for(var e=this._readIndex+2,t=this._readIndex+1;e<this._endIndex;)this._mouseTrackBuffer[this._index(t++)]=this._mouseTrackBuffer[this._index(e)],e+=2;this._endIndex=t},put:function(e){if(e){e.sn=this._nextsn(),this._endIndex-this._beginIndex===this.mouseTrackBufferSize&&this.compHalfOfUnread();var t=this._index(this._endIndex);this._mouseTrackBuffer[t]=e,this._endIndex++}},_interval:function(e,t){var n=this._index(e),r=this._index(t);if(n<r)return this._mouseTrackBuffer.slice(n,r);var i=this._mouseTrackBuffer.slice(n);return Array.prototype.push.apply(i,this._mouseTrackBuffer.slice(0,r)),i},_getUnread:function(e){return this._readIndex===this._endIndex?1===e?void 0:[]:this._mouseTrackBuffer[this._index(this._readIndex)]},getUnread:function(e){var t;try{return t=this._getUnread(e)}finally{t&&(this._readIndex+=1===e?1:t.length)}},getUnreadSize:function(){return this._endIndex-this._readIndex},getUnclearSize:function(){return this._readIndex-this._beginIndex},clearRead:function(e){if(this._readIndex!==this._beginIndex){for(var t=0,n=this._beginIndex;n<this._readIndex;n++){var r=this._index(n);if(!(this._mouseTrackBuffer[r].sn<=e))break;this._beginIndex++,t++}return t}}})},function(e,t,n){"use strict";function r(){}var i=n(1),o=i.tagLogger("CompositeCanvas");for(var s in CanvasRenderingContext2D.prototype)!function(e){r.prototype[e]=function(){if("function"==typeof this._canvasContext[e])this._canvasContext[e].apply(this._canvasContext,arguments);else{var t=arguments.length>=1?arguments[0]:void 0;if(!t)return this._canvasContext[e];this._canvasContext[e]=t}}}(s);var a=i.prototypeExtend(r,{__init__:function(){var e=this;e.compositeCanvasTag||(e.compositeCanvasTag=document.createElement("canvas")),e._canvasContext=e.compositeCanvasTag.getContext("2d"),e._canvasContext.globalAlpha=void 0!==this._globalAlpha?this._globalAlpha:1,e._compositeOperation=e._compositeOperation||c.source_over,e.globalCompositeOperation(e._compositeOperation)},setCanvas:function(){for(var e,t=this,n=0;n<arguments.length;n++)e=arguments[n],"function"==typeof e&&e(this.compositeCanvasTag,this._canvasContext),"function"!=typeof e&&i.isPlainObject(e)&&i.forEach(e,function(e,n){o.debug("Canvas set ",e," = ",n),t.compositeCanvasTag.setAttribute(e,n)});return t},getCanvasImageData:function(e,t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e.getContext("2d");return i.globalAlpha=t||0,i.getImageData.apply(i,n)},_composite:function(e){var t=this;return new a(t,{_compositeOperation:e})},composite:function(e){var t=this;return t.globalCompositeOperation(e),t},requestAnimationFrame:function(e){var t=this;return t.requestFrame(),t._requestAnimationFrameStart=window.requestAnimationFrame(function(e){t.requestAnimationFrame(e)}),t},cancelAnimationFrame:function(){var e=this;return e._requestAnimationFrameStart&&window.cancelAnimationFrame(e._requestAnimationFrameStart),e},requestFrame:function u(e){var t=this;if("function"!=typeof this.requestOneFrame)throw o.error("Pleas implement requestOneFrame()"),"Pleas implement requestOneFrame()";try{this.requestOneFrame()}catch(n){o.error(n)}var r;if(e&&(r=Math.floor(1e3/e)),!r)return t;var u=this.requestFrame.bind(this);return this.intervalId=setInterval(function(){u(e)},r),t},stopRequestFrame:function(){return this.intervalId&&clearInterval(this.intervalId),this}});a.CompositeOperation=["source-atop","source-in","source-out","source-over","destination-atop","destination-in","destination-out","destination-over","lighter","darker","xor","copy"];var c=a.operation={source_atop:"source-atop",source_in:"source-in",source_out:"source-out",source_over:"source-over",destination_atop:"destination-atop",destination_in:"destination-in",destination_out:"destination-out",destination_over:"destination-over",lighter:"lighter",darker:"darker",xor:"xor",copy:"copy"};a.compositeVideoOverCanvas=function(e,t,n){var r;return(r=e.compositeCanvas)||(r=new a({compositeCanvasTag:e,requestOneFrame:function(){t&&r.drawImage(t,0,0,e.width,e.height),n&&r.drawImage(n,0,0,e.width,e.height)}}),e.compositeCanvas=r),r},e.exports=a},function(e,t,n){"use strict";var r=n(1);r.tagLogger("Keyboard");e.exports=r.prototypeExtend({onKeyDown:function(e){},onKeyUp:function(e){}})},function(e,t,n){"use strict";window.emedia=window.emedia||{};var r=n(1),i=r.tagLogger("electron");emedia.electron=window.require("electron"),emedia.chooseElectronDesktopMedia=function(e,t,n){i.info("Choose desktop. ",e[0]),t(e[0])}}])}),window._emediaVersion="3.2.2.3c011f9",console&&console.warn("emedia version","3.2.2.3c011f9")}]);