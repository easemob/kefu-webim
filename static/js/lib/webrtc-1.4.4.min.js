!function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="./",t(0)}({0:function(e,t,n){e.exports=n(228)},228:function(e,t,n){var o,a;(function(e){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(230),c=n(231);window.WebIM="undefined"!=typeof WebIM?WebIM:{},WebIM.WebRTC=WebIM.WebRTC||{},WebIM.WebRTC.Call=c,WebIM.WebRTC.Util=r,"object"===i(e)&&"object"===i(e.exports)?e.exports=WebIM.WebRTC:(o=[],a=function(){return WebIM.WebRTC}.apply(t,o),!(void 0!==a&&(e.exports=a))),/Chrome/.test(navigator.userAgent)&&(WebIM.WebRTC.supportPRAnswer=navigator.userAgent.split("Chrome/")[1].split(".")[0]>=50?!0:!1)}).call(t,n(229)(e))},229:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},230:function(e,t){"use strict";function n(){}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var o,a=e,i=[];if(n=n||a.length,t)for(o=0;t>o;o++)i[o]=a[0|Math.random()*n];else{var r;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",o=0;36>o;o++)i[o]||(r=0|16*Math.random(),i[o]=a[19==o?3&r|8:r])}return i.join("")},Math.uuidFast=function(){for(var t,n=e,o=new Array(36),a=0,i=0;36>i;i++)8==i||13==i||18==i||23==i?o[i]="-":14==i?o[i]="4":(2>=a&&(a=33554432+16777216*Math.random()|0),t=15&a,a>>=4,o[i]=n[19==i?3&t|8:t]);return o.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}}();var a=function(){function e(e,n){var o=[];o.push(e);for(var a in n)o.push(n[a]);t.log.apply(t,o)}var t=this,n={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5},o=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];this.log=function(){var e=arguments[0];e=arguments[0]="["+o[e]+"] ";arguments[1];WebIM&&WebIM.config&&WebIM.config.isDebug&&console.log.apply(console,arguments)},this.trace=function(){this.log&&e(n.TRACE,arguments)},this.debug=function(){this.log&&e(n.DEBUG,arguments)},this.info=function(){this.log&&e(n.INFO,arguments)},this.warn=function(){this.log&&e(n.WARN,arguments)},this.error=function(){this.log&&e(n.ERROR,arguments)},this.fatal=function(){this.log&&e(n.FATAL,arguments)}};n.prototype.logger=new a,n.prototype.parseJSON=function(e){return JSON.parse(e)};var i=(n.prototype.stringifyJSON=function(e){return JSON.stringify(e)},{}),r=i.toString,c=i.hasOwnProperty,s=c.toString,d=s.call(Object);n.prototype.isPlainObject=function(e){var t,n;return e&&"[object Object]"===r.call(e)?(t=Object.getPrototypeOf(e))?(n=c.call(t,"constructor")&&t.constructor,"function"==typeof n&&s.call(n)===d):!0:!1};n.prototype.isArray=Array.isArray,n.prototype.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},n.prototype.type=function(e){return null==e?e+"":"object"===("undefined"==typeof e?"undefined":o(e))||"function"==typeof e?i[r.call(e)]||"object":"undefined"==typeof e?"undefined":o(e)},n.prototype.extend=function(){var e,t,n,a,i,r,c=this,s=arguments[0]||{},d=1,u=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[d]||{},d++),"object"===("undefined"==typeof s?"undefined":o(s))||c.isFunction(s)||(s={}),d===u&&(s=this,d--);u>d;d++)if(null!=(e=arguments[d]))for(t in e)n=s[t],a=e[t],s!==a&&(l&&a&&(c.isPlainObject(a)||(i=c.isArray(a)))?(i?(i=!1,r=n&&c.isArray(n)?n:[]):r=n&&c.isPlainObject(n)?n:{},s[t]=c.extend(l,r,a)):void 0!==a&&(s[t]=a));return s},n.prototype.hasLocalStorage=function(e){return null==localStorage.getItem(e)||"{}"==localStorage.getItem(e)?!1:!0},n.prototype.toggleClass=function(e,t){return e.hasClass(t)?void e.removeClass(t):void e.addClass(t)},n.prototype.setCookie=function(e,t,n){var o=new Date;o.setTime(o.getTime()+60*n*60*1e3),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()},n.prototype.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},n.prototype.parseURL=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},e.exports=new n},231:function(e,t,n){"use strict";var o=n(230),a=n(232),i=n(233),r=n(234),c=n(235),s=i.RouteTo,d=i.Api,u=o.logger,l={api:null,caller:"",connection:null,pattern:null,listener:{onAcceptCall:function(e,t){},onRinging:function(e){},onTermCall:function(){},onIceConnectionStateChange:function(e){}},mediaStreamConstaints:{audio:!0,video:!0},init:function(){var e=this;if("undefined"==typeof e.connection)throw"Caller need a instance of Easemob.im.Connection";e.api=e.api||new d({imConnection:e.connection,rtcHandler:new a({imConnection:e.connection})}),e.api.onInitC=function(){e._onInitC.apply(e,arguments)},e.api.onIceConnectionStateChange=function(){e.listener.onIceConnectionStateChange.apply(e,arguments)}},makeVideoCall:function(e,t){var n={};o.extend(n,this.mediaStreamConstaints),this.call(e,n,t)},makeVoiceCall:function(e,t){var n=this,a={};o.extend(a,n.mediaStreamConstaints),n.mediaStreamConstaints.video=!1,n.call(e,a,t)},acceptCall:function(){var e=this;e.pattern.accept()},endCall:function(e){var t=this;t.caller="",t.pattern.termCall()},call:function(e,t,n){var o=this;this.callee=this.api.jid(e);var a=new s({rtKey:"",sid:n,success:function(e){u.debug("iq to server success",e)},fail:function(e){u.debug("iq to server error",e),o.onError(e)}});this.api.reqP2P(a,t.video?1:0,t.audio?1:0,this.api.jid(e),function(e,t){return"0"==t.online?void o.listener.onError({message:"callee is not online!"}):(o._onGotServerP2PConfig(e,t),void o.pattern.initC(o.mediaStreamConstaints,n))})},_onInitC:function(e,t,n,o,a){var i=this;i.callee=e,i._rtcCfg=t.rtcCfg,i._WebRTCCfg=t.WebRTC,i.sessId=t.sessId,i.rtcId=t.rtcId,i.switchPattern(),i.pattern._onInitC(e,t,n,o,a)},_onGotServerP2PConfig:function(e,t){var n=this;0==t.result&&(n._p2pConfig=t,n._rtcCfg=t.rtcCfg,n._rtcCfg2=t.rtcCfg2,n.sessId=t.sessId,n.rtcId="Channel_webIM",n._rtKey=n._rtkey=t.rtKey||t.rtkey,n._rtFlag=n._rtflag=t.rtFlag||t.rtflag,n._WebRTCCfg=t.WebRTC,n.admtok=t.admtok,n.tkt=t.tkt,n.switchPattern())},switchPattern:function(){var e=this;!e._WebRTCCfg&&(e.pattern=new c({callee:e.callee,_p2pConfig:e._p2pConfig,_rtcCfg:e._rtcCfg,_rtcCfg2:e._rtcCfg2,_rtKey:e._rtKey||e._rtkey,_rtFlag:e._rtFlag||e._rtflag,_sessId:e.sessId,_rtcId:e.rtcId,webRtc:new r({onGotLocalStream:e.listener.onGotLocalStream,onGotRemoteStream:e.listener.onGotRemoteStream,onError:e.listener.onError}),api:e.api,onAcceptCall:e.listener&&e.listener.onAcceptCall||function(){},onRinging:e.listener&&e.listener.onRinging||function(){},onTermCall:e.listener&&e.listener.onTermCall||function(){}}))}};e.exports=function(e){o.extend(!0,this,l,e||{}),this.init()}},232:function(e,t,n){"use strict";var o=n(230),a=o.logger,i=n(233),r=i.RouteTo,c="urn:xmpp:media-conference",s={_apiCallbacks:{},imConnection:null,_connectedSid:"",init:function(){var e,t=this,n=t.imConnection;n.addHandler=function(o,i,r,s,d,u,l){"function"!=typeof e&&(e=function(e){try{t.handleRtcMessage(e)}catch(n){throw a.error(n.stack||n),n}return!0},n.addHandler(e,c,"iq","set",null,null),n.addHandler(e,c,"iq","get",null,null)),n.context.stropheConn.addHandler(o,i,r,s,d,u,l)}},handleRtcMessage:function(e){var t=this,n=(e.getAttribute("id"),e.getAttribute("from")||"");n.lastIndexOf("/")>=0&&(n=n.substring(0,n.lastIndexOf("/")));var i=e.getElementsByTagName("rtkey")[0].innerHTML,c=e.getElementsByTagName("sid")[0].innerHTML;(t._fromSessionID||(t._fromSessionID={}))[n]=c;var s=e.getElementsByTagName("content"),d=(e.getElementsByTagName("stream_type")[0].innerHTML,s[0].innerHTML),u=o.parseJSON(d),l=u,f=u.tsxId;if(t.ctx=u.ctx,a.debug("Recv [op = "+l.op+"] [tsxId="+f+"]\r\n json :",e),n.indexOf("@")>=0)if(""==t._connectedSid&&102==l.op)t._connectedSid=c;else if(t._connectedSid!=c){if(102==l.op){var p=new r({to:n,rtKey:i,sid:c,success:function(e){a.debug("iq to server success",e)},fail:function(e){a.debug("iq to server error",e),t.onError(e)}}),C={data:{op:107,sessId:l.sessId,rtcId:l.rtcId,reason:"busy"},reason:"busy"};t.sendRtcMessage(p,C)}return}if(107==l.op&&(t._connectedSid="",t._fromSessionID={}),l.sdp&&("string"==typeof l.sdp&&(l.sdp=o.parseJSON(l.sdp)),l.sdp.type&&(l.sdp.type=l.sdp.type.toLowerCase())),l.cands){"string"==typeof l.cands&&(l.cands=o.parseJSON(l.cands));for(var g=0;g<l.cands.length;g++)"string"==typeof l.cands[g]&&(l.cands[g]=o.parseJSON(l.cands[g])),l.cands[g].sdpMLineIndex=l.cands[g].mlineindex,l.cands[g].sdpMid=l.cands[g].mid,delete l.cands[g].mlineindex,delete l.cands[g].mid}if(l.rtcCfg&&"string"==typeof l.rtcCfg&&(l.rtcCfg=o.parseJSON(l.rtcCfg)),l.rtcCfg2&&"string"==typeof l.rtcCfg2&&(l.rtcCfg2=o.parseJSON(l.rtcCfg2)),l.WebRTC&&"string"==typeof l.WebRTC&&(l.WebRTC=o.parseJSON(l.WebRTC)),f&&t._apiCallbacks[f])try{t._apiCallbacks[f].callback&&t._apiCallbacks[f].callback(n,l)}catch(S){throw S}finally{delete t._apiCallbacks[f]}else t.onRecvRtcMessage(n,l,i,f,c);return!0},onRecvRtcMessage:function(e,t,n,i,r){a.debug(" form : "+e+" \r\n json :"+o.stringifyJSON(rtcJSON))},convertRtcOptions:function(e){var t=e.data.sdp;if(t){var n={type:t.type,sdp:t.sdp};t=n,t.type=t.type.toUpperCase(),t=o.stringifyJSON(t),e.data.sdp=t}var a=e.data.cands;if(a){if(o.isArray(a));else{var i=[];i.push(a),a=i}for(var r in a)if(a[r]instanceof RTCIceCandidate){var c={type:"candidate",candidate:a[r].candidate,mlineindex:a[r].sdpMLineIndex,mid:a[r].sdpMid};a[r]=o.stringifyJSON(c)}e.data.cands=a}var s=e.data.rtcCfg;s&&"string"!=typeof s&&(e.data.rtcCfg=o.stringifyJSON(s));var d=e.data.WebRTC;d&&"string"!=typeof d&&(e.data.WebRTC=o.stringifyJSON(d))},sendRtcMessage:function(e,t,n){var i=this,r=i.imConnection,s=e.tsxId||r.getUniqueId(),d=e.to||r.domain,u=e.sid||i._fromSessionID&&i._fromSessionID[d];u=u||r.getUniqueId("CONFR_"),(i._fromSessionID||(i._fromSessionID={}))[d]=u,d.indexOf("@")>=0&&""==i._connectedSid&&102==t.data.op&&(i._connectedSid=u);var l=e.rtKey||e.rtkey;l||(l="");var f=e.rtflag;f||(f=1),t.data||(t.data={}),t.data.tsxId=s,i.ctx&&(t.data.ctx=i.ctx),i.convertRtcOptions(t);var p="VIDEO",C=e.id||r.getUniqueId("CONFR_"),g=$iq({id:C,to:d,from:r.context.jid,type:e.type||"get"}).c("query",{xmlns:c}).c("MediaReqExt").c("rtkey").t(l).up().c("rtflag").t(f).up().c("stream_type").t(p).up().c("sid").t(u).up().c("content").t(o.stringifyJSON(t.data));107==t.data.op&&t.reason&&g.up().c("reaseon").t(t.reason),a.debug("Send [op = "+t.data.op+"] : \r\n",g.tree()),n&&(i._apiCallbacks[s]={callback:n});var S=function(t){e.success(t)}||function(e){a.debug("send result. op:"+t.data.op+".",e)},b=function(t){e.fail(t)}||function(e){a.debug(e)};r.context.stropheConn.sendIQ(g.tree(),S,b),107==t.data.op&&i._connectedSid&&(e.sid&&i._connectedSid!=e.sid||(i._connectedSid="",i._fromSessionID={}))}},d=function(e){o.extend(!0,this,s,e||{}),this.init()};e.exports=d},233:function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=n(230),i=a.logger,r={rtFlag:1,success:function(e){},fail:function(e){}},c=function d(e){if(!(this instanceof d)){var t=function(e){var t=this;a.extend(!0,t,e||{})};return a.extend(!0,t.prototype,r,e||{}),t}var n=this;a.extend(!0,n,r,e||{})};t.RouteTo=c;var s={imConnection:null,rtcHandler:null,events:{0:"onReqP2P",1:"onNewCfr",2:"onDelCfr",3:"onReqTkt",100:"onPing",101:"onPong",102:"onInitC",103:"onReqC",104:"onAcptC",105:"onTcklC",106:"onAnsC",107:"onTermC",300:"onEvEnter",301:"onEvExit",302:"onEvPub",303:"onEvUnpub",304:"onEvMems",204:"onEvClose",onServerError:"onServerError"},register:function(e){if("object"===("undefined"==typeof e?"undefined":o(e)))for(var t in e)this.bind(t,e[t])},bind:function(e,t){var n,o=this;(n=o.events[e])?o[n]=t:(n=o.events[e]="on_"+e,o[n]=t)},jid:function(e){return/^.+#.+_.+@.+$/g.test(e)?e:this.imConnection.context.appKey+"_"+e+"@"+this.imConnection.domain},reqP2P:function(e,t,n,o,a){i.debug("req p2p ...");var r={data:{op:0,video:t,audio:n,peer:o}};this.rtcHandler.sendRtcMessage(e,r,a)},newCfr:function(e,t,n,o){i.debug("newCfr ...");var a=this,r={data:{op:1}};t&&(r.data.reqTkt=t),n&&(r.data.password=n),a.rtcHandler.sendRtcMessage(e,r,o)},enter:function(e,t,n,o,a,r,c){i.debug("enter ...");var s=this,d={data:{op:200}};t&&(d.data.WebRTCId=t),n&&(d.data.reqMembers=n),o&&(d.data.tkt=o),a&&(d.data.nonce=a),r&&(d.data.digest=r),s.rtcHandler.sendRtcMessage(e,d,c)},ping:function(e,t,n){i.debug("ping ...");var o=this,a={data:{op:100}};t&&(a.data.sessId=t),o.rtcHandler.sendRtcMessage(e,a,n)},reqTkt:function(e,t,n){i.debug("reqTkt ...");var o=this,a={data:{op:3}};t&&(a.data.WebRTCId=t),o.rtcHandler.sendRtcMessage(e,a,n)},initC:function(e,t,n,o,a,r,c,s,d,u,l,f){i.debug("initC ...");var p={data:{op:102}};t&&(p.data.WebRTCId=t),n&&(p.data.tkt=n),o&&(p.data.sessId=o),a&&(p.data.rtcId=a),r&&(p.data.pubS=r),c&&(p.data.subS=c),s&&(p.data.sdp=s),d&&(p.data.cands=d),u&&(p.data.rtcCfg=u),l&&(p.data.WebRTC=l),this.rtcHandler.sendRtcMessage(e,p,f)},tcklC:function(e,t,n,o,a,r){i.debug("tcklC ...");var c=this,s={data:{op:105}};t&&(s.data.sessId=t),n&&(s.data.rtcId=n),o&&(s.data.sdp=o),a&&(s.data.cands=a),c.rtcHandler.sendRtcMessage(e,s,r)},ansC:function(e,t,n,o,a,r){i.debug("ansC ...");var c=this,s={data:{op:106}};t&&(s.data.sessId=t),n&&(s.data.rtcId=n),o&&(s.data.sdp=o),a&&(s.data.cands=a),c.rtcHandler.sendRtcMessage(e,s,r)},acptC:function(e,t,n,o,a,r,c){i.debug("acptC ...");var s=this,d={data:{op:104}};t&&(d.data.sessId=t),n&&(d.data.rtcId=n),o&&(d.data.sdp=o),a&&(d.data.cands=a),r&&(d.data.ans=r),s.rtcHandler.sendRtcMessage(e,d,c)},getMems:function(e,t,n,o){i.debug("getMems ...");var a=this,r={data:{op:203}};t&&(r.data.WebRTCId=t),n&&(r.data.sessId=n),a.rtcHandler.sendRtcMessage(e,r,o)},subC:function(e,t,n,o,a){i.debug("subC ...");var r=this,c={data:{op:205}};t&&(c.data.sessId=t),n&&(c.data.rtcId=n),o&&(c.data.subS=o),r.rtcHandler.sendRtcMessage(e,c,a)},usubC:function(e,t,n,o){i.debug("usubC ...");var a=this,r={data:{op:206}};t&&(r.data.sessId=t),n&&(r.data.rtcId=n),a.rtcHandler.sendRtcMessage(e,r,o)},termC:function(e,t,n,o,a){i.debug("termC ...");var r=this,c={data:{op:107}};t&&(c.data.sessId=t),n&&(c.data.rtcId=n),o&&(c.reason=o),r.rtcHandler.sendRtcMessage(e,c,a)},exit:function(e,t,n,o){i.debug("exit ...");var a=this,r={data:{op:201}};t&&(r.data.WebRTCId=t),n&&(r.data.sessId=n),a.rtcHandler.sendRtcMessage(e,r,o)},delCfr:function(e,t,n,o){i.debug("delCfr ...");var a=this,r={data:{op:2}};t&&(r.data.WebRTCId=t),n&&(r.data.admtok=n),a.rtcHandler.sendRtcMessage(e,r,o)}};t.Api=function(e){function t(e,t,o,a,r){if(0!=t.result&&n.onServerError)n.onServerError.call(n,e,t,o,a,r);else{var c;n.events[t.op]&&(c=n[n.events[t.op]])?c.call(n,e,t,o,a,r):i.info("can not handle(recvRtcMessage) the op: "+t.op,t)}}var n=this;a.extend(!0,this,s,e||{}),this.rtcHandler.onRecvRtcMessage=t}},234:function(e,t,n){"use strict";var o=n(230),a=o.logger,i={headerSection:null,audioSection:null,videoSection:null,_parseHeaderSection:function(e){var t=e.indexOf("m=audio");return t>=0?e.slice(0,t):(t=e.indexOf("m=video"),t>=0?e.slice(0,t):e)},_parseAudioSection:function(e){var t=e.indexOf("m=audio");if(t>=0){var n=e.indexOf("m=video");return e.slice(t,0>n?e.length:n)}},_parseVideoSection:function(e){var t=e.indexOf("m=video");return t>=0?e.slice(t):void 0},spiltSection:function(e){var t=this;t.headerSection=t._parseHeaderSection(e),t.audioSection=t._parseAudioSection(e),t.videoSection=t._parseVideoSection(e)},removeSSRC:function(e){for(var t=[],n=e.split(/a=ssrc:[^\n]+/g),o=0;o<n.length;o++)"\n"!=n[o]&&t.push(n[o]);return t.join("\n")},updateHeaderMsidSemantic:function(e){var t=this,n="a=msid-semantic: WMS "+e,o=t.headerSection.split(/a=msid\-semantic: WMS.*/g),a=[];switch(o.length){case 1:a.push(o[0]);break;case 2:a.push(o[0]),a.push(n),a.push("\n");break;case 3:a.push(o[0]),a.push(n),a.push("\n"),a.push(o[2]),a.push("\n")}return t.headerSection=a.join("")},updateAudioSSRCSection:function(e,t,n,o){var a=this;a.audioSection&&(a.audioSection=a.removeSSRC(a.audioSection)+a.ssrcSection(e,t,n,o))},updateVideoSSRCSection:function(e,t,n,o){var a=this;a.videoSection&&(a.videoSection=a.removeSSRC(a.videoSection)+a.ssrcSection(e,t,n,o))},getUpdatedSDP:function(){var e=this,t="";return e.headerSection&&(t+=e.headerSection),e.audioSection&&(t+=e.audioSection),e.videoSection&&(t+=e.videoSection),t},parseMsidSemantic:function(e){var t=this,n=/a=msid\-semantic: WMS (\S+)/gi,o=t._parseLine(e,n);return o&&2==o.length&&(t.msidSemantic={line:o[0],WMS:o[1]}),t.msidSemantic},ssrcSection:function(e,t,n,o){var a=["a=ssrc:"+e+" cname:"+t,"a=ssrc:"+e+" msid:"+n+" "+o,"a=ssrc:"+e+" mslabel:"+n,"a=ssrc:"+e+" label:"+o,""];return a.join("\n")},parseSSRC:function(e){var t=this,n=new RegExp("a=(ssrc):(\\d+) (\\S+):(\\S+)","ig"),o=t._parseLine(e,n);if(o){for(var a={lines:[],updateSSRCSection:t.ssrcSection},i=0;i<o.length;i++){var r=o[i];if(r.indexOf("a=ssrc")>=0)a.lines.push(r);else switch(r){case"ssrc":case"cname":case"msid":case"mslabel":case"label":a[r]=o[++i]}}return a}},_parseLine:function(e,t){for(var n,o=[];null!=(n=t.exec(e));)for(var a=0;a<n.length;a++)o.push(n[a]);return o.length>0?o:void 0}},r=function(e){o.extend(this,i),this.spiltSection(e)},c={mediaStreamConstaints:{audio:!0,video:!0},localStream:null,rtcPeerConnection:null,offerOptions:{offerToReceiveAudio:1,offerToReceiveVideo:1},createMedia:function(e,t){function n(e){a.debug("[WebRTC-API] got local stream"),o.localStream=e;var n=o.localStream.getVideoTracks(),i=o.localStream.getAudioTracks();n.length>0&&a.debug("[WebRTC-API] Using video device: "+n[0].label),i.length>0&&a.debug("[WebRTC-API] Using audio device: "+i[0].label),t?t(o,e):o.onGotStream(e)}var o=this;return e&&"function"==typeof e&&(t=e,e=null),a.debug("[WebRTC-API] begin create media ......"),navigator.mediaDevices.getUserMedia(e||o.mediaStreamConstaints).then(n).then(o.onCreateMedia)["catch"](function(e){a.debug("[WebRTC-API] getUserMedia() error: ",e),o.onError(e)})},setLocalVideoSrcObject:function(e){this.onGotLocalStream(e),a.debug("[WebRTC-API] you can see yourself !")},createRtcPeerConnection:function(e){a.debug("[WebRTC-API] begin create RtcPeerConnection ......");var t=this;e?(!e.iceServers&&(e.iceServers=[]),e.rtcpMuxPolicy="require",e.bundlePolicy="max-bundle",e.relayOnly&&(e.iceTransportPolicy="relay")):e=null,a.debug("[WebRTC-API] RtcPeerConnection config:",e),t.startTime=window.performance.now();var n=t.rtcPeerConnection=new RTCPeerConnection(e);a.debug("[WebRTC-API] Created local peer connection object",n),n.onicecandidate=function(e){("icecandidate"!=e.type||null!=e.candidate&&!/ tcp /.test(e.candidate.candidate))&&t.onIceCandidate(e)},n.onicestatechange=function(e){t.onIceStateChange(e)},n.oniceconnectionstatechange=function(e){t.onIceStateChange(e)},n.onaddstream=function(e){t._onGotRemoteStream(e)}},_uploadLocalStream:function(){this.rtcPeerConnection.addStream(this.localStream),a.debug("[WebRTC-API] Added local stream to RtcPeerConnection")},createOffer:function(e,t){var n=this;return n._uploadLocalStream(),a.debug("[WebRTC-API] createOffer start..."),n.rtcPeerConnection.createOffer(n.offerOptions).then(function(t){n.offerDescription=t,a.debug("[WebRTC-API] Offer "),a.debug("[WebRTC-API] setLocalDescription start"),n.rtcPeerConnection.setLocalDescription(t).then(n.onSetLocalSessionDescriptionSuccess,n.onSetSessionDescriptionError).then(function(){(e||n.onCreateOfferSuccess)(t)})},t||n.onCreateSessionDescriptionError)},createPRAnswer:function(e,t){var n=this;return a.info(" createPRAnswer start"),n.rtcPeerConnection.createAnswer().then(function(t){a.debug("[WebRTC-API] _____________PRAnswer "),t.type="pranswer",t.sdp=t.sdp.replace(/a=recvonly/g,"a=inactive"),n.prAnswerDescription=t,a.debug("[WebRTC-API] inactive PRAnswer "),a.debug("[WebRTC-API] setLocalDescription start"),n.rtcPeerConnection.setLocalDescription(t).then(n.onSetLocalSuccess,n.onSetSessionDescriptionError).then(function(){var o=new r(t.sdp);o.updateHeaderMsidSemantic("MS_0000"),o.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),o.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=o.getUpdatedSDP(),a.debug("[WebRTC-API] Send PRAnswer "),(e||n.onCreatePRAnswerSuccess)(t)})},t||n.onCreateSessionDescriptionError)},createAnswer:function(e,t){var n=this;return n._uploadLocalStream(),a.info("[WebRTC-API] createAnswer start"),n.rtcPeerConnection.createAnswer().then(function(t){a.debug("[WebRTC-API] _____________________Answer "),t.type="answer";var o=new r(t.sdp),i=o.parseMsidSemantic(o.headerSection),c=o.parseSSRC(o.audioSection),s=o.parseSSRC(o.videoSection);o.updateAudioSSRCSection(1e3,"CHROME0000",i.WMS,c.label),o.updateVideoSSRCSection(2e3,"CHROME0000",i.WMS,s.label),t.sdp=o.getUpdatedSDP(),n.answerDescription=t,a.debug("[WebRTC-API] Answer "),a.debug("[WebRTC-API] setLocalDescription start"),n.rtcPeerConnection.setLocalDescription(t).then(n.onSetLocalSuccess,n.onSetSessionDescriptionError).then(function(){var o=new r(t.sdp);o.updateHeaderMsidSemantic("MS_0000"),o.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),o.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=o.getUpdatedSDP(),a.debug("[WebRTC-API] Send Answer "),(e||n.onCreateAnswerSuccess)(t)})},t||n.onCreateSessionDescriptionError)},close:function(){var e=this;try{e.rtcPeerConnection&&e.rtcPeerConnection.close()}catch(t){}e.localStream&&e.localStream.getTracks().forEach(function(e){e.stop()}),e.localStream=null},addIceCandidate:function(e){var t=this;if(t.rtcPeerConnection){a.debug("[WebRTC-API] Add ICE candidate: \n",e);var n=o.isArray(e)?e:[];!o.isArray(e)&&n.push(e);for(var i=0;i<n.length;i++)e=n[i],t.rtcPeerConnection.addIceCandidate(new RTCIceCandidate(e)).then(t.onAddIceCandidateSuccess,t.onAddIceCandidateError)}},setRemoteDescription:function(e){var t=this;return a.debug("[WebRTC-API] setRemoteDescription start. "),e=new RTCSessionDescription(e),t.rtcPeerConnection.setRemoteDescription(e).then(t.onSetRemoteSuccess,t.onSetSessionDescriptionError)},iceConnectionState:function(){var e=this;return e.rtcPeerConnection.iceConnectionState},onCreateMedia:function(){a.debug("[WebRTC-API] media created.")},_onGotRemoteStream:function(e){a.debug("[WebRTC-API] onGotRemoteStream.",e),this.onGotRemoteStream(e.stream),a.debug("[WebRTC-API] received remote stream, you will see the other.")},onGotStream:function(e){a.debug("[WebRTC-API] on got a local stream")},onSetRemoteSuccess:function(){a.info("[WebRTC-API] onSetRemoteSuccess complete")},onSetLocalSuccess:function(){a.info("[WebRTC-API] setLocalDescription complete")},onAddIceCandidateSuccess:function(){a.debug("[WebRTC-API] addIceCandidate success")},onAddIceCandidateError:function(e){a.debug("[WebRTC-API] failed to add ICE Candidate: "+e.toString())},onIceCandidate:function(e){a.debug("[WebRTC-API] onIceCandidate : ICE candidate: \n"+e.candidate)},onIceStateChange:function(e){a.debug("[WebRTC-API] onIceStateChange : ICE state change event: ",e)},onCreateSessionDescriptionError:function(e){a.error("[WebRTC-API] Failed to create session description: "+e.toString())},onCreateOfferSuccess:function(e){a.debug("[WebRTC-API] create offer success")},onCreatePRAnswerSuccess:function(e){a.debug("[WebRTC-API] create answer success")},onCreateAnswerSuccess:function(e){a.debug("[WebRTC-API] create answer success")},onSetSessionDescriptionError:function(e){a.error("[WebRTC-API] onSetSessionDescriptionError : Failed to set session description: "+e.toString())},onSetLocalSessionDescriptionSuccess:function(){a.debug("[WebRTC-API] onSetLocalSessionDescriptionSuccess : setLocalDescription complete")}};e.exports=function(e){o.extend(!0,this,c,e||{})}},235:function(e,t,n){"use strict";var o=n(230),a=n(233).RouteTo,i=o.logger,r=a({success:function(e){i.debug("iq to server success",e)},fail:function(e){i.debug("iq to server error",e)}}),c={_pingIntervalId:null,_p2pConfig:null,_rtcCfg:null,_rtcCfg2:null,_rtKey:null,_rtFlag:null,webRtc:null,api:null,callee:null,consult:!1,init:function(){var e=this;e.api.onPing=function(){e._onPing.apply(e,arguments)},e.api.onTcklC=function(){e._onTcklC.apply(e,arguments)},e.api.onAcptC=function(){e._onAcptC.apply(e,arguments)},e.api.onAnsC=function(){e._onAnsC.apply(e,arguments)},e.api.onTermC=function(){e._onTermC.apply(e,arguments)},e.webRtc.onIceCandidate=function(){e._onIceCandidate.apply(e,arguments)},e.webRtc.onIceStateChange=function(){e._onIceStateChange.apply(e,arguments)}},_ping:function(){function e(){var e=new r({to:t.callee,rtKey:t._rtKey});t.api.ping(e,t._sessId,function(e,t){i.debug("ping result",t)})}var t=this;t._pingIntervalId=window.setInterval(e,59e3)},_onPing:function(e,t,n,o,a){i.debug("_onPing from",a)},initC:function(e,t){var n=this;n.sid=t,n.createLocalMedia(e)},createLocalMedia:function(e){var t=this;t.consult=!1,this.webRtc.createMedia(e,function(e,n){e.setLocalVideoSrcObject(n),t.webRtc.createRtcPeerConnection(t._rtcCfg),t.webRtc.createOffer(function(e){t._onGotWebRtcOffer(e),t._onHandShake()})})},_onGotWebRtcOffer:function(e){var t=this,n=new r({sid:t.sid,to:t.callee,rtKey:t._rtKey});t.api.initC(n,null,null,t._sessId,t._rtcId,null,null,e,null,t._rtcCfg2,null,function(e,t){i.debug("initc result",t)}),t._ping()},_onAcptC:function(e,t){var n=this;t.ans&&1==t.ans&&(i.info("[WebRTC-API] _onAcptC : 104, ans = 1, it is a answer. will onAcceptCall"),n.onAcceptCall(e,t),n._onAnsC(e,t)),WebIM.WebRTC.supportPRAnswer?(i.info("[WebRTC-API] _onAcptC : recv pranswer. "),(t.sdp||t.cands)&&(t.sdp&&n.webRtc.setRemoteDescription(t.sdp),t.cands&&n._onTcklC(e,t),n.onAcceptCall(e,t))):(i.info("[WebRTC-API] _onAcptC : not supported pranswer. drop it. will onAcceptCall"),n.onAcceptCall(e,t))},onAcceptCall:function(e,t){},_onAnsC:function(e,t){var n=this;i.info("[WebRTC-API] _onAnsC : recv answer. "),t.sdp&&n.webRtc.setRemoteDescription(t.sdp),t.cands&&n._onTcklC(e,t)},_onInitC:function(e,t,n,o,a){var r=this;r.consult=!1,r.callee=e,r._rtcCfg2=t.rtcCfg,r._rtKey=n,r._tsxId=o,r._fromSid=a,r._rtcId=t.rtcId,r._sessId=t.sessId,r.webRtc.createRtcPeerConnection(r._rtcCfg2),t.cands&&r._onTcklC(e,t),t.sdp&&r.webRtc.setRemoteDescription(t.sdp).then(function(){r._onHandShake(e,t),WebIM.WebRTC.supportPRAnswer?r.webRtc.createPRAnswer(function(e){r._onGotWebRtcPRAnswer(e),setTimeout(function(){i.info("[WebRTC-API] onRinging : after send pranswer. ",r.callee),r.onRinging(r.callee)},500)}):(setTimeout(function(){i.info("[WebRTC-API] onRinging : After iniC, cause by: not supported pranswer. ",r.callee),r.onRinging(r.callee)},500),r._ping())})},_onGotWebRtcPRAnswer:function(e){var t=this,n=new r({to:t.callee,rtKey:t._rtKey});t.api.acptC(n,t._sessId,t._rtcId,e),t._ping()},onRinging:function(e){},accept:function(){function e(){i.info("createAndSendAnswer : ...... "),t.webRtc.createAnswer(function(e){var n=new r({to:t.callee,rtKey:t._rtKey});WebIM.WebRTC.supportPRAnswer?t.api.ansC(n,t._sessId,t._rtcId,e):t.api.acptC(n,t._sessId,t._rtcId,e,null,1)})}var t=this;t.webRtc.createMedia(function(t,n){t.setLocalVideoSrcObject(n),e()})},_onHandShake:function(e,t){var n=this;n.consult=!0,i.info("hand shake over. may switch cands."),t&&setTimeout(function(){n._onTcklC(e,t)},100),setTimeout(function(){n._onIceCandidate()},100)},_onTcklC:function(e,t){var n=this;if(n.consult)i.info("[WebRTC-API] recv and add cands."),n._recvCands&&n._recvCands.length>0&&n.webRtc.addIceCandidate(n._recvCands),t&&t.cands&&n.webRtc.addIceCandidate(t.cands);else if(t&&t.cands&&t.cands.length>0){for(var o=0;o<t.cands.length;o++)(n._recvCands||(n._recvCands=[])).push(t.cands[o]);i.debug("[_onTcklC] temporary memory[recv] ice candidate. util consult = true")}},_onIceStateChange:function(e){var t=this;e&&i.debug("[WebRTC-API] "+t.webRtc.iceConnectionState()+" |||| ice state is "+e.target.iceConnectionState),t.api.onIceConnectionStateChange(t.webRtc.iceConnectionState())},_onIceCandidate:function(e){var t=this;if(t.consult){var n=function(e){i.debug("send ice candidate...");var n=new r({to:t.callee,rtKey:t._rtKey});e&&t.api.tcklC(n,t._sessId,t._rtcId,null,e)};t._cands&&t._cands.length>0&&(n(t._cands),t._cands=[]),e&&e.candidate&&n(e.candidate)}else e&&e.candidate&&(t._cands||(t._cands=[])).push(e.candidate),i.debug("[_onIceCandidate] temporary memory[send] ice candidate. util consult = true")},termCall:function(e){var t=this;t._pingIntervalId&&window.clearInterval(t._pingIntervalId);var n=new r({to:t.callee,rtKey:t._rtKey});t.hangup||t.api.termC(n,t._sessId,t._rtcId,e),t.webRtc.close(),t.hangup=!0,t.onTermCall(e)},_onTermC:function(e,t){var n=this;n.hangup=!0,n.termCall(t.reason)},onTermCall:function(){}};e.exports=function(e){var t=this;o.extend(!0,this,c,e||{}),t.init()}}});